var ro=Object.defineProperty;var no=(e,t,s)=>t in e?ro(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var io=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var zs=(e,t,s)=>no(e,typeof t!="symbol"?t+"":t,s);import{r as p,b as ao,u as oo,d as ke,L as kt,O as lo,e as co,N as ho,R as uo,f as fo}from"./vendor-4YBsvtOL.js";import{L as J,f as Ps,b as qt,l as cn,a as Ft,c as mo,d as Si,p as go,e as po}from"./map-EM7m49nP.js";var I1=io(O=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Ii={exports:{}},js={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vo=p,yo=Symbol.for("react.element"),xo=Symbol.for("react.fragment"),bo=Object.prototype.hasOwnProperty,_o=vo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wo={key:!0,ref:!0,__self:!0,__source:!0};function Ci(e,t,s){var r,n={},i=null,a=null;s!==void 0&&(i=""+s),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)bo.call(t,r)&&!wo.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:yo,type:e,key:i,ref:a,props:n,_owner:_o.current}}js.Fragment=xo;js.jsx=Ci;js.jsxs=Ci;Ii.exports=js;var c=Ii.exports,lr={},hn=ao;lr.createRoot=hn.createRoot,lr.hydrateRoot=hn.hydrateRoot;var un={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ai=function(e){const t=[];let s=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t[s++]=n:n<2048?(t[s++]=n>>6|192,t[s++]=n&63|128):(n&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(n=65536+((n&1023)<<10)+(e.charCodeAt(++r)&1023),t[s++]=n>>18|240,t[s++]=n>>12&63|128,t[s++]=n>>6&63|128,t[s++]=n&63|128):(t[s++]=n>>12|224,t[s++]=n>>6&63|128,t[s++]=n&63|128)}return t},Mo=function(e){const t=[];let s=0,r=0;for(;s<e.length;){const n=e[s++];if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){const i=e[s++];t[r++]=String.fromCharCode((n&31)<<6|i&63)}else if(n>239&&n<365){const i=e[s++],a=e[s++],o=e[s++],l=((n&7)<<18|(i&63)<<12|(a&63)<<6|o&63)-65536;t[r++]=String.fromCharCode(55296+(l>>10)),t[r++]=String.fromCharCode(56320+(l&1023))}else{const i=e[s++],a=e[s++];t[r++]=String.fromCharCode((n&15)<<12|(i&63)<<6|a&63)}}return t.join("")},ki={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let n=0;n<e.length;n+=3){const i=e[n],a=n+1<e.length,o=a?e[n+1]:0,l=n+2<e.length,h=l?e[n+2]:0,d=i>>2,u=(i&3)<<4|o>>4;let f=(o&15)<<2|h>>6,m=h&63;l||(m=64,a||(f=64)),r.push(s[d],s[u],s[f],s[m])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ai(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Mo(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let n=0;n<e.length;){const i=s[e.charAt(n++)],o=n<e.length?s[e.charAt(n)]:0;++n;const h=n<e.length?s[e.charAt(n)]:64;++n;const u=n<e.length?s[e.charAt(n)]:64;if(++n,i==null||o==null||h==null||u==null)throw new Eo;const f=i<<2|o>>4;if(r.push(f),h!==64){const m=o<<4&240|h>>2;if(r.push(m),u!==64){const v=h<<6&192|u;r.push(v)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Eo extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const No=function(e){const t=Ai(e);return ki.encodeByteArray(t,!0)},vs=function(e){return No(e).replace(/\./g,"")},Ti=function(e){try{return ki.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io=()=>So().__FIREBASE_DEFAULTS__,Co=()=>{if(typeof process>"u"||typeof un>"u")return;const e=un.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Ao=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Ti(e[1]);return t&&JSON.parse(t)},kr=()=>{try{return Io()||Co()||Ao()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Ri=e=>{var t,s;return(s=(t=kr())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[e]},ko=e=>{const t=Ri(e);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),r]:[t.substring(0,s),r]},Pi=()=>{var e;return(e=kr())===null||e===void 0?void 0:e.config},ji=e=>{var t;return(t=kr())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,r)=>{s?this.reject(s):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ro(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[vs(JSON.stringify(s)),vs(JSON.stringify(a)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Po(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(se())}function jo(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Oo(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Lo(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Do(){const e=se();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Fo(){try{return typeof indexedDB=="object"}catch{return!1}}function $o(){return new Promise((e,t)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(r);n.onsuccess=()=>{n.result.close(),s||self.indexedDB.deleteDatabase(r),e(!0)},n.onupgradeneeded=()=>{s=!1},n.onerror=()=>{var i;t(((i=n.error)===null||i===void 0?void 0:i.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="FirebaseError";class Te extends Error{constructor(t,s,r){super(s),this.code=t,this.customData=r,this.name=Uo,Object.setPrototypeOf(this,Te.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wt.prototype.create)}}class Wt{constructor(t,s,r){this.service=t,this.serviceName=s,this.errors=r}create(t,...s){const r=s[0]||{},n=`${this.service}/${t}`,i=this.errors[t],a=i?Bo(i,r):"Error",o=`${this.serviceName}: ${a} (${n}).`;return new Te(n,o,r)}}function Bo(e,t){return e.replace(Vo,(s,r)=>{const n=t[r];return n!=null?String(n):`<${r}?>`})}const Vo=/\{\$([^}]+)}/g;function Go(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ys(e,t){if(e===t)return!0;const s=Object.keys(e),r=Object.keys(t);for(const n of s){if(!r.includes(n))return!1;const i=e[n],a=t[n];if(dn(i)&&dn(a)){if(!ys(i,a))return!1}else if(i!==a)return!1}for(const n of r)if(!s.includes(n))return!1;return!0}function dn(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(e){const t=[];for(const[s,r]of Object.entries(e))Array.isArray(r)?r.forEach(n=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Ho(e,t){const s=new zo(e,t);return s.subscribe.bind(s)}class zo{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,r){let n;if(t===void 0&&s===void 0&&r===void 0)throw new Error("Missing Observer.");qo(t,["next","error","complete"])?n=t:n={next:t,error:s,complete:r},n.next===void 0&&(n.next=qs),n.error===void 0&&(n.error=qs),n.complete===void 0&&(n.complete=qs);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch{}}),this.observers.push(n),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function qo(e,t){if(typeof e!="object"||e===null)return!1;for(const s of t)if(s in e&&typeof e[s]=="function")return!0;return!1}function qs(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(e){return e&&e._delegate?e._delegate:e}class Ze{constructor(t,s,r){this.name=t,this.instanceFactory=s,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const We="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const r=new To;if(this.instancesDeferred.set(s,r),this.isInitialized(s)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:s});n&&r.resolve(n)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const r=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),n=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Ko(t))try{this.getOrInitializeService({instanceIdentifier:We})}catch{}for(const[s,r]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(s);try{const i=this.getOrInitializeService({instanceIdentifier:n});r.resolve(i)}catch{}}}}clearInstance(t=We){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=We){return this.instances.has(t)}getOptions(t=We){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:s});for(const[i,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(i);r===o&&a.resolve(n)}return n}onInit(t,s){var r;const n=this.normalizeInstanceIdentifier(s),i=(r=this.onInitCallbacks.get(n))!==null&&r!==void 0?r:new Set;i.add(t),this.onInitCallbacks.set(n,i);const a=this.instances.get(n);return a&&t(a,n),()=>{i.delete(t)}}invokeOnInitCallbacks(t,s){const r=this.onInitCallbacks.get(s);if(r)for(const n of r)try{n(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Jo(t),options:s}),this.instances.set(t,r),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=We){return this.component?this.component.multipleInstances?t:We:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Jo(e){return e===We?void 0:e}function Ko(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new Wo(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var z;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(z||(z={}));const Zo={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},Qo=z.INFO,Yo={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},el=(e,t,...s)=>{if(t<e.logLevel)return;const r=new Date().toISOString(),n=Yo[t];if(n)console[n](`[${r}]  ${e.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Oi{constructor(t){this.name=t,this._logLevel=Qo,this._logHandler=el,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Zo[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}}const tl=(e,t)=>t.some(s=>e instanceof s);let fn,mn;function sl(){return fn||(fn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rl(){return mn||(mn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Li=new WeakMap,cr=new WeakMap,Di=new WeakMap,Ws=new WeakMap,Tr=new WeakMap;function nl(e){const t=new Promise((s,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{s($e(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(s=>{s instanceof IDBCursor&&Li.set(s,e)}).catch(()=>{}),Tr.set(t,e),t}function il(e){if(cr.has(e))return;const t=new Promise((s,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{s(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});cr.set(e,t)}let hr={get(e,t,s){if(e instanceof IDBTransaction){if(t==="done")return cr.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Di.get(e);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return $e(e[t])},set(e,t,s){return e[t]=s,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function al(e){hr=e(hr)}function ol(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const r=e.call(Js(this),t,...s);return Di.set(r,t.sort?t.sort():[t]),$e(r)}:rl().includes(e)?function(...t){return e.apply(Js(this),t),$e(Li.get(this))}:function(...t){return $e(e.apply(Js(this),t))}}function ll(e){return typeof e=="function"?ol(e):(e instanceof IDBTransaction&&il(e),tl(e,sl())?new Proxy(e,hr):e)}function $e(e){if(e instanceof IDBRequest)return nl(e);if(Ws.has(e))return Ws.get(e);const t=ll(e);return t!==e&&(Ws.set(e,t),Tr.set(t,e)),t}const Js=e=>Tr.get(e);function cl(e,t,{blocked:s,upgrade:r,blocking:n,terminated:i}={}){const a=indexedDB.open(e,t),o=$e(a);return r&&a.addEventListener("upgradeneeded",l=>{r($e(a.result),l.oldVersion,l.newVersion,$e(a.transaction),l)}),s&&a.addEventListener("blocked",l=>s(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",h=>n(h.oldVersion,h.newVersion,h))}).catch(()=>{}),o}const hl=["get","getKey","getAll","getAllKeys","count"],ul=["put","add","delete","clear"],Ks=new Map;function gn(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Ks.get(t))return Ks.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,n=ul.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(n||hl.includes(s)))return;const i=async function(a,...o){const l=this.transaction(a,n?"readwrite":"readonly");let h=l.store;return r&&(h=h.index(o.shift())),(await Promise.all([h[s](...o),n&&l.done]))[0]};return Ks.set(t,i),i}al(e=>({...e,get:(t,s,r)=>gn(t,s)||e.get(t,s,r),has:(t,s)=>!!gn(t,s)||e.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(fl(s)){const r=s.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(s=>s).join(" ")}}function fl(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const ur="@firebase/app",pn="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ce=new Oi("@firebase/app"),ml="@firebase/app-compat",gl="@firebase/analytics-compat",pl="@firebase/analytics",vl="@firebase/app-check-compat",yl="@firebase/app-check",xl="@firebase/auth",bl="@firebase/auth-compat",_l="@firebase/database",wl="@firebase/data-connect",Ml="@firebase/database-compat",El="@firebase/functions",Nl="@firebase/functions-compat",Sl="@firebase/installations",Il="@firebase/installations-compat",Cl="@firebase/messaging",Al="@firebase/messaging-compat",kl="@firebase/performance",Tl="@firebase/performance-compat",Rl="@firebase/remote-config",Pl="@firebase/remote-config-compat",jl="@firebase/storage",Ol="@firebase/storage-compat",Ll="@firebase/firestore",Dl="@firebase/vertexai-preview",Fl="@firebase/firestore-compat",$l="firebase",Ul="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dr="[DEFAULT]",Bl={[ur]:"fire-core",[ml]:"fire-core-compat",[pl]:"fire-analytics",[gl]:"fire-analytics-compat",[yl]:"fire-app-check",[vl]:"fire-app-check-compat",[xl]:"fire-auth",[bl]:"fire-auth-compat",[_l]:"fire-rtdb",[wl]:"fire-data-connect",[Ml]:"fire-rtdb-compat",[El]:"fire-fn",[Nl]:"fire-fn-compat",[Sl]:"fire-iid",[Il]:"fire-iid-compat",[Cl]:"fire-fcm",[Al]:"fire-fcm-compat",[kl]:"fire-perf",[Tl]:"fire-perf-compat",[Rl]:"fire-rc",[Pl]:"fire-rc-compat",[jl]:"fire-gcs",[Ol]:"fire-gcs-compat",[Ll]:"fire-fst",[Fl]:"fire-fst-compat",[Dl]:"fire-vertex","fire-js":"fire-js",[$l]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xs=new Map,Vl=new Map,fr=new Map;function vn(e,t){try{e.container.addComponent(t)}catch(s){Ce.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,s)}}function ft(e){const t=e.name;if(fr.has(t))return Ce.debug(`There were multiple attempts to register component ${t}.`),!1;fr.set(t,e);for(const s of xs.values())vn(s,e);for(const s of Vl.values())vn(s,e);return!0}function Rr(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function Ee(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gl={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ue=new Wt("app","Firebase",Gl);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(t,s,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ze("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ue.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt=Ul;function Fi(e,t={}){let s=e;typeof t!="object"&&(t={name:t});const r=Object.assign({name:dr,automaticDataCollectionEnabled:!1},t),n=r.name;if(typeof n!="string"||!n)throw Ue.create("bad-app-name",{appName:String(n)});if(s||(s=Pi()),!s)throw Ue.create("no-options");const i=xs.get(n);if(i){if(ys(s,i.options)&&ys(r,i.config))return i;throw Ue.create("duplicate-app",{appName:n})}const a=new Xo(n);for(const l of fr.values())a.addComponent(l);const o=new Hl(s,r,a);return xs.set(n,o),o}function $i(e=dr){const t=xs.get(e);if(!t&&e===dr&&Pi())return Fi();if(!t)throw Ue.create("no-app",{appName:e});return t}function Be(e,t,s){var r;let n=(r=Bl[e])!==null&&r!==void 0?r:e;s&&(n+=`-${s}`);const i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const o=[`Unable to register library "${n}" with version "${t}":`];i&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&o.push("and"),a&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ce.warn(o.join(" "));return}ft(new Ze(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl="firebase-heartbeat-database",ql=1,$t="firebase-heartbeat-store";let Xs=null;function Ui(){return Xs||(Xs=cl(zl,ql,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore($t)}catch(s){console.warn(s)}}}}).catch(e=>{throw Ue.create("idb-open",{originalErrorMessage:e.message})})),Xs}async function Wl(e){try{const s=(await Ui()).transaction($t),r=await s.objectStore($t).get(Bi(e));return await s.done,r}catch(t){if(t instanceof Te)Ce.warn(t.message);else{const s=Ue.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Ce.warn(s.message)}}}async function yn(e,t){try{const r=(await Ui()).transaction($t,"readwrite");await r.objectStore($t).put(t,Bi(e)),await r.done}catch(s){if(s instanceof Te)Ce.warn(s.message);else{const r=Ue.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Ce.warn(r.message)}}}function Bi(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl=1024,Kl=30*24*60*60*1e3;class Xl{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Ql(s),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var t,s;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=xn();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const o=new Date(a.date).valueOf();return Date.now()-o<=Kl}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Ce.warn(r)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=xn(),{heartbeatsToSend:r,unsentEntries:n}=Zl(this._heartbeatsCache.heartbeats),i=vs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=s,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(s){return Ce.warn(s),""}}}function xn(){return new Date().toISOString().substring(0,10)}function Zl(e,t=Jl){const s=[];let r=e.slice();for(const n of e){const i=s.find(a=>a.agent===n.agent);if(i){if(i.dates.push(n.date),bn(s)>t){i.dates.pop();break}}else if(s.push({agent:n.agent,dates:[n.date]}),bn(s)>t){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}class Ql{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Fo()?$o().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await Wl(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const n=await this.read();return yn(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const n=await this.read();return yn(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function bn(e){return vs(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yl(e){ft(new Ze("platform-logger",t=>new dl(t),"PRIVATE")),ft(new Ze("heartbeat",t=>new Xl(t),"PRIVATE")),Be(ur,pn,e),Be(ur,pn,"esm2017"),Be("fire-js","")}Yl("");function Pr(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]]);return s}function Vi(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ec=Vi,Gi=new Wt("auth","Firebase",Vi());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs=new Oi("@firebase/auth");function tc(e,...t){bs.logLevel<=z.WARN&&bs.warn(`Auth (${xt}): ${e}`,...t)}function cs(e,...t){bs.logLevel<=z.ERROR&&bs.error(`Auth (${xt}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(e,...t){throw Or(e,...t)}function de(e,...t){return Or(e,...t)}function jr(e,t,s){const r=Object.assign(Object.assign({},ec()),{[t]:s});return new Wt("auth","Firebase",r).create(t,{appName:e.name})}function Ke(e){return jr(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sc(e,t,s){const r=s;if(!(t instanceof r))throw r.name!==t.constructor.name&&xe(e,"argument-error"),jr(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Or(e,...t){if(typeof e!="string"){const s=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(s,...r)}return Gi.create(e,...t)}function L(e,t,...s){if(!e)throw Or(t,...s)}function Ne(e){const t="INTERNAL ASSERTION FAILED: "+e;throw cs(t),new Error(t)}function Ae(e,t){e||Ne(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mr(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function rc(){return _n()==="http:"||_n()==="https:"}function _n(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rc()||Oo()||"connection"in navigator)?navigator.onLine:!0}function ic(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(t,s){this.shortDelay=t,this.longDelay=s,Ae(s>t,"Short delay should be less than long delay!"),this.isMobile=Po()||Lo()}get(){return nc()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(e,t){Ae(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{static initialize(t,s,r){this.fetchImpl=t,s&&(this.headersImpl=s),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ne("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ne("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ne("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc=new Kt(3e4,6e4);function Dr(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function bt(e,t,s,r,n={}){return zi(e,n,async()=>{let i={},a={};r&&(t==="GET"?a=r:i={body:JSON.stringify(r)});const o=Jt(Object.assign({key:e.config.apiKey},a)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const h=Object.assign({method:t,headers:l},i);return jo()||(h.referrerPolicy="no-referrer"),Hi.fetch()(qi(e,e.config.apiHost,s,o),h)})}async function zi(e,t,s){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},ac),t);try{const n=new cc(e),i=await Promise.race([s(),n.promise]);n.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw is(e,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const o=i.ok?a.errorMessage:a.error.message,[l,h]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw is(e,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw is(e,"email-already-in-use",a);if(l==="USER_DISABLED")throw is(e,"user-disabled",a);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw jr(e,d,h);xe(e,d)}}catch(n){if(n instanceof Te)throw n;xe(e,"network-request-failed",{message:String(n)})}}async function lc(e,t,s,r,n={}){const i=await bt(e,t,s,r,n);return"mfaPendingCredential"in i&&xe(e,"multi-factor-auth-required",{_serverResponse:i}),i}function qi(e,t,s,r){const n=`${t}${s}?${r}`;return e.config.emulator?Lr(e.config,n):`${e.config.apiScheme}://${n}`}class cc{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,r)=>{this.timer=setTimeout(()=>r(de(this.auth,"network-request-failed")),oc.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function is(e,t,s){const r={appName:e.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const n=de(e,t,r);return n.customData._tokenResponse=s,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hc(e,t){return bt(e,"POST","/v1/accounts:delete",t)}async function Wi(e,t){return bt(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function uc(e,t=!1){const s=Re(e),r=await s.getIdToken(t),n=Fr(r);L(n&&n.exp&&n.auth_time&&n.iat,s.auth,"internal-error");const i=typeof n.firebase=="object"?n.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:n,token:r,authTime:Tt(Zs(n.auth_time)),issuedAtTime:Tt(Zs(n.iat)),expirationTime:Tt(Zs(n.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Zs(e){return Number(e)*1e3}function Fr(e){const[t,s,r]=e.split(".");if(t===void 0||s===void 0||r===void 0)return cs("JWT malformed, contained fewer than 3 sections"),null;try{const n=Ti(s);return n?JSON.parse(n):(cs("Failed to decode base64 JWT payload"),null)}catch(n){return cs("Caught error parsing JWT payload as JSON",n==null?void 0:n.toString()),null}}function wn(e){const t=Fr(e);return L(t,"internal-error"),L(typeof t.exp<"u","internal-error"),L(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ut(e,t,s=!1){if(s)return t;try{return await t}catch(r){throw r instanceof Te&&dc(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}function dc({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const n=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,n)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tt(this.lastLoginAt),this.creationTime=Tt(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _s(e){var t;const s=e.auth,r=await e.getIdToken(),n=await Ut(e,Wi(s,{idToken:r}));L(n==null?void 0:n.users.length,s,"internal-error");const i=n.users[0];e._notifyReloadListener(i);const a=!((t=i.providerUserInfo)===null||t===void 0)&&t.length?Ji(i.providerUserInfo):[],o=gc(e.providerData,a),l=e.isAnonymous,h=!(e.email&&i.passwordHash)&&!(o!=null&&o.length),d=l?h:!1,u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new gr(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,u)}async function mc(e){const t=Re(e);await _s(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function gc(e,t){return[...e.filter(r=>!t.some(n=>n.providerId===r.providerId)),...t]}function Ji(e){return e.map(t=>{var{providerId:s}=t,r=Pr(t,["providerId"]);return{providerId:s,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pc(e,t){const s=await zi(e,{},async()=>{const r=Jt({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,a=qi(e,n,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Hi.fetch()(a,{method:"POST",headers:o,body:r})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function vc(e,t){return bt(e,"POST","/v2/accounts:revokeToken",Dr(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){L(t.idToken,"internal-error"),L(typeof t.idToken<"u","internal-error"),L(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):wn(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){L(t.length!==0,"internal-error");const s=wn(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(L(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:r,refreshToken:n,expiresIn:i}=await pc(t,s);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(t,s,r){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(t,s){const{refreshToken:r,accessToken:n,expirationTime:i}=s,a=new lt;return r&&(L(typeof r=="string","internal-error",{appName:t}),a.refreshToken=r),n&&(L(typeof n=="string","internal-error",{appName:t}),a.accessToken=n),i&&(L(typeof i=="number","internal-error",{appName:t}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new lt,this.toJSON())}_performRefresh(){return Ne("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(e,t){L(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Se{constructor(t){var{uid:s,auth:r,stsTokenManager:n}=t,i=Pr(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fc(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new gr(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const s=await Ut(this,this.stsTokenManager.getToken(this.auth,t));return L(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return uc(this,t)}reload(){return mc(this)}_assign(t){this!==t&&(L(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new Se(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let r=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),s&&await _s(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ee(this.auth.app))return Promise.reject(Ke(this.auth));const t=await this.getIdToken();return await Ut(this,hc(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var r,n,i,a,o,l,h,d;const u=(r=s.displayName)!==null&&r!==void 0?r:void 0,f=(n=s.email)!==null&&n!==void 0?n:void 0,m=(i=s.phoneNumber)!==null&&i!==void 0?i:void 0,v=(a=s.photoURL)!==null&&a!==void 0?a:void 0,x=(o=s.tenantId)!==null&&o!==void 0?o:void 0,g=(l=s._redirectEventId)!==null&&l!==void 0?l:void 0,w=(h=s.createdAt)!==null&&h!==void 0?h:void 0,_=(d=s.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:y,emailVerified:M,isAnonymous:b,providerData:E,stsTokenManager:N}=s;L(y&&N,t,"internal-error");const I=lt.fromJSON(this.name,N);L(typeof y=="string",t,"internal-error"),Oe(u,t.name),Oe(f,t.name),L(typeof M=="boolean",t,"internal-error"),L(typeof b=="boolean",t,"internal-error"),Oe(m,t.name),Oe(v,t.name),Oe(x,t.name),Oe(g,t.name),Oe(w,t.name),Oe(_,t.name);const A=new Se({uid:y,auth:t,email:f,emailVerified:M,displayName:u,isAnonymous:b,photoURL:v,phoneNumber:m,tenantId:x,stsTokenManager:I,createdAt:w,lastLoginAt:_});return E&&Array.isArray(E)&&(A.providerData=E.map(R=>Object.assign({},R))),g&&(A._redirectEventId=g),A}static async _fromIdTokenResponse(t,s,r=!1){const n=new lt;n.updateFromServerResponse(s);const i=new Se({uid:s.localId,auth:t,stsTokenManager:n,isAnonymous:r});return await _s(i),i}static async _fromGetAccountInfoResponse(t,s,r){const n=s.users[0];L(n.localId!==void 0,"internal-error");const i=n.providerUserInfo!==void 0?Ji(n.providerUserInfo):[],a=!(n.email&&n.passwordHash)&&!(i!=null&&i.length),o=new lt;o.updateFromIdToken(r);const l=new Se({uid:n.localId,auth:t,stsTokenManager:o,isAnonymous:a}),h={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new gr(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,h),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=new Map;function Ie(e){Ae(e instanceof Function,"Expected a class definition");let t=Mn.get(e);return t?(Ae(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Mn.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Ki.type="NONE";const En=Ki;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(e,t,s){return`firebase:${e}:${t}:${s}`}class ct{constructor(t,s,r){this.persistence=t,this.auth=s,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=hs(this.userKey,n.apiKey,i),this.fullPersistenceKey=hs("persistence",n.apiKey,i),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Se._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,r="authUser"){if(!s.length)return new ct(Ie(En),t,r);const n=(await Promise.all(s.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=n[0]||Ie(En);const a=hs(r,t.config.apiKey,t.name);let o=null;for(const h of s)try{const d=await h._get(a);if(d){const u=Se._fromJSON(t,d);h!==i&&(o=u),i=h;break}}catch{}const l=n.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ct(i,t,r):(i=l[0],o&&await i._set(a,o.toJSON()),await Promise.all(s.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new ct(i,t,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Yi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Xi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ta(t))return"Blackberry";if(sa(t))return"Webos";if(Zi(t))return"Safari";if((t.includes("chrome/")||Qi(t))&&!t.includes("edge/"))return"Chrome";if(ea(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(s);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Xi(e=se()){return/firefox\//i.test(e)}function Zi(e=se()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Qi(e=se()){return/crios\//i.test(e)}function Yi(e=se()){return/iemobile/i.test(e)}function ea(e=se()){return/android/i.test(e)}function ta(e=se()){return/blackberry/i.test(e)}function sa(e=se()){return/webos/i.test(e)}function $r(e=se()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function yc(e=se()){var t;return $r(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function xc(){return Do()&&document.documentMode===10}function ra(e=se()){return $r(e)||ea(e)||sa(e)||ta(e)||/windows phone/i.test(e)||Yi(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function na(e,t=[]){let s;switch(e){case"Browser":s=Nn(se());break;case"Worker":s=`${Nn(se())}-${e}`;break;default:s=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${xt}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const r=i=>new Promise((a,o)=>{try{const l=t(i);a(l)}catch(l){o(l)}});r.onAbort=s,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const r of this.queue)await r(t),r.onAbort&&s.push(r.onAbort)}catch(r){s.reverse();for(const n of s)try{n()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _c(e,t={}){return bt(e,"GET","/v2/passwordPolicy",Dr(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc=6;class Mc{constructor(t){var s,r,n,i;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=a.minPasswordLength)!==null&&s!==void 0?s:wc,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(n=(r=t.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&n!==void 0?n:"",this.forceUpgradeOnSignin=(i=t.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,r,n,i,a,o;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(s=l.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(n=l.containsLowercaseLetter)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(o=l.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),l}validatePasswordLengthOptions(t,s){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(s.meetsMinPasswordLength=t.length>=r),n&&(s.meetsMaxPasswordLength=t.length<=n)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let r;for(let n=0;n<t.length;n++)r=t.charAt(n),this.updatePasswordCharacterOptionsStatuses(s,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(t,s,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(t,s,r,n){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Sn(this),this.idTokenSubscription=new Sn(this),this.beforeStateQueue=new bc(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gi,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=Ie(s)),this._initializationPromise=this.queue(async()=>{var r,n;if(!this._deleted&&(this.persistenceManager=await ct.create(this,t),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((n=this.currentUser)===null||n===void 0?void 0:n.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Wi(this,{idToken:t}),r=await Se._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(r)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(Ee(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let n=r,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,o=n==null?void 0:n._redirectEventId,l=await this.tryRedirectSignIn(t);(!a||a===o)&&(l!=null&&l.user)&&(n=l.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(a){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return L(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await _s(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=ic()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ee(this.app))return Promise.reject(Ke(this));const s=t?Re(t):null;return s&&L(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&L(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ee(this.app)?Promise.reject(Ke(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ee(this.app)?Promise.reject(Ke(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ie(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await _c(this),s=new Mc(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Wt("auth","Firebase",t())}onAuthStateChanged(t,s,r){return this.registerStateListener(this.authStateSubscription,t,s,r)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,r){return this.registerStateListener(this.idTokenSubscription,t,s,r)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const r=this.onAuthStateChanged(()=>{r(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(r.tenantId=this.tenantId),await vc(this,r)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const r=await this.getOrInitRedirectPersistenceManager(s);return t===null?r.removeCurrentUser():r.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&Ie(t)||this._popupRedirectResolver;L(s,this,"argument-error"),this.redirectPersistenceManager=await ct.create(this,[Ie(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,r;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,r,n){if(this._deleted)return()=>{};const i=typeof s=="function"?s:s.next.bind(s);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),typeof s=="function"){const l=t.addObserver(s,r,n);return()=>{a=!0,l()}}else{const l=t.addObserver(s);return()=>{a=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=na(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const r=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());r&&(s["X-Firebase-Client"]=r);const n=await this._getAppCheckToken();return n&&(s["X-Firebase-AppCheck"]=n),s}async _getAppCheckToken(){var t;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&tc(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Os(e){return Re(e)}class Sn{constructor(t){this.auth=t,this.observer=null,this.addObserver=Ho(s=>this.observer=s)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ur={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Nc(e){Ur=e}function Sc(e){return Ur.loadJS(e)}function Ic(){return Ur.gapiScript}function Cc(e){return`__${e}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ac(e,t){const s=Rr(e,"auth");if(s.isInitialized()){const n=s.getImmediate(),i=s.getOptions();if(ys(i,t??{}))return n;xe(n,"already-initialized")}return s.initialize({options:t})}function kc(e,t){const s=(t==null?void 0:t.persistence)||[],r=(Array.isArray(s)?s:[s]).map(Ie);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t==null?void 0:t.popupRedirectResolver)}function Tc(e,t,s){const r=Os(e);L(r._canInitEmulator,r,"emulator-config-failed"),L(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const n=!1,i=ia(t),{host:a,port:o}=Rc(t),l=o===null?"":`:${o}`;r.config.emulator={url:`${i}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:n})}),Pc()}function ia(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Rc(e){const t=ia(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(r);if(n){const i=n[1];return{host:i,port:In(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:In(a)}}}function In(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function Pc(){function e(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return Ne("not implemented")}_getIdTokenResponse(t){return Ne("not implemented")}_linkToIdToken(t,s){return Ne("not implemented")}_getReauthenticationResolver(t){return Ne("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ht(e,t){return lc(e,"POST","/v1/accounts:signInWithIdp",Dr(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc="http://localhost";class Qe extends aa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new Qe(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):xe("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:r,signInMethod:n}=s,i=Pr(s,["providerId","signInMethod"]);if(!r||!n)return null;const a=new Qe(r,n);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(t){const s=this.buildRequest();return ht(t,s)}_linkToIdToken(t,s){const r=this.buildRequest();return r.idToken=s,ht(t,r)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,ht(t,s)}buildRequest(){const t={requestUri:jc,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=Jt(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt extends Br{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le extends Xt{constructor(){super("facebook.com")}static credential(t){return Qe._fromParams({providerId:Le.PROVIDER_ID,signInMethod:Le.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Le.credentialFromTaggedObject(t)}static credentialFromError(t){return Le.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Le.credential(t.oauthAccessToken)}catch{return null}}}Le.FACEBOOK_SIGN_IN_METHOD="facebook.com";Le.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me extends Xt{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return Qe._fromParams({providerId:Me.PROVIDER_ID,signInMethod:Me.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Me.credentialFromTaggedObject(t)}static credentialFromError(t){return Me.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:r}=t;if(!s&&!r)return null;try{return Me.credential(s,r)}catch{return null}}}Me.GOOGLE_SIGN_IN_METHOD="google.com";Me.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De extends Xt{constructor(){super("github.com")}static credential(t){return Qe._fromParams({providerId:De.PROVIDER_ID,signInMethod:De.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return De.credentialFromTaggedObject(t)}static credentialFromError(t){return De.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return De.credential(t.oauthAccessToken)}catch{return null}}}De.GITHUB_SIGN_IN_METHOD="github.com";De.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe extends Xt{constructor(){super("twitter.com")}static credential(t,s){return Qe._fromParams({providerId:Fe.PROVIDER_ID,signInMethod:Fe.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Fe.credentialFromTaggedObject(t)}static credentialFromError(t){return Fe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:r}=t;if(!s||!r)return null;try{return Fe.credential(s,r)}catch{return null}}}Fe.TWITTER_SIGN_IN_METHOD="twitter.com";Fe.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,r,n=!1){const i=await Se._fromIdTokenResponse(t,r,n),a=Cn(r);return new mt({user:i,providerId:a,_tokenResponse:r,operationType:s})}static async _forOperation(t,s,r){await t._updateTokensIfNecessary(r,!0);const n=Cn(r);return new mt({user:t,providerId:n,_tokenResponse:r,operationType:s})}}function Cn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Te{constructor(t,s,r,n){var i;super(s.code,s.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,ws.prototype),this.customData={appName:t.name,tenantId:(i=t.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:s.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,s,r,n){return new ws(t,s,r,n)}}function oa(e,t,s,r){return(t==="reauthenticate"?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ws._fromErrorAndOperation(e,i,t,r):i})}async function Oc(e,t,s=!1){const r=await Ut(e,t._linkToIdToken(e.auth,await e.getIdToken()),s);return mt._forOperation(e,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lc(e,t,s=!1){const{auth:r}=e;if(Ee(r.app))return Promise.reject(Ke(r));const n="reauthenticate";try{const i=await Ut(e,oa(r,n,t,e),s);L(i.idToken,r,"internal-error");const a=Fr(i.idToken);L(a,r,"internal-error");const{sub:o}=a;return L(e.uid===o,r,"user-mismatch"),mt._forOperation(e,n,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&xe(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dc(e,t,s=!1){if(Ee(e.app))return Promise.reject(Ke(e));const r="signIn",n=await oa(e,r,t),i=await mt._fromIdTokenResponse(e,r,n);return s||await e._updateCurrentUser(i.user),i}function Fc(e,t,s,r){return Re(e).onIdTokenChanged(t,s,r)}function $c(e,t,s){return Re(e).beforeAuthStateChanged(t,s)}function Uc(e,t,s,r){return Re(e).onAuthStateChanged(t,s,r)}function Bc(e){return Re(e).signOut()}const Ms="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Ms,"1"),this.storage.removeItem(Ms),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc=1e3,Gc=10;class ca extends la{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ra(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const r=this.storage.getItem(s),n=this.localCache[s];r!==n&&t(s,n,r)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=t.key;s?this.detachListener():this.stopPolling();const n=()=>{const a=this.storage.getItem(r);!s&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);xc()&&i!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,Gc):n()}notifyListeners(t,s){this.localCache[t]=s;const r=this.listeners[t];if(r)for(const n of Array.from(r))n(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:r}),!0)})},Vc)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}ca.type="LOCAL";const Hc=ca;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends la{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}ha.type="SESSION";const ua=ha;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(n=>n.isListeningto(t));if(s)return s;const r=new Ls(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:r,eventType:n,data:i}=s.data,a=this.handlersMap[n];if(!(a!=null&&a.size))return;s.ports[0].postMessage({status:"ack",eventId:r,eventType:n});const o=Array.from(a).map(async h=>h(s.origin,i)),l=await zc(o);s.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:l})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ls.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(e="",t=10){let s="";for(let r=0;r<t;r++)s+=Math.floor(Math.random()*10);return e+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,r=50){const n=typeof MessageChannel<"u"?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let i,a;return new Promise((o,l)=>{const h=Vr("",20);n.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:n,onMessage(u){const f=u;if(f.data.eventId===h)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(f.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),n.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:t,eventId:h,data:s},[n.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ve(){return window}function Wc(e){ve().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(){return typeof ve().WorkerGlobalScope<"u"&&typeof ve().importScripts=="function"}async function Jc(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Kc(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Xc(){return da()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa="firebaseLocalStorageDb",Zc=1,Es="firebaseLocalStorage",ma="fbase_key";class Zt{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function Ds(e,t){return e.transaction([Es],t?"readwrite":"readonly").objectStore(Es)}function Qc(){const e=indexedDB.deleteDatabase(fa);return new Zt(e).toPromise()}function pr(){const e=indexedDB.open(fa,Zc);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const r=e.result;try{r.createObjectStore(Es,{keyPath:ma})}catch(n){s(n)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(Es)?t(r):(r.close(),await Qc(),t(await pr()))})})}async function An(e,t,s){const r=Ds(e,!0).put({[ma]:t,value:s});return new Zt(r).toPromise()}async function Yc(e,t){const s=Ds(e,!1).get(t),r=await new Zt(s).toPromise();return r===void 0?null:r.value}function kn(e,t){const s=Ds(e,!0).delete(t);return new Zt(s).toPromise()}const eh=800,th=3;class ga{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await pr(),this.db)}async _withRetries(t){let s=0;for(;;)try{const r=await this._openDb();return await t(r)}catch(r){if(s++>th)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return da()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ls._getInstance(Xc()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await Jc(),!this.activeServiceWorker)return;this.sender=new qc(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((s=r[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Kc()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await pr();return await An(t,Ms,"1"),await kn(t,Ms),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(r=>An(r,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(r=>Yc(r,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>kn(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(n=>{const i=Ds(n,!1).getAll();return new Zt(i).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],r=new Set;if(t.length!==0)for(const{fbase_key:n,value:i}of t)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),s.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!r.has(n)&&(this.notifyListeners(n,null),s.push(n));return s}notifyListeners(t,s){this.localCache[t]=s;const r=this.listeners[t];if(r)for(const n of Array.from(r))n(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),eh)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ga.type="LOCAL";const sh=ga;new Kt(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pa(e,t){return t?Ie(t):(L(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr extends aa{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return ht(t,this._buildIdpRequest())}_linkToIdToken(t,s){return ht(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return ht(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function rh(e){return Dc(e.auth,new Gr(e),e.bypassAuthState)}function nh(e){const{auth:t,user:s}=e;return L(s,t,"internal-error"),Lc(s,new Gr(e),e.bypassAuthState)}async function ih(e){const{auth:t,user:s}=e;return L(s,t,"internal-error"),Oc(s,new Gr(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(t,s,r,n,i=!1){this.auth=t,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:r,postBody:n,tenantId:i,error:a,type:o}=t;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:s,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(h){this.reject(h)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return rh;case"linkViaPopup":case"linkViaRedirect":return ih;case"reauthViaPopup":case"reauthViaRedirect":return nh;default:xe(this.auth,"internal-error")}}resolve(t){Ae(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ae(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=new Kt(2e3,1e4);async function oh(e,t,s){if(Ee(e.app))return Promise.reject(de(e,"operation-not-supported-in-this-environment"));const r=Os(e);sc(e,t,Br);const n=pa(r,s);return new Je(r,"signInViaPopup",t,n).executeNotNull()}class Je extends va{constructor(t,s,r,n,i){super(t,s,n,i),this.provider=r,this.authWindow=null,this.pollId=null,Je.currentPopupAction&&Je.currentPopupAction.cancel(),Je.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return L(t,this.auth,"internal-error"),t}async onExecution(){Ae(this.filter.length===1,"Popup operations only handle one event");const t=Vr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(de(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(de(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Je.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,r;if(!((r=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(de(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,ah.get())};t()}}Je.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lh="pendingRedirect",us=new Map;class ch extends va{constructor(t,s,r=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,r),this.eventId=null}async execute(){let t=us.get(this.auth._key());if(!t){try{const r=await hh(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(r)}catch(s){t=()=>Promise.reject(s)}us.set(this.auth._key(),t)}return this.bypassAuthState||us.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hh(e,t){const s=fh(t),r=dh(e);if(!await r._isAvailable())return!1;const n=await r._get(s)==="true";return await r._remove(s),n}function uh(e,t){us.set(e._key(),t)}function dh(e){return Ie(e._redirectPersistence)}function fh(e){return hs(lh,e.config.apiKey,e.name)}async function mh(e,t,s=!1){if(Ee(e.app))return Promise.reject(Ke(e));const r=Os(e),n=pa(r,t),a=await new ch(r,n,s).execute();return a&&!s&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh=10*60*1e3;class ph{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(t,r)&&(s=!0,this.sendToConsumer(t,r),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!vh(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var r;if(t.error&&!ya(t)){const n=((r=t.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";s.onError(de(this.auth,n))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const r=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&r}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=gh&&this.cachedEventUids.clear(),this.cachedEventUids.has(Tn(t))}saveEventToCache(t){this.cachedEventUids.add(Tn(t)),this.lastProcessedEventTime=Date.now()}}function Tn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function ya({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function vh(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ya(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yh(e,t={}){return bt(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xh=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,bh=/^https?/;async function _h(e){if(e.config.emulator)return;const{authorizedDomains:t}=await yh(e);for(const s of t)try{if(wh(s))return}catch{}xe(e,"unauthorized-domain")}function wh(e){const t=mr(),{protocol:s,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const a=new URL(e);return a.hostname===""&&r===""?s==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&a.hostname===r}if(!bh.test(s))return!1;if(xh.test(e))return r===e;const n=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh=new Kt(3e4,6e4);function Rn(){const e=ve().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}}function Eh(e){return new Promise((t,s)=>{var r,n,i;function a(){Rn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Rn(),s(de(e,"network-request-failed"))},timeout:Mh.get()})}if(!((n=(r=ve().gapi)===null||r===void 0?void 0:r.iframes)===null||n===void 0)&&n.Iframe)t(gapi.iframes.getContext());else if(!((i=ve().gapi)===null||i===void 0)&&i.load)a();else{const o=Cc("iframefcb");return ve()[o]=()=>{gapi.load?a():s(de(e,"network-request-failed"))},Sc(`${Ic()}?onload=${o}`).catch(l=>s(l))}}).catch(t=>{throw ds=null,t})}let ds=null;function Nh(e){return ds=ds||Eh(e),ds}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sh=new Kt(5e3,15e3),Ih="__/auth/iframe",Ch="emulator/auth/iframe",Ah={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Th(e){const t=e.config;L(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?Lr(t,Ch):`https://${e.config.authDomain}/${Ih}`,r={apiKey:t.apiKey,appName:e.name,v:xt},n=kh.get(e.config.apiHost);n&&(r.eid=n);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${s}?${Jt(r).slice(1)}`}async function Rh(e){const t=await Nh(e),s=ve().gapi;return L(s,e,"internal-error"),t.open({where:document.body,url:Th(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ah,dontclear:!0},r=>new Promise(async(n,i)=>{await r.restyle({setHideOnLeave:!1});const a=de(e,"network-request-failed"),o=ve().setTimeout(()=>{i(a)},Sh.get());function l(){ve().clearTimeout(o),n(r)}r.ping(l).then(l,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ph={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},jh=500,Oh=600,Lh="_blank",Dh="http://localhost";class Pn{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Fh(e,t,s,r=jh,n=Oh){const i=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},Ph),{width:r.toString(),height:n.toString(),top:i,left:a}),h=se().toLowerCase();s&&(o=Qi(h)?Lh:s),Xi(h)&&(t=t||Dh,l.scrollbars="yes");const d=Object.entries(l).reduce((f,[m,v])=>`${f}${m}=${v},`,"");if(yc(h)&&o!=="_self")return $h(t||"",o),new Pn(null);const u=window.open(t||"",o,d);L(u,e,"popup-blocked");try{u.focus()}catch{}return new Pn(u)}function $h(e,t){const s=document.createElement("a");s.href=e,s.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh="__/auth/handler",Bh="emulator/auth/handler",Vh=encodeURIComponent("fac");async function jn(e,t,s,r,n,i){L(e.config.authDomain,e,"auth-domain-config-required"),L(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:r,v:xt,eventId:n};if(t instanceof Br){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",Go(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[d,u]of Object.entries({}))a[d]=u}if(t instanceof Xt){const d=t.getScopes().filter(u=>u!=="");d.length>0&&(a.scopes=d.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))o[d]===void 0&&delete o[d];const l=await e._getAppCheckToken(),h=l?`#${Vh}=${encodeURIComponent(l)}`:"";return`${Gh(e)}?${Jt(o).slice(1)}${h}`}function Gh({config:e}){return e.emulator?Lr(e,Bh):`https://${e.authDomain}/${Uh}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs="webStorageSupport";class Hh{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ua,this._completeRedirectFn=mh,this._overrideRedirectResult=uh}async _openPopup(t,s,r,n){var i;Ae((i=this.eventManagers[t._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await jn(t,s,r,mr(),n);return Fh(t,a,Vr())}async _openRedirect(t,s,r,n){await this._originValidation(t);const i=await jn(t,s,r,mr(),n);return Wc(i),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:n,promise:i}=this.eventManagers[s];return n?Promise.resolve(n):(Ae(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(t);return this.eventManagers[s]={promise:r},r.catch(()=>{delete this.eventManagers[s]}),r}async initAndGetManager(t){const s=await Rh(t),r=new ph(t);return s.register("authEvent",n=>(L(n==null?void 0:n.authEvent,t,"invalid-auth-event"),{status:r.onEvent(n.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=s,r}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(Qs,{type:Qs},n=>{var i;const a=(i=n==null?void 0:n[0])===null||i===void 0?void 0:i[Qs];a!==void 0&&s(!!a),xe(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=_h(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return ra()||Zi()||$r()}}const zh=Hh;var On="@firebase/auth",Ln="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(r=>{t((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Jh(e){ft(new Ze("auth",(t,{options:s})=>{const r=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),i=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;L(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:na(e)},h=new Ec(r,n,i,l);return kc(h,s),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,r)=>{t.getProvider("auth-internal").initialize()})),ft(new Ze("auth-internal",t=>{const s=Os(t.getProvider("auth").getImmediate());return(r=>new qh(r))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Be(On,Ln,Wh(e)),Be(On,Ln,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh=5*60,Xh=ji("authIdTokenMaxAge")||Kh;let Dn=null;const Zh=e=>async t=>{const s=t&&await t.getIdTokenResult(),r=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(r&&r>Xh)return;const n=s==null?void 0:s.token;Dn!==n&&(Dn=n,await fetch(e,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))};function Qh(e=$i()){const t=Rr(e,"auth");if(t.isInitialized())return t.getImmediate();const s=Ac(e,{popupRedirectResolver:zh,persistence:[sh,Hc,ua]}),r=ji("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Zh(i.toString());$c(s,a,()=>a(s.currentUser)),Fc(s,o=>a(o))}}const n=Ri("auth");return n&&Tc(s,`http://${n}`),s}function Yh(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}Nc({loadJS(e){return new Promise((t,s)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=n=>{const i=de("internal-error");i.customData=n,s(i)},r.type="text/javascript",r.charset="UTF-8",Yh().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Jh("Browser");var eu="firebase",tu="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Be(eu,tu,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa="firebasestorage.googleapis.com",su="storageBucket",ru=2*60*1e3,nu=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we extends Te{constructor(t,s,r=0){super(Ys(t),`Firebase Storage: ${s} (${Ys(t)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,we.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Ys(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var be;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(be||(be={}));function Ys(e){return"storage/"+e}function iu(){const e="An unknown error occurred, please check the error payload for server response.";return new we(be.UNKNOWN,e)}function au(){return new we(be.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ou(){return new we(be.CANCELED,"User canceled the upload/download.")}function lu(e){return new we(be.INVALID_URL,"Invalid URL '"+e+"'.")}function cu(e){return new we(be.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function Fn(e){return new we(be.INVALID_ARGUMENT,e)}function ba(){return new we(be.APP_DELETED,"The Firebase app was deleted.")}function hu(e){return new we(be.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let r;try{r=ue.makeFromUrl(t,s)}catch{return new ue(t,"")}if(r.path==="")return r;throw cu(t)}static makeFromUrl(t,s){let r=null;const n="([A-Za-z0-9.\\-_]+)";function i(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+n+a,"i"),l={bucket:1,path:3};function h(M){M.path_=decodeURIComponent(M.path)}const d="v[A-Za-z0-9_]+",u=s.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${u}/${d}/b/${n}/o${f}`,"i"),v={bucket:1,path:3},x=s===xa?"(?:storage.googleapis.com|storage.cloud.google.com)":s,g="([^?#]*)",w=new RegExp(`^https?://${x}/${n}/${g}`,"i"),y=[{regex:o,indices:l,postModify:i},{regex:m,indices:v,postModify:h},{regex:w,indices:{bucket:1,path:2},postModify:h}];for(let M=0;M<y.length;M++){const b=y[M],E=b.regex.exec(t);if(E){const N=E[b.indices.bucket];let I=E[b.indices.path];I||(I=""),r=new ue(N,I),b.postModify(r);break}}if(r==null)throw lu(t);return r}}class uu{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(e,t,s){let r=1,n=null,i=null,a=!1,o=0;function l(){return o===2}let h=!1;function d(...g){h||(h=!0,t.apply(null,g))}function u(g){n=setTimeout(()=>{n=null,e(m,l())},g)}function f(){i&&clearTimeout(i)}function m(g,...w){if(h){f();return}if(g){f(),d.call(null,g,...w);return}if(l()||a){f(),d.call(null,g,...w);return}r<64&&(r*=2);let y;o===1?(o=2,y=0):y=(r+Math.random())*1e3,u(y)}let v=!1;function x(g){v||(v=!0,f(),!h&&(n!==null?(g||(o=2),clearTimeout(n),u(0)):g||(o=1)))}return u(0),i=setTimeout(()=>{a=!0,x(!0)},s),x}function fu(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(e){return e!==void 0}function $n(e,t,s,r){if(r<t)throw Fn(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>s)throw Fn(`Invalid value for '${e}'. Expected ${s} or less.`)}function gu(e){const t=encodeURIComponent;let s="?";for(const r in e)if(e.hasOwnProperty(r)){const n=t(r)+"="+t(e[r]);s=s+n+"&"}return s=s.slice(0,-1),s}var Ns;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(Ns||(Ns={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pu(e,t){const s=e>=500&&e<600,n=[408,429].indexOf(e)!==-1,i=t.indexOf(e)!==-1;return s||n||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(t,s,r,n,i,a,o,l,h,d,u,f=!0){this.url_=t,this.method_=s,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=h,this.progressCallback_=d,this.connectionFactory_=u,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((m,v)=>{this.resolve_=m,this.reject_=v,this.start_()})}start_(){const t=(r,n)=>{if(n){r(!1,new as(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=o=>{const l=o.loaded,h=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,h)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const o=i.getErrorCode()===Ns.NO_ERROR,l=i.getStatus();if(!o||pu(l,this.additionalRetryCodes_)&&this.retry){const d=i.getErrorCode()===Ns.ABORT;r(!1,new as(!1,null,d));return}const h=this.successCodes_.indexOf(l)!==-1;r(!0,new as(h,i))})},s=(r,n)=>{const i=this.resolve_,a=this.reject_,o=n.connection;if(n.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());mu(l)?i(l):i()}catch(l){a(l)}else if(o!==null){const l=iu();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(n.canceled){const l=this.appDelete_?ba():ou();a(l)}else{const l=au();a(l)}};this.canceled_?s(!1,new as(!1,null,!0)):this.backoffId_=du(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&fu(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class as{constructor(t,s,r){this.wasSuccessCode=t,this.connection=s,this.canceled=!!r}}function yu(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function xu(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function bu(e,t){t&&(e["X-Firebase-GMPID"]=t)}function _u(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function wu(e,t,s,r,n,i,a=!0){const o=gu(e.urlParams),l=e.url+o,h=Object.assign({},e.headers);return bu(h,t),yu(h,s),xu(h,i),_u(h,r),new vu(l,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(e){if(e.length===0)return null;const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function Eu(e){const t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(t,s){this._service=t,s instanceof ue?this._location=s:this._location=ue.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new Ss(t,s)}get root(){const t=new ue(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Eu(this._location.path)}get storage(){return this._service}get parent(){const t=Mu(this._location.path);if(t===null)return null;const s=new ue(this._location.bucket,t);return new Ss(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw hu(t)}}function Un(e,t){const s=t==null?void 0:t[su];return s==null?null:ue.makeFromBucketSpec(s,e)}function Nu(e,t,s,r={}){e.host=`${t}:${s}`,e._protocol="http";const{mockUserToken:n}=r;n&&(e._overrideAuthToken=typeof n=="string"?n:Ro(n,e.app.options.projectId))}class Su{constructor(t,s,r,n,i){this.app=t,this._authProvider=s,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._bucket=null,this._host=xa,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=ru,this._maxUploadRetryTime=nu,this._requests=new Set,n!=null?this._bucket=ue.makeFromBucketSpec(n,this._host):this._bucket=Un(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=ue.makeFromBucketSpec(this._url,t):this._bucket=Un(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){$n("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){$n("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Ss(this,t)}_makeRequest(t,s,r,n,i=!0){if(this._deleted)return new uu(ba());{const a=wu(t,this._appId,r,n,s,this._firebaseVersion,i);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(t,s){const[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,r,n).getPromise()}}const Bn="@firebase/storage",Vn="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a="storage";function Iu(e=$i(),t){e=Re(e);const r=Rr(e,_a).getImmediate({identifier:t}),n=ko("storage");return n&&Cu(r,...n),r}function Cu(e,t,s,r={}){Nu(e,t,s,r)}function Au(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),n=e.getProvider("app-check-internal");return new Su(s,r,n,t,xt)}function ku(){ft(new Ze(_a,Au,"PUBLIC").setMultipleInstances(!0)),Be(Bn,Vn,""),Be(Bn,Vn,"esm2017")}ku();const Tu={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyCsboACH7vFaM9kiKNxXpjgNC-PMq1HNc8",VITE_FIREBASE_APP_ID:"1:487990753122:web:e158caa86b40372fa75e3b",VITE_FIREBASE_AUTH_DOMAIN:"cvic-456409.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"487990753122",VITE_FIREBASE_PROJECT_ID:"cvic-456409",VITE_FIREBASE_STORAGE_BUCKET:"cvic-456409.firebasestorage.app"},Ru=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Gn=Ru.filter(e=>!Tu[e]);if(Gn.length>0)throw new Error(`Missing required Firebase configuration variables: ${Gn.join(", ")}`);const er={apiKey:"AIzaSyCsboACH7vFaM9kiKNxXpjgNC-PMq1HNc8",authDomain:"cvic-456409.firebaseapp.com",projectId:"cvic-456409",storageBucket:"cvic-456409.firebasestorage.app",messagingSenderId:"487990753122",appId:"1:487990753122:web:e158caa86b40372fa75e3b"};let vr,Pu;try{vr=Fi(er),Pu=Iu(vr)}catch(e){throw console.error("Error initializing Firebase:",e),console.error("Firebase config:",{...er,apiKey:er.apiKey?"***":void 0}),e}const Hr=Qh(vr),ju=new Me;async function Ou(){try{const t=(await oh(Hr,ju)).user;return{id:t.uid,email:t.email||"",displayName:t.displayName||void 0,photoURL:t.photoURL||void 0}}catch(e){throw console.error("Error signing in with Google:",e),e}}async function Lu(){try{await Bc(Hr)}catch(e){throw console.error("Error signing out:",e),e}}function Du(e){return Uc(Hr,t=>{if(t){const s={id:t.uid,email:t.email||"",displayName:t.displayName||void 0,photoURL:t.photoURL||void 0};e(s)}else e(null)})}const wa=p.createContext(null);function Fs(){const e=p.useContext(wa);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}function Fu({children:e}){const[t,s]=p.useState(null),[r,n]=p.useState(!0),[i,a]=p.useState(null);p.useEffect(()=>{const h=Du(d=>{s(d),n(!1),a(null)});return()=>h()},[]);const o=async()=>{n(!0),a(null);try{await Ou()}catch(h){console.error("Sign in error:",h),a(h instanceof Error?h.message:"Failed to sign in."),n(!1)}},l=async()=>{n(!0),a(null);try{await Lu()}catch(h){console.error("Sign out error:",h),a(h instanceof Error?h.message:"Failed to sign out."),n(!1)}};return c.jsx(wa.Provider,{value:{user:t,loading:r,error:i,signIn:o,signOut:l},children:e})}const $u=[],Uu=()=>{const e=oo(),t=ke(),{user:s,loading:r,signOut:n}=Fs(),i=e.pathname.replace("/CVIc",""),a=async()=>{await n(),t("/login")};return r?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("nav",{className:"bg-white shadow-sm",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between h-16",children:[c.jsxs("div",{className:"flex",children:[c.jsx("div",{className:"flex-shrink-0 flex items-center",children:c.jsx(kt,{to:"/",className:"text-xl font-bold text-primary-600",children:"CVIc"})}),c.jsx("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:s&&$u.map(o=>c.jsx(kt,{to:o.href,className:`${i===o.href?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium`,children:o.name},o.name))})]}),c.jsx("div",{className:"flex items-center",children:s?c.jsxs("div",{className:"flex items-center space-x-4",children:[s.displayName&&c.jsxs("span",{className:"text-sm text-gray-700 hidden sm:inline",children:["Welcome, ",s.displayName,"!"]}),!s.displayName&&s.email&&c.jsx("span",{className:"text-sm text-gray-700 hidden sm:inline",children:s.email}),c.jsx("button",{onClick:a,className:"btn btn-secondary text-sm",children:"Sign Out"})]}):c.jsx(kt,{to:"/login",className:"btn btn-primary text-sm",children:"Sign In"})})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsx(lo,{})})]})};class Bu extends p.Component{constructor(){super(...arguments);zs(this,"state",{hasError:!1,error:void 0})}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("Uncaught error:",s,r)}render(){var s;return this.state.hasError?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:c.jsx("div",{className:"max-w-md w-full space-y-8 p-8",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Something went wrong"}),c.jsx("p",{className:"text-gray-600 mb-8",children:((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred"}),c.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Reload Page"})]})})}):this.props.children}}function Vu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const Ma=p.forwardRef(Vu);function Gu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const Ea=p.forwardRef(Gu);function Hu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const zu=p.forwardRef(Hu);function qu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"}))}const yr=p.forwardRef(qu);function Wu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const zr=p.forwardRef(Wu);function Ju({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const Hn=p.forwardRef(Ju);function Ku({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"}))}const zn=p.forwardRef(Ku);function Xu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Zu=p.forwardRef(Xu);function Qu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"}))}const qn=p.forwardRef(Qu);function Yu({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z"}))}const tr=p.forwardRef(Yu);function ed({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-2.25-1.313M21 7.5v2.25m0-2.25-2.25 1.313M3 7.5l2.25-1.313M3 7.5l2.25 1.313M3 7.5v2.25m9 3 2.25-1.313M12 12.75l-2.25-1.313M12 12.75V15m0 6.75 2.25-1.313M12 21.75V19.5m0 2.25-2.25-1.313m0-16.875L12 2.25l2.25 1.313M21 14.25v2.25l-2.25 1.313m-13.5 0L3 16.5v-2.25"}))}const xr=p.forwardRef(ed);function td({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const sd=p.forwardRef(td);function rd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const Wn=p.forwardRef(rd);function nd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.864 4.243A7.5 7.5 0 0 1 19.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 0 0 4.5 10.5a7.464 7.464 0 0 1-1.15 3.993m1.989 3.559A11.209 11.209 0 0 0 8.25 10.5a3.75 3.75 0 1 1 7.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 0 1-3.6 9.75m6.633-4.596a18.666 18.666 0 0 1-2.485 5.33"}))}const id=p.forwardRef(nd);function ad({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const od=p.forwardRef(ad);function ld({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const cd=p.forwardRef(ld);function hd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const ud=p.forwardRef(hd);function dd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const St=p.forwardRef(dd);function fd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42"}))}const Jn=p.forwardRef(fd);function md({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"}))}const gd=p.forwardRef(md);function pd({title:e,titleId:t,...s},r){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?p.createElement("title",{id:t},e):null,p.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const vd=p.forwardRef(pd);function yd(){const{user:e,loading:t}=Fs(),s=[{text:"Upload shoreline Shapefile.",icon:c.jsx(tr,{className:"h-6 w-6 text-primary-600"})},{text:"Segment shoreline by specified resolution.",icon:c.jsx(xr,{className:"h-6 w-6 text-primary-600"})},{text:"Select vulnerability parameters & assign weights.",icon:c.jsx(yr,{className:"h-6 w-6 text-primary-600"})},{text:"Assign values to segments via interactive map & table.",icon:c.jsx(St,{className:"h-6 w-6 text-primary-600"})},{text:"Select CVI calculation formula.",icon:c.jsx(qn,{className:"h-6 w-6 text-primary-600"})},{text:"Visualize results & export as GeoJSON.",icon:c.jsx(zn,{className:"h-6 w-6 text-primary-600"})}],r=[{name:"React",purpose:"UI Framework",icon:c.jsx(xr,{className:"h-4 w-4 text-cyan-700"})},{name:"TypeScript",purpose:"Language / Type Safety",icon:c.jsx(qn,{className:"h-4 w-4 text-blue-700"})},{name:"Vite",purpose:"Build Tool / Dev Server",icon:c.jsx(tr,{className:"h-4 w-4 text-purple-700"})},{name:"React Router",purpose:"Client-Side Routing",icon:c.jsx(St,{className:"h-4 w-4 text-orange-700"})},{name:"Leaflet",purpose:"Interactive Maps Core",icon:c.jsx(St,{className:"h-4 w-4 text-green-700"})},{name:"React Leaflet",purpose:"React Integration for Leaflet",icon:c.jsx(St,{className:"h-4 w-4 text-green-600"})},{name:"Leaflet Draw",purpose:"Map Drawing/Selection Tools",icon:c.jsx(Jn,{className:"h-4 w-4 text-green-800"})},{name:"Turf.js",purpose:"Geospatial Analysis",icon:c.jsx(yr,{className:"h-4 w-4 text-lime-700"})},{name:"TailwindCSS",purpose:"Utility-First CSS Styling",icon:c.jsx(Jn,{className:"h-4 w-4 text-sky-700"})},{name:"IndexedDB (idb)",purpose:"Client-Side Data Storage",icon:c.jsx(zn,{className:"h-4 w-4 text-gray-700"})},{name:"shpjs",purpose:"Shapefile Parsing",icon:c.jsx(tr,{className:"h-4 w-4 text-red-700"})},{name:"Firebase Auth",purpose:"User Authentication",icon:c.jsx(id,{className:"h-4 w-4 text-yellow-700"})}];return t?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white",children:c.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary-600"})}):c.jsx("div",{className:"bg-white text-gray-800 font-sans py-12 px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"max-w-4xl mx-auto",children:[c.jsxs("div",{className:"text-center mb-12",children:[c.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold text-primary-900 tracking-tight",children:"CVIc: Coastal Vulnerability Index Compiler"}),c.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Web Platform for Automating Coastal Vulnerability Index Calculation"})]}),c.jsx("section",{className:"text-center mt-10 mb-16",children:e?c.jsxs(kt,{to:"/shoreline",className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-6 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:["Start New Analysis",c.jsx(Hn,{className:"ml-2 h-5 w-5"})]}):c.jsxs(kt,{to:"/login",className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-6 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:["Sign In to Begin",c.jsx(Hn,{className:"ml-2 h-5 w-5"})]})}),c.jsxs("section",{className:"mb-16",children:[c.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-8 text-center",children:[" ","Workflow Overview"]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[" ",s.map((n,i)=>c.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-sm hover:shadow-md hover:border-primary-200 transition duration-200 ease-in-out",children:[" ",c.jsxs("div",{className:"flex-shrink-0 w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center ring-2 ring-primary-200",children:[" ",n.icon]}),c.jsxs("div",{className:"flex-1 pt-1",children:[" ",c.jsxs("p",{className:"text-gray-700 font-medium",children:[" ",c.jsxs("span",{className:"font-bold text-primary-700 mr-1",children:[i+1,"."]})," ",n.text]})]})]},i))]})]}),c.jsxs("section",{className:"mb-16",children:[c.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 text-center",children:"Technology Stack"}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(n=>c.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[c.jsx("div",{className:"flex-shrink-0 p-1.5 bg-gray-100 rounded-md",children:n.icon}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.name}),c.jsx("p",{className:"text-xs text-gray-500",children:n.purpose})]})]},n.name))})]})]})})}function xd(){const[e,t]=p.useState(""),[s,r]=p.useState(!1),n=ke(),{signIn:i}=Fs(),a=async()=>{t(""),r(!0);try{await i(),n("/")}catch{t("Failed to sign in with Google. Please try again.")}finally{r(!1)}};return c.jsxs("div",{className:"max-w-md mx-auto mt-8",children:[c.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Sign In"}),e&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:e}),c.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:c.jsx("button",{onClick:a,disabled:s,className:"w-full btn btn-primary flex items-center justify-center space-x-2",children:s?"Signing in...":c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),c.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),c.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),c.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),c.jsx("span",{children:"Sign in with Google"})]})})})]})}function bd(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var Ye=1,et=2,ut=3,_d=4,br=5,Kn=6378137,wd=6356752314e-3,Xn=.0066943799901413165,Rt=484813681109536e-20,S=Math.PI/2,Md=.16666666666666666,Ed=.04722222222222222,Nd=.022156084656084655,C=1e-10,Z=.017453292519943295,pe=57.29577951308232,B=Math.PI/4,Bt=Math.PI*2,Q=3.14159265359,ae={};ae.greenwich=0;ae.lisbon=-9.131906111111;ae.paris=2.337229166667;ae.bogota=-74.080916666667;ae.madrid=-3.687938888889;ae.rome=12.452333333333;ae.bern=7.439583333333;ae.jakarta=106.807719444444;ae.ferro=-17.666666666667;ae.brussels=4.367975;ae.stockholm=18.058277777778;ae.athens=23.7163375;ae.oslo=10.722916666667;const Sd={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var Zn=/[\s_\-\/\(\)]/g;function Ge(e,t){if(e[t])return e[t];for(var s=Object.keys(e),r=t.toLowerCase().replace(Zn,""),n=-1,i,a;++n<s.length;)if(i=s[n],a=i.toLowerCase().replace(Zn,""),a===r)return e[i]}function _r(e){var t={},s=e.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),r,n,i,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*Z},lat_1:function(o){t.lat1=o*Z},lat_2:function(o){t.lat2=o*Z},lat_ts:function(o){t.lat_ts=o*Z},lon_0:function(o){t.long0=o*Z},lon_1:function(o){t.long1=o*Z},lon_2:function(o){t.long2=o*Z},alpha:function(o){t.alpha=parseFloat(o)*Z},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*Z},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var l=Ge(Sd,o);l&&(t.to_meter=l.to_meter)},from_greenwich:function(o){t.from_greenwich=o*Z},pm:function(o){var l=Ge(ae,o);t.from_greenwich=(l||parseFloat(o))*Z},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(r in s)n=s[r],r in a?(i=a[r],typeof i=="function"?i(n):t[i]=n):t[r]=n;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var Vt=1,Na=2,Sa=3,Is=4,Ia=5,qr=-1,Id=/\s/,Cd=/[A-Za-z]/,Ad=/[A-Za-z84_]/,$s=/[,\]]/,Ca=/[\d\.E\-\+]/;function Pe(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Vt}Pe.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==Is)for(;Id.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Vt:return this.neutral(e);case Na:return this.keyword(e);case Is:return this.quoted(e);case Ia:return this.afterquote(e);case Sa:return this.number(e);case qr:return}};Pe.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=Is;return}if($s.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Pe.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Vt;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Vt,this.currentObject=this.stack.pop(),this.currentObject||(this.state=qr);return}};Pe.prototype.number=function(e){if(Ca.test(e)){this.word+=e;return}if($s.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Pe.prototype.quoted=function(e){if(e==='"'){this.state=Ia;return}this.word+=e};Pe.prototype.keyword=function(e){if(Ad.test(e)){this.word+=e;return}if(e==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=Vt;return}if($s.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Pe.prototype.neutral=function(e){if(Cd.test(e)){this.word=e,this.state=Na;return}if(e==='"'){this.word="",this.state=Is;return}if(Ca.test(e)){this.word=e,this.state=Sa;return}if($s.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Pe.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===qr)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function kd(e){var t=new Pe(e);return t.output()}function sr(e,t,s){Array.isArray(t)&&(s.unshift(t),t=null);var r=t?{}:e,n=s.reduce(function(i,a){return nt(a,i),i},r);t&&(e[t]=n)}function nt(e,t){if(!Array.isArray(e)){t[e]=!0;return}var s=e.shift();if(s==="PARAMETER"&&(s=e.shift()),e.length===1){if(Array.isArray(e[0])){t[s]={},nt(e[0],t[s]);return}t[s]=e[0];return}if(!e.length){t[s]=!0;return}if(s==="TOWGS84"){t[s]=e;return}if(s==="AXIS"){s in t||(t[s]=[]),t[s].push(e);return}Array.isArray(s)||(t[s]={});var r;switch(s){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[s]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&nt(e[2],t[s]);return;case"SPHEROID":case"ELLIPSOID":t[s]={name:e[0],a:e[1],rf:e[2]},e.length===4&&nt(e[3],t[s]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":e[0]=["name",e[0]],sr(t,s,e);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":e[0]=["name",e[0]],sr(t,s,e),t[s].type=s;return;default:for(r=-1;++r<e.length;)if(!Array.isArray(e[r]))return nt(e,t[s]);return sr(t,s,e)}}var Td=.017453292519943295,Rd=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Pd(e,t){var s=t[0],r=t[1];!(s in e)&&r in e&&(e[s]=e[r],t.length===3&&(e[s]=t[2](e[s])))}function ge(e){return e*Td}function Aa(e){for(var t=Object.keys(e),s=0,r=t.length;s<r;++s){var n=t[s];Rd.indexOf(n)!==-1&&jd(e[n]),typeof e[n]=="object"&&Aa(e[n])}}function jd(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var s="",r=0,n=e.AXIS.length;r<n;++r){var i=[e.AXIS[r][0].toLowerCase(),e.AXIS[r][1].toLowerCase()];i[0].indexOf("north")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="north"?s+="n":i[0].indexOf("south")!==-1||(i[0]==="y"||i[0]==="lat")&&i[1]==="south"?s+="s":i[0].indexOf("east")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="east"?s+="e":(i[0].indexOf("west")!==-1||(i[0]==="x"||i[0]==="lon")&&i[1]==="west")&&(s+="w")}s.length===2&&(s+="u"),s.length===3&&(e.axis=s)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var a=e.GEOGCS;e.type==="GEOGCS"&&(a=e),a&&(a.DATUM?e.datumCode=a.DATUM.name.toLowerCase():e.datumCode=a.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),e.datumCode==="new_zealand_1949"&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode==="belge_1972"&&(e.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(e.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=a.DATUM.SPHEROID.a,e.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(e.datum_params=a.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function o(d){var u=e.to_meter||1;return d*u}var l=function(d){return Pd(e,d)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",ge],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",ge],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",ge],["lat0","latitude_of_origin",ge],["lat0","standard_parallel_1",ge],["lat1","standard_parallel_1",ge],["lat2","standard_parallel_2",ge],["azimuth","Azimuth"],["alpha","azimuth",ge],["srsCode","name"]];h.forEach(l),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=ge(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=ge(e.lat0>0?90:-90))}function ka(e){var t=kd(e),s=t[0],r={};return nt(t,r),Aa(r),r[s]}function ee(e){var t=this;if(arguments.length===2){var s=arguments[1];typeof s=="string"?s.charAt(0)==="+"?ee[e]=_r(arguments[1]):ee[e]=ka(arguments[1]):ee[e]=s}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(r){Array.isArray(r)?ee.apply(t,r):ee(r)});if(typeof e=="string"){if(e in ee)return ee[e]}else"EPSG"in e?ee["EPSG:"+e.EPSG]=e:"ESRI"in e?ee["ESRI:"+e.ESRI]=e:"IAU2000"in e?ee["IAU2000:"+e.IAU2000]=e:console.log(e);return}}bd(ee);function Od(e){return typeof e=="string"}function Ld(e){return e in ee}var Dd=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Fd(e){return Dd.some(function(t){return e.indexOf(t)>-1})}var $d=["3857","900913","3785","102113"];function Ud(e){var t=Ge(e,"authority");if(t){var s=Ge(t,"epsg");return s&&$d.indexOf(s)>-1}}function Bd(e){var t=Ge(e,"extension");if(t)return Ge(t,"proj4")}function Vd(e){return e[0]==="+"}function Gd(e){if(Od(e)){if(Ld(e))return ee[e];if(Fd(e)){var t=ka(e);if(Ud(t))return ee["EPSG:3857"];var s=Bd(t);return s?_r(s):t}if(Vd(e))return _r(e)}else return e}function Qn(e,t){e=e||{};var s,r;if(!t)return e;for(r in t)s=t[r],s!==void 0&&(e[r]=s);return e}function _e(e,t,s){var r=e*t;return s/Math.sqrt(1-r*r)}function Qt(e){return e<0?-1:1}function k(e){return Math.abs(e)<=Q?e:e-Qt(e)*Bt}function fe(e,t,s){var r=e*s,n=.5*e;return r=Math.pow((1-r)/(1+r),n),Math.tan(.5*(S-t))/r}function Gt(e,t){for(var s=.5*e,r,n,i=S-2*Math.atan(t),a=0;a<=15;a++)if(r=e*Math.sin(i),n=S-2*Math.atan(t*Math.pow((1-r)/(1+r),s))-i,i+=n,Math.abs(n)<=1e-10)return i;return-9999}function Hd(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=_e(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function zd(e){var t=e.x,s=e.y;if(s*pe>90&&s*pe<-90&&t*pe>180&&t*pe<-180)return null;var r,n;if(Math.abs(Math.abs(s)-S)<=C)return null;if(this.sphere)r=this.x0+this.a*this.k0*k(t-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(B+.5*s));else{var i=Math.sin(s),a=fe(this.e,s,i);r=this.x0+this.a*this.k0*k(t-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return e.x=r,e.y=n,e}function qd(e){var t=e.x-this.x0,s=e.y-this.y0,r,n;if(this.sphere)n=S-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var i=Math.exp(-s/(this.a*this.k0));if(n=Gt(this.e,i),n===-9999)return null}return r=k(this.long0+t/(this.a*this.k0)),e.x=r,e.y=n,e}var Wd=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const Jd={init:Hd,forward:zd,inverse:qd,names:Wd};function Kd(){}function Yn(e){return e}var Xd=["longlat","identity"];const Zd={init:Kd,forward:Yn,inverse:Yn,names:Xd};var Qd=[Jd,Zd],fs={},Cs=[];function Ta(e,t){var s=Cs.length;return e.names?(Cs[s]=e,e.names.forEach(function(r){fs[r.toLowerCase()]=s}),this):(console.log(t),!0)}function Yd(e){if(!e)return!1;var t=e.toLowerCase();if(typeof fs[t]<"u"&&Cs[fs[t]])return Cs[fs[t]]}function ef(){Qd.forEach(Ta)}const tf={start:ef,add:Ta,get:Yd};var O={};O.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};O.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};O.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};O.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};O.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};O.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};O.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};O.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};O.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};O.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};O.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};O.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};O.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};O.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};O.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};O.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};O.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};O.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};O.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};O.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};O.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};O.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};O.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};O.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};O.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};O.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};O.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};O.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};O.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};O.hough={a:6378270,rf:297,ellipseName:"Hough"};O.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};O.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};O.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};O.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};O.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};O.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};O.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};O.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};O.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};O.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};O.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};O.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var sf=O.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};O.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function rf(e,t,s,r){var n=e*e,i=t*t,a=(n-i)/n,o=0;r?(e*=1-a*(Md+a*(Ed+a*Nd)),n=e*e,a=0):o=Math.sqrt(a);var l=(n-i)/i;return{es:a,e:o,ep2:l}}function nf(e,t,s,r,n){if(!e){var i=Ge(O,r);i||(i=sf),e=i.a,t=i.b,s=i.rf}return s&&!t&&(t=(1-1/s)*e),(s===0||Math.abs(e-t)<C)&&(n=!0,t=e),{a:e,b:t,rf:s,sphere:n}}var ms={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var af in ms){var ei=ms[af];ms[ei.datumName]=ei}function of(e,t,s,r,n,i,a){var o={};return e===void 0||e==="none"?o.datum_type=br:o.datum_type=_d,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Ye),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=et,o.datum_params[3]*=Rt,o.datum_params[4]*=Rt,o.datum_params[5]*=Rt,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=ut,o.grids=a),o.a=s,o.b=r,o.es=n,o.ep2=i,o}var Ra={};function lf(e,t){var s=new DataView(t),r=uf(s),n=df(s,r),i=ff(s,n,r),a={header:n,subgrids:i};return Ra[e]=a,a}function cf(e){if(e===void 0)return null;var t=e.split(",");return t.map(hf)}function hf(e){if(e.length===0)return null;var t=e[0]==="@";return t&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:Ra[e]||null,isNull:!1}}function it(e){return e/3600*Math.PI/180}function uf(e){var t=e.getInt32(8,!1);return t===11?!1:(t=e.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function df(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:wr(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function wr(e,t,s){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,s)))}function ff(e,t,s){for(var r=176,n=[],i=0;i<t.nSubgrids;i++){var a=gf(e,r,s),o=pf(e,r,a,s),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[it(a.lowerLongitude),it(a.lowerLatitude)],del:[it(a.longitudeInterval),it(a.latitudeInterval)],lim:[l,h],count:a.gridNodeCount,cvs:mf(o)}),r+=176+a.gridNodeCount*16}return n}function mf(e){return e.map(function(t){return[it(t.longitudeShift),it(t.latitudeShift)]})}function gf(e,t,s){return{name:wr(e,t+8,t+16).trim(),parent:wr(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,s),upperLatitude:e.getFloat64(t+88,s),lowerLongitude:e.getFloat64(t+104,s),upperLongitude:e.getFloat64(t+120,s),latitudeInterval:e.getFloat64(t+136,s),longitudeInterval:e.getFloat64(t+152,s),gridNodeCount:e.getInt32(t+168,s)}}function pf(e,t,s,r){for(var n=t+176,i=16,a=[],o=0;o<s.gridNodeCount;o++){var l={latitudeShift:e.getFloat32(n+o*i,r),longitudeShift:e.getFloat32(n+o*i+4,r),latitudeAccuracy:e.getFloat32(n+o*i+8,r),longitudeAccuracy:e.getFloat32(n+o*i+12,r)};a.push(l)}return a}function ye(e,t){if(!(this instanceof ye))return new ye(e);t=t||function(h){if(h)throw h};var s=Gd(e);if(typeof s!="object"){t("Could not parse to valid json: "+e);return}var r=ye.projections.get(s.projName);if(!r){t("Could not get projection name from: "+e);return}if(s.datumCode&&s.datumCode!=="none"){var n=Ge(ms,s.datumCode);n&&(s.datum_params=s.datum_params||(n.towgs84?n.towgs84.split(","):null),s.ellps=n.ellipse,s.datumName=n.datumName?n.datumName:s.datumCode)}s.k0=s.k0||1,s.axis=s.axis||"enu",s.ellps=s.ellps||"wgs84",s.lat1=s.lat1||s.lat0;var i=nf(s.a,s.b,s.rf,s.ellps,s.sphere),a=rf(i.a,i.b,i.rf,s.R_A),o=cf(s.nadgrids),l=s.datum||of(s.datumCode,s.datum_params,i.a,i.b,a.es,a.ep2,o);Qn(this,s),Qn(this,r),this.a=i.a,this.b=i.b,this.rf=i.rf,this.sphere=i.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,this.init(),t(null,this)}ye.projections=tf;ye.projections.start();function vf(e,t){return e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11?!1:e.datum_type===Ye?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type===et?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]:!0}function Pa(e,t,s){var r=e.x,n=e.y,i=e.z?e.z:0,a,o,l,h;if(n<-S&&n>-1.001*S)n=-S;else if(n>S&&n<1.001*S)n=S;else{if(n<-S)return{x:-1/0,y:-1/0,z:e.z};if(n>S)return{x:1/0,y:1/0,z:e.z}}return r>Math.PI&&(r-=2*Math.PI),o=Math.sin(n),h=Math.cos(n),l=o*o,a=s/Math.sqrt(1-t*l),{x:(a+i)*h*Math.cos(r),y:(a+i)*h*Math.sin(r),z:(a*(1-t)+i)*o}}function ja(e,t,s,r){var n=1e-12,i=n*n,a=30,o,l,h,d,u,f,m,v,x,g,w,_,y,M=e.x,b=e.y,E=e.z?e.z:0,N,I,A;if(o=Math.sqrt(M*M+b*b),l=Math.sqrt(M*M+b*b+E*E),o/s<n){if(N=0,l/s<n)return I=S,A=-r,{x:e.x,y:e.y,z:e.z}}else N=Math.atan2(b,M);h=E/l,d=o/l,u=1/Math.sqrt(1-t*(2-t)*d*d),v=d*(1-t)*u,x=h*u,y=0;do y++,m=s/Math.sqrt(1-t*x*x),A=o*v+E*x-m*(1-t*x*x),f=t*m/(m+A),u=1/Math.sqrt(1-f*(2-f)*d*d),g=d*(1-f)*u,w=h*u,_=w*v-g*x,v=g,x=w;while(_*_>i&&y<a);return I=Math.atan(w/Math.abs(g)),{x:N,y:I,z:A}}function yf(e,t,s){if(t===Ye)return{x:e.x+s[0],y:e.y+s[1],z:e.z+s[2]};if(t===et){var r=s[0],n=s[1],i=s[2],a=s[3],o=s[4],l=s[5],h=s[6];return{x:h*(e.x-l*e.y+o*e.z)+r,y:h*(l*e.x+e.y-a*e.z)+n,z:h*(-o*e.x+a*e.y+e.z)+i}}}function xf(e,t,s){if(t===Ye)return{x:e.x-s[0],y:e.y-s[1],z:e.z-s[2]};if(t===et){var r=s[0],n=s[1],i=s[2],a=s[3],o=s[4],l=s[5],h=s[6],d=(e.x-r)/h,u=(e.y-n)/h,f=(e.z-i)/h;return{x:d+l*u-o*f,y:-l*d+u+a*f,z:o*d-a*u+f}}}function os(e){return e===Ye||e===et}function bf(e,t,s){if(vf(e,t)||e.datum_type===br||t.datum_type===br)return s;var r=e.a,n=e.es;if(e.datum_type===ut){var i=ti(e,!1,s);if(i!==0)return;r=Kn,n=Xn}var a=t.a,o=t.b,l=t.es;if(t.datum_type===ut&&(a=Kn,o=wd,l=Xn),n===l&&r===a&&!os(e.datum_type)&&!os(t.datum_type))return s;if(s=Pa(s,n,r),os(e.datum_type)&&(s=yf(s,e.datum_type,e.datum_params)),os(t.datum_type)&&(s=xf(s,t.datum_type,t.datum_params)),s=ja(s,l,a,o),t.datum_type===ut){var h=ti(t,!0,s);if(h!==0)return}return s}function ti(e,t,s){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var r={x:-s.x,y:s.y},n={x:Number.NaN,y:Number.NaN},i=[];e:for(var a=0;a<e.grids.length;a++){var o=e.grids[a];if(i.push(o.name),o.isNull){n=r;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,d=l.length;h<d;h++){var u=l[h],f=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,m=u.ll[0]-f,v=u.ll[1]-f,x=u.ll[0]+(u.lim[0]-1)*u.del[0]+f,g=u.ll[1]+(u.lim[1]-1)*u.del[1]+f;if(!(v>r.y||m>r.x||g<r.y||x<r.x)&&(n=_f(r,t,u),!isNaN(n.x)))break e}}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*pe+" "+r.y*pe+" tried: '"+i+"'"),-1):(s.x=-n.x,s.y=n.y,0)}function _f(e,t,s){var r={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return r;var n={x:e.x,y:e.y};n.x-=s.ll[0],n.y-=s.ll[1],n.x=k(n.x-Math.PI)+Math.PI;var i=si(n,s);if(t){if(isNaN(i.x))return r;i.x=n.x-i.x,i.y=n.y-i.y;var a=9,o=1e-12,l,h;do{if(h=si(i,s),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:n.x-(h.x+i.x),y:n.y-(h.y+i.y)},i.x+=l.x,i.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=k(i.x+s.ll[0]),r.y=i.y+s.ll[1]}else isNaN(i.x)||(r.x=e.x+i.x,r.y=e.y+i.y);return r}function si(e,t){var s={x:e.x/t.del[0],y:e.y/t.del[1]},r={x:Math.floor(s.x),y:Math.floor(s.y)},n={x:s.x-1*r.x,y:s.y-1*r.y},i={x:Number.NaN,y:Number.NaN},a;if(r.x<0||r.x>=t.lim[0]||r.y<0||r.y>=t.lim[1])return i;a=r.y*t.lim[0]+r.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var l={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var h={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var d={x:t.cvs[a][0],y:t.cvs[a][1]},u=n.x*n.y,f=n.x*(1-n.y),m=(1-n.x)*(1-n.y),v=(1-n.x)*n.y;return i.x=m*o.x+f*l.x+v*d.x+u*h.x,i.y=m*o.y+f*l.y+v*d.y+u*h.y,i}function ri(e,t,s){var r=s.x,n=s.y,i=s.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&s.z===void 0))switch(l===0?(a=r,"ew".indexOf(e.axis[l])!==-1?o="x":o="y"):l===1?(a=n,"ns".indexOf(e.axis[l])!==-1?o="y":o="x"):(a=i,o="z"),e.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":s[o]!==void 0&&(h.z=a);break;case"d":s[o]!==void 0&&(h.z=-a);break;default:return null}return h}function Oa(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function wf(e){ni(e.x),ni(e.y)}function ni(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Mf(e,t){return(e.datum.datum_type===Ye||e.datum.datum_type===et||e.datum.datum_type===ut)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Ye||t.datum.datum_type===et||t.datum.datum_type===ut)&&e.datumCode!=="WGS84"}function As(e,t,s,r){var n;Array.isArray(s)?s=Oa(s):s={x:s.x,y:s.y,z:s.z,m:s.m};var i=s.z!==void 0;if(wf(s),e.datum&&t.datum&&Mf(e,t)&&(n=new ye("WGS84"),s=As(e,n,s,r),e=n),r&&e.axis!=="enu"&&(s=ri(e,!1,s)),e.projName==="longlat")s={x:s.x*Z,y:s.y*Z,z:s.z||0};else if(e.to_meter&&(s={x:s.x*e.to_meter,y:s.y*e.to_meter,z:s.z||0}),s=e.inverse(s),!s)return;if(e.from_greenwich&&(s.x+=e.from_greenwich),s=bf(e.datum,t.datum,s),!!s)return t.from_greenwich&&(s={x:s.x-t.from_greenwich,y:s.y,z:s.z||0}),t.projName==="longlat"?s={x:s.x*pe,y:s.y*pe,z:s.z||0}:(s=t.forward(s),t.to_meter&&(s={x:s.x/t.to_meter,y:s.y/t.to_meter,z:s.z||0})),r&&t.axis!=="enu"?ri(t,!0,s):(s&&!i&&delete s.z,s)}var ii=ye("WGS84");function rr(e,t,s,r){var n,i,a;return Array.isArray(s)?(n=As(e,t,s,r)||{x:NaN,y:NaN},s.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(s.slice(3)):[n.x,n.y,s[2]].concat(s.slice(3)):[n.x,n.y].concat(s.slice(2)):[n.x,n.y]):(i=As(e,t,s,r),a=Object.keys(s),a.length===2||a.forEach(function(o){if(typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;i[o]=s[o]}),i)}function ai(e){return e instanceof ye?e:e.oProj?e.oProj:ye(e)}function re(e,t,s){e=ai(e);var r=!1,n;return typeof t>"u"?(t=e,e=ii,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(s=t,t=e,e=ii,r=!0),t=ai(t),s?rr(e,t,s):(n={forward:function(i,a){return rr(e,t,i,a)},inverse:function(i,a){return rr(t,e,i,a)}},r&&(n.oProj=t),n)}var oi=6,La="AJSAJS",Da="AFAFAF",at=65,ne=73,le=79,It=86,Ct=90;const Ef={forward:Fa,inverse:Nf,toPoint:$a};function Fa(e,t){return t=t||5,Cf(Sf({lat:e[1],lon:e[0]}),t)}function Nf(e){var t=Wr(Ba(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function $a(e){var t=Wr(Ba(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function nr(e){return e*(Math.PI/180)}function li(e){return 180*(e/Math.PI)}function Sf(e){var t=e.lat,s=e.lon,r=6378137,n=.00669438,i=.9996,a,o,l,h,d,u,f,m=nr(t),v=nr(s),x,g;g=Math.floor((s+180)/6)+1,s===180&&(g=60),t>=56&&t<64&&s>=3&&s<12&&(g=32),t>=72&&t<84&&(s>=0&&s<9?g=31:s>=9&&s<21?g=33:s>=21&&s<33?g=35:s>=33&&s<42&&(g=37)),a=(g-1)*6-180+3,x=nr(a),o=n/(1-n),l=r/Math.sqrt(1-n*Math.sin(m)*Math.sin(m)),h=Math.tan(m)*Math.tan(m),d=o*Math.cos(m)*Math.cos(m),u=Math.cos(m)*(v-x),f=r*((1-n/4-3*n*n/64-5*n*n*n/256)*m-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*m)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*m)-35*n*n*n/3072*Math.sin(6*m));var w=i*l*(u+(1-h+d)*u*u*u/6+(5-18*h+h*h+72*d-58*o)*u*u*u*u*u/120)+5e5,_=i*(f+l*Math.tan(m)*(u*u/2+(5-h+9*d+4*d*d)*u*u*u*u/24+(61-58*h+h*h+600*d-330*o)*u*u*u*u*u*u/720));return t<0&&(_+=1e7),{northing:Math.round(_),easting:Math.round(w),zoneNumber:g,zoneLetter:If(t)}}function Wr(e){var t=e.northing,s=e.easting,r=e.zoneLetter,n=e.zoneNumber;if(n<0||n>60)return null;var i=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),d,u,f,m,v,x,g,w,_,y=s-5e5,M=t;r<"N"&&(M-=1e7),g=(n-1)*6-180+3,l=o/(1-o),x=M/i,w=x/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),_=w+(3*h/2-27*h*h*h/32)*Math.sin(2*w)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*w)+151*h*h*h/96*Math.sin(6*w),d=a/Math.sqrt(1-o*Math.sin(_)*Math.sin(_)),u=Math.tan(_)*Math.tan(_),f=l*Math.cos(_)*Math.cos(_),m=a*(1-o)/Math.pow(1-o*Math.sin(_)*Math.sin(_),1.5),v=y/(d*i);var b=_-d*Math.tan(_)/m*(v*v/2-(5+3*u+10*f-4*f*f-9*l)*v*v*v*v/24+(61+90*u+298*f+45*u*u-252*l-3*f*f)*v*v*v*v*v*v/720);b=li(b);var E=(v-(1+2*u+f)*v*v*v/6+(5-2*f+28*u-3*f*f+8*l+24*u*u)*v*v*v*v*v/120)/Math.cos(_);E=g+li(E);var N;if(e.accuracy){var I=Wr({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});N={top:I.lat,right:I.lon,bottom:b,left:E}}else N={lat:b,lon:E};return N}function If(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function Cf(e,t){var s="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+Af(e.easting,e.northing,e.zoneNumber)+s.substr(s.length-5,t)+r.substr(r.length-5,t)}function Af(e,t,s){var r=Ua(s),n=Math.floor(e/1e5),i=Math.floor(t/1e5)%20;return kf(n,i,r)}function Ua(e){var t=e%oi;return t===0&&(t=oi),t}function kf(e,t,s){var r=s-1,n=La.charCodeAt(r),i=Da.charCodeAt(r),a=n+e-1,o=i+t,l=!1;a>Ct&&(a=a-Ct+at-1,l=!0),(a===ne||n<ne&&a>ne||(a>ne||n<ne)&&l)&&a++,(a===le||n<le&&a>le||(a>le||n<le)&&l)&&(a++,a===ne&&a++),a>Ct&&(a=a-Ct+at-1),o>It?(o=o-It+at-1,l=!0):l=!1,(o===ne||i<ne&&o>ne||(o>ne||i<ne)&&l)&&o++,(o===le||i<le&&o>le||(o>le||i<le)&&l)&&(o++,o===ne&&o++),o>It&&(o=o-It+at-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function Ba(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var t=e.length,s=null,r="",n,i=0;!/[A-Z]/.test(n=e.charAt(i));){if(i>=2)throw"MGRSPoint bad conversion from: "+e;r+=n,i++}var a=parseInt(r,10);if(i===0||i+3>t)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(i++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+e;s=e.substring(i,i+=2);for(var l=Ua(a),h=Tf(s.charAt(0),l),d=Rf(s.charAt(1),l);d<Pf(o);)d+=2e6;var u=t-i;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var f=u/2,m=0,v=0,x,g,w,_,y;return f>0&&(x=1e5/Math.pow(10,f),g=e.substring(i,i+f),m=parseFloat(g)*x,w=e.substring(i+f),v=parseFloat(w)*x),_=m+h,y=v+d,{easting:_,northing:y,zoneLetter:o,zoneNumber:a,accuracy:x}}function Tf(e,t){for(var s=La.charCodeAt(t-1),r=1e5,n=!1;s!==e.charCodeAt(0);){if(s++,s===ne&&s++,s===le&&s++,s>Ct){if(n)throw"Bad character: "+e;s=at,n=!0}r+=1e5}return r}function Rf(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var s=Da.charCodeAt(t-1),r=0,n=!1;s!==e.charCodeAt(0);){if(s++,s===ne&&s++,s===le&&s++,s>It){if(n)throw"Bad character: "+e;s=at,n=!0}r+=1e5}return r}function Pf(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function gt(e,t,s){if(!(this instanceof gt))return new gt(e,t,s);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t>"u"){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=s||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}gt.fromMGRS=function(e){return new gt($a(e))};gt.prototype.toMGRS=function(e){return Fa([this.x,this.y],e)};var jf=1,Of=.25,ci=.046875,hi=.01953125,ui=.01068115234375,Lf=.75,Df=.46875,Ff=.013020833333333334,$f=.007120768229166667,Uf=.3645833333333333,Bf=.005696614583333333,Vf=.3076171875;function Jr(e){var t=[];t[0]=jf-e*(Of+e*(ci+e*(hi+e*ui))),t[1]=e*(Lf-e*(ci+e*(hi+e*ui)));var s=e*e;return t[2]=s*(Df-e*(Ff+e*$f)),s*=e,t[3]=s*(Uf-e*Bf),t[4]=s*e*Vf,t}function _t(e,t,s,r){return s*=t,t*=t,r[0]*e-s*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}var Gf=20;function Kr(e,t,s){for(var r=1/(1-t),n=e,i=Gf;i;--i){var a=Math.sin(n),o=1-t*a*a;if(o=(_t(n,a,Math.cos(n),s)-e)*(o*Math.sqrt(o))*r,n-=o,Math.abs(o)<C)return n}return n}function Hf(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Jr(this.es),this.ml0=_t(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function zf(e){var t=e.x,s=e.y,r=k(t-this.long0),n,i,a,o=Math.sin(s),l=Math.cos(s);if(this.es){var d=l*r,u=Math.pow(d,2),f=this.ep2*Math.pow(l,2),m=Math.pow(f,2),v=Math.abs(l)>C?Math.tan(s):0,x=Math.pow(v,2),g=Math.pow(x,2);n=1-this.es*Math.pow(o,2),d=d/Math.sqrt(n);var w=_t(s,o,l,this.en);i=this.a*(this.k0*d*(1+u/6*(1-x+f+u/20*(5-18*x+g+14*f-58*x*f+u/42*(61+179*g-g*x-479*x)))))+this.x0,a=this.a*(this.k0*(w-this.ml0+o*r*d/2*(1+u/12*(5-x+9*f+4*m+u/30*(61+g-58*x+270*f-330*x*f+u/56*(1385+543*g-g*x-3111*x))))))+this.y0}else{var h=l*Math.sin(r);if(Math.abs(Math.abs(h)-1)<C)return 93;if(i=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(r)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>C)return 93;a=0}else a=Math.acos(a);s<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return e.x=i,e.y=a,e}function qf(e){var t,s,r,n,i=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,s=Kr(t,this.es,this.en),Math.abs(s)<S){var u=Math.sin(s),f=Math.cos(s),m=Math.abs(f)>C?Math.tan(s):0,v=this.ep2*Math.pow(f,2),x=Math.pow(v,2),g=Math.pow(m,2),w=Math.pow(g,2);t=1-this.es*Math.pow(u,2);var _=i*Math.sqrt(t)/this.k0,y=Math.pow(_,2);t=t*m,r=s-t*y/(1-this.es)*.5*(1-y/12*(5+3*g-9*v*g+v-4*x-y/30*(61+90*g-252*v*g+45*w+46*v-y/56*(1385+3633*g+4095*w+1574*w*g)))),n=k(this.long0+_*(1-y/6*(1+2*g+v-y/20*(5+28*g+24*w+8*v*g+6*v-y/42*(61+662*g+1320*w+720*w*g))))/f)}else r=S*Qt(a),n=0;else{var o=Math.exp(i/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,d=Math.cos(h);t=Math.sqrt((1-Math.pow(d,2))/(1+Math.pow(l,2))),r=Math.asin(t),a<0&&(r=-r),l===0&&d===0?n=0:n=k(Math.atan2(l,d)+this.long0)}return e.x=n,e.y=r,e}var Wf=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const gs={init:Hf,forward:zf,inverse:qf,names:Wf};function Va(e){var t=Math.exp(e);return t=(t-1/t)/2,t}function ie(e,t){e=Math.abs(e),t=Math.abs(t);var s=Math.max(e,t),r=Math.min(e,t)/(s||1);return s*Math.sqrt(1+Math.pow(r,2))}function Jf(e){var t=1+e,s=t-1;return s===0?e:e*Math.log(t)/s}function Kf(e){var t=Math.abs(e);return t=Jf(t*(1+t/(ie(1,t)+1))),e<0?-t:t}function Xr(e,t){for(var s=2*Math.cos(2*t),r=e.length-1,n=e[r],i=0,a;--r>=0;)a=-i+s*n+e[r],i=n,n=a;return t+a*Math.sin(2*t)}function Xf(e,t){for(var s=2*Math.cos(t),r=e.length-1,n=e[r],i=0,a;--r>=0;)a=-i+s*n+e[r],i=n,n=a;return Math.sin(t)*a}function Zf(e){var t=Math.exp(e);return t=(t+1/t)/2,t}function Ga(e,t,s){for(var r=Math.sin(t),n=Math.cos(t),i=Va(s),a=Zf(s),o=2*n*a,l=-2*r*i,h=e.length-1,d=e[h],u=0,f=0,m=0,v,x;--h>=0;)v=f,x=u,f=d,u=m,d=-v+o*f-l*u+e[h],m=-x+l*f+o*u;return o=r*a,l=n*i,[o*d-l*m,o*m+l*d]}function Qf(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(gs.init.apply(this),this.forward=gs.forward,this.inverse=gs.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),s=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),s=s*t,this.cgb[1]=s*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=s*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),s=s*t,this.cgb[2]=s*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=s*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),s=s*t,this.cgb[3]=s*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=s*(1237/630+t*(-12/5+t*(-24832/14175))),s=s*t,this.cgb[4]=s*(4174/315+t*(-144838/6237)),this.cbg[4]=s*(-734/315+t*(109598/31185)),s=s*t,this.cgb[5]=s*(601676/22275),this.cbg[5]=s*(444337/155925),s=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+s*(1/4+s*(1/64+s/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=s*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=s*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),s=s*t,this.utg[2]=s*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=s*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),s=s*t,this.utg[3]=s*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=s*(49561/161280+t*(-179/168+t*(6601661/7257600))),s=s*t,this.utg[4]=s*(-4583/161280+t*(108847/3991680)),this.gtu[4]=s*(34729/80640+t*(-3418889/1995840)),s=s*t,this.utg[5]=s*(-20648693/638668800),this.gtu[5]=s*(212378941/319334400);var r=Xr(this.cbg,this.lat0);this.Zb=-this.Qn*(r+Xf(this.gtu,2*r))}function Yf(e){var t=k(e.x-this.long0),s=e.y;s=Xr(this.cbg,s);var r=Math.sin(s),n=Math.cos(s),i=Math.sin(t),a=Math.cos(t);s=Math.atan2(r,a*n),t=Math.atan2(i*n,ie(r,n*a)),t=Kf(Math.tan(t));var o=Ga(this.gtu,2*s,2*t);s=s+o[0],t=t+o[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*s+this.Zb)+this.y0):(l=1/0,h=1/0),e.x=l,e.y=h,e}function e0(e){var t=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);s=(s-this.Zb)/this.Qn,t=t/this.Qn;var r,n;if(Math.abs(t)<=2.623395162778){var i=Ga(this.utg,2*s,2*t);s=s+i[0],t=t+i[1],t=Math.atan(Va(t));var a=Math.sin(s),o=Math.cos(s),l=Math.sin(t),h=Math.cos(t);s=Math.atan2(a*h,ie(l,h*o)),t=Math.atan2(l,h*o),r=k(t+this.long0),n=Xr(this.cgb,s)}else r=1/0,n=1/0;return e.x=r,e.y=n,e}var t0=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const ps={init:Qf,forward:Yf,inverse:e0,names:t0};function s0(e,t){if(e===void 0){if(e=Math.floor((k(t)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var r0="etmerc";function n0(){var e=s0(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Z,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ps.init.apply(this),this.forward=ps.forward,this.inverse=ps.inverse}var i0=["Universal Transverse Mercator System","utm"];const a0={init:n0,names:i0,dependsOn:r0};function Zr(e,t){return Math.pow((1-e)/(1+e),t)}var o0=20;function l0(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+B)/(Math.pow(Math.tan(.5*this.lat0+B),this.C)*Zr(this.e*e,this.ratexp))}function c0(e){var t=e.x,s=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*s+B),this.C)*Zr(this.e*Math.sin(s),this.ratexp))-S,e.x=this.C*t,e}function h0(e){for(var t=1e-14,s=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+B)/this.K,1/this.C),i=o0;i>0&&(r=2*Math.atan(n*Zr(this.e*Math.sin(e.y),-.5*this.e))-S,!(Math.abs(r-e.y)<t));--i)e.y=r;return i?(e.x=s,e.y=r,e):null}const Qr={init:l0,forward:c0,inverse:h0};function u0(){Qr.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function d0(e){var t,s,r,n;return e.x=k(e.x-this.long0),Qr.forward.apply(this,[e]),t=Math.sin(e.y),s=Math.cos(e.y),r=Math.cos(e.x),n=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*s*r),e.x=n*s*Math.sin(e.x),e.y=n*(this.cosc0*t-this.sinc0*s*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function f0(e){var t,s,r,n,i;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,i=ie(e.x,e.y)){var a=2*Math.atan2(i,this.R2);t=Math.sin(a),s=Math.cos(a),n=Math.asin(s*this.sinc0+e.y*t*this.cosc0/i),r=Math.atan2(e.x*t,i*this.cosc0*s-e.y*this.sinc0*t)}else n=this.phic0,r=0;return e.x=r,e.y=n,Qr.inverse.apply(this,[e]),e.x=k(e.x+this.long0),e}var m0=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const g0={init:u0,forward:d0,inverse:f0,names:m0};function p0(e,t,s){return t*=s,Math.tan(.5*(S+e))*Math.pow((1-t)/(1+t),.5*s)}function v0(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=C&&(this.k0=.5*(1+Qt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=C&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=C&&Math.abs(Math.cos(this.lat_ts))>C&&(this.k0=.5*this.cons*_e(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/fe(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=_e(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-S,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function y0(e){var t=e.x,s=e.y,r=Math.sin(s),n=Math.cos(s),i,a,o,l,h,d,u=k(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=C&&Math.abs(s+this.lat0)<=C?(e.x=NaN,e.y=NaN,e):this.sphere?(i=2*this.k0/(1+this.sinlat0*r+this.coslat0*n*Math.cos(u)),e.x=this.a*i*n*Math.sin(u)+this.x0,e.y=this.a*i*(this.coslat0*r-this.sinlat0*n*Math.cos(u))+this.y0,e):(a=2*Math.atan(this.ssfn_(s,r,this.e))-S,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=C?(h=fe(this.e,s*this.con,this.con*r),d=2*this.a*this.k0*h/this.cons,e.x=this.x0+d*Math.sin(t-this.long0),e.y=this.y0-this.con*d*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<C?(i=2*this.a*this.k0/(1+l*Math.cos(u)),e.y=i*o):(i=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(u))),e.y=i*(this.cosX0*o-this.sinX0*l*Math.cos(u))+this.y0),e.x=i*l*Math.sin(u)+this.x0,e))}function x0(e){e.x-=this.x0,e.y-=this.y0;var t,s,r,n,i,a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,s=this.lat0,a<=C?(e.x=t,e.y=s,e):(s=Math.asin(Math.cos(o)*this.sinlat0+e.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<C?this.lat0>0?t=k(this.long0+Math.atan2(e.x,-1*e.y)):t=k(this.long0+Math.atan2(e.x,e.y)):t=k(this.long0+Math.atan2(e.x*Math.sin(o),a*this.coslat0*Math.cos(o)-e.y*this.sinlat0*Math.sin(o))),e.x=t,e.y=s,e)}else if(Math.abs(this.coslat0)<=C){if(a<=C)return s=this.lat0,t=this.long0,e.x=t,e.y=s,e;e.x*=this.con,e.y*=this.con,r=a*this.cons/(2*this.a*this.k0),s=this.con*Gt(this.e,r),t=this.con*k(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=C?i=this.X0:(i=Math.asin(Math.cos(n)*this.sinX0+e.y*Math.sin(n)*this.cosX0/a),t=k(this.long0+Math.atan2(e.x*Math.sin(n),a*this.cosX0*Math.cos(n)-e.y*this.sinX0*Math.sin(n)))),s=-1*Gt(this.e,Math.tan(.5*(S+i)));return e.x=t,e.y=s,e}var b0=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const _0={init:v0,forward:y0,inverse:x0,names:b0,ssfn_:p0};function w0(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),s=this.a,r=this.rf,n=1/r,i=2*n-Math.pow(n,2),a=this.e=Math.sqrt(i);this.R=this.k0*s*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+e/2)),h=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*l+this.alpha*a/2*h}function M0(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),s=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+s)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),i=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(i))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(i));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*a+this.x0,e}function E0(e){for(var t=e.x-this.x0,s=e.y-this.y0,r=t/this.R,n=2*(Math.atan(Math.exp(s/this.R))-Math.PI/4),i=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),o=this.lambda0+a/this.alpha,l=0,h=i,d=-1e3,u=0;Math.abs(h-d)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+i/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),d=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=o,e.y=h,e}var N0=["somerc"];const S0={init:w0,forward:M0,inverse:E0,names:N0};var rt=1e-7;function I0(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],s=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||t.indexOf(s)!==-1}function C0(){var e,t,s,r,n,i,a,o,l,h,d=0,u,f=0,m=0,v=0,x=0,g=0,w=0;this.no_off=I0(this),this.no_rot="no_rot"in this;var _=!1;"alpha"in this&&(_=!0);var y=!1;if("rectified_grid_angle"in this&&(y=!0),_&&(w=this.alpha),y&&(d=this.rectified_grid_angle*Z),_||y)f=this.longc;else if(m=this.long1,x=this.lat1,v=this.long2,g=this.lat2,Math.abs(x-g)<=rt||(e=Math.abs(x))<=rt||Math.abs(e-S)<=rt||Math.abs(Math.abs(this.lat0)-S)<=rt||Math.abs(Math.abs(g)-S)<=rt)throw new Error;var M=1-this.es;t=Math.sqrt(M),Math.abs(this.lat0)>C?(o=Math.sin(this.lat0),s=Math.cos(this.lat0),e=1-this.es*o*o,this.B=s*s,this.B=Math.sqrt(1+this.es*this.B*this.B/M),this.A=this.B*this.k0*t/e,r=this.B*t/(s*Math.sqrt(e)),n=r*r-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=r,this.E*=Math.pow(fe(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=r=n=1),_||y?(_?(u=Math.asin(Math.sin(w)/r),y||(d=w)):(u=d,w=Math.asin(r*Math.sin(u))),this.lam0=f-Math.asin(.5*(n-1/n)*Math.tan(u))/this.B):(i=Math.pow(fe(this.e,x,Math.sin(x)),this.B),a=Math.pow(fe(this.e,g,Math.sin(g)),this.B),n=this.E/i,l=(a-i)/(a+i),h=this.E*this.E,h=(h-a*i)/(h+a*i),e=m-v,e<-Math.pi?v-=Bt:e>Math.pi&&(v+=Bt),this.lam0=k(.5*(m+v)-Math.atan(h*Math.tan(.5*this.B*(m-v))/l)/this.B),u=Math.atan(2*Math.sin(this.B*k(m-this.lam0))/(n-1/n)),d=w=Math.asin(r*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(w))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(B-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(B+n))}function A0(e){var t={},s,r,n,i,a,o,l,h;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-S)>C){if(a=this.E/Math.pow(fe(this.e,e.y,Math.sin(e.y)),this.B),o=1/a,s=.5*(a-o),r=.5*(a+o),i=Math.sin(this.B*e.x),n=(s*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<C)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*e.x),Math.abs(o)<rt?l=this.A*e.x:l=this.ArB*Math.atan2(s*this.cosgam+i*this.singam,o)}else h=e.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*e.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function k0(e){var t,s,r,n,i,a,o,l={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(s=e.y,t=e.x):(s=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*s),n=.5*(r-1/r),i=.5*(r+1/r),a=Math.sin(this.BrA*t),o=(a*this.cosgam+n*this.singam)/i,Math.abs(Math.abs(o)-1)<C)l.x=0,l.y=o<0?-S:S;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Gt(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(n*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var T0=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const R0={init:C0,forward:A0,inverse:k0,names:T0};function P0(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<C)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),s=Math.cos(this.lat1),r=_e(this.e,t,s),n=fe(this.e,this.lat1,t),i=Math.sin(this.lat2),a=Math.cos(this.lat2),o=_e(this.e,i,a),l=fe(this.e,this.lat2,i),h=fe(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>C?this.ns=Math.log(r/o)/Math.log(n/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function j0(e){var t=e.x,s=e.y;Math.abs(2*Math.abs(s)-Math.PI)<=C&&(s=Qt(s)*(S-2*C));var r=Math.abs(Math.abs(s)-S),n,i;if(r>C)n=fe(this.e,s,Math.sin(s)),i=this.a*this.f0*Math.pow(n,this.ns);else{if(r=s*this.ns,r<=0)return null;i=0}var a=this.ns*k(t-this.long0);return e.x=this.k0*(i*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,e}function O0(e){var t,s,r,n,i,a=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),s=1):(t=-Math.sqrt(a*a+o*o),s=-1);var l=0;if(t!==0&&(l=Math.atan2(s*a,s*o)),t!==0||this.ns>0){if(s=1/this.ns,r=Math.pow(t/(this.a*this.f0),s),n=Gt(this.e,r),n===-9999)return null}else n=-S;return i=k(l/this.ns+this.long0),e.x=i,e.y=n,e}var L0=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const D0={init:P0,forward:j0,inverse:O0,names:L0};function F0(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function $0(e){var t,s,r,n,i,a,o,l=e.x,h=e.y,d=k(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),s=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),r=-d*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(s)+Math.sin(this.ad)*Math.cos(s)*Math.cos(r)),i=Math.asin(Math.cos(s)*Math.sin(r)/Math.cos(n)),a=this.n*i,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),e.y=o*Math.cos(a)/1,e.x=o*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e}function U0(e){var t,s,r,n,i,a,o,l,h=e.x;e.x=e.y,e.y=h,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x),n=i/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),s=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(t)),e.x=this.long0-s/this.alfa,o=t,l=0;var d=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(l=1),o=e.y,d+=1;while(l===0&&d<15);return d>=15?null:e}var B0=["Krovak","krovak"];const V0={init:F0,forward:$0,inverse:U0,names:B0};function te(e,t,s,r,n){return e*n-t*Math.sin(2*n)+s*Math.sin(4*n)-r*Math.sin(6*n)}function Yt(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function es(e){return .375*e*(1+.25*e*(1+.46875*e))}function ts(e){return .05859375*e*e*(1+.75*e)}function ss(e){return e*e*e*(35/3072)}function pt(e,t,s){var r=t*s;return e/Math.sqrt(1-r*r)}function ze(e){return Math.abs(e)<S?e:e-Qt(e)*Math.PI}function ks(e,t,s,r,n){var i,a;i=e/t;for(var o=0;o<15;o++)if(a=(e-(t*i-s*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)))/(t-2*s*Math.cos(2*i)+4*r*Math.cos(4*i)-6*n*Math.cos(6*i)),i+=a,Math.abs(a)<=1e-10)return i;return NaN}function G0(){this.sphere||(this.e0=Yt(this.es),this.e1=es(this.es),this.e2=ts(this.es),this.e3=ss(this.es),this.ml0=this.a*te(this.e0,this.e1,this.e2,this.e3,this.lat0))}function H0(e){var t,s,r=e.x,n=e.y;if(r=k(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(n)*Math.sin(r)),s=this.a*(Math.atan2(Math.tan(n),Math.cos(r))-this.lat0);else{var i=Math.sin(n),a=Math.cos(n),o=pt(this.a,this.e,i),l=Math.tan(n)*Math.tan(n),h=r*Math.cos(n),d=h*h,u=this.es*a*a/(1-this.es),f=this.a*te(this.e0,this.e1,this.e2,this.e3,n);t=o*h*(1-d*l*(1/6-(8-l+8*u)*d/120)),s=f-this.ml0+o*i/a*d*(.5+(5-l+6*u)*d/24)}return e.x=t+this.x0,e.y=s+this.y0,e}function z0(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,s=e.y/this.a,r,n;if(this.sphere){var i=s+this.lat0;r=Math.asin(Math.sin(i)*Math.cos(t)),n=Math.atan2(Math.tan(t),Math.cos(i))}else{var a=this.ml0/this.a+s,o=ks(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-S)<=C)return e.x=this.long0,e.y=S,s<0&&(e.y*=-1),e;var l=pt(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(o),2),u=t*this.a/l,f=u*u;r=o-l*Math.tan(o)/h*u*u*(.5-(1+3*d)*u*u/24),n=u*(1-f*(d/3+(1+3*d)*d*f/15))/Math.cos(o)}return e.x=k(n+this.long0),e.y=ze(r),e}var q0=["Cassini","Cassini_Soldner","cass"];const W0={init:G0,forward:H0,inverse:z0,names:q0};function Ve(e,t){var s;return e>1e-7?(s=e*t,(1-e*e)*(t/(1-s*s)-.5/e*Math.log((1-s)/(1+s)))):2*t}var J0=1,K0=2,X0=3,Z0=4;function Q0(){var e=Math.abs(this.lat0);if(Math.abs(e-S)<C?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<C?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=Ve(this.e,1),this.mmf=.5/(1-this.es),this.apa=om(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Ve(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function Y0(e){var t,s,r,n,i,a,o,l,h,d,u=e.x,f=e.y;if(u=k(u-this.long0),this.sphere){if(i=Math.sin(f),d=Math.cos(f),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(s=this.mode===this.EQUIT?1+d*r:1+this.sinph0*i+this.cosph0*d*r,s<=C)return null;s=Math.sqrt(2/s),t=s*d*Math.sin(u),s*=this.mode===this.EQUIT?i:this.cosph0*i-this.sinph0*d*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(f+this.lat0)<C)return null;s=B-f*.5,s=2*(this.mode===this.S_POLE?Math.cos(s):Math.sin(s)),t=s*Math.sin(u),s*=r}}else{switch(o=0,l=0,h=0,r=Math.cos(u),n=Math.sin(u),i=Math.sin(f),a=Ve(this.e,i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*r;break;case this.EQUIT:h=1+l*r;break;case this.N_POLE:h=S+f,a=this.qp-a;break;case this.S_POLE:h=f-S,a=this.qp+a;break}if(Math.abs(h)<C)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?s=this.ymf*h*(this.cosb1*o-this.sinb1*l*r):s=(h=Math.sqrt(2/(1+l*r)))*o*this.ymf,t=this.xmf*h*l*n;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(h=Math.sqrt(a))*n,s=r*(this.mode===this.S_POLE?h:-h)):t=s=0;break}}return e.x=this.a*t+this.x0,e.y=this.a*s+this.y0,e}function em(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,s=e.y/this.a,r,n,i,a,o,l,h;if(this.sphere){var d=0,u,f=0;if(u=Math.sqrt(t*t+s*s),n=u*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(n),d=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(u)<=C?0:Math.asin(s*f/u),t*=f,s=d*u;break;case this.OBLIQ:n=Math.abs(u)<=C?this.lat0:Math.asin(d*this.sinph0+s*f*this.cosph0/u),t*=f*this.cosph0,s=(d-Math.sin(n)*this.sinph0)*u;break;case this.N_POLE:s=-s,n=S-n;break;case this.S_POLE:n-=S;break}r=s===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,s)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,s*=this.dd,l=Math.sqrt(t*t+s*s),l<C)return e.x=this.long0,e.y=this.lat0,e;a=2*Math.asin(.5*l/this.rq),i=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(h=i*this.sinb1+s*a*this.cosb1/l,o=this.qp*h,s=l*this.cosb1*i-s*this.sinb1*a):(h=s*a/l,o=this.qp*h,s=l*i)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),o=t*t+s*s,!o)return e.x=this.long0,e.y=this.lat0,e;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}r=Math.atan2(t,s),n=lm(Math.asin(h),this.apa)}return e.x=k(this.long0+r),e.y=n,e}var tm=.3333333333333333,sm=.17222222222222222,rm=.10257936507936508,nm=.06388888888888888,im=.0664021164021164,am=.016415012942191543;function om(e){var t,s=[];return s[0]=e*tm,t=e*e,s[0]+=t*sm,s[1]=t*nm,t*=e,s[0]+=t*rm,s[1]+=t*im,s[2]=t*am,s}function lm(e,t){var s=e+e;return e+t[0]*Math.sin(s)+t[1]*Math.sin(s+s)+t[2]*Math.sin(s+s+s)}var cm=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const hm={init:Q0,forward:Y0,inverse:em,names:cm,S_POLE:J0,N_POLE:K0,EQUIT:X0,OBLIQ:Z0};function He(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function um(){Math.abs(this.lat1+this.lat2)<C||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=_e(this.e3,this.sin_po,this.cos_po),this.qs1=Ve(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=_e(this.e3,this.sin_po,this.cos_po),this.qs2=Ve(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Ve(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>C?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function dm(e){var t=e.x,s=e.y;this.sin_phi=Math.sin(s),this.cos_phi=Math.cos(s);var r=Ve(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,i=this.ns0*k(t-this.long0),a=n*Math.sin(i)+this.x0,o=this.rh-n*Math.cos(i)+this.y0;return e.x=a,e.y=o,e}function fm(e){var t,s,r,n,i,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),n=0,t!==0&&(n=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(s=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,s)),i=k(n/this.ns0+this.long0),e.x=i,e.y=a,e}function mm(e,t){var s,r,n,i,a,o=He(.5*t);if(e<C)return o;for(var l=e*e,h=1;h<=25;h++)if(s=Math.sin(o),r=Math.cos(o),n=e*s,i=1-n*n,a=.5*i*i/r*(t/(1-l)-s/i+.5/e*Math.log((1-n)/(1+n))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var gm=["Albers_Conic_Equal_Area","Albers","aea"];const pm={init:um,forward:dm,inverse:fm,names:gm,phi1z:mm};function vm(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function ym(e){var t,s,r,n,i,a,o,l,h=e.x,d=e.y;return r=k(h-this.long0),t=Math.sin(d),s=Math.cos(d),n=Math.cos(r),a=this.sin_p14*t+this.cos_p14*s*n,i=1,a>0||Math.abs(a)<=C?(o=this.x0+this.a*i*s*Math.sin(r)/a,l=this.y0+this.a*i*(this.cos_p14*t-this.sin_p14*s*n)/a):(o=this.x0+this.infinity_dist*s*Math.sin(r),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*s*n)),e.x=o,e.y=l,e}function xm(e){var t,s,r,n,i,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(n=Math.atan2(t,this.rc),s=Math.sin(n),r=Math.cos(n),a=He(r*this.sin_p14+e.y*s*this.cos_p14/t),i=Math.atan2(e.x*s,t*this.cos_p14*r-e.y*this.sin_p14*s),i=k(this.long0+i)):(a=this.phic0,i=0),e.x=i,e.y=a,e}var bm=["gnom"];const _m={init:vm,forward:ym,inverse:xm,names:bm};function wm(e,t){var s=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-s)<1e-6)return t<0?-1*S:S;for(var r=Math.asin(.5*t),n,i,a,o,l=0;l<30;l++)if(i=Math.sin(r),a=Math.cos(r),o=e*i,n=Math.pow(1-o*o,2)/(2*a)*(t/(1-e*e)-i/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),r+=n,Math.abs(n)<=1e-10)return r;return NaN}function Mm(){this.sphere||(this.k0=_e(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function Em(e){var t=e.x,s=e.y,r,n,i=k(t-this.long0);if(this.sphere)r=this.x0+this.a*i*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var a=Ve(this.e,Math.sin(s));r=this.x0+this.a*this.k0*i,n=this.y0+this.a*a*.5/this.k0}return e.x=r,e.y=n,e}function Nm(e){e.x-=this.x0,e.y-=this.y0;var t,s;return this.sphere?(t=k(this.long0+e.x/this.a/Math.cos(this.lat_ts)),s=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(s=wm(this.e,2*e.y*this.k0/this.a),t=k(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=s,e}var Sm=["cea"];const Im={init:Mm,forward:Em,inverse:Nm,names:Sm};function Cm(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Am(e){var t=e.x,s=e.y,r=k(t-this.long0),n=ze(s-this.lat0);return e.x=this.x0+this.a*r*this.rc,e.y=this.y0+this.a*n,e}function km(e){var t=e.x,s=e.y;return e.x=k(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=ze(this.lat0+(s-this.y0)/this.a),e}var Tm=["Equirectangular","Equidistant_Cylindrical","eqc"];const Rm={init:Cm,forward:Am,inverse:km,names:Tm};var di=20;function Pm(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Yt(this.es),this.e1=es(this.es),this.e2=ts(this.es),this.e3=ss(this.es),this.ml0=this.a*te(this.e0,this.e1,this.e2,this.e3,this.lat0)}function jm(e){var t=e.x,s=e.y,r,n,i,a=k(t-this.long0);if(i=a*Math.sin(s),this.sphere)Math.abs(s)<=C?(r=this.a*a,n=-1*this.a*this.lat0):(r=this.a*Math.sin(i)/Math.tan(s),n=this.a*(ze(s-this.lat0)+(1-Math.cos(i))/Math.tan(s)));else if(Math.abs(s)<=C)r=this.a*a,n=-1*this.ml0;else{var o=pt(this.a,this.e,Math.sin(s))/Math.tan(s);r=o*Math.sin(i),n=this.a*te(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*(1-Math.cos(i))}return e.x=r+this.x0,e.y=n+this.y0,e}function Om(e){var t,s,r,n,i,a,o,l,h;if(r=e.x-this.x0,n=e.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=C)t=k(r/this.a+this.long0),s=0;else{a=this.lat0+n/this.a,o=r*r/this.a/this.a+a*a,l=a;var d;for(i=di;i;--i)if(d=Math.tan(l),h=-1*(a*(l*d+1)-l-.5*(l*l+o)*d)/((l-a)/d-1),l+=h,Math.abs(h)<=C){s=l;break}t=k(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(s))}else if(Math.abs(n+this.ml0)<=C)s=0,t=k(this.long0+r/this.a);else{a=(this.ml0+n)/this.a,o=r*r/this.a/this.a+a*a,l=a;var u,f,m,v,x;for(i=di;i;--i)if(x=this.e*Math.sin(l),u=Math.sqrt(1-x*x)*Math.tan(l),f=this.a*te(this.e0,this.e1,this.e2,this.e3,l),m=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),v=f/this.a,h=(a*(u*v+1)-v-.5*u*(v*v+o))/(this.es*Math.sin(2*l)*(v*v+o-2*a*v)/(4*u)+(a-v)*(u*m-2/Math.sin(2*l))-m),l-=h,Math.abs(h)<=C){s=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(s),2))*Math.tan(s),t=k(this.long0+Math.asin(r*u/this.a)/Math.sin(s))}return e.x=t,e.y=s,e}var Lm=["Polyconic","poly"];const Dm={init:Pm,forward:jm,inverse:Om,names:Lm};function Fm(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function $m(e){var t,s=e.x,r=e.y,n=r-this.lat0,i=s-this.long0,a=n/Rt*1e-5,o=i,l=1,h=0;for(t=1;t<=10;t++)l=l*a,h=h+this.A[t]*l;var d=h,u=o,f=1,m=0,v,x,g=0,w=0;for(t=1;t<=6;t++)v=f*d-m*u,x=m*d+f*u,f=v,m=x,g=g+this.B_re[t]*f-this.B_im[t]*m,w=w+this.B_im[t]*f+this.B_re[t]*m;return e.x=w*this.a+this.x0,e.y=g*this.a+this.y0,e}function Um(e){var t,s=e.x,r=e.y,n=s-this.x0,i=r-this.y0,a=i/this.a,o=n/this.a,l=1,h=0,d,u,f=0,m=0;for(t=1;t<=6;t++)d=l*a-h*o,u=h*a+l*o,l=d,h=u,f=f+this.C_re[t]*l-this.C_im[t]*h,m=m+this.C_im[t]*l+this.C_re[t]*h;for(var v=0;v<this.iterations;v++){var x=f,g=m,w,_,y=a,M=o;for(t=2;t<=6;t++)w=x*f-g*m,_=g*f+x*m,x=w,g=_,y=y+(t-1)*(this.B_re[t]*x-this.B_im[t]*g),M=M+(t-1)*(this.B_im[t]*x+this.B_re[t]*g);x=1,g=0;var b=this.B_re[1],E=this.B_im[1];for(t=2;t<=6;t++)w=x*f-g*m,_=g*f+x*m,x=w,g=_,b=b+t*(this.B_re[t]*x-this.B_im[t]*g),E=E+t*(this.B_im[t]*x+this.B_re[t]*g);var N=b*b+E*E;f=(y*b+M*E)/N,m=(M*b-y*E)/N}var I=f,A=m,R=1,T=0;for(t=1;t<=9;t++)R=R*I,T=T+this.D[t]*R;var D=this.lat0+T*Rt*1e5,U=this.long0+A;return e.x=U,e.y=D,e}var Bm=["New_Zealand_Map_Grid","nzmg"];const Vm={init:Fm,forward:$m,inverse:Um,names:Bm};function Gm(){}function Hm(e){var t=e.x,s=e.y,r=k(t-this.long0),n=this.x0+this.a*r,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+s/2.5))*1.25;return e.x=n,e.y=i,e}function zm(e){e.x-=this.x0,e.y-=this.y0;var t=k(this.long0+e.x/this.a),s=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=s,e}var qm=["Miller_Cylindrical","mill"];const Wm={init:Gm,forward:Hm,inverse:zm,names:qm};var Jm=20;function Km(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Jr(this.es)}function Xm(e){var t,s,r=e.x,n=e.y;if(r=k(r-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var i=this.n*Math.sin(n),a=Jm;a;--a){var o=(this.m*n+Math.sin(n)-i)/(this.m+Math.cos(n));if(n-=o,Math.abs(o)<C)break}t=this.a*this.C_x*r*(this.m+Math.cos(n)),s=this.a*this.C_y*n}else{var l=Math.sin(n),h=Math.cos(n);s=this.a*_t(n,l,h,this.en),t=this.a*r*h/Math.sqrt(1-this.es*l*l)}return e.x=t,e.y=s,e}function Zm(e){var t,s,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(t))),this.m?t=He((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=He(Math.sin(t)/this.n)),r=k(r+this.long0),t=ze(t)):(t=Kr(e.y/this.a,this.es,this.en),n=Math.abs(t),n<S?(n=Math.sin(t),s=this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)),r=k(s)):n-C<S&&(r=this.long0)),e.x=r,e.y=t,e}var Qm=["Sinusoidal","sinu"];const Ym={init:Km,forward:Xm,inverse:Zm,names:Qm};function eg(){}function tg(e){for(var t=e.x,s=e.y,r=k(t-this.long0),n=s,i=Math.PI*Math.sin(s);;){var a=-(n+Math.sin(n)-i)/(1+Math.cos(n));if(n+=a,Math.abs(a)<C)break}n/=2,Math.PI/2-Math.abs(s)<C&&(r=0);var o=.900316316158*this.a*r*Math.cos(n)+this.x0,l=1.4142135623731*this.a*Math.sin(n)+this.y0;return e.x=o,e.y=l,e}function sg(e){var t,s;e.x-=this.x0,e.y-=this.y0,s=e.y/(1.4142135623731*this.a),Math.abs(s)>.999999999999&&(s=.999999999999),t=Math.asin(s);var r=k(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),s=(2*t+Math.sin(2*t))/Math.PI,Math.abs(s)>1&&(s=1);var n=Math.asin(s);return e.x=r,e.y=n,e}var rg=["Mollweide","moll"];const ng={init:eg,forward:tg,inverse:sg,names:rg};function ig(){Math.abs(this.lat1+this.lat2)<C||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Yt(this.es),this.e1=es(this.es),this.e2=ts(this.es),this.e3=ss(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=_e(this.e,this.sinphi,this.cosphi),this.ml1=te(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<C?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=_e(this.e,this.sinphi,this.cosphi),this.ml2=te(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=te(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function ag(e){var t=e.x,s=e.y,r;if(this.sphere)r=this.a*(this.g-s);else{var n=te(this.e0,this.e1,this.e2,this.e3,s);r=this.a*(this.g-n)}var i=this.ns*k(t-this.long0),a=this.x0+r*Math.sin(i),o=this.y0+this.rh-r*Math.cos(i);return e.x=a,e.y=o,e}function og(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,s,r,n;this.ns>=0?(s=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(s=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var i=0;if(s!==0&&(i=Math.atan2(t*e.x,t*e.y)),this.sphere)return n=k(this.long0+i/this.ns),r=ze(this.g-s/this.a),e.x=n,e.y=r,e;var a=this.g-s/this.a;return r=ks(a,this.e0,this.e1,this.e2,this.e3),n=k(this.long0+i/this.ns),e.x=n,e.y=r,e}var lg=["Equidistant_Conic","eqdc"];const cg={init:ig,forward:ag,inverse:og,names:lg};function hg(){this.R=this.a}function ug(e){var t=e.x,s=e.y,r=k(t-this.long0),n,i;Math.abs(s)<=C&&(n=this.x0+this.R*r,i=this.y0);var a=He(2*Math.abs(s/Math.PI));(Math.abs(r)<=C||Math.abs(Math.abs(s)-S)<=C)&&(n=this.x0,s>=0?i=this.y0+Math.PI*this.R*Math.tan(.5*a):i=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/r-r/Math.PI),l=o*o,h=Math.sin(a),d=Math.cos(a),u=d/(h+d-1),f=u*u,m=u*(2/h-1),v=m*m,x=Math.PI*this.R*(o*(u-v)+Math.sqrt(l*(u-v)*(u-v)-(v+l)*(f-v)))/(v+l);r<0&&(x=-x),n=this.x0+x;var g=l+u;return x=Math.PI*this.R*(m*g-o*Math.sqrt((v+l)*(l+1)-g*g))/(v+l),s>=0?i=this.y0+x:i=this.y0-x,e.x=n,e.y=i,e}function dg(e){var t,s,r,n,i,a,o,l,h,d,u,f,m;return e.x-=this.x0,e.y-=this.y0,u=Math.PI*this.R,r=e.x/u,n=e.y/u,i=r*r+n*n,a=-Math.abs(n)*(1+i),o=a-2*n*n+r*r,l=-2*a+1+2*n*n+i*i,m=n*n/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,d=2*Math.sqrt(-h/3),u=3*m/h/d,Math.abs(u)>1&&(u>=0?u=1:u=-1),f=Math.acos(u)/3,e.y>=0?s=(-d*Math.cos(f+Math.PI/3)-o/3/l)*Math.PI:s=-(-d*Math.cos(f+Math.PI/3)-o/3/l)*Math.PI,Math.abs(r)<C?t=this.long0:t=k(this.long0+Math.PI*(i-1+Math.sqrt(1+2*(r*r-n*n)+i*i))/2/r),e.x=t,e.y=s,e}var fg=["Van_der_Grinten_I","VanDerGrinten","vandg"];const mg={init:hg,forward:ug,inverse:dg,names:fg};function gg(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function pg(e){var t=e.x,s=e.y,r=Math.sin(e.y),n=Math.cos(e.y),i=k(t-this.long0),a,o,l,h,d,u,f,m,v,x,g,w,_,y,M,b,E,N,I,A,R,T,D;return this.sphere?Math.abs(this.sin_p12-1)<=C?(e.x=this.x0+this.a*(S-s)*Math.sin(i),e.y=this.y0-this.a*(S-s)*Math.cos(i),e):Math.abs(this.sin_p12+1)<=C?(e.x=this.x0+this.a*(S+s)*Math.sin(i),e.y=this.y0+this.a*(S+s)*Math.cos(i),e):(N=this.sin_p12*r+this.cos_p12*n*Math.cos(i),b=Math.acos(N),E=b?b/Math.sin(b):1,e.x=this.x0+this.a*E*n*Math.sin(i),e.y=this.y0+this.a*E*(this.cos_p12*r-this.sin_p12*n*Math.cos(i)),e):(a=Yt(this.es),o=es(this.es),l=ts(this.es),h=ss(this.es),Math.abs(this.sin_p12-1)<=C?(d=this.a*te(a,o,l,h,S),u=this.a*te(a,o,l,h,s),e.x=this.x0+(d-u)*Math.sin(i),e.y=this.y0-(d-u)*Math.cos(i),e):Math.abs(this.sin_p12+1)<=C?(d=this.a*te(a,o,l,h,S),u=this.a*te(a,o,l,h,s),e.x=this.x0+(d+u)*Math.sin(i),e.y=this.y0+(d+u)*Math.cos(i),e):(f=r/n,m=pt(this.a,this.e,this.sin_p12),v=pt(this.a,this.e,r),x=Math.atan((1-this.es)*f+this.es*m*this.sin_p12/(v*n)),g=Math.atan2(Math.sin(i),this.cos_p12*Math.tan(x)-this.sin_p12*Math.cos(i)),g===0?I=Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.abs(Math.abs(g)-Math.PI)<=C?I=-Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):I=Math.asin(Math.sin(i)*Math.cos(x)/Math.sin(g)),w=this.e*this.sin_p12/Math.sqrt(1-this.es),_=this.e*this.cos_p12*Math.cos(g)/Math.sqrt(1-this.es),y=w*_,M=_*_,A=I*I,R=A*I,T=R*I,D=T*I,b=m*I*(1-A*M*(1-M)/6+R/8*y*(1-2*M)+T/120*(M*(4-7*M)-3*w*w*(1-7*M))-D/48*y),e.x=this.x0+b*Math.sin(g),e.y=this.y0+b*Math.cos(g),e))}function vg(e){e.x-=this.x0,e.y-=this.y0;var t,s,r,n,i,a,o,l,h,d,u,f,m,v,x,g,w,_,y,M,b,E,N,I;return this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y),t>2*S*this.a?void 0:(s=t/this.a,r=Math.sin(s),n=Math.cos(s),i=this.long0,Math.abs(t)<=C?a=this.lat0:(a=He(n*this.sin_p12+e.y*r*this.cos_p12/t),o=Math.abs(this.lat0)-S,Math.abs(o)<=C?this.lat0>=0?i=k(this.long0+Math.atan2(e.x,-e.y)):i=k(this.long0-Math.atan2(-e.x,e.y)):i=k(this.long0+Math.atan2(e.x*r,t*this.cos_p12*n-e.y*this.sin_p12*r))),e.x=i,e.y=a,e)):(l=Yt(this.es),h=es(this.es),d=ts(this.es),u=ss(this.es),Math.abs(this.sin_p12-1)<=C?(f=this.a*te(l,h,d,u,S),t=Math.sqrt(e.x*e.x+e.y*e.y),m=f-t,a=ks(m/this.a,l,h,d,u),i=k(this.long0+Math.atan2(e.x,-1*e.y)),e.x=i,e.y=a,e):Math.abs(this.sin_p12+1)<=C?(f=this.a*te(l,h,d,u,S),t=Math.sqrt(e.x*e.x+e.y*e.y),m=t-f,a=ks(m/this.a,l,h,d,u),i=k(this.long0+Math.atan2(e.x,e.y)),e.x=i,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),g=Math.atan2(e.x,e.y),v=pt(this.a,this.e,this.sin_p12),w=Math.cos(g),_=this.e*this.cos_p12*w,y=-_*_/(1-this.es),M=3*this.es*(1-y)*this.sin_p12*this.cos_p12*w/(1-this.es),b=t/v,E=b-y*(1+y)*Math.pow(b,3)/6-M*(1+3*y)*Math.pow(b,4)/24,N=1-y*E*E/2-b*E*E*E/6,x=Math.asin(this.sin_p12*Math.cos(E)+this.cos_p12*Math.sin(E)*w),i=k(this.long0+Math.asin(Math.sin(g)*Math.sin(E)/Math.cos(x))),I=Math.sin(x),a=Math.atan2((I-this.es*N*this.sin_p12)*Math.tan(x),I*(1-this.es)),e.x=i,e.y=a,e))}var yg=["Azimuthal_Equidistant","aeqd"];const xg={init:gg,forward:pg,inverse:vg,names:yg};function bg(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function _g(e){var t,s,r,n,i,a,o,l,h=e.x,d=e.y;return r=k(h-this.long0),t=Math.sin(d),s=Math.cos(d),n=Math.cos(r),a=this.sin_p14*t+this.cos_p14*s*n,i=1,(a>0||Math.abs(a)<=C)&&(o=this.a*i*s*Math.sin(r),l=this.y0+this.a*i*(this.cos_p14*t-this.sin_p14*s*n)),e.x=o,e.y=l,e}function wg(e){var t,s,r,n,i,a,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),s=He(t/this.a),r=Math.sin(s),n=Math.cos(s),a=this.long0,Math.abs(t)<=C?(o=this.lat0,e.x=a,e.y=o,e):(o=He(n*this.sin_p14+e.y*r*this.cos_p14/t),i=Math.abs(this.lat0)-S,Math.abs(i)<=C?(this.lat0>=0?a=k(this.long0+Math.atan2(e.x,-e.y)):a=k(this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=o,e):(a=k(this.long0+Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r)),e.x=a,e.y=o,e))}var Mg=["ortho"];const Eg={init:bg,forward:_g,inverse:wg,names:Mg};var K={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},V={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Ng(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=S-B/2?this.face=K.TOP:this.lat0<=-(S-B/2)?this.face=K.BOTTOM:Math.abs(this.long0)<=B?this.face=K.FRONT:Math.abs(this.long0)<=S+B?this.face=this.long0>0?K.RIGHT:K.LEFT:this.face=K.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Sg(e){var t={x:0,y:0},s,r,n,i,a,o,l={value:0};if(e.x-=this.long0,this.es!==0?s=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):s=e.y,r=e.x,this.face===K.TOP)i=S-s,r>=B&&r<=S+B?(l.value=V.AREA_0,n=r-S):r>S+B||r<=-(S+B)?(l.value=V.AREA_1,n=r>0?r-Q:r+Q):r>-(S+B)&&r<=-B?(l.value=V.AREA_2,n=r+S):(l.value=V.AREA_3,n=r);else if(this.face===K.BOTTOM)i=S+s,r>=B&&r<=S+B?(l.value=V.AREA_0,n=-r+S):r<B&&r>=-B?(l.value=V.AREA_1,n=-r):r<-B&&r>=-(S+B)?(l.value=V.AREA_2,n=-r-S):(l.value=V.AREA_3,n=r>0?-r+Q:-r-Q);else{var h,d,u,f,m,v,x;this.face===K.RIGHT?r=dt(r,+S):this.face===K.BACK?r=dt(r,3.14159265359):this.face===K.LEFT&&(r=dt(r,-S)),f=Math.sin(s),m=Math.cos(s),v=Math.sin(r),x=Math.cos(r),h=m*x,d=m*v,u=f,this.face===K.FRONT?(i=Math.acos(h),n=ls(i,u,d,l)):this.face===K.RIGHT?(i=Math.acos(d),n=ls(i,u,-h,l)):this.face===K.BACK?(i=Math.acos(-h),n=ls(i,u,-d,l)):this.face===K.LEFT?(i=Math.acos(-d),n=ls(i,u,h,l)):(i=n=0,l.value=V.AREA_0)}return o=Math.atan(12/Q*(n+Math.acos(Math.sin(n)*Math.cos(B))-S)),a=Math.sqrt((1-Math.cos(i))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===V.AREA_1?o+=S:l.value===V.AREA_2?o+=Q:l.value===V.AREA_3&&(o+=1.5*Q),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e}function Ig(e){var t={lam:0,phi:0},s,r,n,i,a,o,l,h,d,u={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),s=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?u.value=V.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(u.value=V.AREA_1,s-=S):e.x<0&&-e.x>=Math.abs(e.y)?(u.value=V.AREA_2,s=s<0?s+Q:s-Q):(u.value=V.AREA_3,s+=S),d=Q/12*Math.tan(s),a=Math.sin(d)/(Math.cos(d)-1/Math.sqrt(2)),o=Math.atan(a),n=Math.cos(s),i=Math.tan(r),l=1-n*n*i*i*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===K.TOP)h=Math.acos(l),t.phi=S-h,u.value===V.AREA_0?t.lam=o+S:u.value===V.AREA_1?t.lam=o<0?o+Q:o-Q:u.value===V.AREA_2?t.lam=o-S:t.lam=o;else if(this.face===K.BOTTOM)h=Math.acos(l),t.phi=h-S,u.value===V.AREA_0?t.lam=-o+S:u.value===V.AREA_1?t.lam=-o:u.value===V.AREA_2?t.lam=-o-S:t.lam=o<0?-o-Q:-o+Q;else{var f,m,v;f=l,d=f*f,d>=1?v=0:v=Math.sqrt(1-d)*Math.sin(o),d+=v*v,d>=1?m=0:m=Math.sqrt(1-d),u.value===V.AREA_1?(d=m,m=-v,v=d):u.value===V.AREA_2?(m=-m,v=-v):u.value===V.AREA_3&&(d=m,m=v,v=-d),this.face===K.RIGHT?(d=f,f=-m,m=d):this.face===K.BACK?(f=-f,m=-m):this.face===K.LEFT&&(d=f,f=m,m=-d),t.phi=Math.acos(-v)-S,t.lam=Math.atan2(m,f),this.face===K.RIGHT?t.lam=dt(t.lam,-S):this.face===K.BACK?t.lam=dt(t.lam,-3.14159265359):this.face===K.LEFT&&(t.lam=dt(t.lam,+S))}if(this.es!==0){var x,g,w;x=t.phi<0?1:0,g=Math.tan(t.phi),w=this.b/Math.sqrt(g*g+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-w*w)/(this.one_minus_f*w)),x&&(t.phi=-t.phi)}return t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e}function ls(e,t,s,r){var n;return e<C?(r.value=V.AREA_0,n=0):(n=Math.atan2(t,s),Math.abs(n)<=B?r.value=V.AREA_0:n>B&&n<=S+B?(r.value=V.AREA_1,n-=S):n>S+B||n<=-(S+B)?(r.value=V.AREA_2,n=n>=0?n-Q:n+Q):(r.value=V.AREA_3,n+=S)),n}function dt(e,t){var s=e+t;return s<-3.14159265359?s+=Bt:s>3.14159265359&&(s-=Bt),s}var Cg=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Ag={init:Ng,forward:Sg,inverse:Ig,names:Cg};var Mr=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],At=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ha=.8487,za=1.3523,qa=pe/5,kg=1/qa,ot=18,Ts=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},Tg=function(e,t){return e[1]+t*(2*e[2]+t*3*e[3])};function Rg(e,t,s,r){for(var n=t;r;--r){var i=e(n);if(n-=i,Math.abs(i)<s)break}return n}function Pg(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function jg(e){var t=k(e.x-this.long0),s=Math.abs(e.y),r=Math.floor(s*qa);r<0?r=0:r>=ot&&(r=ot-1),s=pe*(s-kg*r);var n={x:Ts(Mr[r],s)*t,y:Ts(At[r],s)};return e.y<0&&(n.y=-n.y),n.x=n.x*this.a*Ha+this.x0,n.y=n.y*this.a*za+this.y0,n}function Og(e){var t={x:(e.x-this.x0)/(this.a*Ha),y:Math.abs(e.y-this.y0)/(this.a*za)};if(t.y>=1)t.x/=Mr[ot][0],t.y=e.y<0?-S:S;else{var s=Math.floor(t.y*ot);for(s<0?s=0:s>=ot&&(s=ot-1);;)if(At[s][0]>t.y)--s;else if(At[s+1][0]<=t.y)++s;else break;var r=At[s],n=5*(t.y-r[0])/(At[s+1][0]-r[0]);n=Rg(function(i){return(Ts(r,i)-t.y)/Tg(r,i)},n,C,100),t.x/=Ts(Mr[s],n),t.y=(5*s+n)*Z,e.y<0&&(t.y=-t.y)}return t.x=k(t.x+this.long0),t}var Lg=["Robinson","robin"];const Dg={init:Pg,forward:jg,inverse:Og,names:Lg};function Fg(){this.name="geocent"}function $g(e){var t=Pa(e,this.es,this.a);return t}function Ug(e){var t=ja(e,this.es,this.a,this.b);return t}var Bg=["Geocentric","geocentric","geocent","Geocent"];const Vg={init:Fg,forward:$g,inverse:Ug,names:Bg};var Y={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Mt={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Gg(){if(Object.keys(Mt).forEach((function(s){if(typeof this[s]>"u")this[s]=Mt[s].def;else{if(Mt[s].num&&isNaN(this[s]))throw new Error("Invalid parameter value, must be numeric "+s+" = "+this[s]);Mt[s].num&&(this[s]=parseFloat(this[s]))}Mt[s].degrees&&(this[s]=this[s]*Z)}).bind(this)),Math.abs(Math.abs(this.lat0)-S)<C?this.mode=this.lat0<0?Y.S_POLE:Y.N_POLE:Math.abs(this.lat0)<C?this.mode=Y.EQUIT:(this.mode=Y.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)}function Hg(e){e.x-=this.long0;var t=Math.sin(e.y),s=Math.cos(e.y),r=Math.cos(e.x),n,i;switch(this.mode){case Y.OBLIQ:i=this.sinph0*t+this.cosph0*s*r;break;case Y.EQUIT:i=s*r;break;case Y.S_POLE:i=-t;break;case Y.N_POLE:i=t;break}switch(i=this.pn1/(this.p-i),n=i*s*Math.sin(e.x),this.mode){case Y.OBLIQ:i*=this.cosph0*t-this.sinph0*s*r;break;case Y.EQUIT:i*=t;break;case Y.N_POLE:i*=-(s*r);break;case Y.S_POLE:i*=s*r;break}var a,o;return a=i*this.cg+n*this.sg,o=1/(a*this.sw*this.h1+this.cw),n=(n*this.cg-i*this.sg)*this.cw*o,i=a*o,e.x=n*this.a,e.y=i*this.a,e}function zg(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},s,r,n;n=1/(this.pn1-e.y*this.sw),s=this.pn1*e.x*n,r=this.pn1*e.y*this.cw*n,e.x=s*this.cg+r*this.sg,e.y=r*this.cg-s*this.sg;var i=ie(e.x,e.y);if(Math.abs(i)<C)t.x=0,t.y=e.y;else{var a,o;switch(o=1-i*i*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/i+i/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Y.OBLIQ:t.y=Math.asin(a*this.sinph0+e.y*o*this.cosph0/i),e.y=(a-this.sinph0*Math.sin(t.y))*i,e.x*=o*this.cosph0;break;case Y.EQUIT:t.y=Math.asin(e.y*o/i),e.y=a*i,e.x*=o;break;case Y.N_POLE:t.y=Math.asin(a),e.y=-e.y;break;case Y.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e}var qg=["Tilted_Perspective","tpers"];const Wg={init:Gg,forward:Hg,inverse:zg,names:qg};function Jg(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function Kg(e){var t=e.x,s=e.y,r,n,i,a;if(t=t-this.long0,this.shape==="ellipse"){s=Math.atan(this.radius_p2*Math.tan(s));var o=this.radius_p/ie(this.radius_p*Math.cos(s),Math.sin(s));if(n=o*Math.cos(t)*Math.cos(s),i=o*Math.sin(t)*Math.cos(s),a=o*Math.sin(s),(this.radius_g-n)*n-i*i-a*a*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(i/ie(a,r)),e.y=this.radius_g_1*Math.atan(a/r)):(e.x=this.radius_g_1*Math.atan(i/r),e.y=this.radius_g_1*Math.atan(a/ie(i,r)))}else this.shape==="sphere"&&(r=Math.cos(s),n=Math.cos(t)*r,i=Math.sin(t)*r,a=Math.sin(s),r=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(i/ie(a,r)),e.y=this.radius_g_1*Math.atan(a/r)):(e.x=this.radius_g_1*Math.atan(i/r),e.y=this.radius_g_1*Math.atan(a/ie(i,r))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function Xg(e){var t=-1,s=0,r=0,n,i,a,o;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*ie(1,r)):(s=Math.tan(e.x/this.radius_g_1),r=Math.tan(e.y/this.radius_g_1)*ie(1,s));var l=r/this.radius_p;if(n=s*s+l*l+t*t,i=2*this.radius_g*t,a=i*i-4*n*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-i-Math.sqrt(a))/(2*n),t=this.radius_g+o*t,s*=o,r*=o,e.x=Math.atan2(s,t),e.y=Math.atan(r*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+r*r)):(s=Math.tan(e.x/this.radius_g_1),r=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+s*s)),n=s*s+r*r+t*t,i=2*this.radius_g*t,a=i*i-4*n*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-i-Math.sqrt(a))/(2*n),t=this.radius_g+o*t,s*=o,r*=o,e.x=Math.atan2(s,t),e.y=Math.atan(r*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e}var Zg=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Qg={init:Jg,forward:Kg,inverse:Xg,names:Zg};var Pt=1.340264,jt=-.081106,Ot=893e-6,Lt=.003796,Rs=Math.sqrt(3)/2;function Yg(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function ep(e){var t=k(e.x-this.long0),s=e.y,r=Math.asin(Rs*Math.sin(s)),n=r*r,i=n*n*n;return e.x=t*Math.cos(r)/(Rs*(Pt+3*jt*n+i*(7*Ot+9*Lt*n))),e.y=r*(Pt+jt*n+i*(Ot+Lt*n)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function tp(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t=1e-9,s=12,r=e.y,n,i,a,o,l,h;for(h=0;h<s&&(n=r*r,i=n*n*n,a=r*(Pt+jt*n+i*(Ot+Lt*n))-e.y,o=Pt+3*jt*n+i*(7*Ot+9*Lt*n),r-=l=a/o,!(Math.abs(l)<t));++h);return n=r*r,i=n*n*n,e.x=Rs*e.x*(Pt+3*jt*n+i*(7*Ot+9*Lt*n))/Math.cos(r),e.y=Math.asin(Math.sin(r)/Rs),e.x=k(e.x+this.long0),e}var sp=["eqearth","Equal Earth","Equal_Earth"];const rp={init:Yg,forward:ep,inverse:tp,names:sp};var Ht=1e-10;function np(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<Ht)throw new Error;this.es?(this.en=Jr(this.es),this.m1=_t(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=ap,this.forward=ip):(Math.abs(this.phi1)+Ht>=S?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=lp,this.forward=op)}function ip(e){var t=k(e.x-(this.long0||0)),s=e.y,r,n,i;return r=this.am1+this.m1-_t(s,n=Math.sin(s),i=Math.cos(s),this.en),n=i*t/(r*Math.sqrt(1-this.es*n*n)),e.x=r*Math.sin(n),e.y=this.am1-r*Math.cos(n),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function ap(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,s,r,n;if(s=ie(e.x,e.y=this.am1-e.y),n=Kr(this.am1+this.m1-s,this.es,this.en),(t=Math.abs(n))<S)t=Math.sin(n),r=s*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(n);else if(Math.abs(t-S)<=Ht)r=0;else throw new Error;return e.x=k(r+(this.long0||0)),e.y=ze(n),e}function op(e){var t=k(e.x-(this.long0||0)),s=e.y,r,n;return n=this.cphi1+this.phi1-s,Math.abs(n)>Ht?(e.x=n*Math.sin(r=t*Math.cos(s)/n),e.y=this.cphi1-n*Math.cos(r)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function lp(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,s,r=ie(e.x,e.y=this.cphi1-e.y);if(s=this.cphi1+this.phi1-r,Math.abs(s)>S)throw new Error;return Math.abs(Math.abs(s)-S)<=Ht?t=0:t=r*Math.atan2(e.x,e.y)/Math.cos(s),e.x=k(t+(this.long0||0)),e.y=ze(s),e}var cp=["bonne","Bonne (Werner lat_1=90)"];const hp={init:np,names:cp};function up(e){e.Proj.projections.add(gs),e.Proj.projections.add(ps),e.Proj.projections.add(a0),e.Proj.projections.add(g0),e.Proj.projections.add(_0),e.Proj.projections.add(S0),e.Proj.projections.add(R0),e.Proj.projections.add(D0),e.Proj.projections.add(V0),e.Proj.projections.add(W0),e.Proj.projections.add(hm),e.Proj.projections.add(pm),e.Proj.projections.add(_m),e.Proj.projections.add(Im),e.Proj.projections.add(Rm),e.Proj.projections.add(Dm),e.Proj.projections.add(Vm),e.Proj.projections.add(Wm),e.Proj.projections.add(Ym),e.Proj.projections.add(ng),e.Proj.projections.add(cg),e.Proj.projections.add(mg),e.Proj.projections.add(xg),e.Proj.projections.add(Eg),e.Proj.projections.add(Ag),e.Proj.projections.add(Dg),e.Proj.projections.add(Vg),e.Proj.projections.add(Wg),e.Proj.projections.add(Qg),e.Proj.projections.add(rp),e.Proj.projections.add(hp)}re.defaultDatum="WGS84";re.Proj=ye;re.WGS84=new re.Proj("WGS84");re.Point=gt;re.toPoint=Oa;re.defs=ee;re.nadgrid=lf;re.transform=As;re.mgrs=Ef;re.version="__VERSION__";up(re);var Wa,fi="deflate-raw",mi=self.DecompressionStream;try{new mi(fi),Wa=async e=>{let t=new mi(fi),s=t.writable.getWriter(),r=t.readable.getReader();s.write(e),s.close();let n,i=[],a=0,o=0,l;for(;!(l=await r.read()).done;)n=l.value,i.push(n),a+=n.length;return i.length-1?(n=new Uint8Array(a),i.map(h=>{n.set(h,o),o+=h.length}),n):i[0]}}catch{}var dp=new TextDecoder,ir=e=>{throw new Error("but-unzip~"+e)},gi=e=>dp.decode(e),fp=e=>{let t=e.length-20,s=Math.max(t-65516,2);for(;(t=e.lastIndexOf(80,t-1))!==-1&&!(e[t+1]===75&&e[t+2]===5&&e[t+3]===6)&&t>s;);return t};function*mp(e,t=Wa){let s=fp(e);s===-1&&ir(2);let r=(l,h)=>e.subarray(s+=l,s+=h),n=new DataView(e.buffer,e.byteOffset),i=l=>n.getUint16(l+s,!0),a=l=>n.getUint32(l+s,!0),o=i(10);for(o!==i(8)&&ir(3),s=a(16);o--;){let l=i(10),h=i(28),d=i(30),u=i(32),f=a(20),m=a(42),v=gi(r(46,h)),x=gi(r(d,u)),g=s,w;s=m,w=r(30+i(26)+i(28),f),yield{filename:v,comment:x,read:()=>l&8?t(w):l?ir(1):w},s=g}}const gp=/.+\.(shp|dbf|json|prj|cpg)$/i,pp=async e=>{const t={},s=[];for(const i of mp(e))gp.test(i.filename)&&s.push(Promise.resolve(i.read()).then(a=>t[i.filename]=a));await Promise.all(s);const r={},n=new TextDecoder;for(const[i,a]of Object.entries(t))i.slice(-3).toLowerCase()==="shp"||i.slice(-3).toLowerCase()==="dbf"?r[i]=new DataView(a.buffer,a.byteOffset,a.byteLength):r[i]=n.decode(a);return r},vp=globalThis.URL,yp=(e,t)=>{if(!t)return e;const s=new vp(e);return s.pathname=`${s.pathname}.${t}`,s.href};async function zt(e,t){const s=yp(e,t),r=t==="prj"||t==="cpg";try{const n=await fetch(s);if(n.status>399)throw new Error(n.statusText);if(r)return n.text();const i=await n.arrayBuffer();return new DataView(i)}catch(n){if(r||t==="dbf")return!1;throw n}}function xp(e){let t=0,s=1;const r=e.length;let n,i;const a=[e[0][0],e[0][1],e[0][0],e[0][1]];for(;s<r;)n=i||e[0],i=e[s],t+=(i[0]-n[0])*(i[1]+n[1]),s++,i[0]<a[0]&&(a[0]=i[0]),i[1]<a[1]&&(a[1]=i[1]),i[0]>a[2]&&(a[2]=i[0]),i[1]>a[3]&&(a[3]=i[1]);return{ring:e,clockWise:t>0,bbox:a,children:[]}}function bp(e,t){return!(e.bbox[0]>t.bbox[0]||e.bbox[1]>t.bbox[1]||e.bbox[2]<t.bbox[2]||e.bbox[3]<t.bbox[3])}function _p(e){const t=[],s=[];for(const n of e){const i=xp(n);i.clockWise?t.push(i):s.push(i)}for(const n of s)for(const i of t)if(bp(i,n)){i.children.push(n.ring);break}const r=[];for(const n of t)r.push([n.ring].concat(n.children));return r}X.prototype.parsePoint=function(e){return{type:"Point",coordinates:this.parseCoord(e,0)}};X.prototype.parseZPoint=function(e){const t=this.parsePoint(e);return t.coordinates.push(e.getFloat64(16,!0)),t};X.prototype.parsePointArray=function(e,t,s){const r=[];let n=0;for(;n<s;)r.push(this.parseCoord(e,t)),t+=16,n++;return r};X.prototype.parseZPointArray=function(e,t,s,r){let n=0;for(;n<s;)r[n].push(e.getFloat64(t,!0)),n++,t+=8;return r};X.prototype.parseArrayGroup=function(e,t,s,r,n){const i=[];let a=0,o,l=0,h;for(;a<r;)a++,s+=4,o=l,a===r?l=n:l=e.getInt32(s,!0),h=l-o,h&&(i.push(this.parsePointArray(e,t,h)),t+=h<<4);return i};X.prototype.parseZArrayGroup=function(e,t,s,r){let n=0;for(;n<s;)r[n]=this.parseZPointArray(e,t,r[n].length,r[n]),t+=r[n].length<<3,n++;return r};X.prototype.parseMultiPoint=function(e){const t={},s=e.getInt32(32,!0);if(!s)return null;const r=this.parseCoord(e,0),n=this.parseCoord(e,16);t.bbox=[r[0],r[1],n[0],n[1]];const i=36;return s===1?(t.type="Point",t.coordinates=this.parseCoord(e,i)):(t.type="MultiPoint",t.coordinates=this.parsePointArray(e,i,s)),t};X.prototype.parseZMultiPoint=function(e){const t=this.parseMultiPoint(e);if(!t)return null;let s;if(t.type==="Point")return t.coordinates.push(e.getFloat64(72,!0)),t;s=t.coordinates.length;const r=52+(s<<4);return t.coordinates=this.parseZPointArray(e,r,s,t.coordinates),t};X.prototype.parsePolyline=function(e){const t={},s=e.getInt32(32,!0);if(!s)return null;const r=this.parseCoord(e,0),n=this.parseCoord(e,16);t.bbox=[r[0],r[1],n[0],n[1]];const i=e.getInt32(36,!0);let a,o;return s===1?(t.type="LineString",a=44,t.coordinates=this.parsePointArray(e,a,i)):(t.type="MultiLineString",a=40+(s<<2),o=40,t.coordinates=this.parseArrayGroup(e,a,o,s,i)),t};X.prototype.parseZPolyline=function(e){const t=this.parsePolyline(e);if(!t)return null;const s=t.coordinates.length;let r;return t.type==="LineString"?(r=60+(s<<4),t.coordinates=this.parseZPointArray(e,r,s,t.coordinates),t):(r=56+(t.coordinates.reduce(function(i,a){return i+a.length},0)<<4)+(s<<2),t.coordinates=this.parseZArrayGroup(e,r,s,t.coordinates),t)};X.prototype.polyFuncs=function(e){return e&&(e.type==="LineString"?(e.type="Polygon",e.coordinates=[e.coordinates],e):(e.coordinates=_p(e.coordinates),e.coordinates.length===1?(e.type="Polygon",e.coordinates=e.coordinates[0],e):(e.type="MultiPolygon",e)))};X.prototype.parsePolygon=function(e){return this.polyFuncs(this.parsePolyline(e))};X.prototype.parseZPolygon=function(e){return this.polyFuncs(this.parseZPolyline(e))};const pi={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function wp(e){return e?function(t,s){const r=[t.getFloat64(s,!0),t.getFloat64(s+8,!0)];return e.inverse(r)}:function(t,s){return[t.getFloat64(s,!0),t.getFloat64(s+8,!0)]}}function X(e,t){if(!(this instanceof X))return new X(e,t);this.buffer=e,this.headers=this.parseHeader(),this.shpFuncs(t),this.rows=this.getRows()}X.prototype.shpFuncs=function(e){let t=this.headers.shpCode;if(t>20&&(t-=20),!(t in pi))throw new Error(`I don't know shp type "${t}"`);this.parseFunc=this[pi[t]],this.parseCoord=wp(e)};X.prototype.getShpCode=function(){return this.parseHeader().shpCode};X.prototype.parseHeader=function(){const e=this.buffer;return{length:e.getInt32(24)<<1,version:e.getInt32(28,!0),shpCode:e.getInt32(32,!0),bbox:[e.getFloat64(36,!0),e.getFloat64(44,!0),e.getFloat64(52,!0),e.getFloat64(60,!0)]}};X.prototype.getRows=function(){let e=100;const t=this.buffer.byteLength-8,s=[];let r;for(;e<=t&&(r=this.getRow(e),!!r);)e+=8,e+=r.len,r.type?s.push(this.parseFunc(r.data)):s.push(null);return s};X.prototype.getRow=function(e){const t=this.buffer.getInt32(e),s=this.buffer.getInt32(e+4)<<1;if(s===0)return{id:t,len:s,type:0};if(!(e+s+8>this.buffer.byteLength))return{id:t,len:s,data:new DataView(this.buffer.buffer,this.buffer.byteOffset+e+12,s-4),type:this.buffer.getInt32(e+8,!0)}};function Yr(e,t){return new X(e,t).rows}var Mp=/^(?:ANSI\s)?(\d+)$/m;function Ja(e,t){if(!e)return r;try{new TextDecoder(e.trim())}catch{var s=Mp.exec(e);return s&&!t?Ja("windows-"+s[1],!0):(e=void 0,r)}return r;function r(n){var i=new TextDecoder(e||void 0),a=i.decode(n,{stream:!0})+i.decode();return a.replace(/\0/g,"").trim()}}function Ep(e){var t={};return t.lastUpdated=new Date(e.getUint8(1)+1900,e.getUint8(2),e.getUint8(3)),t.records=e.getUint32(4,!0),t.headerLen=e.getUint16(8,!0),t.recLen=e.getUint16(10,!0),t}function Np(e,t,s){for(var r=[],n=32;n<t&&(r.push({name:s(new Uint8Array(e.buffer.slice(e.byteOffset+n,e.byteOffset+n+11))),dataType:String.fromCharCode(e.getUint8(n+11)),len:e.getUint8(n+16),decimal:e.getUint8(n+17)}),e.getUint8(n+32)!==13);)n+=32;return r}function Sp(e,t,s,r,n){const i=new Uint8Array(e.buffer.slice(e.byteOffset+t,e.byteOffset+t+s));var a=n(i);switch(r){case"N":case"F":case"O":return parseFloat(a,10);case"D":return new Date(a.slice(0,4),parseInt(a.slice(4,6),10)-1,a.slice(6,8));case"L":return a.toLowerCase()==="y"||a.toLowerCase()==="t";default:return a}}function Ip(e,t,s,r){for(var n={},i=0,a=s.length,o,l;i<a;)l=s[i],o=Sp(e,t,l.len,l.dataType,r),t+=l.len,typeof o<"u"&&(n[l.name]=o),i++;return n}function en(e,t){for(var s=Ja(t),r=Ep(e),n=Np(e,r.headerLen-1,s),i=(n.length+1<<5)+2,a=r.recLen,o=r.records,l=[];o;)l.push(Ip(e,i,n,s)),i+=a,o--;return l}const Cp=globalThis.URL,Ap=e=>{if(!e)throw new Error("forgot to pass buffer");if(vt(e))return new Uint8Array(e);if(vt(e.buffer))return e.BYTES_PER_ELEMENT===1?e:new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")},kp=new TextDecoder,Ka=e=>{if(e){if(typeof e=="string")return e;if(vt(e)||ArrayBuffer.isView(e)||tn(e))return kp.decode(e)}},Xa=e=>{if(!e)throw new Error("forgot to pass buffer");if(tn(e))return e;if(vt(e))return new DataView(e);if(vt(e.buffer))return new DataView(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")};function vt(e){return e instanceof globalThis.ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]"}function tn(e){return e instanceof globalThis.DataView||Object.prototype.toString.call(e)==="[object DataView]"}const sn=function([e,t]){const s={};s.type="FeatureCollection",s.features=[];let r=0;const n=e.length;for(t||(t=[]);r<n;)s.features.push({type:"Feature",geometry:e[r],properties:t[r]||{}}),r++;return s},Za=async function(e,t){let s;e=Ap(e);const r=await pp(e),n=[];t=t||[];for(s in r)s.indexOf("__MACOSX")===-1&&(s.slice(-4).toLowerCase()===".shp"?(n.push(s.slice(0,-4)),r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=r[s]):s.slice(-4).toLowerCase()===".prj"?r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=re(r[s]):s.slice(-5).toLowerCase()===".json"||t.indexOf(s.split(".").pop())>-1?n.push(s.slice(0,-3)+s.slice(-3).toLowerCase()):(s.slice(-4).toLowerCase()===".dbf"||s.slice(-4).toLowerCase()===".cpg")&&(r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=r[s]));if(!n.length)throw new Error("no layers founds");const i=n.map(function(a){let o,l;const h=a.lastIndexOf(".");return h>-1&&a.slice(h).indexOf("json")>-1?(o=JSON.parse(r[a]),o.fileName=a.slice(0,h)):t.indexOf(a.slice(h+1))>-1?(o=r[a],o.fileName=a):(r[a+".dbf"]&&(l=en(r[a+".dbf"],r[a+".cpg"])),o=sn([Yr(r[a+".shp"],r[a+".prj"]),l]),o.fileName=a),o});return i.length===1?i[0]:i};async function Tp(e,t){const s=await zt(e);return Za(s,t)}const Rp=async e=>{const t=await Promise.all([zt(e,"shp"),zt(e,"prj")]);let s=!1;try{t[1]&&(s=re(t[1]))}catch{s=!1}return Yr(t[0],s)},Pp=async e=>{const[t,s]=await Promise.all([zt(e,"dbf"),zt(e,"cpg")]);if(t)return en(t,s)},vi=(e,t)=>{var r;return new Cp(e,(r=globalThis==null?void 0:globalThis.document)==null?void 0:r.location).pathname.slice(-4).toLowerCase()===t},jp=({shp:e,dbf:t,cpg:s,prj:r})=>{const n=[Lp(e,r)];return t&&n.push(Dp(t,s)),sn(n)},Op=async function(e,t){if(typeof e!="string"){if(vt(e)||ArrayBuffer.isView(e)||tn(e))return Za(e);if(e.shp)return jp(e);throw new TypeError("must be a string, some sort of Buffer, or an object with at least a .shp property")}if(vi(e,".zip"))return Tp(e,t);vi(e,".shp")&&(e=e.slice(0,-4));const s=await Promise.all([Rp(e),Pp(e)]);return sn(s)},Lp=function(e,t){if(e=Xa(e),t=Ka(t),typeof t=="string")try{t=re(t)}catch{t=!1}return Yr(e,t)},Dp=function(e,t){return e=Xa(e),t=Ka(t),en(e,t)},yi=50*1024*1024,Fp=["application/zip","application/x-zip-compressed"];function $p(e){if(!e)throw new Error("No file provided");if(e.size>yi)throw new Error(`File size exceeds maximum limit of ${yi/(1024*1024)}MB`);if(!Fp.includes(e.type))throw new Error("Invalid file type. Please upload a ZIP file containing shapefile components.")}function xi(e){if(!Array.isArray(e)||e.length<2)return!1;const[t,s]=e;return typeof t=="number"&&typeof s=="number"&&t>=-180&&t<=180&&s>=-90&&s<=90}function Up(e){if(!e||typeof e!="object")throw new Error("Invalid GeoJSON: not an object");if(e.type!=="FeatureCollection")throw new Error("Invalid GeoJSON: not a FeatureCollection");if(!Array.isArray(e.features))throw new Error("Invalid GeoJSON: features is not an array");if(e.features.length===0)throw new Error("Invalid GeoJSON: no features found");e.features.forEach((t,s)=>{if(!t.geometry)throw new Error(`Invalid feature at index ${s}: no geometry`);if(t.geometry.type!=="LineString"&&t.geometry.type!=="MultiLineString")throw new Error(`Invalid feature at index ${s}: geometry must be LineString or MultiLineString`);t.geometry.type==="LineString"?t.geometry.coordinates.forEach((r,n)=>{if(!xi(r))throw new Error(`Invalid coordinate at index ${n} in feature ${s}`)}):t.geometry.coordinates.forEach((r,n)=>{r.forEach((i,a)=>{if(!xi(i))throw new Error(`Invalid coordinate at index ${a} in line ${n} of feature ${s}`)})})})}async function Bp(e){try{$p(e);const t=await e.arrayBuffer(),s=await Op(t),r=Array.isArray(s)?s[0]:s;return Up(r),{geoJSON:Vp(r)}}catch(t){throw console.error("Error processing shapefile:",t),new Error(t instanceof Error?t.message:"Failed to process shapefile")}}function Vp(e){return{type:"FeatureCollection",features:e.features.map(s=>({...s,properties:{...s.properties||{},_id:void 0,id:void 0,...Object.fromEntries(Object.entries(s.properties||{}).filter(([r])=>!r.startsWith("_")&&!r.includes("password")&&!r.includes("secret")))}}))}}const Er=(e,t)=>t.some(s=>e instanceof s);let bi,_i;function Gp(){return bi||(bi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hp(){return _i||(_i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nr=new WeakMap,ar=new WeakMap,Us=new WeakMap;function zp(e){const t=new Promise((s,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{s(Xe(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",a)});return Us.set(t,e),t}function qp(e){if(Nr.has(e))return;const t=new Promise((s,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{s(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});Nr.set(e,t)}let Sr={get(e,t,s){if(e instanceof IDBTransaction){if(t==="done")return Nr.get(e);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Xe(e[t])},set(e,t,s){return e[t]=s,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Qa(e){Sr=e(Sr)}function Wp(e){return Hp().includes(e)?function(...t){return e.apply(Ir(this),t),Xe(this.request)}:function(...t){return Xe(e.apply(Ir(this),t))}}function Jp(e){return typeof e=="function"?Wp(e):(e instanceof IDBTransaction&&qp(e),Er(e,Gp())?new Proxy(e,Sr):e)}function Xe(e){if(e instanceof IDBRequest)return zp(e);if(ar.has(e))return ar.get(e);const t=Jp(e);return t!==e&&(ar.set(e,t),Us.set(t,e)),t}const Ir=e=>Us.get(e);function Kp(e,t,{blocked:s,upgrade:r,blocking:n,terminated:i}={}){const a=indexedDB.open(e,t),o=Xe(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Xe(a.result),l.oldVersion,l.newVersion,Xe(a.transaction),l)}),s&&a.addEventListener("blocked",l=>s(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",h=>n(h.oldVersion,h.newVersion,h))}).catch(()=>{}),o}const Xp=["get","getKey","getAll","getAllKeys","count"],Zp=["put","add","delete","clear"],or=new Map;function wi(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(or.get(t))return or.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,n=Zp.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(n||Xp.includes(s)))return;const i=async function(a,...o){const l=this.transaction(a,n?"readwrite":"readonly");let h=l.store;return r&&(h=h.index(o.shift())),(await Promise.all([h[s](...o),n&&l.done]))[0]};return or.set(t,i),i}Qa(e=>({...e,get:(t,s,r)=>wi(t,s)||e.get(t,s,r),has:(t,s)=>!!wi(t,s)||e.has(t,s)}));const Qp=["continue","continuePrimaryKey","advance"],Mi={},Cr=new WeakMap,Ya=new WeakMap,Yp={get(e,t){if(!Qp.includes(t))return e[t];let s=Mi[t];return s||(s=Mi[t]=function(...r){Cr.set(this,Ya.get(this)[t](...r))}),s}};async function*e1(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const s=new Proxy(t,Yp);for(Ya.set(s,t),Us.set(s,Ir(t));t;)yield s,t=await(Cr.get(s)||t.continue()),Cr.delete(s)}function Ei(e,t){return t===Symbol.asyncIterator&&Er(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Er(e,[IDBIndex,IDBObjectStore])}Qa(e=>({...e,get(t,s,r){return Ei(t,s)?e1:e.get(t,s,r)},has(t,s){return Ei(t,s)||e.has(t,s)}}));const t1="shorelineDB",s1=1,tt="shorelineData";class r1{constructor(){zs(this,"db",null)}async initialize(){try{this.db=await Kp(t1,s1,{upgrade(t){t.objectStoreNames.contains(tt)||t.createObjectStore(tt,{keyPath:"id"})}})}catch(t){throw console.error("Failed to initialize IndexedDB:",t),new Error("Failed to initialize database storage. Please try again.")}}async storeShorelineData(t,s){this.db||await this.initialize();try{const r={id:t,data:s,timestamp:Date.now()};await this.db.put(tt,r)}catch(r){throw console.error("Failed to store shoreline data:",r),r instanceof Error&&r.name==="QuotaExceededError"?new Error("Storage quota exceeded. Please try with a smaller file or clear some space."):new Error("Failed to store shoreline data. Please try again.")}}async getShorelineData(t){this.db||await this.initialize();try{const s=await this.db.get(tt,t);return s?s.data:null}catch(s){throw console.error("Failed to retrieve shoreline data:",s),new Error("Failed to retrieve shoreline data. Please try again.")}}async deleteShorelineData(t){this.db||await this.initialize();try{await this.db.delete(tt,t)}catch(s){throw console.error("Failed to delete shoreline data:",s),new Error("Failed to delete shoreline data. Please try again.")}}async clearAllData(){this.db||await this.initialize();try{await this.db.clear(tt)}catch(t){throw console.error("Failed to clear shoreline data:",t),new Error("Failed to clear shoreline data. Please try again.")}}}const ce=new r1,Ni=e=>{if(e==null||isNaN(e))return"#808080";const t=Math.round(e);return t<=1?"#1a9850":t===2?"#91cf60":t===3?"#fee08b":t===4?"#fc8d59":t>=5?"#d73027":"#808080"};function n1(e,t,s,r,n,i="parameter"){var v,x;const a=(v=e.properties)==null?void 0:v.id,o=a?r.includes(a):!1,l=(x=e.properties)==null?void 0:x.vulnerabilityIndex;if(i==="cvi"){const g=Ni(l);return{color:o?"#0ea5e9":g,weight:o?5:3,opacity:o?1:.8,fillOpacity:o?.4:.2}}const h=a?t.find(g=>g.id===a):null,d=n?s.find(g=>g.id===n):null;if(!n||!d||!(h!=null&&h.parameters))return{color:o?"#FF4500":"#3388ff",weight:o?5:3,opacity:1};const u=h.parameters[n];if(!u)return{color:o?"#FF4500":"#808080",weight:o?5:2,opacity:o?1:.6,dashArray:"5,5"};let f="#3388ff";const m=u.vulnerability;if(d.type==="categorical"&&d.options){const g=d.options.find(w=>w.value===u.value);f=(g==null?void 0:g.color)||Ni(m)}else if(d.type==="numerical"&&d.vulnerabilityRanges){const g=d.vulnerabilityRanges.find(w=>w.value===m);f=(g==null?void 0:g.color)||"#808080"}return{color:o?"#FF4500":f,weight:o?5:3,opacity:1}}const wt=({segments:e,parameters:t,selectedSegments:s,selectedParameter:r,onSegmentSelect:n,onSelectionDelete:i,onAreaSelect:a,isEditing:o,initialBounds:l,geoJSON:h,zoomToFeatureId:d,stylingMode:u="parameter"})=>{const f=p.useRef(null),m=p.useRef(null),v=p.useRef(null),x=p.useRef(null),[g,w]=p.useState(!1),_=p.useCallback((y,M)=>{if(y.properties&&y.properties.id){const b=y.properties.id;if(console.log("Map: Segment clicked:",b),n(b),f.current&&M instanceof J.Path){const E=y.properties||{};let N=`<b>Segment ID:</b> ${E.id}`;E.cviScore!==void 0&&(N+=`<br/><b>CVI Score:</b> ${E.cviScore.toFixed(2)}`,N+=`<br/><b>Category:</b> ${E.cviCategory}`),E.length!==void 0&&(N+=`<br/><b>Length:</b> ${E.length.toFixed(2)}m`),M.bindPopup(N).openPopup()}}},[n]);return p.useEffect(()=>{if(console.log("Map Effect 1: Initializing map instance..."),f.current||typeof window>"u")return;const y=document.getElementById("map");if(!y){console.error("Map container 'map' not found");return}y._leaflet_id&&(console.warn("Map container already had a Leaflet ID. Clearing it."),y._leaflet_id=null);try{const M=J.map("map",{center:[20,0],zoom:2,zoomControl:!0});f.current=M,J.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(M);const b=new J.FeatureGroup;M.addLayer(b),x.current=b,w(!0),console.log("Map Effect 1: Map instance created.")}catch(M){console.error("Map Effect 1: Error initializing map:",M)}return()=>{console.log("Map Effect 1: Cleaning up map instance."),f.current&&(f.current.remove(),f.current=null),x.current=null,v.current=null,w(!1)}},[]),p.useEffect(()=>{const y=f.current;if(!y||!g){console.log("Map Effect 2: Skipping data layer update (map not ready).");return}if(v.current&&(y.removeLayer(v.current),v.current=null,console.log("Map Effect 2: Removed existing segments layer.")),h&&h.features&&h.features.length>0){console.log(`Map Effect 2: Creating GeoJSON layer with ${h.features.length} features (Styling: ${u}).`);const M=J.geoJSON(h,{style:b=>b?n1(b,e,t,s,r,u):{color:"#808080",weight:1},onEachFeature:(b,E)=>{E.on({mouseover:A=>{var D;const R=A.target,T=(D=b.properties)==null?void 0:D.id;T&&!s.includes(T)&&R instanceof J.Path&&(R.setStyle({weight:5}),R.bringToFront())},mouseout:A=>{var D;const R=A.target,T=(D=b.properties)==null?void 0:D.id;T&&!s.includes(T)&&v.current&&R instanceof J.Path&&v.current.resetStyle(R)},click:()=>_(b,E)});const N=b.properties||{};let I=`ID: ${N.id}`;N.cviScore!==void 0&&(I+=` | CVI: ${N.cviScore.toFixed(2)}`),E.bindTooltip(I,{sticky:!0})}}).addTo(y);v.current=M,console.log("Map Effect 2: Added new segments layer.")}else console.log("Map Effect 2: No features in geoJSON to display.")},[h,e,t,s,r,u,_,g]),p.useEffect(()=>{const y=f.current;if(!y||!g){console.log("Map Effect 3: Skipping bounds fitting (map not ready).");return}if(d&&v.current){console.log("Map Effect 3: Skipping general bounds fitting because zoomToFeatureId is active.");return}let M=null;if(l)try{const b=l instanceof J.LatLngBounds?l:J.latLngBounds(l);b.isValid()?(M=b,console.log("Map Effect 3: Using provided initialBounds",M.toBBoxString())):console.warn("Map Effect 3: Provided initialBounds are invalid.")}catch(b){console.error("Map Effect 3: Error processing provided initialBounds:",b)}if(!M&&h&&h.features&&h.features.length>0){console.log("Map Effect 3: Calculating bounds from geoJSON data.");try{const b=h.features.filter(E=>E&&E.geometry);if(b.length>0){const E=Ps(b),N=qt(E);N&&N.length===4&&N.every(I=>isFinite(I))&&N[0]<=N[2]&&N[1]<=N[3]?(M=J.latLngBounds([[N[1],N[0]],[N[3],N[2]]]),console.log("Map Effect 3: Calculated bounds from geoJSON",M.toBBoxString())):console.warn("Map Effect 3: Calculated bbox is invalid.",N)}else console.log("Map Effect 3: No valid features found in geoJSON for bounds calculation.")}catch(b){console.error("Map Effect 3: Error calculating bounds from geoJSON:",b)}}M&&M.isValid()?(console.log("Map Effect 3: Fitting map to bounds:",M.toBBoxString()),setTimeout(()=>{y.fitBounds(M,{padding:[50,50],maxZoom:18})},100)):l||(console.warn("Map Effect 3: No valid bounds found to fit. Resetting to default view."),y.setView([20,0],2))},[h,l,g,d]),p.useEffect(()=>{const y=f.current,M=v.current;if(!y||!M||!d||!g)return;console.log(`Map Effect 4: Attempting to zoom to feature ID: ${d}`);let b=null;if(M.eachLayer(E=>{var I;const N=E.feature;((I=N==null?void 0:N.properties)==null?void 0:I.id)===d&&(b=E)}),b&&typeof b.getBounds=="function"){const E=b.getBounds();E.isValid()?(console.log(`Map Effect 4: Found feature ${d}, flying to bounds:`,E.toBBoxString()),y.flyToBounds(E,{padding:[100,100],maxZoom:18,duration:1})):console.warn(`Map Effect 4: Feature ${d} found, but its bounds are invalid.`)}else console.warn(`Map Effect 4: Feature with ID ${d} not found in the segments layer or has no bounds.`)},[d,g]),p.useEffect(()=>{const y=f.current,M=x.current;if(!y||!M||!g){console.log("Map Effect 5: Skipping draw control setup (map not ready).");return}if(console.log(`Map Effect 5: Setting up draw controls (isEditing: ${o}).`),m.current){console.log("Map Effect 5: Removing previous draw control.");try{y.removeControl(m.current)}catch(b){console.warn("Minor error removing old draw control",b)}m.current=null}if(y.off(J.Draw.Event.CREATED),y.off(J.Draw.Event.DELETED),y.off(J.Draw.Event.DRAWSTART),y.off(J.Draw.Event.DRAWSTOP),o){console.log("Map Effect 5: Adding Leaflet Draw controls.");const b=new J.Control.Draw({draw:{polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1,polygon:{allowIntersection:!1,showArea:!1,shapeOptions:{color:"#007bff",weight:2,opacity:.7,fillOpacity:.1}}},edit:{featureGroup:M,remove:!0}});y.addControl(b),m.current=b,y.on(J.Draw.Event.DRAWSTART,E=>{console.log(`Draw Event: START (${E.layerType})`),M.clearLayers()}),y.on(J.Draw.Event.CREATED,E=>{const N=E.layer,I=E.layerType;if(console.log(`Draw Event: CREATED (${I})`),I==="polygon")try{const A=N;if(typeof A.toGeoJSON=="function"){const R=A.toGeoJSON();if(R.geometry&&R.geometry.type==="Polygon"){const T=R.geometry;console.log("Map: Passing geometry to onAreaSelect:",JSON.stringify(T)),a(T),setTimeout(()=>{try{y.hasLayer(N)&&(y.removeLayer(N),console.log("Map: Removed temporary drawing layer after CREATED event."))}catch(D){console.warn("Map: Error removing temporary drawing layer:",D)}},0)}else console.error("Map: Created layer is not a valid Polygon GeoJSON",R)}else console.error("Map: Created layer does not have toGeoJSON method.")}catch(A){console.error("Map: Error processing created geometry:",A)}else setTimeout(()=>y.removeLayer(N),0)}),y.on(J.Draw.Event.DELETED,E=>{console.log("Draw Event: DELETED (Selection shape removed by user)")}),y.on(J.Draw.Event.DRAWSTOP,E=>{console.log("Draw Event: STOP")})}else console.log("Map Effect 5: Editing disabled, draw controls not added.");return()=>{if(console.log("Map Effect 5: Cleaning up draw controls and listeners."),f.current&&m.current){try{f.current.removeControl(m.current)}catch(b){console.warn("Minor error removing draw control on effect cleanup",b)}m.current=null}f.current&&(f.current.off(J.Draw.Event.CREATED),f.current.off(J.Draw.Event.DELETED),f.current.off(J.Draw.Event.DRAWSTART),f.current.off(J.Draw.Event.DRAWSTOP))}},[o,a,i,g]),c.jsx("div",{id:"map",style:{height:"100%",width:"100%",minHeight:"400px"}})};wt.displayName="MapComponent";const yt=({message:e,onClose:t})=>e?c.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[c.jsx("strong",{className:"font-bold",children:"Error: "}),c.jsx("span",{className:"block sm:inline",children:e}),c.jsx("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:t,children:c.jsxs("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:[c.jsx("title",{children:"Close"}),c.jsx("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]}):null;function i1(){const e=ke(),[t,s]=p.useState(null),[r,n]=p.useState(!1),[i,a]=p.useState(null),[o,l]=p.useState(null),[h,d]=p.useState(!1),u=p.useCallback(async _=>{if(_){a(null),n(!0),s(null),l(null);try{const y=await Bp(_);s(y.geoJSON),l(_.name),console.log("Shapefile processed successfully.")}catch(y){const M=y instanceof Error?y.message:"Failed to process shapefile. Ensure it is a valid ZIP containing required .shp, .shx, and .dbf files.";a(M),console.error("Error processing shapefile:",y)}finally{n(!1)}}},[]),f=_=>{var y;u(((y=_.target.files)==null?void 0:y[0])??null),_.target.value=""},m=p.useCallback(_=>{_.preventDefault(),_.stopPropagation(),d(!1),_.dataTransfer.files&&_.dataTransfer.files.length>0&&(u(_.dataTransfer.files[0]),_.dataTransfer.clearData())},[u]),v=p.useCallback(_=>{_.preventDefault(),_.stopPropagation(),d(!0)},[]),x=p.useCallback(_=>{_.preventDefault(),_.stopPropagation(),d(!1)},[]),g=()=>{s(null),l(null),a(null)},w=async()=>{if(t){n(!0),a(null);try{await ce.storeShorelineData("current-shoreline",t),console.log("Shoreline data stored in IndexedDB."),e("/segmentation")}catch(_){const y=_ instanceof Error?_.message:"Failed to save shoreline data. Please try again.";a(y),console.error("Error storing shoreline data:",_),n(!1)}}};return c.jsxs("div",{className:"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[c.jsxs("div",{className:"text-center mb-10",children:[c.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"1. Upload Shoreline Data"}),c.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Begin by uploading your shoreline data as a zipped Shapefile (.zip)."})]}),c.jsx(yt,{message:i,onClose:()=>a(null)}),c.jsxs("div",{className:"mt-6 mb-8 bg-white p-8 rounded-lg shadow-md border border-gray-200",children:[!o&&!r&&c.jsxs("div",{onDrop:m,onDragOver:v,onDragLeave:x,className:`relative block w-full rounded-lg border-2 ${h?"border-primary-500 bg-primary-50":"border-dashed border-gray-300"} p-12 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-colors duration-200`,children:[c.jsx("input",{type:"file",id:"shapefile",accept:".zip,application/zip,application/x-zip-compressed",onChange:f,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:r}),c.jsx(zu,{className:"mx-auto h-12 w-12 text-gray-400"}),c.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Drag & drop your zipped shapefile here"}),c.jsx("span",{className:"block text-xs text-gray-500",children:"or click to browse files"}),c.jsx("span",{className:"mt-4 block text-xs text-gray-500",children:"Must be a .zip containing .shp, .shx, and .dbf files. Max 50MB."})]}),r&&c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),c.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Processing file..."}),c.jsx("p",{className:"text-xs text-gray-500",children:"This may take a moment for larger files."})]}),!r&&o&&t&&c.jsxs("div",{className:"text-center py-8 px-4 bg-green-50 border border-green-200 rounded-lg",children:[c.jsx(zr,{className:"mx-auto h-12 w-12 text-green-500 mb-3"}),c.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"File processed successfully!"}),c.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-600 mb-4",children:[c.jsx(sd,{className:"w-4 h-4 mr-1.5 flex-shrink-0"}),c.jsx("span",{className:"truncate max-w-xs",children:o})]}),c.jsxs("button",{onClick:g,className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500",children:[c.jsx(vd,{className:"w-4 h-4 mr-1.5 text-gray-500"}),"Remove and Upload New File"]})]})]}),t&&!r&&c.jsxs("div",{className:"mb-8",children:[c.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Shoreline Preview"}),c.jsx("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden h-96",children:c.jsx(wt,{geoJSON:t,segments:[],parameters:[],selectedParameter:null,selectedSegments:[],selectionPolygons:[],onSegmentSelect:()=>{},onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1})})]}),c.jsx("div",{className:"text-center",children:c.jsx("button",{onClick:w,disabled:r||!t,className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-8 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",title:t?"Proceed to segment the shoreline":"Upload a shapefile first",children:r&&!t?"Processing...":r&&t?"Saving...":"Continue to Segmentation"})})]})}function a1(e,t){const s=[];let r=1;return e.features.forEach(n=>{(n.geometry.type==="MultiLineString"?n.geometry.coordinates.map(a=>cn(a)):[cn(n.geometry.coordinates)]).forEach((a,o)=>{const l=Ft(a,{units:"meters"}),h=Math.ceil(l/t),d=l/h;for(let u=0;u<h;u++){const f=u*d,m=Math.min((u+1)*d,l),v=mo(a,f,m,{units:"meters"}),x=Ft(v,{units:"meters"});s.push({type:"Feature",id:`segment-${r++}`,geometry:v.geometry,properties:{id:`segment-${r}`,index:u,lineIndex:o,length:x,values:{}},parameters:{}})}})}),s}function o1(){const e=ke(),[t,s]=p.useState(null),[r,n]=p.useState(""),[i,a]=p.useState([]),[o,l]=p.useState(null),[h,d]=p.useState(0),[u,f]=p.useState(0),[m,v]=p.useState(!0),[x,g]=p.useState(!1),[w,_]=p.useState(null),[y,M]=p.useState(!1);p.useEffect(()=>{(async()=>{v(!0),_(null);try{const U=await ce.getShorelineData("current-shoreline");if(!U){_("No shoreline data found. Please upload a shapefile first."),e("/shoreline");return}if(U.features.every(oe=>oe.geometry.type==="LineString"||oe.geometry.type==="MultiLineString")){const oe=U;s(oe);let P=0;if(oe.features.forEach(F=>{try{P+=Ft(Si(F.geometry),{units:"kilometers"})}catch(H){console.warn("Error calculating length for a feature:",H)}}),d(P),oe.features.length>0)try{const F=qt(oe);if(F&&F.length===4&&F.every(H=>isFinite(H))&&F[0]<=F[2]&&F[1]<=F[3]){const H=[[F[1],F[0]],[F[3],F[2]]];l(H)}else console.warn("SegmentationPage: Could not calculate valid initial bounds.")}catch(F){console.error("SegmentationPage: Error calculating initial bounds:",F)}}else throw new Error("Invalid geometry type found in shoreline data. Only LineString or MultiLineString are supported.")}catch(D){console.error("Error loading shoreline data:",D),_(`Failed to load shoreline data: ${D instanceof Error?D.message:String(D)}`)}finally{v(!1)}})()},[e]),p.useEffect(()=>{typeof r=="number"&&r>0&&h>0?f(Math.ceil(h*1e3/r)):f(0)},[r,h]);const b=p.useCallback(T=>{const D=T.target.value,U=D===""?"":Number(D);n(U),_(null),M(!1),a([])},[]),E=p.useCallback(()=>{if(!r||r<=0){_("Resolution must be a positive number (meters).");return}if(!t){_("Original shoreline data is not loaded.");return}u>1e4&&!confirm(`This resolution will generate approximately ${u} segments, which might be slow to preview and process. Continue preview?`)||(g(!0),_(null),a([]),M(!1),setTimeout(()=>{try{console.time("Segmentation Calculation");const T=a1(t,r);console.timeEnd("Segmentation Calculation"),a(T),M(!0),console.log(`Generated ${T.length} segments for preview.`)}catch(T){_(T instanceof Error?T.message:"Failed to generate segment preview."),console.error("Segmentation preview error:",T)}finally{g(!1)}},10))},[t,r,u]),N=p.useCallback(async()=>{if(!y||i.length===0){_("Please generate and preview the segmentation first using the 'Preview Segmentation' button.");return}if(!(u>1e4&&!confirm(`Confirming segmentation with approximately ${u} segments. This might take time to process in the next steps. Continue?`))){g(!0),_(null);try{await ce.storeShorelineData("current-segments",{type:"FeatureCollection",features:i.map(T=>({type:"Feature",geometry:T.geometry,properties:T.properties}))}),console.log("Confirmed segments stored in IndexedDB."),e("/segment-table")}catch(T){console.error("Error storing segments:",T),_(`Failed to save segments: ${T instanceof Error?T.message:String(T)}`)}finally{g(!1)}}},[y,i,e,u]),I=p.useCallback(()=>{e("/shoreline")},[e]),A=p.useMemo(()=>y&&i.length>0?{type:"FeatureCollection",features:i.map(T=>({type:"Feature",geometry:T.geometry,properties:{...T.properties,id:T.id}}))}:t,[t,i,y]),R=p.useMemo(()=>y?"parameter":void 0,[y]);return m?c.jsxs("div",{className:"flex items-center justify-center h-screen",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),c.jsx("p",{className:"ml-4 text-gray-600",children:"Loading shoreline data..."})]}):c.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[c.jsxs("div",{className:"text-center mb-10",children:[c.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"2. Segment Shoreline"}),c.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Define the resolution to divide the shoreline into analysis segments."})]}),c.jsx(yt,{message:w,onClose:()=>_(null)}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:[c.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[" ",c.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[c.jsx(Zu,{className:"h-6 w-6 mr-2 text-primary-700"})," Segmentation Settings"]}),c.jsxs("div",{className:"bg-white p-6 sm:p-8 rounded-lg shadow-md border border-gray-200 space-y-6",children:[" ",c.jsxs("div",{className:"flex items-center text-sm text-gray-600 border-b border-gray-200 pb-4",children:[c.jsx(ud,{className:"h-5 w-5 mr-2 text-primary-600 flex-shrink-0"}),c.jsxs("span",{children:["Total Shoreline Length: ",c.jsxs("span",{className:"font-medium text-gray-800",children:[h.toFixed(2)," km"]})]})]}),c.jsxs("div",{children:[" ",c.jsx("label",{htmlFor:"resolution",className:"block text-sm font-medium text-gray-700",children:"Segment Resolution"}),c.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[c.jsx("input",{type:"number",name:"resolution",id:"resolution",placeholder:"e.g., 100",value:r,onChange:b,className:"block w-full pr-16 rounded-md border-gray-300 focus:border-primary-500 focus:ring-primary-500 sm:text-sm disabled:bg-gray-100",disabled:x,"aria-describedby":"resolution-unit"}),c.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:c.jsx("span",{className:"text-gray-500 sm:text-sm",id:"resolution-unit",children:"meters"})})]}),c.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Enter the desired length for each shoreline segment."})]}),c.jsxs("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 space-y-2",children:[" ",c.jsxs("div",{className:"flex items-center text-sm",children:[c.jsx(od,{className:"h-5 w-5 mr-2 text-blue-500 flex-shrink-0"}),c.jsxs("p",{className:"text-gray-700",children:["Estimated segments: ",c.jsx("span",{className:"font-semibold",children:u.toLocaleString()})]})]}),u>5e3&&c.jsxs("div",{className:"flex items-start text-sm text-amber-600",children:[c.jsx(Wn,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5"}),c.jsx("span",{children:"Warning: High segment count (>5k) may impact performance."})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-start gap-4",children:[c.jsxs("button",{type:"button",onClick:E,disabled:!r||r<=0||x,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",title:!r||r<=0?"Enter a positive resolution first":"Generate segment preview on the map",children:[c.jsx(yr,{className:`h-5 w-5 mr-2 ${x&&!y?"animate-spin":""}`}),x&&!y?"Generating...":"Preview Segmentation"]}),y&&i.length>0&&c.jsxs("div",{className:"flex items-center text-sm text-green-600",children:[c.jsx(zr,{className:"h-5 w-5 mr-1.5"}),c.jsxs("span",{children:[i.length.toLocaleString()," segments ready."]})]}),y&&i.length===0&&c.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[c.jsx(Wn,{className:"h-5 w-5 mr-1.5"}),c.jsx("span",{children:"No segments generated."})]})]})]})]})," ",c.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[c.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[c.jsx(xr,{className:"h-6 w-6 mr-2 text-primary-700"}),"Preview Map"]}),c.jsx("p",{className:"mb-3 text-sm text-gray-600",children:y?`Showing ${i.length.toLocaleString()} generated segments (${r}m).`:t?"Showing original shoreline. Enter resolution & click preview.":"Load shoreline data first."}),c.jsxs("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden flex-grow min-h-[500px] relative",children:[" ",t?c.jsx(wt,{geoJSON:A,segments:i,parameters:[],selectedParameter:null,selectedSegments:[],selectionPolygons:[],onSegmentSelect:()=>{},onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:o,stylingMode:R}):c.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:m?"Loading map data...":"No shoreline data loaded."})]})]})," "]})," ",c.jsxs("div",{className:"mt-10 pt-6 border-t border-gray-200 flex justify-between items-center",children:[c.jsxs("button",{type:"button",onClick:I,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[c.jsx(Ma,{className:"h-4 w-4 mr-2"})," Back"]}),c.jsxs("button",{type:"button",onClick:N,disabled:!y||i.length===0||x,className:"inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:!y||i.length===0?"Generate and preview segments first":"Confirm segments and proceed",children:[x&&y?"Saving...":"Confirm & Continue",c.jsx(Ea,{className:"h-4 w-4 ml-2"})]})]})]})}const Et=10;function l1(){var oe;const e=ke(),[t,s]=p.useState([]),[r,n]=p.useState(!0),[i,a]=p.useState(null),[o,l]=p.useState(1),[h,d]=p.useState(null),[u,f]=p.useState("properties.index"),[m,v]=p.useState("asc"),[x,g]=p.useState(""),[w,_]=p.useState(null);p.useEffect(()=>{(async()=>{n(!0),a(null);try{const F=await ce.getShorelineData("current-segments");if(!F){a("No segment data found. Please complete the segmentation step first."),e("/segmentation");return}const H=F.features.filter(G=>G&&G.geometry&&(G.geometry.type==="LineString"||G.geometry.type==="MultiLineString")).map((G,je)=>{var rs,ns;const q=((rs=G.properties)==null?void 0:rs.id)||`segment-${je+1}`;let he=(ns=G.properties)==null?void 0:ns.length;if(he==null)try{he=Ft(Si(G.geometry),{units:"meters"})}catch(Vs){console.warn(`Could not calculate length for segment ${q}:`,Vs),he=0}return{id:q,type:"Feature",geometry:G.geometry,properties:{...G.properties,id:q,index:je+1,length:he},parameters:{}}});if(H.length===0)throw new Error("No valid line segments found in the data.");if(H.length>0){const G=H.map(q=>({type:"Feature",geometry:q.geometry,properties:{}})),je=Ps(G);try{const q=qt(je);if(q&&q.length===4&&q.every(he=>isFinite(he))&&q[0]<=q[2]&&q[1]<=q[3]){const he=[[q[1],q[0]],[q[3],q[2]]];_(he)}else console.warn("SegmentTablePage: Could not calculate valid initial bounds.")}catch(q){console.error("SegmentTablePage: Error calculating initial bounds:",q)}}s(H)}catch(F){console.error("Error loading segments:",F),a(`Failed to load segment data: ${F instanceof Error?F.message:String(F)}`)}finally{n(!1)}})()},[e]);const y=p.useMemo(()=>t.filter(P=>{const F=x.toLowerCase();return P.id.toLowerCase().includes(F)||String(P.properties.index).includes(F)}),[t,x]),M=p.useMemo(()=>[...y].sort((P,F)=>{let H=P,G=F;const je=u.split(".");for(const q of je)H=H==null?void 0:H[q],G=G==null?void 0:G[q];return H==null?m==="asc"?-1:1:G==null?m==="asc"?1:-1:typeof H=="number"&&typeof G=="number"?m==="asc"?H-G:G-H:(typeof H=="string"&&typeof G=="string"&&(H=H.toLowerCase(),G=G.toLowerCase()),H<G?m==="asc"?-1:1:H>G?m==="asc"?1:-1:0)}),[y,u,m]),b=p.useMemo(()=>{const P=(o-1)*Et;return M.slice(P,P+Et)},[M,o]),E=Math.ceil(y.length/Et),N=p.useCallback(P=>{d(P===h?null:P)},[h]),I=p.useCallback(P=>{P===u?v(F=>F==="asc"?"desc":"asc"):(f(P),v("asc")),l(1)},[u]),A=p.useCallback(()=>e("/segmentation"),[e]),R=p.useCallback(async()=>{n(!0),a(null);try{console.log("Continuing to parameter selection..."),e("/parameter-selection")}catch(P){console.error("Error preparing to continue:",P),a("Failed to proceed. Please try again."),n(!1)}},[e]),T=P=>{P>=1&&P<=E&&l(P)},D=p.useMemo(()=>!t||t.length===0?null:{type:"FeatureCollection",features:t.map(P=>({type:"Feature",geometry:P.geometry,properties:{...P.properties,id:P.id}}))},[t]),U=p.useMemo(()=>h?[h]:[],[h]);return r&&t.length===0?c.jsxs("div",{className:"flex items-center justify-center h-screen",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),c.jsx("p",{className:"ml-4 text-gray-600",children:"Loading segments..."})]}):c.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[" ",c.jsxs("div",{className:"text-center mb-10",children:[c.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"3. Review Segments"}),c.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Review the generated shoreline segments. Click a row to view on map."}),c.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Total Segments: ",t.length.toLocaleString()]})]}),c.jsx(yt,{message:i,onClose:()=>a(null)}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:[c.jsxs("div",{className:"lg:col-span-1 flex flex-col space-y-6",children:[c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 flex-grow flex flex-col",children:[" ",c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4 gap-4 flex-shrink-0",children:[" ",c.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[c.jsx(gd,{className:"h-6 w-6 mr-2 text-primary-700"})," Segment List"]}),c.jsxs("div",{className:"relative w-full sm:w-64",children:[c.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:c.jsx(cd,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),c.jsx("input",{type:"text",placeholder:"Search by ID or #",value:x,onChange:P=>{g(P.target.value),l(1)},className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]})]}),c.jsxs("div",{className:"flex-grow overflow-auto border border-gray-200 rounded-md",children:[" ",c.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[c.jsxs("thead",{className:"bg-gray-50 sticky top-0 z-10",children:[" ",c.jsxs("tr",{children:[c.jsxs("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>I("properties.index"),children:["#",u==="properties.index"&&c.jsx("span",{className:"ml-1",children:m==="asc"?"":""})]}),c.jsxs("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>I("properties.length"),children:["Length (m)",u==="properties.length"&&c.jsx("span",{className:"ml-1",children:m==="asc"?"":""})]})]})]}),c.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[b.map(P=>{var F;return c.jsxs("tr",{onClick:()=>N(P.id),className:`hover:bg-primary-50 cursor-pointer transition-colors duration-150 ${h===P.id?"bg-primary-100 font-medium":""}`,children:[c.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 text-center w-16",children:P.properties.index}),c.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 text-center w-32",children:(F=P.properties)!=null&&F.length?P.properties.length.toFixed(1):"N/A"})]},P.id)}),b.length===0&&c.jsx("tr",{children:c.jsx("td",{colSpan:2,className:"px-6 py-4 text-center text-sm text-gray-500",children:x?"No segments match search.":"No segments loaded."})})]})]})]}),E>1&&c.jsxs("nav",{className:"mt-4 flex items-center justify-between border-t border-gray-200 px-1 pt-3 flex-shrink-0","aria-label":"Pagination",children:[c.jsxs("p",{className:"text-sm text-gray-700 flex-shrink-0 mr-4",children:[" ","Showing ",c.jsx("span",{className:"font-medium",children:(o-1)*Et+1}),"- ",c.jsx("span",{className:"font-medium",children:Math.min(o*Et,y.length)})," ","of"," ",c.jsx("span",{className:"font-medium",children:y.length})]}),c.jsxs("div",{className:"flex space-x-1",children:[" ",c.jsx("button",{onClick:()=>T(o-1),disabled:o===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),c.jsx("button",{onClick:()=>T(o+1),disabled:o===E,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})," ",c.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 mt-auto",children:[" ",c.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:r,children:[c.jsx(Ma,{className:"h-4 w-4 mr-2"})," Back"]}),c.jsxs("button",{type:"button",onClick:R,className:"inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r||t.length===0,title:t.length===0?"No segments loaded":"Confirm segments and proceed to parameter selection",children:[r?"Processing...":"Confirm & Continue",c.jsx(Ea,{className:"h-4 w-4 ml-2"})]})]})]})," ",c.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[c.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[c.jsx(St,{className:"h-6 w-6 mr-2 text-primary-700"})," Map Preview"]}),h&&c.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-800 flex items-center",children:[c.jsx(zr,{className:"h-5 w-5 mr-2 text-blue-600 flex-shrink-0"}),"Highlighting segment #",((oe=t.find(P=>P.id===h))==null?void 0:oe.properties.index)||"",". Map zoomed to selection."]}),c.jsxs("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden h-[600px] lg:h-full lg:min-h-[600px] flex-grow",children:[" ",D?c.jsx(wt,{geoJSON:D,segments:t,parameters:[],selectedParameter:null,selectedSegments:U,selectionPolygons:[],onSegmentSelect:N,onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:w,zoomToFeatureId:h,stylingMode:"parameter"}):c.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:r?"Loading map data...":"No shoreline data available"})]})]})," "]})," "]})}const c1=[{id:"geomorphology",name:"Geomorphology",description:"Coastal landform type and characteristics",type:"categorical",weight:.25,enabled:!0,options:[{type:"categorical",value:"rocky_cliffs",label:"Rocky, cliffed coasts / Fiords / Fiards",color:"#1a9850",vulnerability:1},{type:"categorical",value:"medium_cliffs",label:"Medium cliffs / Indented coasts",color:"#91cf60",vulnerability:2},{type:"categorical",value:"low_cliffs",label:"Low cliffs / Glacial drift / Alluvial plains",color:"#fee08b",vulnerability:3},{type:"categorical",value:"cobble_beaches",label:"Cobble beaches / Estuary / Lagoon",color:"#fc8d59",vulnerability:4},{type:"categorical",value:"barrier_beaches",label:"Barrier beaches / Sand beaches / Salt marsh / Mud flats / Deltas / Mangrove / Coral reefs",color:"#d73027",vulnerability:5}]},{id:"coastal_slope",name:"Coastal Slope",description:"Average slope of the coastal zone (%)",type:"numerical",weight:.25,enabled:!0,unit:"%",vulnerabilityRanges:[{value:1,min:2,max:null,label:"Very Low",color:"#1a9850"},{value:2,min:.7,max:2,label:"Low",color:"#91cf60"},{value:3,min:.04,max:.07,label:"Moderate",color:"#fee08b"},{value:4,min:.025,max:.04,label:"High",color:"#fc8d59"},{value:5,min:null,max:.025,label:"Very High",color:"#d73027"}]},{id:"sea_level_change",name:"Relative Sea-level Change",description:"Rate of relative sea-level change",type:"numerical",weight:.25,enabled:!0,unit:"mm/yr",vulnerabilityRanges:[{value:1,min:null,max:1.8,label:"Very Low",color:"#1a9850"},{value:2,min:1.8,max:2.5,label:"Low",color:"#91cf60"},{value:3,min:2.5,max:2.95,label:"Moderate",color:"#fee08b"},{value:4,min:2.95,max:3.16,label:"High",color:"#fc8d59"},{value:5,min:3.16,max:null,label:"Very High",color:"#d73027"}]},{id:"shoreline_change",name:"Shoreline Erosion/Accretion",description:"Rate of shoreline erosion or accretion",type:"numerical",weight:.25,enabled:!0,unit:"m/yr",vulnerabilityRanges:[{value:1,min:2,max:null,label:"Accretion",color:"#1a9850"},{value:2,min:1,max:2,label:"Low Erosion/Accretion",color:"#91cf60"},{value:3,min:-1,max:1,label:"Stable",color:"#fee08b"},{value:4,min:-2,max:-1,label:"High Erosion",color:"#fc8d59"},{value:5,min:null,max:-2,label:"Very High Erosion",color:"#d73027"}]},{id:"mean_tide_range",name:"Mean Tide Range",description:"Average tidal range",type:"numerical",weight:0,enabled:!1,unit:"m",vulnerabilityRanges:[{value:1,min:6,max:null,label:"Very Low",color:"#1a9850"},{value:2,min:4.1,max:6,label:"Low",color:"#91cf60"},{value:3,min:2,max:4,label:"Moderate",color:"#fee08b"},{value:4,min:1,max:1.9,label:"High",color:"#fc8d59"},{value:5,min:null,max:1,label:"Very High",color:"#d73027"}]},{id:"mean_wave_height",name:"Mean Wave Height",description:"Average wave height",type:"numerical",weight:0,enabled:!1,unit:"m",vulnerabilityRanges:[{value:1,min:null,max:.55,label:"Very Low",color:"#1a9850"},{value:2,min:.55,max:.85,label:"Low",color:"#91cf60"},{value:3,min:.85,max:1.05,label:"Moderate",color:"#fee08b"},{value:4,min:1.05,max:1.25,label:"High",color:"#fc8d59"},{value:5,min:1.25,max:null,label:"Very High",color:"#d73027"}]}];function h1(){const e=ke(),[t,s]=p.useState(c1),[r,n]=p.useState(null);p.useEffect(()=>{(async()=>{try{const u=await ce.getShorelineData("current-parameters");if(u&&u.features){const f=u.features.map(m=>m.properties);s(f.filter(m=>m!==null))}}catch(u){console.error("Error loading parameters:",u),n("Failed to load saved parameters")}})()},[]);const i=t.filter(d=>d.enabled).reduce((d,u)=>d+(u.weight||0),0),a=d=>{s(u=>u.map(f=>f.id===d?{...f,enabled:!f.enabled}:f))},o=(d,u)=>{s(f=>f.map(m=>m.id===d?{...m,weight:u}:m))},l=()=>{const d=t.filter(f=>f.enabled).length;if(d===0)return;const u=1/d;s(f=>f.map(m=>m.enabled?{...m,weight:u}:m))},h=async()=>{const u=t.filter(f=>f.enabled).reduce((f,m)=>f+(m.weight||0),0);if(Math.abs(u-1)>.01){n(`Parameter weights must sum to 100%. Current total: ${(u*100).toFixed(0)}%`);return}try{const f={type:"FeatureCollection",features:t.map(m=>({type:"Feature",properties:m,geometry:{type:"Point",coordinates:[0,0]}}))};await ce.storeShorelineData("current-parameters",f),e("/parameter-assignment")}catch(f){console.error("Error saving parameters:",f),n("Failed to save parameters. Please try again.")}};return c.jsxs("div",{className:"max-w-4xl mx-auto mt-8 px-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"4.  Parameter Selection"}),r&&c.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:r}),c.jsxs("div",{className:"flex justify-between items-start mb-8",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-medium text-gray-900 mb-2 text-left",children:"Vulnerability Parameters"}),c.jsx("p",{className:"text-gray-600",children:"Configure the parameters that determine coastal vulnerability"})]}),c.jsxs("div",{className:"flex items-center gap-6",children:[c.jsxs("div",{className:"text-right",children:[c.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Weight"}),c.jsxs("div",{className:`text-2xl font-medium ${Math.abs(i-1)<.01?"text-emerald-600":"text-gray-900"}`,children:[(i*100).toFixed(0),"%"]})]}),c.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Distribute Evenly"})]})]}),c.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map(d=>c.jsx("div",{className:`p-5 rounded-xl border ${d.enabled?"bg-white border-gray-200 shadow-sm":"bg-gray-50 border-gray-100"}`,children:c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"flex-shrink-0 pt-1",children:c.jsx("input",{type:"checkbox",id:d.id,checked:d.enabled,onChange:()=>a(d.id),className:"h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"})}),c.jsxs("div",{className:"flex-grow min-w-0",children:[c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsx("div",{className:"min-w-0",children:c.jsx("label",{htmlFor:d.id,className:"block text-lg font-medium text-gray-900 text-left",children:d.name})}),d.enabled&&c.jsxs("span",{className:"text-lg font-medium text-gray-900 ml-4 w-16 text-right flex-shrink-0",children:[((d.weight||0)*100).toFixed(0),"%"]})]}),d.enabled&&c.jsx("div",{className:"mt-3 flex items-center gap-3",children:c.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d.weight||0,onChange:u=>o(d.id,parseFloat(u.target.value)),className:"flex-grow h-2 accent-teal-600 cursor-pointer"})})]})]})},d.id))}),c.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-between",children:[c.jsx("button",{onClick:()=>e("/segment-table"),className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Back to Segment Table"}),c.jsx("button",{onClick:h,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Continue to Parameter Assignment"})]})]})}const u1=({segments:e,parameters:t,selectedSegmentIds:s,selectedParameterId:r,selectionPolygons:n,onSegmentSelect:i,onSelectionDelete:a,onAreaSelect:o,initialBounds:l,geoJSON:h,onSelectAll:d,onClearSelection:u,mapContainerRef:f,isReadOnly:m=!1})=>c.jsxs("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[!m&&c.jsxs("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[c.jsxs("div",{children:[c.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md mr-2 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Select all visible segments",disabled:e.length===0,children:"Select All"}),c.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",title:"Deselect all segments",disabled:s.length===0,children:"Clear Selection"})]}),c.jsx("div",{className:"text-sm text-gray-600",children:"Use drawing tools (polygon/rectangle) on map to select segments by area."})]}),c.jsx("div",{className:"flex-grow border rounded overflow-hidden",ref:f,children:e.length>0&&h?c.jsx(wt,{segments:e,parameters:t,geoJSON:h,selectedSegments:s,selectedParameter:r,selectionPolygons:n,onSegmentSelect:m?()=>{}:i,onSelectionDelete:m?()=>{}:a,onAreaSelect:m?()=>{}:o,isEditing:!m,initialBounds:l}):c.jsx("div",{className:"h-full flex items-center justify-center bg-gray-50 text-gray-500",children:c.jsx("p",{className:"text-gray-500",children:e.length===0?"No shoreline segments loaded.":"Loading shoreline data..."})})})]}),d1=({parameters:e,activeParameter:t,onParameterSelect:s,selectedValue:r,selectedVulnerability:n,onValueSelect:i,onApplyValue:a,selectedSegmentIds:o})=>{const l=p.useMemo(()=>{if(!t)return[];if(t.type==="categorical"&&t.options){const u=t.options.map(m=>({label:m.label,value:typeof m.value=="string"?m.value:String(m.value),vulnerability:m.vulnerability})),f={};return u.forEach(m=>{f[m.value]&&console.warn(`Duplicate option value detected for ${t.name}: ${m.value}`),f[m.value]=!0}),u}else if(t.type==="numerical"&&t.vulnerabilityRanges){const u=[],f={};for(let m=1;m<=5;m++){const v=t.vulnerabilityRanges.find(x=>x.value===m);if(v&&!f[v.value]){const x=v.value.toString();let g=`${v.label}`;v.min!==null&&v.max!==null?g+=` (${v.min} - ${v.max}${t.unit||""})`:v.min!==null?g+=` (>= ${v.min}${t.unit||""})`:v.max!==null&&(g+=` (< ${v.max}${t.unit||""})`),u.push({label:g,value:x,vulnerability:v.value}),f[v.value]=!0}}return t.vulnerabilityRanges.forEach(m=>{if(!f[m.value]){const v=m.value.toString();let x=`${m.label}`;u.push({label:x,value:v,vulnerability:m.value}),f[m.value]=!0}}),u.sort((m,v)=>m.vulnerability-v.vulnerability),u}else if(t.type==="numerical"){console.warn(`Numerical parameter "${t.name}" has no vulnerabilityRanges defined. Using generic 1-5 scale.`);const u=["Very Low","Low","Moderate","High","Very High"];return[1,2,3,4,5].map(f=>({label:`${u[f-1]} (Score: ${f})`,value:f.toString(),vulnerability:f}))}return[]},[t]),h=u=>{const f=u.target.value,m=l.find(v=>v.value===f);m?i(m.value,m.vulnerability):i(null,1)},d=p.useMemo(()=>t?r===null?"Select a Value First":o.length===0?"Select Segments First":`Apply ${t.name}: ${r} to ${o.length} Segments`:"Select a Parameter First",[t,r,o]);return c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[c.jsx("h3",{className:"text-lg font-medium mb-4",children:"Parameter Values"}),c.jsxs("p",{className:"mb-4 text-sm text-gray-600",children:[o.length," selected"]}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{htmlFor:"parameter-select",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Parameter"}),c.jsx("select",{id:"parameter-select",value:(t==null?void 0:t.id)||"",onChange:u=>s(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",children:e.length>0?e.map(u=>c.jsx("option",{value:u.id,children:u.name},u.id)):c.jsx("option",{value:"",children:"No parameters available"})})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{htmlFor:"value-select",className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Value ",t&&`for ${t.name}`]}),c.jsxs("select",{id:"value-select",value:r||"",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",disabled:!t||o.length===0,children:[c.jsx("option",{value:"",children:"Select a value..."}),l.map(u=>c.jsxs("option",{value:u.value,children:[u.label," (Vulnerability: ",u.vulnerability,")"]},u.value)),l.length===0&&t&&c.jsx("option",{value:"",disabled:!0,children:"No values available"})]}),(!t||o.length===0)&&r===null&&c.jsx("p",{className:"mt-1 text-sm text-red-500",children:t?"Select segments on the map first":"Select a parameter first"})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vulnerability Preview"}),c.jsxs("div",{className:"flex items-center",children:[c.jsx("span",{className:"mr-2 text-gray-600",children:"Value:"}),c.jsx("span",{className:"font-medium",children:r||"-"}),c.jsx("span",{className:"mx-4 text-gray-600",children:"Vulnerability:"}),c.jsx("span",{className:`inline-block w-6 h-6 rounded-full text-white text-center flex items-center justify-center text-xs font-medium ${(()=>{switch(Math.round(n)){case 1:return"bg-green-600";case 2:return"bg-lime-500";case 3:return"bg-yellow-400";case 4:return"bg-orange-500";case 5:return"bg-red-600";default:return"bg-gray-400"}})()}`,children:n||"?"})]})]}),c.jsx("button",{onClick:a,disabled:!t||r===null||o.length===0,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md disabled:bg-gray-300 disabled:cursor-not-allowed",children:d}),c.jsx("div",{className:"mt-4 text-center",children:c.jsx("p",{className:"text-sm font-medium text-gray-600",children:o.length>0?`${o.length} segments selected`:"No segments selected. Click on the map or use Select All"})})]})},Bs=[{name:"Geometric Mean (Normalized)",type:"geometric-mean-normalized",description:"Normalized weighted geometric mean. Often used to scale results between 1-5."},{name:"Geometric Mean",type:"geometric-mean",description:"Standard weighted geometric mean. Traditional CVI method."},{name:"Arithmetic Mean",type:"arithmetic-mean",description:"Simple weighted arithmetic mean."},{name:"Nonlinear Power (sqrt)",type:"nonlinear-power",description:"Root mean square of weighted vulnerabilities. Emphasizes higher values."}],Dt=e=>{if(e==null||isNaN(e))return"No Data";const t=Math.round(e);return t<=1?"Very Low":t===2?"Low":t===3?"Moderate":t===4?"High":t>=5?"Very High":"No Data"},f1=({selectedFormula:e,onFormulaSelect:t,onCalculateCvi:s,completionPercentage:r,calculatingCvi:n,cviScores:i,segments:a})=>{const o=p.useMemo(()=>{const d=Object.values(i);if(d.length===0)return null;const u=Math.min(...d),f=Math.max(...d),v=d.reduce((M,b)=>M+b,0)/d.length;let x=0,g=0,w=0,_=0,y=0;return d.forEach(M=>{const b=Dt(M);b==="Very Low"?x++:b==="Low"?g++:b==="Moderate"?w++:b==="High"?_++:b==="Very High"&&y++}),{min:u.toFixed(2),max:f.toFixed(2),avg:v.toFixed(2),count:d.length,categories:{veryLow:x,low:g,moderate:w,high:_,veryHigh:y}}},[i]),l=p.useMemo(()=>r>=100&&e!==null&&!n,[r,e,n]),h=d=>{const u=d.target.value;t(u===""?null:u)};return c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[c.jsx("h3",{className:"text-lg font-medium mb-4",children:"CVI Calculation"}),c.jsxs("div",{className:"mb-4",children:[c.jsx("label",{htmlFor:"formula-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Formula"}),c.jsxs("select",{id:"formula-select",value:(e==null?void 0:e.type)||"",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",disabled:n,children:[c.jsx("option",{value:"",children:"-- Select a Formula --"}),Bs.map(d=>c.jsxs("option",{value:d.type,children:[d.name," "]},d.type))]}),e&&c.jsx("p",{className:"mt-1 text-xs text-gray-600",children:e.description})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("button",{onClick:s,disabled:!l,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 mr-2 ${n?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n?c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"}):c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 7h6m0 10v-6m-6 2h6m-6-4h6M9 3a1 1 0 011-1h4a1 1 0 011 1v1H9V3zM15 21a2 2 0 01-2 2H11a2 2 0 01-2-2m4-18a2 2 0 00-2-2H11a2 2 0 00-2 2m4 18V7m-4 14V7"})}),n?"Calculating...":`Calculate CVI ${e?`(${e.name})`:""}`]}),!e&&r>=100&&!n&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Please select a formula before calculating."}),r<100&&!n&&c.jsxs("p",{className:"mt-1 text-sm text-amber-600",children:["Complete all parameter values (",r.toFixed(0),"%) before calculating CVI."]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Calculation Status"}),c.jsxs("div",{className:"flex items-center text-sm",children:[c.jsx("span",{className:"mr-2 text-gray-600 w-28 flex-shrink-0",children:"Selected Formula:"}),c.jsx("span",{className:"font-medium",children:(e==null?void 0:e.name)||"None Selected"})]}),c.jsxs("div",{className:"flex items-center text-sm",children:[c.jsx("span",{className:"mr-2 text-gray-600 w-28 flex-shrink-0",children:"Segments w/ CVI:"}),c.jsx("span",{className:"font-medium",children:Object.keys(i).length}),a.length>0&&c.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",Math.round(Object.keys(i).length/a.length*100),"% of ",a.length,")"]})]})]}),Object.keys(i).length>0&&o&&c.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"CVI Score Categories & Stats"}),c.jsxs("div",{className:"flex flex-wrap space-x-4 mb-3",children:[" ",c.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",c.jsx("span",{className:"w-3 h-3 bg-green-600 rounded-full mr-1.5 border border-green-700 flex-shrink-0"}),"Very Low ","(1)"," [",o.categories.veryLow,"]"]}),c.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",c.jsx("span",{className:"w-3 h-3 bg-lime-500 rounded-full mr-1.5 border border-lime-600 flex-shrink-0"}),"Low ","(2)"," [",o.categories.low,"]"]}),c.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",c.jsx("span",{className:"w-3 h-3 bg-yellow-400 rounded-full mr-1.5 border border-yellow-500 flex-shrink-0"}),"Moderate ","(3)"," [",o.categories.moderate,"]"]}),c.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",c.jsx("span",{className:"w-3 h-3 bg-orange-500 rounded-full mr-1.5 border border-orange-600 flex-shrink-0"}),"High ","(4)"," [",o.categories.high,"]"]}),c.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",c.jsx("span",{className:"w-3 h-3 bg-red-600 rounded-full mr-1.5 border border-red-700 flex-shrink-0"}),"Very High ","(5)"," [",o.categories.veryHigh,"]"]})]}),c.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-3 gap-x-2 gap-y-1",children:[c.jsxs("div",{children:["Min: ",c.jsx("span",{className:"font-medium text-gray-800",children:o.min})]}),c.jsxs("div",{children:["Max: ",c.jsx("span",{className:"font-medium text-gray-800",children:o.max})]}),c.jsxs("div",{children:["Avg: ",c.jsx("span",{className:"font-medium text-gray-800",children:o.avg})]})]})]})]})},Nt=10,m1=({segments:e,parameters:t,selectedSegmentIds:s,onSegmentSelect:r,cviScores:n,selectedFormula:i,cviStatistics:a})=>{const[o,l]=p.useState(1),h=p.useMemo(()=>{const g=[...e],w=(_,y)=>{const M=parseInt(_.split("-")[1]||"0",10),b=parseInt(y.split("-")[1]||"0",10);return M-b};return g.sort((_,y)=>{const M=s.includes(_.id),b=s.includes(y.id);return M!==b?M?-1:1:w(_.id,y.id)}),g},[e,s]),d=p.useMemo(()=>{const g=(o-1)*Nt;return h.slice(g,g+Nt)},[h,o]),u=Math.ceil(h.length/Nt),f=g=>{g>=1&&g<=u&&l(g)},m=g=>g.includes("segment-")?g.split("-")[1]:g,v=g=>{if(g==null)return"bg-gray-300";switch(Math.round(g)){case 1:return"bg-green-600";case 2:return"bg-lime-500";case 3:return"bg-yellow-400";case 4:return"bg-orange-500";case 5:return"bg-red-600";default:return"bg-gray-400"}},x=g=>{if(g==null||isNaN(g))return"bg-gray-400";const w=Math.round(g);return w<=1?"bg-green-600":w===2?"bg-lime-500":w===3?"bg-yellow-400":w===4?"bg-orange-500":w>=5?"bg-red-600":"bg-gray-400"};return c.jsxs("div",{className:"flex flex-col flex-grow h-full overflow-hidden",children:[" ",c.jsx("h3",{className:"text-lg font-medium mb-4",children:"Segment Values"}),i&&a&&Object.keys(n).length>0&&c.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[c.jsxs("div",{className:"flex items-center mb-2",children:[c.jsx("span",{className:"font-medium text-blue-800 mr-2",children:"CVI Calculation:"}),c.jsx("span",{className:"text-blue-700",children:i.name})]}),c.jsx("p",{className:"text-sm text-blue-600",children:i.description}),c.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-x-4 gap-y-1 text-sm",children:[" ",c.jsxs("div",{children:[c.jsx("span",{className:"text-blue-500",children:"Segments:"})," ",c.jsxs("span",{className:"font-medium text-blue-800",children:[a.count," of ",e.length]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-blue-500",children:"Range:"})," ",c.jsxs("span",{className:"font-medium text-blue-800",children:[a.min," - ",a.max]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-blue-500",children:"Average:"})," ",c.jsx("span",{className:"font-medium text-blue-800",children:a.avg})]}),c.jsxs("div",{className:"col-span-3 pt-1 border-t border-blue-100 mt-1 text-xs",children:[" ",c.jsx("span",{className:"text-blue-500",children:"Counts:"})," Very Low: ",c.jsx("span",{className:"font-medium text-blue-800",children:a.categories.veryLow}),", Low: ",c.jsx("span",{className:"font-medium text-blue-800",children:a.categories.low}),", Moderate: ",c.jsx("span",{className:"font-medium text-blue-800",children:a.categories.moderate}),", High: ",c.jsx("span",{className:"font-medium text-blue-800",children:a.categories.high}),", Very High: ",c.jsx("span",{className:"font-medium text-blue-800",children:a.categories.veryHigh})]})]})]}),c.jsxs("div",{className:"flex-grow overflow-auto",children:[" ",c.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[c.jsx("thead",{className:"bg-gray-50",children:c.jsxs("tr",{children:[c.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),c.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Length (m)"}),t.map(g=>c.jsxs("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",title:g.name,children:[g.name.length>15?g.name.substring(0,12)+"...":g.name," (Vuln)"]},g.id)),c.jsxs("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:["CVI ",i&&c.jsxs("span",{className:"text-blue-500",children:["(",i.name.substring(0,10),i.name.length>10?"...":"",")"]})]})]})}),c.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[d.map((g,w)=>{var M;const _=m(g.id),y=s.includes(g.id);return c.jsxs("tr",{className:`${y?"bg-blue-50 font-medium":w%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-100 transition-colors duration-150`,onClick:()=>r(g.id),style:{cursor:"pointer"},children:[c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:y,onChange:b=>{b.stopPropagation(),r(g.id)},className:"mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500","aria-label":`Select segment ${_}`}),c.jsx("span",{children:_})]})}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:typeof((M=g.properties)==null?void 0:M.length)=="number"?g.properties.length.toFixed(2):"N/A"}),t.map(b=>{var I;const E=(I=g.parameters)==null?void 0:I[b.id],N=(E==null?void 0:E.vulnerability)??null;return c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:N!==null?c.jsx("div",{className:"flex justify-center",title:`Value: ${(E==null?void 0:E.value)??"N/A"}, Vulnerability: ${N}`,children:c.jsx("span",{title:`Vulnerability: ${N}`,className:`inline-block w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium ${v(N)}`,children:N})}):"-"},b.id)}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:n[g.id]!==void 0?c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsxs("span",{title:`CVI Score: ${n[g.id].toFixed(2)} (${Dt(n[g.id])})`,className:`inline-block w-6 h-6 rounded-full text-white flex items-center justify-center text-xs font-medium ${x(n[g.id])}`,children:[Math.round(n[g.id])," "]}),c.jsx("span",{className:"text-xs mt-1",children:n[g.id].toFixed(2)})]}):"-"})]},g.id)}),d.length===0&&c.jsx("tr",{children:c.jsx("td",{colSpan:t.length+3,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No segments to display for the current page."})})]})]})]}),u>1&&c.jsxs("div",{className:"mt-4 flex items-center justify-between flex-shrink-0 border-t pt-3",children:[" ",c.jsxs("div",{className:"text-gray-500 text-sm",children:["Showing ",(o-1)*Nt+1," to ",Math.min(o*Nt,h.length)," of ",h.length," segments"]}),c.jsxs("div",{className:"flex space-x-1 sm:space-x-2",children:[c.jsx("button",{onClick:()=>f(o-1),disabled:o===1,className:"px-3 py-1 border border-gray-300 rounded-md text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50","aria-label":"Previous page",children:"Previous"}),c.jsxs("span",{className:"text-xs p-1 text-gray-700",children:[" ","Page ",o," of ",u]}),c.jsx("button",{onClick:()=>f(o+1),disabled:o===u,className:"px-3 py-1 border border-gray-300 rounded-md text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50","aria-label":"Next page",children:"Next"})]})]})]})},g1=()=>{const e=ke(),[t,s]=p.useState([]),[r,n]=p.useState([]),[i,a]=p.useState(null),[o,l]=p.useState({}),[h,d]=p.useState(null),[u,f]=p.useState(!0),[m,v]=p.useState(null),x=p.useCallback(async()=>{f(!0),v(null);try{console.log("Loading data for Parameter Assignment...");const g=await ce.getShorelineData("current-segments");if(!g||!g.features||g.features.length===0){v("No segments found. Please complete the segmentation step first."),e("/segment-table"),f(!1);return}const w=await ce.getShorelineData("current-parameters");if(!w||!w.features||w.features.length===0){v("No parameters found. Please complete the parameter selection step first."),e("/parameter-selection"),f(!1);return}const _=g.features.filter(b=>b&&b.geometry&&(b.geometry.type==="LineString"||b.geometry.type==="MultiLineString")).map((b,E)=>{var D;const N=((D=b.properties)==null?void 0:D.id)||`segment-${E+1}`,I=b.properties||{},A=I.parameters&&typeof I.parameters=="object"?I.parameters:{};let R=I.length;if(R==null||typeof R!="number")try{R=Ft(b.geometry,{units:"meters"})}catch(U){console.warn(`Could not calculate length for segment ${N}:`,U),R=0}const T={...I,id:N,length:R,parameters:A,index:I.index??E+1,vulnerabilityIndex:I.vulnerabilityIndex,vulnerabilityFormula:I.vulnerabilityFormula};return{id:N,type:"Feature",geometry:b.geometry,properties:T,parameters:A}});if(_.length===0)throw new Error("No valid line segments found after filtering");if(console.log(`Processed ${_.length} segments`),s(_),_.length>0){const b=_.map(N=>({type:"Feature",geometry:N.geometry,properties:{}})),E=Ps(b);try{const N=qt(E);if(N&&N.length===4&&N.every(I=>isFinite(I))&&N[0]<=N[2]&&N[1]<=N[3]){const I=[[N[1],N[0]],[N[3],N[2]]];a(I),console.log("Calculated map bounds:",I)}else console.warn("Could not calculate valid bounds from segments.")}catch(N){console.error("Error calculating bounds:",N)}}const y=w.features.map(b=>b.properties).filter(b=>b!==null&&b.enabled===!0);console.log(`Processed ${y.length} enabled parameters`),n(y);const M=_.reduce((b,E)=>(E.properties.vulnerabilityIndex!==void 0&&E.properties.vulnerabilityIndex!==null&&(b[E.id]=E.properties.vulnerabilityIndex),b),{});if(Object.keys(M).length>0){console.log(`Loaded ${Object.keys(M).length} pre-existing CVI scores`),l(M);const b=_.find(E=>E.properties.vulnerabilityFormula);if(b!=null&&b.properties.vulnerabilityFormula){const E=Bs.find(N=>N.type===b.properties.vulnerabilityFormula);E?(console.log(`Setting pre-existing formula: ${E.name}`),d(E)):console.warn(`Segment ${b.id} has unknown formula type: ${b.properties.vulnerabilityFormula}`)}}}catch(g){console.error("Error loading data:",g),v(`Failed to load assignment data: ${g instanceof Error?g.message:String(g)}`)}finally{f(!1)}},[e]);return p.useEffect(()=>{x()},[x]),{segments:t,setSegments:s,parameters:r,mapBounds:i,initialCviScores:o,initialFormula:h,loading:u,error:m,setError:v}},p1=async(e,t,s,r,n)=>{console.log(`Applying value "${r}" (vuln: ${n}) for "${s.name}" to ${t.length} segments`);let i=!1;const a=e.map(o=>{var l;if(t.includes(o.id)){let h,d=!1;if(s.type==="numerical"){const f=parseFloat(r);if(!isNaN(f))h={type:"numerical",value:f,vulnerability:n};else return console.error(`Skipping segment ${o.id}: Invalid numerical value ${r}`),o}else h={type:"categorical",value:r,vulnerability:n};const u=(l=o.parameters)==null?void 0:l[s.id];if((!u||u.value!==h.value||u.vulnerability!==h.vulnerability)&&(d=!0),d){i=!0;const f={...o.parameters,[s.id]:h},m=o.properties||{id:o.id},v=m.parameters&&typeof m.parameters=="object"?m.parameters:{},x={...m,parameters:{...v,[s.id]:h}};return{...o,parameters:f,properties:x}}}return o});if(i)try{const o=a.map(l=>({type:"Feature",geometry:l.geometry,properties:l.properties}));await ce.storeShorelineData("current-segments",{type:"FeatureCollection",features:o}),console.log("Stored updated segments after value application")}catch(o){throw console.error("Failed to store updated segments:",o),new Error(`Failed to save changes: ${o instanceof Error?o.message:String(o)}`)}else console.log("No actual segment values changed, skipping database update.");return a},Ar=(e,t)=>{const s=t.reduce((n,i)=>n+i,0);if(s===0)return 0;let r=1;for(let n=0;n<e.length;n++){const i=Math.max(1e-9,e[n]),a=t[n]/s;r*=Math.pow(i,a)}return r},v1=(e,t)=>{const s=e.length;if(s===0)return 0;const r=Ar(e,t);return Math.pow(r,1/s)},y1=(e,t)=>{const s=t.reduce((i,a)=>i+a,0);if(s===0)return 0;let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r/s},x1=(e,t)=>{const s=t.reduce((a,o)=>a+o,0);if(s===0)return 0;const n=e.reduce((a,o,l)=>a+Math.pow(o,2)*t[l],0)/s;return Math.sqrt(n)},b1=async(e,t,s,r,n,i)=>{console.log("Calculating CVI using formula:",s.name),i(null);try{const a={},o=[...e];let l=!1;const h=t.filter(f=>f.weight>0),d=h.reduce((f,m)=>f+m.weight,0);if(Math.abs(d-1)>.01){const f=`Weights of parameters used in calculation do not sum to 1 (Sum: ${d.toFixed(2)}). Please adjust weights in Parameter Selection.`;console.error(f),i(f)}e.forEach((f,m)=>{var _;if(!h.every(y=>f.parameters&&f.parameters[y.id]!==void 0))return;const x=[],g=[];h.forEach(y=>{const M=f.parameters[y.id],b=Math.max(1,Math.min(5,M.vulnerability));M.vulnerability!==b&&console.warn(`Parameter ${y.name} for segment ${f.id} has vulnerability ${M.vulnerability} outside 1-5 range. Clamped to ${b}.`),x.push(b),g.push(y.weight)});let w;switch(s.type){case"geometric-mean":w=Ar(x,g);break;case"geometric-mean-normalized":w=v1(x,g);break;case"arithmetic-mean":w=y1(x,g);break;case"nonlinear-power":w=x1(x,g);break;default:console.warn(`Unknown formula type: ${s.type}. Defaulting to geometric mean.`),w=Ar(x,g)}w=Math.round(w*100)/100,a[f.id]=w,(_=o[m])!=null&&_.properties&&(o[m].properties.vulnerabilityIndex!==w||o[m].properties.vulnerabilityFormula!==s.type)&&(o[m].properties.vulnerabilityIndex=w,o[m].properties.vulnerabilityFormula=s.type,l=!0)});const u={type:"FeatureCollection",features:o.map(f=>({type:"Feature",geometry:f.geometry,properties:f.properties}))};if(l)try{await ce.storeShorelineData("current-segments",u),r(o),console.log("Saved CVI scores to segments in IndexedDB")}catch(f){console.error("Failed to save CVI scores to IndexedDB:",f),i("Failed to save calculated CVI scores locally. Calculations are shown but may be lost if you leave the page.")}else Object.keys(a).length>0&&console.log("CVI scores calculated, but no segment properties changed. Data already consistent in IndexedDB if previously saved.");n(a),console.log(`Calculated CVI scores for ${Object.keys(a).length} segments.`)}catch(a){console.error("Error during CVI calculation:",a),i(`An error occurred during CVI calculation: ${a instanceof Error?a.message:String(a)}`),n({})}},_1=({title:e,completionPercentage:t})=>c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:e}),c.jsxs("div",{className:"text-right",children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Overall Completion:"}),c.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2.5 mt-1 dark:bg-gray-700",children:c.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${t}%`}})}),c.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[t,"%"]})]})]});function w1(){const e=ke(),t=p.useRef(null),{segments:s,setSegments:r,parameters:n,mapBounds:i,initialCviScores:a,initialFormula:o,loading:l,error:h,setError:d}=g1(),[u,f]=p.useState([]),[m,v]=p.useState(null),[x,g]=p.useState([]),[w,_]=p.useState(null),[y,M]=p.useState(1),[b,E]=p.useState(null),[N,I]=p.useState({}),[A,R]=p.useState(!1),[T,D]=p.useState(null);p.useEffect(()=>{!l&&n.length>0&&!m&&v(n[0]),!l&&o&&!b&&E(o),!l&&Object.keys(a).length>0&&Object.keys(N).length===0&&I(a)},[l,n,o,a,m,b,N]);const U=p.useMemo(()=>{if(s.length===0||n.length===0)return 0;const j=s.length*n.length;let $=0;return s.forEach(W=>{n.forEach(me=>{W.parameters&&W.parameters[me.id]!==void 0&&$++})}),j===0?0:Math.round($/j*100)},[s,n]),oe=p.useMemo(()=>!s||s.length===0?null:{type:"FeatureCollection",features:s.map(j=>({type:"Feature",geometry:j.geometry,properties:{...j.properties,id:j.id,isSelected:u.includes(j.id),vulnerabilityIndex:j.properties.vulnerabilityIndex,vulnerabilityFormula:j.properties.vulnerabilityFormula}}))},[s,u]),P=j=>{D(j),j&&console.error("Error:",j)},F=p.useCallback(j=>{f($=>$.includes(j)?$.filter(W=>W!==j):[...$,j])},[]),H=p.useCallback(()=>{f(s.map(j=>j.id))},[s]),G=p.useCallback(()=>{f([])},[]),je=p.useCallback(j=>{const $=n.find(W=>W.id===j);$?(v($),_(null),M(1),console.log("Parameter selected:",$.name),P(null)):(console.error("Parameter not found:",j),P("Selected parameter could not be found."))},[n]),q=p.useCallback((j,$)=>{_(j),M($??1),console.log(`Value staged for application: ${j}, Vulnerability: ${$??1}`),P(null)},[]),he=p.useCallback(async()=>{if(!m||w===null||u.length===0){P(`Cannot apply value: ${m?w===null?"Select a value first.":"Select at least one segment on the map.":"Select a parameter first."}`);return}P(null);try{const j=await p1(s,u,m,w,y);r(j),console.log("Successfully applied value and updated segments state.")}catch(j){console.error("Error applying parameter value:",j),P(j instanceof Error?j.message:"Failed to apply value.")}},[m,w,y,s,u,r]),rs=p.useCallback(j=>{const $=j?Bs.find(W=>W.type===j):null;E($||null),console.log("Selected formula:",($==null?void 0:$.name)??"None"),P(null)},[]),ns=p.useCallback(async()=>{if(!b){P("Please select a CVI formula before calculating.");return}if(!s.every($=>n.every(W=>$.parameters&&$.parameters[W.id]!==void 0))||U<100){P(`Cannot calculate CVI: Assign values for all parameters to all segments first. (${U}% complete)`);return}P(null),R(!0),console.log(`Calculating CVI using: ${b.name}`);try{await b1(s,n,b,r,I,P),console.log("CVI calculation process finished successfully via utility.")}catch($){console.error("Error during CVI calculation process:",$),T||P($ instanceof Error?$.message:"CVI calculation failed."),I({})}finally{R(!1)}},[s,n,b,r,I,U,T]),Vs=p.useCallback(j=>{if(!j||!j.coordinates||j.coordinates.length===0){console.error("Invalid polygon geometry received for area selection");return}console.log("Area selection polygon created, finding intersecting segments...");const $=go(j.coordinates),W=[];s.forEach(me=>{try{po(me.geometry,$)&&W.push(me.id)}catch(Gs){console.warn(`Error checking intersection for segment ${me.id}:`,Gs)}}),console.log(`Found ${W.length} segments intersecting the selected area.`),f(me=>[...new Set([...me,...W])])},[s]),eo=p.useCallback(j=>{console.log("Selection polygon deletion requested (if applicable):",j),g($=>$.filter(W=>W.id!==j))},[]),to=p.useCallback(async()=>{const j=s.every(W=>n.every(me=>W.parameters&&W.parameters[me.id]!==void 0)),$=Object.keys(N).length===s.length;if(!j||U<100){P(`Assign values for all parameters to all segments first. (${U}% complete)`);return}if(!$){P(`Calculate CVI scores for all ${s.length} segments first. (${Object.keys(N).length} calculated)`);return}P(null);try{console.log("All checks passed. Navigating to results page..."),e("/results")}catch(W){console.error("Error preparing to navigate or navigating:",W),P("Failed to proceed to results.")}},[s,n,N,U,e]),so=p.useMemo(()=>{const j=Object.values(N);if(j.length===0)return null;const $=Math.min(...j),W=Math.max(...j),Gs=j.reduce((Hs,qe)=>Hs+qe,0)/j.length;let rn=0,nn=0,an=0,on=0,ln=0;return j.forEach(Hs=>{const qe=Math.round(Hs);qe<=1?rn++:qe===2?nn++:qe===3?an++:qe===4?on++:qe>=5&&ln++}),{min:$.toFixed(2),max:W.toFixed(2),avg:Gs.toFixed(2),count:j.length,categories:{veryLow:rn,low:nn,moderate:an,high:on,veryHigh:ln}}},[N]);return l?c.jsxs("div",{className:"flex items-center justify-center h-screen",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),c.jsx("p",{className:"ml-4 text-gray-600",children:"Loading assignment data..."})]}):h?c.jsxs("div",{className:"p-4 max-w-lg mx-auto mt-10 text-center",children:[c.jsx(yt,{message:h,onClose:()=>d(null)}),c.jsx("button",{onClick:()=>e("/"),className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Go Home"})]}):c.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] p-4 space-y-4 bg-gray-50",children:[" ",c.jsx(_1,{title:"5. Parameter Assignment & CVI Calculation",completionPercentage:U}),c.jsx(yt,{message:T,onClose:()=>P(null)}),c.jsxs("div",{className:"grid grid-rows-[minmax(400px,1fr)_minmax(250px,1fr)] gap-4 flex-grow overflow-hidden",children:[c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 overflow-hidden",children:[c.jsxs("div",{className:"lg:col-span-2 flex flex-col h-full overflow-hidden",children:[" ",c.jsxs("div",{className:"flex-grow overflow-hidden",children:[" ",c.jsx(u1,{segments:s,parameters:n,geoJSON:oe,initialBounds:i,selectionPolygons:x,selectedSegmentIds:u,selectedParameterId:(m==null?void 0:m.id)??null,onSegmentSelect:F,onSelectAll:H,onClearSelection:G,onSelectionDelete:eo,onAreaSelect:Vs,mapContainerRef:t})]})]}),c.jsxs("div",{className:"lg:col-span-1 flex flex-col space-y-4 overflow-y-auto pr-2 custom-scrollbar",children:[c.jsx(d1,{parameters:n,activeParameter:m,selectedValue:w,selectedVulnerability:y,onParameterSelect:je,onValueSelect:q,onApplyValue:he,selectedSegmentIds:u}),c.jsx(f1,{selectedFormula:b,onFormulaSelect:rs,onCalculateCvi:ns,completionPercentage:U,calculatingCvi:A,cviScores:N,segments:s}),c.jsx("div",{className:"bg-white p-4 rounded-lg shadow sticky bottom-0 border-t border-gray-200 mt-auto",children:c.jsx("button",{onClick:to,className:"w-full px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity duration-200",disabled:U<100||Object.keys(N).length!==s.length||A,title:U<100?`Complete parameter assignment (${U}%) first`:Object.keys(N).length!==s.length?`Calculate CVI for all ${s.length} segments first (${Object.keys(N).length} done)`:A?"Calculation in progress...":"Proceed to results visualization",children:A?c.jsxs(c.Fragment,{children:[c.jsxs("svg",{"aria-hidden":"true",role:"status",className:"inline w-4 h-4 mr-2 text-white animate-spin",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[c.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"#E5E7EB"}),c.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentColor"})]}),"Calculating..."]}):"Continue to Results"})})]})]}),c.jsx("div",{className:"bg-white p-4 rounded-lg shadow flex flex-col overflow-hidden",children:c.jsx(m1,{segments:s,parameters:n,selectedSegmentIds:u,onSegmentSelect:F,cviScores:N,selectedFormula:b,cviStatistics:so})})]})," "]})}const M1=()=>{const e=[{label:"Very Low",rank:1,color:"bg-green-600",border:"border-green-700"},{label:"Low",rank:2,color:"bg-lime-500",border:"border-lime-600"},{label:"Moderate",rank:3,color:"bg-yellow-400",border:"border-yellow-500"},{label:"High",rank:4,color:"bg-orange-500",border:"border-orange-600"},{label:"Very High",rank:5,color:"bg-red-600",border:"border-red-700"},{label:"No Data / Error",rank:0,color:"bg-gray-400",border:"border-gray-500"}];return c.jsx("div",{className:"space-y-2",children:e.map(t=>c.jsxs("div",{className:"flex items-center",children:[c.jsx("span",{className:`w-4 h-4 rounded-full mr-2 flex-shrink-0 ${t.color} border ${t.border}`}),c.jsxs("span",{className:"text-sm text-gray-700",children:[t.label,c.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(Rank ",t.rank>0?t.rank:"N/A",")"]})]})]},t.label))})};function E1(){const e=ke(),[t,s]=p.useState([]),[r,n]=p.useState([]),[i,a]=p.useState(null),[o,l]=p.useState(null),[h,d]=p.useState(!0),[u,f]=p.useState(null);p.useEffect(()=>{(async()=>{d(!0),f(null);try{console.log("Loading data for Results Page...");const y=await ce.getShorelineData("current-segments");if(!y||!y.features||y.features.length===0)throw new Error("No segments found. Please complete previous steps.");const M=y.features.filter(A=>{var R;return A&&A.geometry&&(A.geometry.type==="LineString"||A.geometry.type==="MultiLineString")&&((R=A.properties)==null?void 0:R.vulnerabilityIndex)!==void 0}).map((A,R)=>{const T=A.properties||{};return{id:T.id||`segment-${R+1}`,type:"Feature",geometry:A.geometry,properties:{...T,id:T.id||`segment-${R+1}`,vulnerabilityIndex:T.vulnerabilityIndex,vulnerabilityFormula:T.vulnerabilityFormula,parameters:T.parameters||{}},parameters:T.parameters||{}}});if(M.length===0)throw new Error("No segments with calculated CVI scores found. Please calculate CVI first.");console.log(`Loaded ${M.length} segments with CVI scores.`),s(M);const b=M.find(A=>A.properties.vulnerabilityFormula);if(b!=null&&b.properties.vulnerabilityFormula){const A=Bs.find(R=>R.type===b.properties.vulnerabilityFormula);A?(console.log(`Determined used formula: ${A.name}`),a(A)):console.warn(`Unknown formula type found in segments: ${b.properties.vulnerabilityFormula}`)}else console.warn("Could not determine the CVI formula used from segment data.");const E=await ce.getShorelineData("current-parameters");if(E&&E.features){const A=E.features.map(R=>R.properties).filter(R=>R!==null&&R.enabled===!0);n(A),console.log(`Loaded ${A.length} enabled parameters.`)}const N=M.map(A=>({type:"Feature",geometry:A.geometry,properties:{}})),I=Ps(N);try{const A=qt(I);if(A&&A.length===4&&A.every(R=>isFinite(R))&&A[0]<=A[2]&&A[1]<=A[3]){const R=[[A[1],A[0]],[A[3],A[2]]];l(R),console.log("Calculated map bounds:",R)}else console.warn("Could not calculate valid bounds from segments.")}catch(A){console.error("Error calculating bounds:",A)}}catch(y){console.error("Error loading results data:",y),f(`Failed to load results: ${y instanceof Error?y.message:String(y)}. Please ensure previous steps are completed.`)}finally{d(!1)}})()},[e]);const m=p.useMemo(()=>t.length===0?null:{type:"FeatureCollection",features:t.map(_=>({type:"Feature",geometry:_.geometry,properties:{..._.properties,id:_.id,cviScore:_.properties.vulnerabilityIndex,cviCategory:Dt(_.properties.vulnerabilityIndex??null)}}))},[t]),v=p.useMemo(()=>{const _=t.map(D=>D.properties.vulnerabilityIndex).filter(D=>D!=null);if(_.length===0)return null;const y=Math.min(..._),M=Math.max(..._),E=_.reduce((D,U)=>D+U,0)/_.length;let N=0,I=0,A=0,R=0,T=0;return _.forEach(D=>{const U=Dt(D);U==="Very Low"?N++:U==="Low"?I++:U==="Moderate"?A++:U==="High"?R++:U==="Very High"&&T++}),{min:y.toFixed(2),max:M.toFixed(2),avg:E.toFixed(2),count:_.length,totalSegments:t.length,categories:{veryLow:N,low:I,moderate:A,high:R,veryHigh:T}}},[t]),x=()=>{e("/shoreline")},g=()=>{e("/parameter-assignment")},w=p.useCallback(()=>{if(t.length===0){f("No segment data available to export.");return}f(null);try{const y={type:"FeatureCollection",features:t.map(I=>{const A={...I.properties,cvi_score:I.properties.vulnerabilityIndex,cvi_category:Dt(I.properties.vulnerabilityIndex??null)};return{type:"Feature",geometry:I.geometry,properties:A}})},M=JSON.stringify(y,null,2),b=new Blob([M],{type:"application/geo+json"}),E=URL.createObjectURL(b),N=document.createElement("a");N.href=E,N.download="cvic_results.geojson",document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(E),console.log("GeoJSON export triggered.")}catch(_){console.error("Error exporting GeoJSON:",_),f(`Failed to export GeoJSON: ${_ instanceof Error?_.message:String(_)}`)}},[t]);return h?c.jsxs("div",{className:"flex items-center justify-center h-screen",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),c.jsx("p",{className:"ml-4 text-gray-600",children:"Loading results..."})]}):c.jsxs("div",{className:"max-w-7xl mx-auto mt-8 px-4",children:[c.jsx("h1",{className:"text-3xl font-bold text-center mb-6 text-gray-800",children:"Coastal Vulnerability Index Results"}),c.jsx(yt,{message:u,onClose:()=>f(null)}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"lg:col-span-2 bg-white p-4 rounded-lg shadow overflow-hidden min-h-[600px] flex flex-col",children:[c.jsx("h2",{className:"text-xl font-semibold mb-3 text-gray-700",children:"Vulnerability Map"}),c.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Shoreline segments colored by calculated CVI score. Click segments for details. Formula used: ",c.jsx("span",{className:"font-medium",children:(i==null?void 0:i.name)||"Unknown"}),"."]}),c.jsx("div",{className:"flex-grow h-full border rounded",children:m?c.jsx(wt,{geoJSON:m,segments:t,parameters:r,selectedSegments:[],selectedParameter:null,selectionPolygons:[],onSegmentSelect:_=>console.log("Segment clicked:",_),onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:o,stylingMode:"cvi"}):c.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:u?"Error loading map data.":"No results data to display on map."})})]}),c.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[c.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Summary Statistics"}),v?c.jsxs("div",{className:"space-y-3",children:[c.jsxs("p",{className:"text-sm text-gray-600",children:["Calculated for ",c.jsx("span",{className:"font-medium",children:v.count})," of ",c.jsx("span",{className:"font-medium",children:v.totalSegments})," segments."]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Min CVI"}),c.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.min})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Max CVI"}),c.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.max})]}),c.jsxs("div",{className:"col-span-2",children:[c.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Average CVI"}),c.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.avg})]})]}),c.jsxs("div",{className:"pt-3 mt-3 border-t",children:[c.jsx("span",{className:"text-xs text-gray-500 uppercase block mb-1",children:"Segment Counts by Category"}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-green-700",children:"Very Low:"}),c.jsx("span",{className:"font-medium text-gray-800",children:v.categories.veryLow})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-lime-600",children:"Low:"}),c.jsx("span",{className:"font-medium text-gray-800",children:v.categories.low})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-yellow-600",children:"Moderate:"}),c.jsx("span",{className:"font-medium text-gray-800",children:v.categories.moderate})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-orange-600",children:"High:"}),c.jsx("span",{className:"font-medium text-gray-800",children:v.categories.high})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-red-700",children:"Very High:"}),c.jsx("span",{className:"font-medium text-gray-800",children:v.categories.veryHigh})]})]})]}):c.jsx("p",{className:"text-gray-500",children:"No CVI statistics available."})]}),c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[c.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Map Legend"}),c.jsx(M1,{})]}),c.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[c.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Actions"}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("button",{onClick:g,className:"w-full px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",title:"Return to the parameter assignment and CVI calculation page",children:"Back to Parameter Assignment"}),c.jsx("button",{onClick:w,disabled:t.length===0||h,className:"w-full px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Download the results as a GeoJSON file",children:"Export Results (GeoJSON)"}),c.jsx("button",{onClick:x,className:"w-full px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",title:"Start a new analysis from the beginning (clears current data)",children:"Start New Analysis"})]})]})]})]})]})}function st({children:e}){const{user:t,loading:s}=Fs();return s?c.jsx("div",{className:"flex items-center justify-center min-h-screen",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}):t?c.jsx(c.Fragment,{children:e}):c.jsx(ho,{to:"/login",replace:!0})}const N1=co([{path:"/",element:c.jsx(Bu,{children:c.jsx(Uu,{})}),errorElement:c.jsx("div",{children:"Something went wrong"}),children:[{index:!0,element:c.jsx(yd,{})},{path:"login",element:c.jsx(xd,{})},{path:"shoreline",element:c.jsx(st,{children:c.jsx(i1,{})})},{path:"segmentation",element:c.jsx(st,{children:c.jsx(o1,{})})},{path:"segment-table",element:c.jsx(st,{children:c.jsx(l1,{})})},{path:"parameter-selection",element:c.jsx(st,{children:c.jsx(h1,{})})},{path:"parameter-assignment",element:c.jsx(st,{children:c.jsx(w1,{})})},{path:"results",element:c.jsx(st,{children:c.jsx(E1,{})})}]}]),S1=()=>c.jsx(uo,{router:N1});lr.createRoot(document.getElementById("root")).render(c.jsx(fo.StrictMode,{children:c.jsx(Fu,{children:c.jsx(S1,{})})}))});export default I1();
//# sourceMappingURL=index-Bl3yjLZ3.js.map
