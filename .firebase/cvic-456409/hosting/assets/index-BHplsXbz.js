var Ba=Object.defineProperty;var Ua=(e,t,s)=>t in e?Ba(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Va=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var $s=(e,t,s)=>Ua(e,typeof t!="symbol"?t+"":t,s);import{r as g,b as Ga,u as za,L as St,O as Ha,d as $e,e as qa,N as Wa,R as Ja,f as Ka}from"./vendor-4YBsvtOL.js";import{L as J,f as Ns,b as Vt,l as Zr,a as Tt,c as Xa,d as un,p as Qa,e as Za}from"./map-EM7m49nP.js";var Rp=Va(O=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();var dn={exports:{}},Is={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ya=g,eo=Symbol.for("react.element"),to=Symbol.for("react.fragment"),so=Object.prototype.hasOwnProperty,ro=Ya.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,io={key:!0,ref:!0,__self:!0,__source:!0};function fn(e,t,s){var r,i={},n=null,a=null;s!==void 0&&(n=""+s),t.key!==void 0&&(n=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)so.call(t,r)&&!io.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:eo,type:e,key:n,ref:a,props:i,_owner:ro.current}}Is.Fragment=to;Is.jsx=fn;Is.jsxs=fn;dn.exports=Is;var l=dn.exports,er={},Yr=Ga;er.createRoot=Yr.createRoot,er.hydrateRoot=Yr.hydrateRoot;var ei={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn=function(e){const t=[];let s=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[s++]=i:i<2048?(t[s++]=i>>6|192,t[s++]=i&63|128):(i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[s++]=i>>18|240,t[s++]=i>>12&63|128,t[s++]=i>>6&63|128,t[s++]=i&63|128):(t[s++]=i>>12|224,t[s++]=i>>6&63|128,t[s++]=i&63|128)}return t},no=function(e){const t=[];let s=0,r=0;for(;s<e.length;){const i=e[s++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const n=e[s++];t[r++]=String.fromCharCode((i&31)<<6|n&63)}else if(i>239&&i<365){const n=e[s++],a=e[s++],o=e[s++],c=((i&7)<<18|(n&63)<<12|(a&63)<<6|o&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{const n=e[s++],a=e[s++];t[r++]=String.fromCharCode((i&15)<<12|(n&63)<<6|a&63)}}return t.join("")},gn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const n=e[i],a=i+1<e.length,o=a?e[i+1]:0,c=i+2<e.length,h=c?e[i+2]:0,d=n>>2,u=(n&3)<<4|o>>4;let f=(o&15)<<2|h>>6,m=h&63;c||(m=64,a||(f=64)),r.push(s[d],s[u],s[f],s[m])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(mn(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):no(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const n=s[e.charAt(i++)],o=i<e.length?s[e.charAt(i)]:0;++i;const h=i<e.length?s[e.charAt(i)]:64;++i;const u=i<e.length?s[e.charAt(i)]:64;if(++i,n==null||o==null||h==null||u==null)throw new ao;const f=n<<2|o>>4;if(r.push(f),h!==64){const m=o<<4&240|h>>2;if(r.push(m),u!==64){const v=h<<6&192|u;r.push(v)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ao extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const oo=function(e){const t=mn(e);return gn.encodeByteArray(t,!0)},pn=function(e){return oo(e).replace(/\./g,"")},vn=function(e){try{return gn.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co=()=>lo().__FIREBASE_DEFAULTS__,ho=()=>{if(typeof process>"u"||typeof ei>"u")return;const e=ei.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},uo=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&vn(e[1]);return t&&JSON.parse(t)},wr=()=>{try{return co()||ho()||uo()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},fo=e=>{var t,s;return(s=(t=wr())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[e]},yn=()=>{var e;return(e=wr())===null||e===void 0?void 0:e.config},xn=e=>{var t;return(t=wr())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,r)=>{s?this.reject(s):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,r))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function go(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(se())}function po(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vo(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function yo(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xo(){const e=se();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function bo(){try{return typeof indexedDB=="object"}catch{return!1}}function wo(){return new Promise((e,t)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var n;t(((n=i.error)===null||n===void 0?void 0:n.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo="FirebaseError";class Fe extends Error{constructor(t,s,r){super(s),this.code=t,this.customData=r,this.name=Mo,Object.setPrototypeOf(this,Fe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Gt.prototype.create)}}class Gt{constructor(t,s,r){this.service=t,this.serviceName=s,this.errors=r}create(t,...s){const r=s[0]||{},i=`${this.service}/${t}`,n=this.errors[t],a=n?_o(n,r):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new Fe(i,o,r)}}function _o(e,t){return e.replace(Eo,(s,r)=>{const i=t[r];return i!=null?String(i):`<${r}?>`})}const Eo=/\{\$([^}]+)}/g;function So(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function fs(e,t){if(e===t)return!0;const s=Object.keys(e),r=Object.keys(t);for(const i of s){if(!r.includes(i))return!1;const n=e[i],a=t[i];if(ti(n)&&ti(a)){if(!fs(n,a))return!1}else if(n!==a)return!1}for(const i of r)if(!s.includes(i))return!1;return!0}function ti(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(e){const t=[];for(const[s,r]of Object.entries(e))Array.isArray(r)?r.forEach(i=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function No(e,t){const s=new Io(e,t);return s.subscribe.bind(s)}class Io{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,r){let i;if(t===void 0&&s===void 0&&r===void 0)throw new Error("Missing Observer.");Co(t,["next","error","complete"])?i=t:i={next:t,error:s,complete:r},i.next===void 0&&(i.next=Fs),i.error===void 0&&(i.error=Fs),i.complete===void 0&&(i.complete=Fs);const n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),n}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Co(e,t){if(typeof e!="object"||e===null)return!1;for(const s of t)if(s in e&&typeof e[s]=="function")return!0;return!1}function Fs(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Be(e){return e&&e._delegate?e._delegate:e}class ct{constructor(t,s,r){this.name=t,this.instanceFactory=s,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ge="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const r=new mo;if(this.instancesDeferred.set(s,r),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const r=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(n){if(i)return null;throw n}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(ko(t))try{this.getOrInitializeService({instanceIdentifier:Ge})}catch{}for(const[s,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const n=this.getOrInitializeService({instanceIdentifier:i});r.resolve(n)}catch{}}}}clearInstance(t=Ge){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ge){return this.instances.has(t)}getOptions(t=Ge){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:s});for(const[n,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(n);r===o&&a.resolve(i)}return i}onInit(t,s){var r;const i=this.normalizeInstanceIdentifier(s),n=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;n.add(t),this.onInitCallbacks.set(i,n);const a=this.instances.get(i);return a&&t(a,i),()=>{n.delete(t)}}invokeOnInitCallbacks(t,s){const r=this.onInitCallbacks.get(s);if(r)for(const i of r)try{i(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:jo(t),options:s}),this.instances.set(t,r),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Ge){return this.component?this.component.multipleInstances?t:Ge:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jo(e){return e===Ge?void 0:e}function ko(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new Ao(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(H||(H={}));const To={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Ro=H.INFO,Oo={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Lo=(e,t,...s)=>{if(t<e.logLevel)return;const r=new Date().toISOString(),i=Oo[t];if(i)console[i](`[${r}]  ${e.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class bn{constructor(t){this.name=t,this._logLevel=Ro,this._logHandler=Lo,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?To[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}const Do=(e,t)=>t.some(s=>e instanceof s);let si,ri;function $o(){return si||(si=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fo(){return ri||(ri=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wn=new WeakMap,tr=new WeakMap,Mn=new WeakMap,Bs=new WeakMap,Mr=new WeakMap;function Bo(e){const t=new Promise((s,r)=>{const i=()=>{e.removeEventListener("success",n),e.removeEventListener("error",a)},n=()=>{s(Te(e.result)),i()},a=()=>{r(e.error),i()};e.addEventListener("success",n),e.addEventListener("error",a)});return t.then(s=>{s instanceof IDBCursor&&wn.set(s,e)}).catch(()=>{}),Mr.set(t,e),t}function Uo(e){if(tr.has(e))return;const t=new Promise((s,r)=>{const i=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",a),e.removeEventListener("abort",a)},n=()=>{s(),i()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",n),e.addEventListener("error",a),e.addEventListener("abort",a)});tr.set(e,t)}let sr={get(e,t,s){if(e instanceof IDBTransaction){if(t==="done")return tr.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Mn.get(e);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Te(e[t])},set(e,t,s){return e[t]=s,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Vo(e){sr=e(sr)}function Go(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const r=e.call(Us(this),t,...s);return Mn.set(r,t.sort?t.sort():[t]),Te(r)}:Fo().includes(e)?function(...t){return e.apply(Us(this),t),Te(wn.get(this))}:function(...t){return Te(e.apply(Us(this),t))}}function zo(e){return typeof e=="function"?Go(e):(e instanceof IDBTransaction&&Uo(e),Do(e,$o())?new Proxy(e,sr):e)}function Te(e){if(e instanceof IDBRequest)return Bo(e);if(Bs.has(e))return Bs.get(e);const t=zo(e);return t!==e&&(Bs.set(e,t),Mr.set(t,e)),t}const Us=e=>Mr.get(e);function Ho(e,t,{blocked:s,upgrade:r,blocking:i,terminated:n}={}){const a=indexedDB.open(e,t),o=Te(a);return r&&a.addEventListener("upgradeneeded",c=>{r(Te(a.result),c.oldVersion,c.newVersion,Te(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),o.then(c=>{n&&c.addEventListener("close",()=>n()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),o}const qo=["get","getKey","getAll","getAllKeys","count"],Wo=["put","add","delete","clear"],Vs=new Map;function ii(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Vs.get(t))return Vs.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,i=Wo.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||qo.includes(s)))return;const n=async function(a,...o){const c=this.transaction(a,i?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(o.shift())),(await Promise.all([h[s](...o),i&&c.done]))[0]};return Vs.set(t,n),n}Vo(e=>({...e,get:(t,s,r)=>ii(t,s)||e.get(t,s,r),has:(t,s)=>!!ii(t,s)||e.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(Ko(s)){const r=s.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(s=>s).join(" ")}}function Ko(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const rr="@firebase/app",ni="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Se=new bn("@firebase/app"),Xo="@firebase/app-compat",Qo="@firebase/analytics-compat",Zo="@firebase/analytics",Yo="@firebase/app-check-compat",el="@firebase/app-check",tl="@firebase/auth",sl="@firebase/auth-compat",rl="@firebase/database",il="@firebase/data-connect",nl="@firebase/database-compat",al="@firebase/functions",ol="@firebase/functions-compat",ll="@firebase/installations",cl="@firebase/installations-compat",hl="@firebase/messaging",ul="@firebase/messaging-compat",dl="@firebase/performance",fl="@firebase/performance-compat",ml="@firebase/remote-config",gl="@firebase/remote-config-compat",pl="@firebase/storage",vl="@firebase/storage-compat",yl="@firebase/firestore",xl="@firebase/vertexai-preview",bl="@firebase/firestore-compat",wl="firebase",Ml="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ir="[DEFAULT]",_l={[rr]:"fire-core",[Xo]:"fire-core-compat",[Zo]:"fire-analytics",[Qo]:"fire-analytics-compat",[el]:"fire-app-check",[Yo]:"fire-app-check-compat",[tl]:"fire-auth",[sl]:"fire-auth-compat",[rl]:"fire-rtdb",[il]:"fire-data-connect",[nl]:"fire-rtdb-compat",[al]:"fire-fn",[ol]:"fire-fn-compat",[ll]:"fire-iid",[cl]:"fire-iid-compat",[hl]:"fire-fcm",[ul]:"fire-fcm-compat",[dl]:"fire-perf",[fl]:"fire-perf-compat",[ml]:"fire-rc",[gl]:"fire-rc-compat",[pl]:"fire-gcs",[vl]:"fire-gcs-compat",[yl]:"fire-fst",[bl]:"fire-fst-compat",[xl]:"fire-vertex","fire-js":"fire-js",[wl]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms=new Map,El=new Map,nr=new Map;function ai(e,t){try{e.container.addComponent(t)}catch(s){Se.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,s)}}function Rt(e){const t=e.name;if(nr.has(t))return Se.debug(`There were multiple attempts to register component ${t}.`),!1;nr.set(t,e);for(const s of ms.values())ai(s,e);for(const s of El.values())ai(s,e);return!0}function _n(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function we(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Re=new Gt("app","Firebase",Sl);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(t,s,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ct("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Re.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht=Ml;function En(e,t={}){let s=e;typeof t!="object"&&(t={name:t});const r=Object.assign({name:ir,automaticDataCollectionEnabled:!1},t),i=r.name;if(typeof i!="string"||!i)throw Re.create("bad-app-name",{appName:String(i)});if(s||(s=yn()),!s)throw Re.create("no-options");const n=ms.get(i);if(n){if(fs(s,n.options)&&fs(r,n.config))return n;throw Re.create("duplicate-app",{appName:i})}const a=new Po(i);for(const c of nr.values())a.addComponent(c);const o=new Nl(s,r,a);return ms.set(i,o),o}function Il(e=ir){const t=ms.get(e);if(!t&&e===ir&&yn())return En();if(!t)throw Re.create("no-app",{appName:e});return t}function rt(e,t,s){var r;let i=(r=_l[e])!==null&&r!==void 0?r:e;s&&(i+=`-${s}`);const n=i.match(/\s|\//),a=t.match(/\s|\//);if(n||a){const o=[`Unable to register library "${i}" with version "${t}":`];n&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),n&&a&&o.push("and"),a&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Se.warn(o.join(" "));return}Rt(new ct(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl="firebase-heartbeat-database",Al=1,Ot="firebase-heartbeat-store";let Gs=null;function Sn(){return Gs||(Gs=Ho(Cl,Al,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Ot)}catch(s){console.warn(s)}}}}).catch(e=>{throw Re.create("idb-open",{originalErrorMessage:e.message})})),Gs}async function jl(e){try{const s=(await Sn()).transaction(Ot),r=await s.objectStore(Ot).get(Nn(e));return await s.done,r}catch(t){if(t instanceof Fe)Se.warn(t.message);else{const s=Re.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Se.warn(s.message)}}}async function oi(e,t){try{const r=(await Sn()).transaction(Ot,"readwrite");await r.objectStore(Ot).put(t,Nn(e)),await r.done}catch(s){if(s instanceof Fe)Se.warn(s.message);else{const r=Re.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Se.warn(r.message)}}}function Nn(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl=1024,Pl=30*24*60*60*1e3;class Tl{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Ol(s),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var t,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=li();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(a=>a.date===n)?void 0:(this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const o=new Date(a.date).valueOf();return Date.now()-o<=Pl}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Se.warn(r)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=li(),{heartbeatsToSend:r,unsentEntries:i}=Rl(this._heartbeatsCache.heartbeats),n=pn(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(s){return Se.warn(s),""}}}function li(){return new Date().toISOString().substring(0,10)}function Rl(e,t=kl){const s=[];let r=e.slice();for(const i of e){const n=s.find(a=>a.agent===i.agent);if(n){if(n.dates.push(i.date),ci(s)>t){n.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),ci(s)>t){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}class Ol{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return bo()?wo().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await jl(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return oi(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return oi(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function ci(e){return pn(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(e){Rt(new ct("platform-logger",t=>new Jo(t),"PRIVATE")),Rt(new ct("heartbeat",t=>new Tl(t),"PRIVATE")),rt(rr,ni,e),rt(rr,ni,"esm2017"),rt("fire-js","")}Ll("");function _r(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]]);return s}function In(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Dl=In,Cn=new Gt("auth","Firebase",In());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gs=new bn("@firebase/auth");function $l(e,...t){gs.logLevel<=H.WARN&&gs.warn(`Auth (${Ht}): ${e}`,...t)}function ns(e,...t){gs.logLevel<=H.ERROR&&gs.error(`Auth (${Ht}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(e,...t){throw Sr(e,...t)}function ue(e,...t){return Sr(e,...t)}function Er(e,t,s){const r=Object.assign(Object.assign({},Dl()),{[t]:s});return new Gt("auth","Firebase",r).create(t,{appName:e.name})}function He(e){return Er(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fl(e,t,s){const r=s;if(!(t instanceof r))throw r.name!==t.constructor.name&&ye(e,"argument-error"),Er(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Sr(e,...t){if(typeof e!="string"){const s=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(s,...r)}return Cn.create(e,...t)}function L(e,t,...s){if(!e)throw Sr(t,...s)}function Me(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ns(t),new Error(t)}function Ne(e,t){e||Me(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function Bl(){return hi()==="http:"||hi()==="https:"}function hi(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Bl()||vo()||"connection"in navigator)?navigator.onLine:!0}function Vl(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(t,s){this.shortDelay=t,this.longDelay=s,Ne(s>t,"Short delay should be less than long delay!"),this.isMobile=go()||yo()}get(){return Ul()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(e,t){Ne(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{static initialize(t,s,r){this.fetchImpl=t,s&&(this.headersImpl=s),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Me("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Me("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Me("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl=new qt(3e4,6e4);function Ir(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function gt(e,t,s,r,i={}){return jn(e,i,async()=>{let n={},a={};r&&(t==="GET"?a=r:n={body:JSON.stringify(r)});const o=zt(Object.assign({key:e.config.apiKey},a)).slice(1),c=await e._getAdditionalHeaders();c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode);const h=Object.assign({method:t,headers:c},n);return po()||(h.referrerPolicy="no-referrer"),An.fetch()(kn(e,e.config.apiHost,s,o),h)})}async function jn(e,t,s){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Gl),t);try{const i=new ql(e),n=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const a=await n.json();if("needConfirmation"in a)throw ss(e,"account-exists-with-different-credential",a);if(n.ok&&!("errorMessage"in a))return a;{const o=n.ok?a.errorMessage:a.error.message,[c,h]=o.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw ss(e,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw ss(e,"email-already-in-use",a);if(c==="USER_DISABLED")throw ss(e,"user-disabled",a);const d=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Er(e,d,h);ye(e,d)}}catch(i){if(i instanceof Fe)throw i;ye(e,"network-request-failed",{message:String(i)})}}async function Hl(e,t,s,r,i={}){const n=await gt(e,t,s,r,i);return"mfaPendingCredential"in n&&ye(e,"multi-factor-auth-required",{_serverResponse:n}),n}function kn(e,t,s,r){const i=`${t}${s}?${r}`;return e.config.emulator?Nr(e.config,i):`${e.config.apiScheme}://${i}`}class ql{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,r)=>{this.timer=setTimeout(()=>r(ue(this.auth,"network-request-failed")),zl.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ss(e,t,s){const r={appName:e.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const i=ue(e,t,r);return i.customData._tokenResponse=s,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wl(e,t){return gt(e,"POST","/v1/accounts:delete",t)}async function Pn(e,t){return gt(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function Jl(e,t=!1){const s=Be(e),r=await s.getIdToken(t),i=Cr(r);L(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const n=typeof i.firebase=="object"?i.firebase:void 0,a=n==null?void 0:n.sign_in_provider;return{claims:i,token:r,authTime:Nt(zs(i.auth_time)),issuedAtTime:Nt(zs(i.iat)),expirationTime:Nt(zs(i.exp)),signInProvider:a||null,signInSecondFactor:(n==null?void 0:n.sign_in_second_factor)||null}}function zs(e){return Number(e)*1e3}function Cr(e){const[t,s,r]=e.split(".");if(t===void 0||s===void 0||r===void 0)return ns("JWT malformed, contained fewer than 3 sections"),null;try{const i=vn(s);return i?JSON.parse(i):(ns("Failed to decode base64 JWT payload"),null)}catch(i){return ns("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function ui(e){const t=Cr(e);return L(t,"internal-error"),L(typeof t.exp<"u","internal-error"),L(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lt(e,t,s=!1){if(s)return t;try{return await t}catch(r){throw r instanceof Fe&&Kl(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}function Kl({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nt(this.lastLoginAt),this.creationTime=Nt(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ps(e){var t;const s=e.auth,r=await e.getIdToken(),i=await Lt(e,Pn(s,{idToken:r}));L(i==null?void 0:i.users.length,s,"internal-error");const n=i.users[0];e._notifyReloadListener(n);const a=!((t=n.providerUserInfo)===null||t===void 0)&&t.length?Tn(n.providerUserInfo):[],o=Zl(e.providerData,a),c=e.isAnonymous,h=!(e.email&&n.passwordHash)&&!(o!=null&&o.length),d=c?h:!1,u={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:o,metadata:new or(n.createdAt,n.lastLoginAt),isAnonymous:d};Object.assign(e,u)}async function Ql(e){const t=Be(e);await ps(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Zl(e,t){return[...e.filter(r=>!t.some(i=>i.providerId===r.providerId)),...t]}function Tn(e){return e.map(t=>{var{providerId:s}=t,r=_r(t,["providerId"]);return{providerId:s,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yl(e,t){const s=await jn(e,{},async()=>{const r=zt({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:n}=e.config,a=kn(e,i,"/v1/token",`key=${n}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",An.fetch()(a,{method:"POST",headers:o,body:r})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function ec(e,t){return gt(e,"POST","/v2/accounts:revokeToken",Ir(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){L(t.idToken,"internal-error"),L(typeof t.idToken<"u","internal-error"),L(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):ui(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){L(t.length!==0,"internal-error");const s=ui(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(L(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:r,refreshToken:i,expiresIn:n}=await Yl(t,s);this.updateTokensAndExpiration(r,i,Number(n))}updateTokensAndExpiration(t,s,r){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(t,s){const{refreshToken:r,accessToken:i,expirationTime:n}=s,a=new it;return r&&(L(typeof r=="string","internal-error",{appName:t}),a.refreshToken=r),i&&(L(typeof i=="string","internal-error",{appName:t}),a.accessToken=i),n&&(L(typeof n=="number","internal-error",{appName:t}),a.expirationTime=n),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new it,this.toJSON())}_performRefresh(){return Me("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(e,t){L(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class _e{constructor(t){var{uid:s,auth:r,stsTokenManager:i}=t,n=_r(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Xl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new or(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(t){const s=await Lt(this,this.stsTokenManager.getToken(this.auth,t));return L(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return Jl(this,t)}reload(){return Ql(this)}_assign(t){this!==t&&(L(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new _e(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let r=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),s&&await ps(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(we(this.auth.app))return Promise.reject(He(this.auth));const t=await this.getIdToken();return await Lt(this,Wl(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var r,i,n,a,o,c,h,d;const u=(r=s.displayName)!==null&&r!==void 0?r:void 0,f=(i=s.email)!==null&&i!==void 0?i:void 0,m=(n=s.phoneNumber)!==null&&n!==void 0?n:void 0,v=(a=s.photoURL)!==null&&a!==void 0?a:void 0,y=(o=s.tenantId)!==null&&o!==void 0?o:void 0,p=(c=s._redirectEventId)!==null&&c!==void 0?c:void 0,_=(h=s.createdAt)!==null&&h!==void 0?h:void 0,x=(d=s.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:w,emailVerified:E,isAnonymous:b,providerData:M,stsTokenManager:S}=s;L(w&&S,t,"internal-error");const I=it.fromJSON(this.name,S);L(typeof w=="string",t,"internal-error"),Ae(u,t.name),Ae(f,t.name),L(typeof E=="boolean",t,"internal-error"),L(typeof b=="boolean",t,"internal-error"),Ae(m,t.name),Ae(v,t.name),Ae(y,t.name),Ae(p,t.name),Ae(_,t.name),Ae(x,t.name);const C=new _e({uid:w,auth:t,email:f,emailVerified:E,displayName:u,isAnonymous:b,photoURL:v,phoneNumber:m,tenantId:y,stsTokenManager:I,createdAt:_,lastLoginAt:x});return M&&Array.isArray(M)&&(C.providerData=M.map(R=>Object.assign({},R))),p&&(C._redirectEventId=p),C}static async _fromIdTokenResponse(t,s,r=!1){const i=new it;i.updateFromServerResponse(s);const n=new _e({uid:s.localId,auth:t,stsTokenManager:i,isAnonymous:r});return await ps(n),n}static async _fromGetAccountInfoResponse(t,s,r){const i=s.users[0];L(i.localId!==void 0,"internal-error");const n=i.providerUserInfo!==void 0?Tn(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(n!=null&&n.length),o=new it;o.updateFromIdToken(r);const c=new _e({uid:i.localId,auth:t,stsTokenManager:o,isAnonymous:a}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:n,metadata:new or(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(n!=null&&n.length)};return Object.assign(c,h),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const di=new Map;function Ee(e){Ne(e instanceof Function,"Expected a class definition");let t=di.get(e);return t?(Ne(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,di.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Rn.type="NONE";const fi=Rn;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function as(e,t,s){return`firebase:${e}:${t}:${s}`}class nt{constructor(t,s,r){this.persistence=t,this.auth=s,this.userKey=r;const{config:i,name:n}=this.auth;this.fullUserKey=as(this.userKey,i.apiKey,n),this.fullPersistenceKey=as("persistence",i.apiKey,n),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?_e._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,r="authUser"){if(!s.length)return new nt(Ee(fi),t,r);const i=(await Promise.all(s.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let n=i[0]||Ee(fi);const a=as(r,t.config.apiKey,t.name);let o=null;for(const h of s)try{const d=await h._get(a);if(d){const u=_e._fromJSON(t,d);h!==n&&(o=u),n=h;break}}catch{}const c=i.filter(h=>h._shouldAllowMigration);return!n._shouldAllowMigration||!c.length?new nt(n,t,r):(n=c[0],o&&await n._set(a,o.toJSON()),await Promise.all(s.map(async h=>{if(h!==n)try{await h._remove(a)}catch{}})),new nt(n,t,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if($n(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(On(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Bn(t))return"Blackberry";if(Un(t))return"Webos";if(Ln(t))return"Safari";if((t.includes("chrome/")||Dn(t))&&!t.includes("edge/"))return"Chrome";if(Fn(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(s);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function On(e=se()){return/firefox\//i.test(e)}function Ln(e=se()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Dn(e=se()){return/crios\//i.test(e)}function $n(e=se()){return/iemobile/i.test(e)}function Fn(e=se()){return/android/i.test(e)}function Bn(e=se()){return/blackberry/i.test(e)}function Un(e=se()){return/webos/i.test(e)}function Ar(e=se()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function tc(e=se()){var t;return Ar(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function sc(){return xo()&&document.documentMode===10}function Vn(e=se()){return Ar(e)||Fn(e)||Un(e)||Bn(e)||/windows phone/i.test(e)||$n(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(e,t=[]){let s;switch(e){case"Browser":s=mi(se());break;case"Worker":s=`${mi(se())}-${e}`;break;default:s=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ht}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const r=n=>new Promise((a,o)=>{try{const c=t(n);a(c)}catch(c){o(c)}});r.onAbort=s,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const r of this.queue)await r(t),r.onAbort&&s.push(r.onAbort)}catch(r){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ic(e,t={}){return gt(e,"GET","/v2/passwordPolicy",Ir(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=6;class ac{constructor(t){var s,r,i,n;const a=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=a.minPasswordLength)!==null&&s!==void 0?s:nc,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=t.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(n=t.forceUpgradeOnSignin)!==null&&n!==void 0?n:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,r,i,n,a,o;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,c),this.validatePasswordCharacterOptions(t,c),c.isValid&&(c.isValid=(s=c.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(n=c.containsUppercaseLetter)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(o=c.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),c}validatePasswordLengthOptions(t,s){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(s.meetsMinPasswordLength=t.length>=r),i&&(s.meetsMaxPasswordLength=t.length<=i)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let r;for(let i=0;i<t.length;i++)r=t.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(t,s,r,i,n){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(t,s,r,i){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gi(this),this.idTokenSubscription=new gi(this),this.beforeStateQueue=new rc(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=Ee(s)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await nt.create(this,t),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Pn(this,{idToken:t}),r=await _e._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(r)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(we(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,n=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,o=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(t);(!a||a===o)&&(c!=null&&c.user)&&(i=c.user,n=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return L(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await ps(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Vl()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(we(this.app))return Promise.reject(He(this));const s=t?Be(t):null;return s&&L(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&L(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return we(this.app)?Promise.reject(He(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return we(this.app)?Promise.reject(He(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ee(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await ic(this),s=new ac(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Gt("auth","Firebase",t())}onAuthStateChanged(t,s,r){return this.registerStateListener(this.authStateSubscription,t,s,r)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,r){return this.registerStateListener(this.idTokenSubscription,t,s,r)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const r=this.onAuthStateChanged(()=>{r(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(r.tenantId=this.tenantId),await ec(this,r)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const r=await this.getOrInitRedirectPersistenceManager(s);return t===null?r.removeCurrentUser():r.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&Ee(t)||this._popupRedirectResolver;L(s,this,"argument-error"),this.redirectPersistenceManager=await nt.create(this,[Ee(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,r;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,r,i){if(this._deleted)return()=>{};const n=typeof s=="function"?s:s.next.bind(s);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(o,this,"internal-error"),o.then(()=>{a||n(this.currentUser)}),typeof s=="function"){const c=t.addObserver(s,r,i);return()=>{a=!0,c()}}else{const c=t.addObserver(s);return()=>{a=!0,c()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Gn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const r=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());r&&(s["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(s["X-Firebase-AppCheck"]=i),s}async _getAppCheckToken(){var t;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&$l(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Cs(e){return Be(e)}class gi{constructor(t){this.auth=t,this.observer=null,this.addObserver=No(s=>this.observer=s)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lc(e){jr=e}function cc(e){return jr.loadJS(e)}function hc(){return jr.gapiScript}function uc(e){return`__${e}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(e,t){const s=_n(e,"auth");if(s.isInitialized()){const i=s.getImmediate(),n=s.getOptions();if(fs(n,t??{}))return i;ye(i,"already-initialized")}return s.initialize({options:t})}function fc(e,t){const s=(t==null?void 0:t.persistence)||[],r=(Array.isArray(s)?s:[s]).map(Ee);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t==null?void 0:t.popupRedirectResolver)}function mc(e,t,s){const r=Cs(e);L(r._canInitEmulator,r,"emulator-config-failed"),L(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!1,n=zn(t),{host:a,port:o}=gc(t),c=o===null?"":`:${o}`;r.config.emulator={url:`${n}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:n.replace(":",""),options:Object.freeze({disableWarnings:i})}),pc()}function zn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function gc(e){const t=zn(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const n=i[1];return{host:n,port:pi(r.substr(n.length+1))}}else{const[n,a]=r.split(":");return{host:n,port:pi(a)}}}function pi(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function pc(){function e(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return Me("not implemented")}_getIdTokenResponse(t){return Me("not implemented")}_linkToIdToken(t,s){return Me("not implemented")}_getReauthenticationResolver(t){return Me("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function at(e,t){return Hl(e,"POST","/v1/accounts:signInWithIdp",Ir(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vc="http://localhost";class We extends Hn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new We(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):ye("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:r,signInMethod:i}=s,n=_r(s,["providerId","signInMethod"]);if(!r||!i)return null;const a=new We(r,i);return a.idToken=n.idToken||void 0,a.accessToken=n.accessToken||void 0,a.secret=n.secret,a.nonce=n.nonce,a.pendingToken=n.pendingToken||null,a}_getIdTokenResponse(t){const s=this.buildRequest();return at(t,s)}_linkToIdToken(t,s){const r=this.buildRequest();return r.idToken=s,at(t,r)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,at(t,s)}buildRequest(){const t={requestUri:vc,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=zt(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt extends kr{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je extends Wt{constructor(){super("facebook.com")}static credential(t){return We._fromParams({providerId:je.PROVIDER_ID,signInMethod:je.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return je.credentialFromTaggedObject(t)}static credentialFromError(t){return je.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return je.credential(t.oauthAccessToken)}catch{return null}}}je.FACEBOOK_SIGN_IN_METHOD="facebook.com";je.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be extends Wt{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return We._fromParams({providerId:be.PROVIDER_ID,signInMethod:be.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return be.credentialFromTaggedObject(t)}static credentialFromError(t){return be.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:r}=t;if(!s&&!r)return null;try{return be.credential(s,r)}catch{return null}}}be.GOOGLE_SIGN_IN_METHOD="google.com";be.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke extends Wt{constructor(){super("github.com")}static credential(t){return We._fromParams({providerId:ke.PROVIDER_ID,signInMethod:ke.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ke.credentialFromTaggedObject(t)}static credentialFromError(t){return ke.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ke.credential(t.oauthAccessToken)}catch{return null}}}ke.GITHUB_SIGN_IN_METHOD="github.com";ke.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe extends Wt{constructor(){super("twitter.com")}static credential(t,s){return We._fromParams({providerId:Pe.PROVIDER_ID,signInMethod:Pe.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Pe.credentialFromTaggedObject(t)}static credentialFromError(t){return Pe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:r}=t;if(!s||!r)return null;try{return Pe.credential(s,r)}catch{return null}}}Pe.TWITTER_SIGN_IN_METHOD="twitter.com";Pe.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,r,i=!1){const n=await _e._fromIdTokenResponse(t,r,i),a=vi(r);return new ht({user:n,providerId:a,_tokenResponse:r,operationType:s})}static async _forOperation(t,s,r){await t._updateTokensIfNecessary(r,!0);const i=vi(r);return new ht({user:t,providerId:i,_tokenResponse:r,operationType:s})}}function vi(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs extends Fe{constructor(t,s,r,i){var n;super(s.code,s.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,vs.prototype),this.customData={appName:t.name,tenantId:(n=t.tenantId)!==null&&n!==void 0?n:void 0,_serverResponse:s.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,s,r,i){return new vs(t,s,r,i)}}function qn(e,t,s,r){return(t==="reauthenticate"?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(n=>{throw n.code==="auth/multi-factor-auth-required"?vs._fromErrorAndOperation(e,n,t,r):n})}async function yc(e,t,s=!1){const r=await Lt(e,t._linkToIdToken(e.auth,await e.getIdToken()),s);return ht._forOperation(e,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xc(e,t,s=!1){const{auth:r}=e;if(we(r.app))return Promise.reject(He(r));const i="reauthenticate";try{const n=await Lt(e,qn(r,i,t,e),s);L(n.idToken,r,"internal-error");const a=Cr(n.idToken);L(a,r,"internal-error");const{sub:o}=a;return L(e.uid===o,r,"user-mismatch"),ht._forOperation(e,i,n)}catch(n){throw(n==null?void 0:n.code)==="auth/user-not-found"&&ye(r,"user-mismatch"),n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bc(e,t,s=!1){if(we(e.app))return Promise.reject(He(e));const r="signIn",i=await qn(e,r,t),n=await ht._fromIdTokenResponse(e,r,i);return s||await e._updateCurrentUser(n.user),n}function wc(e,t,s,r){return Be(e).onIdTokenChanged(t,s,r)}function Mc(e,t,s){return Be(e).beforeAuthStateChanged(t,s)}function _c(e,t,s,r){return Be(e).onAuthStateChanged(t,s,r)}function Ec(e){return Be(e).signOut()}const ys="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(ys,"1"),this.storage.removeItem(ys),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc=1e3,Nc=10;class Jn extends Wn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vn(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const r=this.storage.getItem(s),i=this.localCache[s];r!==i&&t(s,i,r)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((a,o,c)=>{this.notifyListeners(a,c)});return}const r=t.key;s?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!s&&this.localCache[r]===a||this.notifyListeners(r,a)},n=this.storage.getItem(r);sc()&&n!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,Nc):i()}notifyListeners(t,s){this.localCache[t]=s;const r=this.listeners[t];if(r)for(const i of Array.from(r))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:r}),!0)})},Sc)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Jn.type="LOCAL";const Ic=Jn;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn extends Wn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}Kn.type="SESSION";const Xn=Kn;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cc(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(i=>i.isListeningto(t));if(s)return s;const r=new As(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:r,eventType:i,data:n}=s.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;s.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(a).map(async h=>h(s.origin,n)),c=await Cc(o);s.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}As.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(e="",t=10){let s="";for(let r=0;r<t;r++)s+=Math.floor(Math.random()*10);return e+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let n,a;return new Promise((o,c)=>{const h=Pr("",20);i.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(u){const f=u;if(f.data.eventId===h)switch(f.data.status){case"ack":clearTimeout(d),n=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(n),o(f.data.response);break;default:clearTimeout(d),clearTimeout(n),c(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:t,eventId:h,data:s},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pe(){return window}function jc(e){pe().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(){return typeof pe().WorkerGlobalScope<"u"&&typeof pe().importScripts=="function"}async function kc(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Pc(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Tc(){return Qn()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zn="firebaseLocalStorageDb",Rc=1,xs="firebaseLocalStorage",Yn="fbase_key";class Jt{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function js(e,t){return e.transaction([xs],t?"readwrite":"readonly").objectStore(xs)}function Oc(){const e=indexedDB.deleteDatabase(Zn);return new Jt(e).toPromise()}function lr(){const e=indexedDB.open(Zn,Rc);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const r=e.result;try{r.createObjectStore(xs,{keyPath:Yn})}catch(i){s(i)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(xs)?t(r):(r.close(),await Oc(),t(await lr()))})})}async function yi(e,t,s){const r=js(e,!0).put({[Yn]:t,value:s});return new Jt(r).toPromise()}async function Lc(e,t){const s=js(e,!1).get(t),r=await new Jt(s).toPromise();return r===void 0?null:r.value}function xi(e,t){const s=js(e,!0).delete(t);return new Jt(s).toPromise()}const Dc=800,$c=3;class ea{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await lr(),this.db)}async _withRetries(t){let s=0;for(;;)try{const r=await this._openDb();return await t(r)}catch(r){if(s++>$c)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=As._getInstance(Tc()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await kc(),!this.activeServiceWorker)return;this.sender=new Ac(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((s=r[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Pc()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await lr();return await yi(t,ys,"1"),await xi(t,ys),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(r=>yi(r,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(r=>Lc(r,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>xi(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(i=>{const n=js(i,!1).getAll();return new Jt(n).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],r=new Set;if(t.length!==0)for(const{fbase_key:i,value:n}of t)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(n)&&(this.notifyListeners(i,n),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(t,s){this.localCache[t]=s;const r=this.listeners[t];if(r)for(const i of Array.from(r))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Dc)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ea.type="LOCAL";const Fc=ea;new qt(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ta(e,t){return t?Ee(t):(L(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr extends Hn{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return at(t,this._buildIdpRequest())}_linkToIdToken(t,s){return at(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return at(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function Bc(e){return bc(e.auth,new Tr(e),e.bypassAuthState)}function Uc(e){const{auth:t,user:s}=e;return L(s,t,"internal-error"),xc(s,new Tr(e),e.bypassAuthState)}async function Vc(e){const{auth:t,user:s}=e;return L(s,t,"internal-error"),yc(s,new Tr(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(t,s,r,i,n=!1){this.auth=t,this.resolver=r,this.user=i,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:r,postBody:i,tenantId:n,error:a,type:o}=t;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:s,sessionId:r,tenantId:n||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(c))}catch(h){this.reject(h)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Bc;case"linkViaPopup":case"linkViaRedirect":return Vc;case"reauthViaPopup":case"reauthViaRedirect":return Uc;default:ye(this.auth,"internal-error")}}resolve(t){Ne(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ne(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gc=new qt(2e3,1e4);async function zc(e,t,s){if(we(e.app))return Promise.reject(ue(e,"operation-not-supported-in-this-environment"));const r=Cs(e);Fl(e,t,kr);const i=ta(r,s);return new ze(r,"signInViaPopup",t,i).executeNotNull()}class ze extends sa{constructor(t,s,r,i,n){super(t,s,i,n),this.provider=r,this.authWindow=null,this.pollId=null,ze.currentPopupAction&&ze.currentPopupAction.cancel(),ze.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return L(t,this.auth,"internal-error"),t}async onExecution(){Ne(this.filter.length===1,"Popup operations only handle one event");const t=Pr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(ue(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(ue(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ze.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,r;if(!((r=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ue(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Gc.get())};t()}}ze.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc="pendingRedirect",os=new Map;class qc extends sa{constructor(t,s,r=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,r),this.eventId=null}async execute(){let t=os.get(this.auth._key());if(!t){try{const r=await Wc(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(r)}catch(s){t=()=>Promise.reject(s)}os.set(this.auth._key(),t)}return this.bypassAuthState||os.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Wc(e,t){const s=Xc(t),r=Kc(e);if(!await r._isAvailable())return!1;const i=await r._get(s)==="true";return await r._remove(s),i}function Jc(e,t){os.set(e._key(),t)}function Kc(e){return Ee(e._redirectPersistence)}function Xc(e){return as(Hc,e.config.apiKey,e.name)}async function Qc(e,t,s=!1){if(we(e.app))return Promise.reject(He(e));const r=Cs(e),i=ta(r,t),a=await new qc(r,i,s).execute();return a&&!s&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=10*60*1e3;class Yc{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(t,r)&&(s=!0,this.sendToConsumer(t,r),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!eh(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var r;if(t.error&&!ra(t)){const i=((r=t.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";s.onError(ue(this.auth,i))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const r=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&r}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Zc&&this.cachedEventUids.clear(),this.cachedEventUids.has(bi(t))}saveEventToCache(t){this.cachedEventUids.add(bi(t)),this.lastProcessedEventTime=Date.now()}}function bi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function ra({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function eh(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ra(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function th(e,t={}){return gt(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sh=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rh=/^https?/;async function ih(e){if(e.config.emulator)return;const{authorizedDomains:t}=await th(e);for(const s of t)try{if(nh(s))return}catch{}ye(e,"unauthorized-domain")}function nh(e){const t=ar(),{protocol:s,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const a=new URL(e);return a.hostname===""&&r===""?s==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&a.hostname===r}if(!rh.test(s))return!1;if(sh.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=new qt(3e4,6e4);function wi(){const e=pe().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}}function oh(e){return new Promise((t,s)=>{var r,i,n;function a(){wi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{wi(),s(ue(e,"network-request-failed"))},timeout:ah.get()})}if(!((i=(r=pe().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)t(gapi.iframes.getContext());else if(!((n=pe().gapi)===null||n===void 0)&&n.load)a();else{const o=uc("iframefcb");return pe()[o]=()=>{gapi.load?a():s(ue(e,"network-request-failed"))},cc(`${hc()}?onload=${o}`).catch(c=>s(c))}}).catch(t=>{throw ls=null,t})}let ls=null;function lh(e){return ls=ls||oh(e),ls}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch=new qt(5e3,15e3),hh="__/auth/iframe",uh="emulator/auth/iframe",dh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mh(e){const t=e.config;L(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?Nr(t,uh):`https://${e.config.authDomain}/${hh}`,r={apiKey:t.apiKey,appName:e.name,v:Ht},i=fh.get(e.config.apiHost);i&&(r.eid=i);const n=e._getFrameworks();return n.length&&(r.fw=n.join(",")),`${s}?${zt(r).slice(1)}`}async function gh(e){const t=await lh(e),s=pe().gapi;return L(s,e,"internal-error"),t.open({where:document.body,url:mh(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dh,dontclear:!0},r=>new Promise(async(i,n)=>{await r.restyle({setHideOnLeave:!1});const a=ue(e,"network-request-failed"),o=pe().setTimeout(()=>{n(a)},ch.get());function c(){pe().clearTimeout(o),i(r)}r.ping(c).then(c,()=>{n(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},vh=500,yh=600,xh="_blank",bh="http://localhost";class Mi{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function wh(e,t,s,r=vh,i=yh){const n=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},ph),{width:r.toString(),height:i.toString(),top:n,left:a}),h=se().toLowerCase();s&&(o=Dn(h)?xh:s),On(h)&&(t=t||bh,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[m,v])=>`${f}${m}=${v},`,"");if(tc(h)&&o!=="_self")return Mh(t||"",o),new Mi(null);const u=window.open(t||"",o,d);L(u,e,"popup-blocked");try{u.focus()}catch{}return new Mi(u)}function Mh(e,t){const s=document.createElement("a");s.href=e,s.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h="__/auth/handler",Eh="emulator/auth/handler",Sh=encodeURIComponent("fac");async function _i(e,t,s,r,i,n){L(e.config.authDomain,e,"auth-domain-config-required"),L(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:r,v:Ht,eventId:i};if(t instanceof kr){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",So(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[d,u]of Object.entries({}))a[d]=u}if(t instanceof Wt){const d=t.getScopes().filter(u=>u!=="");d.length>0&&(a.scopes=d.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const d of Object.keys(o))o[d]===void 0&&delete o[d];const c=await e._getAppCheckToken(),h=c?`#${Sh}=${encodeURIComponent(c)}`:"";return`${Nh(e)}?${zt(o).slice(1)}${h}`}function Nh({config:e}){return e.emulator?Nr(e,Eh):`https://${e.authDomain}/${_h}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs="webStorageSupport";class Ih{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xn,this._completeRedirectFn=Qc,this._overrideRedirectResult=Jc}async _openPopup(t,s,r,i){var n;Ne((n=this.eventManagers[t._key()])===null||n===void 0?void 0:n.manager,"_initialize() not called before _openPopup()");const a=await _i(t,s,r,ar(),i);return wh(t,a,Pr())}async _openRedirect(t,s,r,i){await this._originValidation(t);const n=await _i(t,s,r,ar(),i);return jc(n),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:i,promise:n}=this.eventManagers[s];return i?Promise.resolve(i):(Ne(n,"If manager is not set, promise should be"),n)}const r=this.initAndGetManager(t);return this.eventManagers[s]={promise:r},r.catch(()=>{delete this.eventManagers[s]}),r}async initAndGetManager(t){const s=await gh(t),r=new Yc(t);return s.register("authEvent",i=>(L(i==null?void 0:i.authEvent,t,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=s,r}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(Hs,{type:Hs},i=>{var n;const a=(n=i==null?void 0:i[0])===null||n===void 0?void 0:n[Hs];a!==void 0&&s(!!a),ye(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=ih(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return Vn()||Ln()||Ar()}}const Ch=Ih;var Ei="@firebase/auth",Si="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(r=>{t((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function kh(e){Rt(new ct("auth",(t,{options:s})=>{const r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),n=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;L(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gn(e)},h=new oc(r,i,n,c);return fc(h,s),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,r)=>{t.getProvider("auth-internal").initialize()})),Rt(new ct("auth-internal",t=>{const s=Cs(t.getProvider("auth").getImmediate());return(r=>new Ah(r))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),rt(Ei,Si,jh(e)),rt(Ei,Si,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ph=5*60,Th=xn("authIdTokenMaxAge")||Ph;let Ni=null;const Rh=e=>async t=>{const s=t&&await t.getIdTokenResult(),r=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(r&&r>Th)return;const i=s==null?void 0:s.token;Ni!==i&&(Ni=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Oh(e=Il()){const t=_n(e,"auth");if(t.isInitialized())return t.getImmediate();const s=dc(e,{popupRedirectResolver:Ch,persistence:[Fc,Ic,Xn]}),r=xn("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const n=new URL(r,location.origin);if(location.origin===n.origin){const a=Rh(n.toString());Mc(s,a,()=>a(s.currentUser)),wc(s,o=>a(o))}}const i=fo("auth");return i&&mc(s,`http://${i}`),s}function Lh(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}lc({loadJS(e){return new Promise((t,s)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=i=>{const n=ue("internal-error");n.customData=i,s(n)},r.type="text/javascript",r.charset="UTF-8",Lh().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});kh("Browser");var Dh="firebase",$h="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rt(Dh,$h,"app");const Fh={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyCsboACH7vFaM9kiKNxXpjgNC-PMq1HNc8",VITE_FIREBASE_APP_ID:"1:487990753122:web:e158caa86b40372fa75e3b",VITE_FIREBASE_AUTH_DOMAIN:"cvic-456409.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"487990753122",VITE_FIREBASE_PROJECT_ID:"cvic-456409",VITE_FIREBASE_STORAGE_BUCKET:"cvic-456409.firebasestorage.app"},Bh=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Ii=Bh.filter(e=>!Fh[e]);if(Ii.length>0)throw new Error(`Missing required Firebase configuration variables: ${Ii.join(", ")}`);const qs={apiKey:"AIzaSyCsboACH7vFaM9kiKNxXpjgNC-PMq1HNc8",authDomain:"cvic-456409.firebaseapp.com",projectId:"cvic-456409",storageBucket:"cvic-456409.firebasestorage.app",messagingSenderId:"487990753122",appId:"1:487990753122:web:e158caa86b40372fa75e3b"};let ia;try{ia=En(qs)}catch(e){throw console.error("Error initializing Firebase:",e),console.error("Firebase config:",{...qs,apiKey:qs.apiKey?"***":void 0}),e}const Rr=Oh(ia),Uh=new be;async function Vh(){try{const t=(await zc(Rr,Uh)).user;return{id:t.uid,email:t.email||"",displayName:t.displayName||void 0,photoURL:t.photoURL||void 0}}catch(e){throw console.error("Error signing in with Google:",e),e}}async function Gh(){try{await Ec(Rr)}catch(e){throw console.error("Error signing out:",e),e}}function zh(e){return _c(Rr,t=>{if(t){const s={id:t.uid,email:t.email||"",displayName:t.displayName||void 0,photoURL:t.photoURL||void 0};e(s)}else e(null)})}const na=g.createContext(null);function ks(){const e=g.useContext(na);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}function Hh({children:e}){const[t,s]=g.useState(null),[r,i]=g.useState(!0),[n,a]=g.useState(null);g.useEffect(()=>{const h=zh(d=>{s(d),i(!1),a(null)});return()=>h()},[]);const o=async()=>{i(!0),a(null);try{await Vh()}catch(h){console.error("Sign in error:",h),a(h instanceof Error?h.message:"Failed to sign in."),i(!1)}},c=async()=>{i(!0),a(null);try{await Gh()}catch(h){console.error("Sign out error:",h),a(h instanceof Error?h.message:"Failed to sign out."),i(!1)}};return l.jsx(na.Provider,{value:{user:t,loading:r,error:n,signIn:o,signOut:c},children:e})}const qh=[],Wh=()=>{const e=za(),{user:t,loading:s,signOut:r}=ks(),i=e.pathname.replace("/CVIc","");return s?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}):l.jsxs("div",{className:"min-h-screen bg-gray-50",children:[l.jsx("nav",{className:"bg-white shadow-sm",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"flex justify-between h-16",children:[l.jsxs("div",{className:"flex",children:[l.jsx("div",{className:"flex-shrink-0 flex items-center",children:l.jsx(St,{to:"/",className:"text-xl font-bold text-primary-600",children:"CVIc"})}),t&&l.jsx("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:qh.map(n=>l.jsx(St,{to:n.href,className:`${i===n.href?"border-primary-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium`,children:n.name},n.name))})]}),l.jsx("div",{className:"flex items-center",children:t?l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsx("span",{className:"text-sm text-gray-700",children:t.displayName}),l.jsx("button",{onClick:()=>r(),className:"btn btn-secondary text-sm",children:"Sign Out"})]}):l.jsx(St,{to:"/login",className:"btn btn-primary text-sm",children:"Sign In"})})]})})}),l.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:l.jsx(Ha,{})})]})};class Jh extends g.Component{constructor(){super(...arguments);$s(this,"state",{hasError:!1,error:void 0})}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("Uncaught error:",s,r)}render(){var s;return this.state.hasError?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:l.jsx("div",{className:"max-w-md w-full space-y-8 p-8",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Something went wrong"}),l.jsx("p",{className:"text-gray-600 mb-8",children:((s=this.state.error)==null?void 0:s.message)||"An unexpected error occurred"}),l.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Reload Page"})]})})}):this.props.children}}function Kh({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const aa=g.forwardRef(Kh);function Xh({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"}))}const oa=g.forwardRef(Xh);function Qh({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const Zh=g.forwardRef(Qh);function Yh({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"}))}const cr=g.forwardRef(Yh);function eu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Or=g.forwardRef(eu);function tu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const Ci=g.forwardRef(tu);function su({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"}))}const Ai=g.forwardRef(su);function ru({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const iu=g.forwardRef(ru);function nu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"}))}const ji=g.forwardRef(nu);function au({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z"}))}const Ws=g.forwardRef(au);function ou({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-2.25-1.313M21 7.5v2.25m0-2.25-2.25 1.313M3 7.5l2.25-1.313M3 7.5l2.25 1.313M3 7.5v2.25m9 3 2.25-1.313M12 12.75l-2.25-1.313M12 12.75V15m0 6.75 2.25-1.313M12 21.75V19.5m0 2.25-2.25-1.313m0-16.875L12 2.25l2.25 1.313M21 14.25v2.25l-2.25 1.313m-13.5 0L3 16.5v-2.25"}))}const hr=g.forwardRef(ou);function lu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const cu=g.forwardRef(lu);function hu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const ki=g.forwardRef(hu);function uu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.864 4.243A7.5 7.5 0 0 1 19.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 0 0 4.5 10.5a7.464 7.464 0 0 1-1.15 3.993m1.989 3.559A11.209 11.209 0 0 0 8.25 10.5a3.75 3.75 0 1 1 7.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 0 1-3.6 9.75m6.633-4.596a18.666 18.666 0 0 1-2.485 5.33"}))}const du=g.forwardRef(uu);function fu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const mu=g.forwardRef(fu);function gu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const pu=g.forwardRef(gu);function vu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const yu=g.forwardRef(vu);function xu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const wt=g.forwardRef(xu);function bu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42"}))}const Pi=g.forwardRef(bu);function wu({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"}))}const Mu=g.forwardRef(wu);function _u({title:e,titleId:t,...s},r){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?g.createElement("title",{id:t},e):null,g.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Eu=g.forwardRef(_u);function Su(){const{user:e,loading:t}=ks(),s=[{text:"Upload shoreline Shapefile.",icon:l.jsx(Ws,{className:"h-6 w-6 text-primary-600"})},{text:"Segment shoreline by specified resolution.",icon:l.jsx(hr,{className:"h-6 w-6 text-primary-600"})},{text:"Select vulnerability parameters & assign weights.",icon:l.jsx(cr,{className:"h-6 w-6 text-primary-600"})},{text:"Assign values to segments via interactive map & table.",icon:l.jsx(wt,{className:"h-6 w-6 text-primary-600"})},{text:"Select CVI calculation formula.",icon:l.jsx(ji,{className:"h-6 w-6 text-primary-600"})},{text:"Visualize results & export as GeoJSON.",icon:l.jsx(Ai,{className:"h-6 w-6 text-primary-600"})}],r=[{name:"React",purpose:"UI Framework",icon:l.jsx(hr,{className:"h-4 w-4 text-cyan-700"})},{name:"TypeScript",purpose:"Language / Type Safety",icon:l.jsx(ji,{className:"h-4 w-4 text-blue-700"})},{name:"Vite",purpose:"Build Tool / Dev Server",icon:l.jsx(Ws,{className:"h-4 w-4 text-purple-700"})},{name:"React Router",purpose:"Client-Side Routing",icon:l.jsx(wt,{className:"h-4 w-4 text-orange-700"})},{name:"Leaflet",purpose:"Interactive Maps Core",icon:l.jsx(wt,{className:"h-4 w-4 text-green-700"})},{name:"React Leaflet",purpose:"React Integration for Leaflet",icon:l.jsx(wt,{className:"h-4 w-4 text-green-600"})},{name:"Leaflet Draw",purpose:"Map Drawing/Selection Tools",icon:l.jsx(Pi,{className:"h-4 w-4 text-green-800"})},{name:"Turf.js",purpose:"Geospatial Analysis",icon:l.jsx(cr,{className:"h-4 w-4 text-lime-700"})},{name:"TailwindCSS",purpose:"Utility-First CSS Styling",icon:l.jsx(Pi,{className:"h-4 w-4 text-sky-700"})},{name:"IndexedDB (idb)",purpose:"Client-Side Data Storage",icon:l.jsx(Ai,{className:"h-4 w-4 text-gray-700"})},{name:"shpjs",purpose:"Shapefile Parsing",icon:l.jsx(Ws,{className:"h-4 w-4 text-red-700"})},{name:"Firebase Auth",purpose:"User Authentication",icon:l.jsx(du,{className:"h-4 w-4 text-yellow-700"})}];return t?l.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white",children:l.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary-600"})}):l.jsx("div",{className:"bg-white text-gray-800 font-sans py-12 px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"max-w-4xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-12",children:[l.jsx("h1",{className:"text-3xl sm:text-4xl font-extrabold text-primary-900 tracking-tight",children:"CVIc: Coastal Vulnerability Index Compiler"}),l.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Web Platform for Automating Coastal Vulnerability Index Calculation"})]}),l.jsx("section",{className:"text-center mt-10 mb-16",children:e?l.jsxs(St,{to:"/shoreline",className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-6 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:["Start New Analysis",l.jsx(Ci,{className:"ml-2 h-5 w-5"})]}):l.jsxs(St,{to:"/login",className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-6 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:["Sign In to Begin",l.jsx(Ci,{className:"ml-2 h-5 w-5"})]})}),l.jsxs("section",{className:"mb-16",children:[l.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-8 text-center",children:[" ","Workflow Overview"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[" ",s.map((i,n)=>l.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-sm hover:shadow-md hover:border-primary-200 transition duration-200 ease-in-out",children:[" ",l.jsxs("div",{className:"flex-shrink-0 w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center ring-2 ring-primary-200",children:[" ",i.icon]}),l.jsxs("div",{className:"flex-1 pt-1",children:[" ",l.jsxs("p",{className:"text-gray-700 font-medium",children:[" ",l.jsxs("span",{className:"font-bold text-primary-700 mr-1",children:[n+1,"."]})," ",i.text]})]})]},n))]})]}),l.jsxs("section",{className:"mb-16",children:[l.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 text-center",children:"Technology Stack"}),l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(i=>l.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[l.jsx("div",{className:"flex-shrink-0 p-1.5 bg-gray-100 rounded-md",children:i.icon}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.name}),l.jsx("p",{className:"text-xs text-gray-500",children:i.purpose})]})]},i.name))})]})]})})}function Nu(){const[e,t]=g.useState(""),[s,r]=g.useState(!1),i=$e(),{signIn:n}=ks(),a=async()=>{t(""),r(!0);try{await n(),i("/")}catch{t("Failed to sign in with Google. Please try again.")}finally{r(!1)}};return l.jsxs("div",{className:"max-w-md mx-auto mt-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Sign In"}),e&&l.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:e}),l.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:l.jsx("button",{onClick:a,disabled:s,className:"w-full btn btn-primary flex items-center justify-center space-x-2",children:s?"Signing in...":l.jsxs(l.Fragment,{children:[l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[l.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),l.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),l.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),l.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),l.jsx("span",{children:"Sign in with Google"})]})})})]})}function Iu(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var Je=1,Ke=2,ot=3,Cu=4,ur=5,Ti=6378137,Au=6356752314e-3,Ri=.0066943799901413165,It=484813681109536e-20,N=Math.PI/2,ju=.16666666666666666,ku=.04722222222222222,Pu=.022156084656084655,A=1e-10,Q=.017453292519943295,ge=57.29577951308232,U=Math.PI/4,Dt=Math.PI*2,Z=3.14159265359,ae={};ae.greenwich=0;ae.lisbon=-9.131906111111;ae.paris=2.337229166667;ae.bogota=-74.080916666667;ae.madrid=-3.687938888889;ae.rome=12.452333333333;ae.bern=7.439583333333;ae.jakarta=106.807719444444;ae.ferro=-17.666666666667;ae.brussels=4.367975;ae.stockholm=18.058277777778;ae.athens=23.7163375;ae.oslo=10.722916666667;const Tu={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var Oi=/[\s_\-\/\(\)]/g;function Le(e,t){if(e[t])return e[t];for(var s=Object.keys(e),r=t.toLowerCase().replace(Oi,""),i=-1,n,a;++i<s.length;)if(n=s[i],a=n.toLowerCase().replace(Oi,""),a===r)return e[n]}function dr(e){var t={},s=e.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,c){var h=c.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),r,i,n,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*Q},lat_1:function(o){t.lat1=o*Q},lat_2:function(o){t.lat2=o*Q},lat_ts:function(o){t.lat_ts=o*Q},lon_0:function(o){t.long0=o*Q},lon_1:function(o){t.long1=o*Q},lon_2:function(o){t.long2=o*Q},alpha:function(o){t.alpha=parseFloat(o)*Q},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*Q},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(c){return parseFloat(c)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var c=Le(Tu,o);c&&(t.to_meter=c.to_meter)},from_greenwich:function(o){t.from_greenwich=o*Q},pm:function(o){var c=Le(ae,o);t.from_greenwich=(c||parseFloat(o))*Q},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var c="ewnsud";o.length===3&&c.indexOf(o.substr(0,1))!==-1&&c.indexOf(o.substr(1,1))!==-1&&c.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(r in s)i=s[r],r in a?(n=a[r],typeof n=="function"?n(i):t[n]=i):t[r]=i;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var $t=1,la=2,ca=3,bs=4,ha=5,Lr=-1,Ru=/\s/,Ou=/[A-Za-z]/,Lu=/[A-Za-z84_]/,Ps=/[,\]]/,ua=/[\d\.E\-\+]/;function Ie(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=$t}Ie.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==bs)for(;Ru.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case $t:return this.neutral(e);case la:return this.keyword(e);case bs:return this.quoted(e);case ha:return this.afterquote(e);case ca:return this.number(e);case Lr:return}};Ie.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=bs;return}if(Ps.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};Ie.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=$t;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=$t,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Lr);return}};Ie.prototype.number=function(e){if(ua.test(e)){this.word+=e;return}if(Ps.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};Ie.prototype.quoted=function(e){if(e==='"'){this.state=ha;return}this.word+=e};Ie.prototype.keyword=function(e){if(Lu.test(e)){this.word+=e;return}if(e==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=$t;return}if(Ps.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};Ie.prototype.neutral=function(e){if(Ou.test(e)){this.word=e,this.state=la;return}if(e==='"'){this.word="",this.state=bs;return}if(ua.test(e)){this.word=e,this.state=ca;return}if(Ps.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};Ie.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Lr)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Du(e){var t=new Ie(e);return t.output()}function Js(e,t,s){Array.isArray(t)&&(s.unshift(t),t=null);var r=t?{}:e,i=s.reduce(function(n,a){return Ye(a,n),n},r);t&&(e[t]=i)}function Ye(e,t){if(!Array.isArray(e)){t[e]=!0;return}var s=e.shift();if(s==="PARAMETER"&&(s=e.shift()),e.length===1){if(Array.isArray(e[0])){t[s]={},Ye(e[0],t[s]);return}t[s]=e[0];return}if(!e.length){t[s]=!0;return}if(s==="TOWGS84"){t[s]=e;return}if(s==="AXIS"){s in t||(t[s]=[]),t[s].push(e);return}Array.isArray(s)||(t[s]={});var r;switch(s){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[s]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&Ye(e[2],t[s]);return;case"SPHEROID":case"ELLIPSOID":t[s]={name:e[0],a:e[1],rf:e[2]},e.length===4&&Ye(e[3],t[s]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":e[0]=["name",e[0]],Js(t,s,e);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":e[0]=["name",e[0]],Js(t,s,e),t[s].type=s;return;default:for(r=-1;++r<e.length;)if(!Array.isArray(e[r]))return Ye(e,t[s]);return Js(t,s,e)}}var $u=.017453292519943295,Fu=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Bu(e,t){var s=t[0],r=t[1];!(s in e)&&r in e&&(e[s]=e[r],t.length===3&&(e[s]=t[2](e[s])))}function me(e){return e*$u}function da(e){for(var t=Object.keys(e),s=0,r=t.length;s<r;++s){var i=t[s];Fu.indexOf(i)!==-1&&Uu(e[i]),typeof e[i]=="object"&&da(e[i])}}function Uu(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var s="",r=0,i=e.AXIS.length;r<i;++r){var n=[e.AXIS[r][0].toLowerCase(),e.AXIS[r][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?s+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?s+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?s+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(s+="w")}s.length===2&&(s+="u"),s.length===3&&(e.axis=s)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var a=e.GEOGCS;e.type==="GEOGCS"&&(a=e),a&&(a.DATUM?e.datumCode=a.DATUM.name.toLowerCase():e.datumCode=a.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),e.datumCode==="new_zealand_1949"&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode==="belge_1972"&&(e.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(e.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=a.DATUM.SPHEROID.a,e.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(e.datum_params=a.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function o(d){var u=e.to_meter||1;return d*u}var c=function(d){return Bu(e,d)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",me],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",me],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",me],["lat0","latitude_of_origin",me],["lat0","standard_parallel_1",me],["lat1","standard_parallel_1",me],["lat2","standard_parallel_2",me],["azimuth","Azimuth"],["alpha","azimuth",me],["srsCode","name"]];h.forEach(c),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=me(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=me(e.lat0>0?90:-90))}function fa(e){var t=Du(e),s=t[0],r={};return Ye(t,r),da(r),r[s]}function ee(e){var t=this;if(arguments.length===2){var s=arguments[1];typeof s=="string"?s.charAt(0)==="+"?ee[e]=dr(arguments[1]):ee[e]=fa(arguments[1]):ee[e]=s}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(r){Array.isArray(r)?ee.apply(t,r):ee(r)});if(typeof e=="string"){if(e in ee)return ee[e]}else"EPSG"in e?ee["EPSG:"+e.EPSG]=e:"ESRI"in e?ee["ESRI:"+e.ESRI]=e:"IAU2000"in e?ee["IAU2000:"+e.IAU2000]=e:console.log(e);return}}Iu(ee);function Vu(e){return typeof e=="string"}function Gu(e){return e in ee}var zu=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Hu(e){return zu.some(function(t){return e.indexOf(t)>-1})}var qu=["3857","900913","3785","102113"];function Wu(e){var t=Le(e,"authority");if(t){var s=Le(t,"epsg");return s&&qu.indexOf(s)>-1}}function Ju(e){var t=Le(e,"extension");if(t)return Le(t,"proj4")}function Ku(e){return e[0]==="+"}function Xu(e){if(Vu(e)){if(Gu(e))return ee[e];if(Hu(e)){var t=fa(e);if(Wu(t))return ee["EPSG:3857"];var s=Ju(t);return s?dr(s):t}if(Ku(e))return dr(e)}else return e}function Li(e,t){e=e||{};var s,r;if(!t)return e;for(r in t)s=t[r],s!==void 0&&(e[r]=s);return e}function xe(e,t,s){var r=e*t;return s/Math.sqrt(1-r*r)}function Kt(e){return e<0?-1:1}function j(e){return Math.abs(e)<=Z?e:e-Kt(e)*Dt}function de(e,t,s){var r=e*s,i=.5*e;return r=Math.pow((1-r)/(1+r),i),Math.tan(.5*(N-t))/r}function Ft(e,t){for(var s=.5*e,r,i,n=N-2*Math.atan(t),a=0;a<=15;a++)if(r=e*Math.sin(n),i=N-2*Math.atan(t*Math.pow((1-r)/(1+r),s))-n,n+=i,Math.abs(i)<=1e-10)return n;return-9999}function Qu(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=xe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Zu(e){var t=e.x,s=e.y;if(s*ge>90&&s*ge<-90&&t*ge>180&&t*ge<-180)return null;var r,i;if(Math.abs(Math.abs(s)-N)<=A)return null;if(this.sphere)r=this.x0+this.a*this.k0*j(t-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(U+.5*s));else{var n=Math.sin(s),a=de(this.e,s,n);r=this.x0+this.a*this.k0*j(t-this.long0),i=this.y0-this.a*this.k0*Math.log(a)}return e.x=r,e.y=i,e}function Yu(e){var t=e.x-this.x0,s=e.y-this.y0,r,i;if(this.sphere)i=N-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var n=Math.exp(-s/(this.a*this.k0));if(i=Ft(this.e,n),i===-9999)return null}return r=j(this.long0+t/(this.a*this.k0)),e.x=r,e.y=i,e}var ed=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const td={init:Qu,forward:Zu,inverse:Yu,names:ed};function sd(){}function Di(e){return e}var rd=["longlat","identity"];const id={init:sd,forward:Di,inverse:Di,names:rd};var nd=[td,id],cs={},ws=[];function ma(e,t){var s=ws.length;return e.names?(ws[s]=e,e.names.forEach(function(r){cs[r.toLowerCase()]=s}),this):(console.log(t),!0)}function ad(e){if(!e)return!1;var t=e.toLowerCase();if(typeof cs[t]<"u"&&ws[cs[t]])return ws[cs[t]]}function od(){nd.forEach(ma)}const ld={start:od,add:ma,get:ad};var O={};O.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};O.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};O.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};O.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};O.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};O.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};O.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};O.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};O.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};O.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};O.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};O.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};O.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};O.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};O.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};O.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};O.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};O.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};O.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};O.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};O.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};O.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};O.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};O.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};O.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};O.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};O.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};O.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};O.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};O.hough={a:6378270,rf:297,ellipseName:"Hough"};O.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};O.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};O.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};O.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};O.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};O.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};O.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};O.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};O.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};O.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};O.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};O.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var cd=O.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};O.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function hd(e,t,s,r){var i=e*e,n=t*t,a=(i-n)/i,o=0;r?(e*=1-a*(ju+a*(ku+a*Pu)),i=e*e,a=0):o=Math.sqrt(a);var c=(i-n)/n;return{es:a,e:o,ep2:c}}function ud(e,t,s,r,i){if(!e){var n=Le(O,r);n||(n=cd),e=n.a,t=n.b,s=n.rf}return s&&!t&&(t=(1-1/s)*e),(s===0||Math.abs(e-t)<A)&&(i=!0,t=e),{a:e,b:t,rf:s,sphere:i}}var hs={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var dd in hs){var $i=hs[dd];hs[$i.datumName]=$i}function fd(e,t,s,r,i,n,a){var o={};return e===void 0||e==="none"?o.datum_type=ur:o.datum_type=Cu,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Je),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=Ke,o.datum_params[3]*=It,o.datum_params[4]*=It,o.datum_params[5]*=It,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=ot,o.grids=a),o.a=s,o.b=r,o.es=i,o.ep2=n,o}var ga={};function md(e,t){var s=new DataView(t),r=vd(s),i=yd(s,r),n=xd(s,i,r),a={header:i,subgrids:n};return ga[e]=a,a}function gd(e){if(e===void 0)return null;var t=e.split(",");return t.map(pd)}function pd(e){if(e.length===0)return null;var t=e[0]==="@";return t&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:ga[e]||null,isNull:!1}}function et(e){return e/3600*Math.PI/180}function vd(e){var t=e.getInt32(8,!1);return t===11?!1:(t=e.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function yd(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:fr(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function fr(e,t,s){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,s)))}function xd(e,t,s){for(var r=176,i=[],n=0;n<t.nSubgrids;n++){var a=wd(e,r,s),o=Md(e,r,a,s),c=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);i.push({ll:[et(a.lowerLongitude),et(a.lowerLatitude)],del:[et(a.longitudeInterval),et(a.latitudeInterval)],lim:[c,h],count:a.gridNodeCount,cvs:bd(o)}),r+=176+a.gridNodeCount*16}return i}function bd(e){return e.map(function(t){return[et(t.longitudeShift),et(t.latitudeShift)]})}function wd(e,t,s){return{name:fr(e,t+8,t+16).trim(),parent:fr(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,s),upperLatitude:e.getFloat64(t+88,s),lowerLongitude:e.getFloat64(t+104,s),upperLongitude:e.getFloat64(t+120,s),latitudeInterval:e.getFloat64(t+136,s),longitudeInterval:e.getFloat64(t+152,s),gridNodeCount:e.getInt32(t+168,s)}}function Md(e,t,s,r){for(var i=t+176,n=16,a=[],o=0;o<s.gridNodeCount;o++){var c={latitudeShift:e.getFloat32(i+o*n,r),longitudeShift:e.getFloat32(i+o*n+4,r),latitudeAccuracy:e.getFloat32(i+o*n+8,r),longitudeAccuracy:e.getFloat32(i+o*n+12,r)};a.push(c)}return a}function ve(e,t){if(!(this instanceof ve))return new ve(e);t=t||function(h){if(h)throw h};var s=Xu(e);if(typeof s!="object"){t("Could not parse to valid json: "+e);return}var r=ve.projections.get(s.projName);if(!r){t("Could not get projection name from: "+e);return}if(s.datumCode&&s.datumCode!=="none"){var i=Le(hs,s.datumCode);i&&(s.datum_params=s.datum_params||(i.towgs84?i.towgs84.split(","):null),s.ellps=i.ellipse,s.datumName=i.datumName?i.datumName:s.datumCode)}s.k0=s.k0||1,s.axis=s.axis||"enu",s.ellps=s.ellps||"wgs84",s.lat1=s.lat1||s.lat0;var n=ud(s.a,s.b,s.rf,s.ellps,s.sphere),a=hd(n.a,n.b,n.rf,s.R_A),o=gd(s.nadgrids),c=s.datum||fd(s.datumCode,s.datum_params,n.a,n.b,a.es,a.ep2,o);Li(this,s),Li(this,r),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=c,this.init(),t(null,this)}ve.projections=ld;ve.projections.start();function _d(e,t){return e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11?!1:e.datum_type===Je?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type===Ke?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]:!0}function pa(e,t,s){var r=e.x,i=e.y,n=e.z?e.z:0,a,o,c,h;if(i<-N&&i>-1.001*N)i=-N;else if(i>N&&i<1.001*N)i=N;else{if(i<-N)return{x:-1/0,y:-1/0,z:e.z};if(i>N)return{x:1/0,y:1/0,z:e.z}}return r>Math.PI&&(r-=2*Math.PI),o=Math.sin(i),h=Math.cos(i),c=o*o,a=s/Math.sqrt(1-t*c),{x:(a+n)*h*Math.cos(r),y:(a+n)*h*Math.sin(r),z:(a*(1-t)+n)*o}}function va(e,t,s,r){var i=1e-12,n=i*i,a=30,o,c,h,d,u,f,m,v,y,p,_,x,w,E=e.x,b=e.y,M=e.z?e.z:0,S,I,C;if(o=Math.sqrt(E*E+b*b),c=Math.sqrt(E*E+b*b+M*M),o/s<i){if(S=0,c/s<i)return I=N,C=-r,{x:e.x,y:e.y,z:e.z}}else S=Math.atan2(b,E);h=M/c,d=o/c,u=1/Math.sqrt(1-t*(2-t)*d*d),v=d*(1-t)*u,y=h*u,w=0;do w++,m=s/Math.sqrt(1-t*y*y),C=o*v+M*y-m*(1-t*y*y),f=t*m/(m+C),u=1/Math.sqrt(1-f*(2-f)*d*d),p=d*(1-f)*u,_=h*u,x=_*v-p*y,v=p,y=_;while(x*x>n&&w<a);return I=Math.atan(_/Math.abs(p)),{x:S,y:I,z:C}}function Ed(e,t,s){if(t===Je)return{x:e.x+s[0],y:e.y+s[1],z:e.z+s[2]};if(t===Ke){var r=s[0],i=s[1],n=s[2],a=s[3],o=s[4],c=s[5],h=s[6];return{x:h*(e.x-c*e.y+o*e.z)+r,y:h*(c*e.x+e.y-a*e.z)+i,z:h*(-o*e.x+a*e.y+e.z)+n}}}function Sd(e,t,s){if(t===Je)return{x:e.x-s[0],y:e.y-s[1],z:e.z-s[2]};if(t===Ke){var r=s[0],i=s[1],n=s[2],a=s[3],o=s[4],c=s[5],h=s[6],d=(e.x-r)/h,u=(e.y-i)/h,f=(e.z-n)/h;return{x:d+c*u-o*f,y:-c*d+u+a*f,z:o*d-a*u+f}}}function rs(e){return e===Je||e===Ke}function Nd(e,t,s){if(_d(e,t)||e.datum_type===ur||t.datum_type===ur)return s;var r=e.a,i=e.es;if(e.datum_type===ot){var n=Fi(e,!1,s);if(n!==0)return;r=Ti,i=Ri}var a=t.a,o=t.b,c=t.es;if(t.datum_type===ot&&(a=Ti,o=Au,c=Ri),i===c&&r===a&&!rs(e.datum_type)&&!rs(t.datum_type))return s;if(s=pa(s,i,r),rs(e.datum_type)&&(s=Ed(s,e.datum_type,e.datum_params)),rs(t.datum_type)&&(s=Sd(s,t.datum_type,t.datum_params)),s=va(s,c,a,o),t.datum_type===ot){var h=Fi(t,!0,s);if(h!==0)return}return s}function Fi(e,t,s){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;var r={x:-s.x,y:s.y},i={x:Number.NaN,y:Number.NaN},n=[];e:for(var a=0;a<e.grids.length;a++){var o=e.grids[a];if(n.push(o.name),o.isNull){i=r;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var c=o.grid.subgrids,h=0,d=c.length;h<d;h++){var u=c[h],f=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,m=u.ll[0]-f,v=u.ll[1]-f,y=u.ll[0]+(u.lim[0]-1)*u.del[0]+f,p=u.ll[1]+(u.lim[1]-1)*u.del[1]+f;if(!(v>r.y||m>r.x||p<r.y||y<r.x)&&(i=Id(r,t,u),!isNaN(i.x)))break e}}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*ge+" "+r.y*ge+" tried: '"+n+"'"),-1):(s.x=-i.x,s.y=i.y,0)}function Id(e,t,s){var r={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return r;var i={x:e.x,y:e.y};i.x-=s.ll[0],i.y-=s.ll[1],i.x=j(i.x-Math.PI)+Math.PI;var n=Bi(i,s);if(t){if(isNaN(n.x))return r;n.x=i.x-n.x,n.y=i.y-n.y;var a=9,o=1e-12,c,h;do{if(h=Bi(n,s),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}c={x:i.x-(h.x+n.x),y:i.y-(h.y+n.y)},n.x+=c.x,n.y+=c.y}while(a--&&Math.abs(c.x)>o&&Math.abs(c.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=j(n.x+s.ll[0]),r.y=n.y+s.ll[1]}else isNaN(n.x)||(r.x=e.x+n.x,r.y=e.y+n.y);return r}function Bi(e,t){var s={x:e.x/t.del[0],y:e.y/t.del[1]},r={x:Math.floor(s.x),y:Math.floor(s.y)},i={x:s.x-1*r.x,y:s.y-1*r.y},n={x:Number.NaN,y:Number.NaN},a;if(r.x<0||r.x>=t.lim[0]||r.y<0||r.y>=t.lim[1])return n;a=r.y*t.lim[0]+r.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var c={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var h={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var d={x:t.cvs[a][0],y:t.cvs[a][1]},u=i.x*i.y,f=i.x*(1-i.y),m=(1-i.x)*(1-i.y),v=(1-i.x)*i.y;return n.x=m*o.x+f*c.x+v*d.x+u*h.x,n.y=m*o.y+f*c.y+v*d.y+u*h.y,n}function Ui(e,t,s){var r=s.x,i=s.y,n=s.z||0,a,o,c,h={};for(c=0;c<3;c++)if(!(t&&c===2&&s.z===void 0))switch(c===0?(a=r,"ew".indexOf(e.axis[c])!==-1?o="x":o="y"):c===1?(a=i,"ns".indexOf(e.axis[c])!==-1?o="y":o="x"):(a=n,o="z"),e.axis[c]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":s[o]!==void 0&&(h.z=a);break;case"d":s[o]!==void 0&&(h.z=-a);break;default:return null}return h}function ya(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function Cd(e){Vi(e.x),Vi(e.y)}function Vi(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Ad(e,t){return(e.datum.datum_type===Je||e.datum.datum_type===Ke||e.datum.datum_type===ot)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Je||t.datum.datum_type===Ke||t.datum.datum_type===ot)&&e.datumCode!=="WGS84"}function Ms(e,t,s,r){var i;Array.isArray(s)?s=ya(s):s={x:s.x,y:s.y,z:s.z,m:s.m};var n=s.z!==void 0;if(Cd(s),e.datum&&t.datum&&Ad(e,t)&&(i=new ve("WGS84"),s=Ms(e,i,s,r),e=i),r&&e.axis!=="enu"&&(s=Ui(e,!1,s)),e.projName==="longlat")s={x:s.x*Q,y:s.y*Q,z:s.z||0};else if(e.to_meter&&(s={x:s.x*e.to_meter,y:s.y*e.to_meter,z:s.z||0}),s=e.inverse(s),!s)return;if(e.from_greenwich&&(s.x+=e.from_greenwich),s=Nd(e.datum,t.datum,s),!!s)return t.from_greenwich&&(s={x:s.x-t.from_greenwich,y:s.y,z:s.z||0}),t.projName==="longlat"?s={x:s.x*ge,y:s.y*ge,z:s.z||0}:(s=t.forward(s),t.to_meter&&(s={x:s.x/t.to_meter,y:s.y/t.to_meter,z:s.z||0})),r&&t.axis!=="enu"?Ui(t,!0,s):(s&&!n&&delete s.z,s)}var Gi=ve("WGS84");function Ks(e,t,s,r){var i,n,a;return Array.isArray(s)?(i=Ms(e,t,s,r)||{x:NaN,y:NaN},s.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof i.z=="number"?[i.x,i.y,i.z].concat(s.slice(3)):[i.x,i.y,s[2]].concat(s.slice(3)):[i.x,i.y].concat(s.slice(2)):[i.x,i.y]):(n=Ms(e,t,s,r),a=Object.keys(s),a.length===2||a.forEach(function(o){if(typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;n[o]=s[o]}),n)}function zi(e){return e instanceof ve?e:e.oProj?e.oProj:ve(e)}function re(e,t,s){e=zi(e);var r=!1,i;return typeof t>"u"?(t=e,e=Gi,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(s=t,t=e,e=Gi,r=!0),t=zi(t),s?Ks(e,t,s):(i={forward:function(n,a){return Ks(e,t,n,a)},inverse:function(n,a){return Ks(t,e,n,a)}},r&&(i.oProj=t),i)}var Hi=6,xa="AJSAJS",ba="AFAFAF",tt=65,ie=73,le=79,Mt=86,_t=90;const jd={forward:wa,inverse:kd,toPoint:Ma};function wa(e,t){return t=t||5,Rd(Pd({lat:e[1],lon:e[0]}),t)}function kd(e){var t=Dr(Ea(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function Ma(e){var t=Dr(Ea(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Xs(e){return e*(Math.PI/180)}function qi(e){return 180*(e/Math.PI)}function Pd(e){var t=e.lat,s=e.lon,r=6378137,i=.00669438,n=.9996,a,o,c,h,d,u,f,m=Xs(t),v=Xs(s),y,p;p=Math.floor((s+180)/6)+1,s===180&&(p=60),t>=56&&t<64&&s>=3&&s<12&&(p=32),t>=72&&t<84&&(s>=0&&s<9?p=31:s>=9&&s<21?p=33:s>=21&&s<33?p=35:s>=33&&s<42&&(p=37)),a=(p-1)*6-180+3,y=Xs(a),o=i/(1-i),c=r/Math.sqrt(1-i*Math.sin(m)*Math.sin(m)),h=Math.tan(m)*Math.tan(m),d=o*Math.cos(m)*Math.cos(m),u=Math.cos(m)*(v-y),f=r*((1-i/4-3*i*i/64-5*i*i*i/256)*m-(3*i/8+3*i*i/32+45*i*i*i/1024)*Math.sin(2*m)+(15*i*i/256+45*i*i*i/1024)*Math.sin(4*m)-35*i*i*i/3072*Math.sin(6*m));var _=n*c*(u+(1-h+d)*u*u*u/6+(5-18*h+h*h+72*d-58*o)*u*u*u*u*u/120)+5e5,x=n*(f+c*Math.tan(m)*(u*u/2+(5-h+9*d+4*d*d)*u*u*u*u/24+(61-58*h+h*h+600*d-330*o)*u*u*u*u*u*u/720));return t<0&&(x+=1e7),{northing:Math.round(x),easting:Math.round(_),zoneNumber:p,zoneLetter:Td(t)}}function Dr(e){var t=e.northing,s=e.easting,r=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var n=.9996,a=6378137,o=.00669438,c,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),d,u,f,m,v,y,p,_,x,w=s-5e5,E=t;r<"N"&&(E-=1e7),p=(i-1)*6-180+3,c=o/(1-o),y=E/n,_=y/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),x=_+(3*h/2-27*h*h*h/32)*Math.sin(2*_)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*_)+151*h*h*h/96*Math.sin(6*_),d=a/Math.sqrt(1-o*Math.sin(x)*Math.sin(x)),u=Math.tan(x)*Math.tan(x),f=c*Math.cos(x)*Math.cos(x),m=a*(1-o)/Math.pow(1-o*Math.sin(x)*Math.sin(x),1.5),v=w/(d*n);var b=x-d*Math.tan(x)/m*(v*v/2-(5+3*u+10*f-4*f*f-9*c)*v*v*v*v/24+(61+90*u+298*f+45*u*u-252*c-3*f*f)*v*v*v*v*v*v/720);b=qi(b);var M=(v-(1+2*u+f)*v*v*v/6+(5-2*f+28*u-3*f*f+8*c+24*u*u)*v*v*v*v*v/120)/Math.cos(x);M=p+qi(M);var S;if(e.accuracy){var I=Dr({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});S={top:I.lat,right:I.lon,bottom:b,left:M}}else S={lat:b,lon:M};return S}function Td(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function Rd(e,t){var s="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+Od(e.easting,e.northing,e.zoneNumber)+s.substr(s.length-5,t)+r.substr(r.length-5,t)}function Od(e,t,s){var r=_a(s),i=Math.floor(e/1e5),n=Math.floor(t/1e5)%20;return Ld(i,n,r)}function _a(e){var t=e%Hi;return t===0&&(t=Hi),t}function Ld(e,t,s){var r=s-1,i=xa.charCodeAt(r),n=ba.charCodeAt(r),a=i+e-1,o=n+t,c=!1;a>_t&&(a=a-_t+tt-1,c=!0),(a===ie||i<ie&&a>ie||(a>ie||i<ie)&&c)&&a++,(a===le||i<le&&a>le||(a>le||i<le)&&c)&&(a++,a===ie&&a++),a>_t&&(a=a-_t+tt-1),o>Mt?(o=o-Mt+tt-1,c=!0):c=!1,(o===ie||n<ie&&o>ie||(o>ie||n<ie)&&c)&&o++,(o===le||n<le&&o>le||(o>le||n<le)&&c)&&(o++,o===ie&&o++),o>Mt&&(o=o-Mt+tt-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function Ea(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var t=e.length,s=null,r="",i,n=0;!/[A-Z]/.test(i=e.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+e;r+=i,n++}var a=parseInt(r,10);if(n===0||n+3>t)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(n++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+e;s=e.substring(n,n+=2);for(var c=_a(a),h=Dd(s.charAt(0),c),d=$d(s.charAt(1),c);d<Fd(o);)d+=2e6;var u=t-n;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var f=u/2,m=0,v=0,y,p,_,x,w;return f>0&&(y=1e5/Math.pow(10,f),p=e.substring(n,n+f),m=parseFloat(p)*y,_=e.substring(n+f),v=parseFloat(_)*y),x=m+h,w=v+d,{easting:x,northing:w,zoneLetter:o,zoneNumber:a,accuracy:y}}function Dd(e,t){for(var s=xa.charCodeAt(t-1),r=1e5,i=!1;s!==e.charCodeAt(0);){if(s++,s===ie&&s++,s===le&&s++,s>_t){if(i)throw"Bad character: "+e;s=tt,i=!0}r+=1e5}return r}function $d(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var s=ba.charCodeAt(t-1),r=0,i=!1;s!==e.charCodeAt(0);){if(s++,s===ie&&s++,s===le&&s++,s>Mt){if(i)throw"Bad character: "+e;s=tt,i=!0}r+=1e5}return r}function Fd(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function ut(e,t,s){if(!(this instanceof ut))return new ut(e,t,s);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t>"u"){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=s||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ut.fromMGRS=function(e){return new ut(Ma(e))};ut.prototype.toMGRS=function(e){return wa([this.x,this.y],e)};var Bd=1,Ud=.25,Wi=.046875,Ji=.01953125,Ki=.01068115234375,Vd=.75,Gd=.46875,zd=.013020833333333334,Hd=.007120768229166667,qd=.3645833333333333,Wd=.005696614583333333,Jd=.3076171875;function $r(e){var t=[];t[0]=Bd-e*(Ud+e*(Wi+e*(Ji+e*Ki))),t[1]=e*(Vd-e*(Wi+e*(Ji+e*Ki)));var s=e*e;return t[2]=s*(Gd-e*(zd+e*Hd)),s*=e,t[3]=s*(qd-e*Wd),t[4]=s*e*Jd,t}function pt(e,t,s,r){return s*=t,t*=t,r[0]*e-s*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}var Kd=20;function Fr(e,t,s){for(var r=1/(1-t),i=e,n=Kd;n;--n){var a=Math.sin(i),o=1-t*a*a;if(o=(pt(i,a,Math.cos(i),s)-e)*(o*Math.sqrt(o))*r,i-=o,Math.abs(o)<A)return i}return i}function Xd(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=$r(this.es),this.ml0=pt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Qd(e){var t=e.x,s=e.y,r=j(t-this.long0),i,n,a,o=Math.sin(s),c=Math.cos(s);if(this.es){var d=c*r,u=Math.pow(d,2),f=this.ep2*Math.pow(c,2),m=Math.pow(f,2),v=Math.abs(c)>A?Math.tan(s):0,y=Math.pow(v,2),p=Math.pow(y,2);i=1-this.es*Math.pow(o,2),d=d/Math.sqrt(i);var _=pt(s,o,c,this.en);n=this.a*(this.k0*d*(1+u/6*(1-y+f+u/20*(5-18*y+p+14*f-58*y*f+u/42*(61+179*p-p*y-479*y)))))+this.x0,a=this.a*(this.k0*(_-this.ml0+o*r*d/2*(1+u/12*(5-y+9*f+4*m+u/30*(61+p-58*y+270*f-330*y*f+u/56*(1385+543*p-p*y-3111*y))))))+this.y0}else{var h=c*Math.sin(r);if(Math.abs(Math.abs(h)-1)<A)return 93;if(n=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=c*Math.cos(r)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>A)return 93;a=0}else a=Math.acos(a);s<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return e.x=n,e.y=a,e}function Zd(e){var t,s,r,i,n=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,s=Fr(t,this.es,this.en),Math.abs(s)<N){var u=Math.sin(s),f=Math.cos(s),m=Math.abs(f)>A?Math.tan(s):0,v=this.ep2*Math.pow(f,2),y=Math.pow(v,2),p=Math.pow(m,2),_=Math.pow(p,2);t=1-this.es*Math.pow(u,2);var x=n*Math.sqrt(t)/this.k0,w=Math.pow(x,2);t=t*m,r=s-t*w/(1-this.es)*.5*(1-w/12*(5+3*p-9*v*p+v-4*y-w/30*(61+90*p-252*v*p+45*_+46*v-w/56*(1385+3633*p+4095*_+1574*_*p)))),i=j(this.long0+x*(1-w/6*(1+2*p+v-w/20*(5+28*p+24*_+8*v*p+6*v-w/42*(61+662*p+1320*_+720*_*p))))/f)}else r=N*Kt(a),i=0;else{var o=Math.exp(n/this.k0),c=.5*(o-1/o),h=this.lat0+a/this.k0,d=Math.cos(h);t=Math.sqrt((1-Math.pow(d,2))/(1+Math.pow(c,2))),r=Math.asin(t),a<0&&(r=-r),c===0&&d===0?i=0:i=j(Math.atan2(c,d)+this.long0)}return e.x=i,e.y=r,e}var Yd=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const us={init:Xd,forward:Qd,inverse:Zd,names:Yd};function Sa(e){var t=Math.exp(e);return t=(t-1/t)/2,t}function ne(e,t){e=Math.abs(e),t=Math.abs(t);var s=Math.max(e,t),r=Math.min(e,t)/(s||1);return s*Math.sqrt(1+Math.pow(r,2))}function e0(e){var t=1+e,s=t-1;return s===0?e:e*Math.log(t)/s}function t0(e){var t=Math.abs(e);return t=e0(t*(1+t/(ne(1,t)+1))),e<0?-t:t}function Br(e,t){for(var s=2*Math.cos(2*t),r=e.length-1,i=e[r],n=0,a;--r>=0;)a=-n+s*i+e[r],n=i,i=a;return t+a*Math.sin(2*t)}function s0(e,t){for(var s=2*Math.cos(t),r=e.length-1,i=e[r],n=0,a;--r>=0;)a=-n+s*i+e[r],n=i,i=a;return Math.sin(t)*a}function r0(e){var t=Math.exp(e);return t=(t+1/t)/2,t}function Na(e,t,s){for(var r=Math.sin(t),i=Math.cos(t),n=Sa(s),a=r0(s),o=2*i*a,c=-2*r*n,h=e.length-1,d=e[h],u=0,f=0,m=0,v,y;--h>=0;)v=f,y=u,f=d,u=m,d=-v+o*f-c*u+e[h],m=-y+c*f+o*u;return o=r*a,c=i*n,[o*d-c*m,o*m+c*d]}function i0(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(us.init.apply(this),this.forward=us.forward,this.inverse=us.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),s=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),s=s*t,this.cgb[1]=s*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=s*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),s=s*t,this.cgb[2]=s*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=s*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),s=s*t,this.cgb[3]=s*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=s*(1237/630+t*(-12/5+t*(-24832/14175))),s=s*t,this.cgb[4]=s*(4174/315+t*(-144838/6237)),this.cbg[4]=s*(-734/315+t*(109598/31185)),s=s*t,this.cgb[5]=s*(601676/22275),this.cbg[5]=s*(444337/155925),s=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+s*(1/4+s*(1/64+s/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=s*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=s*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),s=s*t,this.utg[2]=s*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=s*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),s=s*t,this.utg[3]=s*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=s*(49561/161280+t*(-179/168+t*(6601661/7257600))),s=s*t,this.utg[4]=s*(-4583/161280+t*(108847/3991680)),this.gtu[4]=s*(34729/80640+t*(-3418889/1995840)),s=s*t,this.utg[5]=s*(-20648693/638668800),this.gtu[5]=s*(212378941/319334400);var r=Br(this.cbg,this.lat0);this.Zb=-this.Qn*(r+s0(this.gtu,2*r))}function n0(e){var t=j(e.x-this.long0),s=e.y;s=Br(this.cbg,s);var r=Math.sin(s),i=Math.cos(s),n=Math.sin(t),a=Math.cos(t);s=Math.atan2(r,a*i),t=Math.atan2(n*i,ne(r,i*a)),t=t0(Math.tan(t));var o=Na(this.gtu,2*s,2*t);s=s+o[0],t=t+o[1];var c,h;return Math.abs(t)<=2.623395162778?(c=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*s+this.Zb)+this.y0):(c=1/0,h=1/0),e.x=c,e.y=h,e}function a0(e){var t=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);s=(s-this.Zb)/this.Qn,t=t/this.Qn;var r,i;if(Math.abs(t)<=2.623395162778){var n=Na(this.utg,2*s,2*t);s=s+n[0],t=t+n[1],t=Math.atan(Sa(t));var a=Math.sin(s),o=Math.cos(s),c=Math.sin(t),h=Math.cos(t);s=Math.atan2(a*h,ne(c,h*o)),t=Math.atan2(c,h*o),r=j(t+this.long0),i=Br(this.cgb,s)}else r=1/0,i=1/0;return e.x=r,e.y=i,e}var o0=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const ds={init:i0,forward:n0,inverse:a0,names:o0};function l0(e,t){if(e===void 0){if(e=Math.floor((j(t)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var c0="etmerc";function h0(){var e=l0(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*Q,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ds.init.apply(this),this.forward=ds.forward,this.inverse=ds.inverse}var u0=["Universal Transverse Mercator System","utm"];const d0={init:h0,names:u0,dependsOn:c0};function Ur(e,t){return Math.pow((1-e)/(1+e),t)}var f0=20;function m0(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+U)/(Math.pow(Math.tan(.5*this.lat0+U),this.C)*Ur(this.e*e,this.ratexp))}function g0(e){var t=e.x,s=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*s+U),this.C)*Ur(this.e*Math.sin(s),this.ratexp))-N,e.x=this.C*t,e}function p0(e){for(var t=1e-14,s=e.x/this.C,r=e.y,i=Math.pow(Math.tan(.5*r+U)/this.K,1/this.C),n=f0;n>0&&(r=2*Math.atan(i*Ur(this.e*Math.sin(e.y),-.5*this.e))-N,!(Math.abs(r-e.y)<t));--n)e.y=r;return n?(e.x=s,e.y=r,e):null}const Vr={init:m0,forward:g0,inverse:p0};function v0(){Vr.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function y0(e){var t,s,r,i;return e.x=j(e.x-this.long0),Vr.forward.apply(this,[e]),t=Math.sin(e.y),s=Math.cos(e.y),r=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*s*r),e.x=i*s*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*s*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function x0(e){var t,s,r,i,n;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,n=ne(e.x,e.y)){var a=2*Math.atan2(n,this.R2);t=Math.sin(a),s=Math.cos(a),i=Math.asin(s*this.sinc0+e.y*t*this.cosc0/n),r=Math.atan2(e.x*t,n*this.cosc0*s-e.y*this.sinc0*t)}else i=this.phic0,r=0;return e.x=r,e.y=i,Vr.inverse.apply(this,[e]),e.x=j(e.x+this.long0),e}var b0=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const w0={init:v0,forward:y0,inverse:x0,names:b0};function M0(e,t,s){return t*=s,Math.tan(.5*(N+e))*Math.pow((1-t)/(1+t),.5*s)}function _0(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=A&&(this.k0=.5*(1+Kt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=A&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=A&&Math.abs(Math.cos(this.lat_ts))>A&&(this.k0=.5*this.cons*xe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/de(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=xe(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-N,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function E0(e){var t=e.x,s=e.y,r=Math.sin(s),i=Math.cos(s),n,a,o,c,h,d,u=j(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=A&&Math.abs(s+this.lat0)<=A?(e.x=NaN,e.y=NaN,e):this.sphere?(n=2*this.k0/(1+this.sinlat0*r+this.coslat0*i*Math.cos(u)),e.x=this.a*n*i*Math.sin(u)+this.x0,e.y=this.a*n*(this.coslat0*r-this.sinlat0*i*Math.cos(u))+this.y0,e):(a=2*Math.atan(this.ssfn_(s,r,this.e))-N,c=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=A?(h=de(this.e,s*this.con,this.con*r),d=2*this.a*this.k0*h/this.cons,e.x=this.x0+d*Math.sin(t-this.long0),e.y=this.y0-this.con*d*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<A?(n=2*this.a*this.k0/(1+c*Math.cos(u)),e.y=n*o):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*c*Math.cos(u))),e.y=n*(this.cosX0*o-this.sinX0*c*Math.cos(u))+this.y0),e.x=n*c*Math.sin(u)+this.x0,e))}function S0(e){e.x-=this.x0,e.y-=this.y0;var t,s,r,i,n,a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,s=this.lat0,a<=A?(e.x=t,e.y=s,e):(s=Math.asin(Math.cos(o)*this.sinlat0+e.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<A?this.lat0>0?t=j(this.long0+Math.atan2(e.x,-1*e.y)):t=j(this.long0+Math.atan2(e.x,e.y)):t=j(this.long0+Math.atan2(e.x*Math.sin(o),a*this.coslat0*Math.cos(o)-e.y*this.sinlat0*Math.sin(o))),e.x=t,e.y=s,e)}else if(Math.abs(this.coslat0)<=A){if(a<=A)return s=this.lat0,t=this.long0,e.x=t,e.y=s,e;e.x*=this.con,e.y*=this.con,r=a*this.cons/(2*this.a*this.k0),s=this.con*Ft(this.e,r),t=this.con*j(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=A?n=this.X0:(n=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/a),t=j(this.long0+Math.atan2(e.x*Math.sin(i),a*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),s=-1*Ft(this.e,Math.tan(.5*(N+n)));return e.x=t,e.y=s,e}var N0=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const I0={init:_0,forward:E0,inverse:S0,names:N0,ssfn_:M0};function C0(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),s=this.a,r=this.rf,i=1/r,n=2*i-Math.pow(i,2),a=this.e=Math.sqrt(n);this.R=this.k0*s*Math.sqrt(1-n)/(1-n*Math.pow(t,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),c=Math.log(Math.tan(Math.PI/4+e/2)),h=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*c+this.alpha*a/2*h}function A0(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),s=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+s)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),n=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(n))),o=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(n));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*a+this.x0,e}function j0(e){for(var t=e.x-this.x0,s=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(s/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),o=this.lambda0+a/this.alpha,c=0,h=n,d=-1e3,u=0;Math.abs(h-d)>1e-7;){if(++u>20)return;c=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),d=h,h=2*Math.atan(Math.exp(c))-Math.PI/2}return e.x=o,e.y=h,e}var k0=["somerc"];const P0={init:C0,forward:A0,inverse:j0,names:k0};var Ze=1e-7;function T0(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],s=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||t.indexOf(s)!==-1}function R0(){var e,t,s,r,i,n,a,o,c,h,d=0,u,f=0,m=0,v=0,y=0,p=0,_=0;this.no_off=T0(this),this.no_rot="no_rot"in this;var x=!1;"alpha"in this&&(x=!0);var w=!1;if("rectified_grid_angle"in this&&(w=!0),x&&(_=this.alpha),w&&(d=this.rectified_grid_angle*Q),x||w)f=this.longc;else if(m=this.long1,y=this.lat1,v=this.long2,p=this.lat2,Math.abs(y-p)<=Ze||(e=Math.abs(y))<=Ze||Math.abs(e-N)<=Ze||Math.abs(Math.abs(this.lat0)-N)<=Ze||Math.abs(Math.abs(p)-N)<=Ze)throw new Error;var E=1-this.es;t=Math.sqrt(E),Math.abs(this.lat0)>A?(o=Math.sin(this.lat0),s=Math.cos(this.lat0),e=1-this.es*o*o,this.B=s*s,this.B=Math.sqrt(1+this.es*this.B*this.B/E),this.A=this.B*this.k0*t/e,r=this.B*t/(s*Math.sqrt(e)),i=r*r-1,i<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=r,this.E*=Math.pow(de(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=r=i=1),x||w?(x?(u=Math.asin(Math.sin(_)/r),w||(d=_)):(u=d,_=Math.asin(r*Math.sin(u))),this.lam0=f-Math.asin(.5*(i-1/i)*Math.tan(u))/this.B):(n=Math.pow(de(this.e,y,Math.sin(y)),this.B),a=Math.pow(de(this.e,p,Math.sin(p)),this.B),i=this.E/n,c=(a-n)/(a+n),h=this.E*this.E,h=(h-a*n)/(h+a*n),e=m-v,e<-Math.pi?v-=Dt:e>Math.pi&&(v+=Dt),this.lam0=j(.5*(m+v)-Math.atan(h*Math.tan(.5*this.B*(m-v))/c)/this.B),u=Math.atan(2*Math.sin(this.B*j(m-this.lam0))/(i-1/i)),d=_=Math.asin(r*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(_))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(U-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(U+i))}function O0(e){var t={},s,r,i,n,a,o,c,h;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-N)>A){if(a=this.E/Math.pow(de(this.e,e.y,Math.sin(e.y)),this.B),o=1/a,s=.5*(a-o),r=.5*(a+o),n=Math.sin(this.B*e.x),i=(s*this.singam-n*this.cosgam)/r,Math.abs(Math.abs(i)-1)<A)throw new Error;h=.5*this.ArB*Math.log((1-i)/(1+i)),o=Math.cos(this.B*e.x),Math.abs(o)<Ze?c=this.A*e.x:c=this.ArB*Math.atan2(s*this.cosgam+n*this.singam,o)}else h=e.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*e.y;return this.no_rot?(t.x=c,t.y=h):(c-=this.u_0,t.x=h*this.cosrot+c*this.sinrot,t.y=c*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function L0(e){var t,s,r,i,n,a,o,c={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(s=e.y,t=e.x):(s=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*s),i=.5*(r-1/r),n=.5*(r+1/r),a=Math.sin(this.BrA*t),o=(a*this.cosgam+i*this.singam)/n,Math.abs(Math.abs(o)-1)<A)c.x=0,c.y=o<0?-N:N;else{if(c.y=this.E/Math.sqrt((1+o)/(1-o)),c.y=Ft(this.e,Math.pow(c.y,1/this.B)),c.y===1/0)throw new Error;c.x=-this.rB*Math.atan2(i*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return c.x+=this.lam0,c}var D0=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const $0={init:R0,forward:O0,inverse:L0,names:D0};function F0(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<A)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),s=Math.cos(this.lat1),r=xe(this.e,t,s),i=de(this.e,this.lat1,t),n=Math.sin(this.lat2),a=Math.cos(this.lat2),o=xe(this.e,n,a),c=de(this.e,this.lat2,n),h=de(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>A?this.ns=Math.log(r/o)/Math.log(i/c):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function B0(e){var t=e.x,s=e.y;Math.abs(2*Math.abs(s)-Math.PI)<=A&&(s=Kt(s)*(N-2*A));var r=Math.abs(Math.abs(s)-N),i,n;if(r>A)i=de(this.e,s,Math.sin(s)),n=this.a*this.f0*Math.pow(i,this.ns);else{if(r=s*this.ns,r<=0)return null;n=0}var a=this.ns*j(t-this.long0);return e.x=this.k0*(n*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-n*Math.cos(a))+this.y0,e}function U0(e){var t,s,r,i,n,a=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),s=1):(t=-Math.sqrt(a*a+o*o),s=-1);var c=0;if(t!==0&&(c=Math.atan2(s*a,s*o)),t!==0||this.ns>0){if(s=1/this.ns,r=Math.pow(t/(this.a*this.f0),s),i=Ft(this.e,r),i===-9999)return null}else i=-N;return n=j(c/this.ns+this.long0),e.x=n,e.y=i,e}var V0=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const G0={init:F0,forward:B0,inverse:U0,names:V0};function z0(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function H0(e){var t,s,r,i,n,a,o,c=e.x,h=e.y,d=j(c-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),s=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),r=-d*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(s)+Math.sin(this.ad)*Math.cos(s)*Math.cos(r)),n=Math.asin(Math.cos(s)*Math.sin(r)/Math.cos(i)),a=this.n*n,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=o*Math.cos(a)/1,e.x=o*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e}function q0(e){var t,s,r,i,n,a,o,c,h=e.x;e.x=e.y,e.y=h,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),n=Math.atan2(e.y,e.x),i=n/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),s=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t)),e.x=this.long0-s/this.alfa,o=t,c=0;var d=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(c=1),o=e.y,d+=1;while(c===0&&d<15);return d>=15?null:e}var W0=["Krovak","krovak"];const J0={init:z0,forward:H0,inverse:q0,names:W0};function te(e,t,s,r,i){return e*i-t*Math.sin(2*i)+s*Math.sin(4*i)-r*Math.sin(6*i)}function Xt(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Qt(e){return .375*e*(1+.25*e*(1+.46875*e))}function Zt(e){return .05859375*e*e*(1+.75*e)}function Yt(e){return e*e*e*(35/3072)}function dt(e,t,s){var r=t*s;return e/Math.sqrt(1-r*r)}function Ue(e){return Math.abs(e)<N?e:e-Kt(e)*Math.PI}function _s(e,t,s,r,i){var n,a;n=e/t;for(var o=0;o<15;o++)if(a=(e-(t*n-s*Math.sin(2*n)+r*Math.sin(4*n)-i*Math.sin(6*n)))/(t-2*s*Math.cos(2*n)+4*r*Math.cos(4*n)-6*i*Math.cos(6*n)),n+=a,Math.abs(a)<=1e-10)return n;return NaN}function K0(){this.sphere||(this.e0=Xt(this.es),this.e1=Qt(this.es),this.e2=Zt(this.es),this.e3=Yt(this.es),this.ml0=this.a*te(this.e0,this.e1,this.e2,this.e3,this.lat0))}function X0(e){var t,s,r=e.x,i=e.y;if(r=j(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(r)),s=this.a*(Math.atan2(Math.tan(i),Math.cos(r))-this.lat0);else{var n=Math.sin(i),a=Math.cos(i),o=dt(this.a,this.e,n),c=Math.tan(i)*Math.tan(i),h=r*Math.cos(i),d=h*h,u=this.es*a*a/(1-this.es),f=this.a*te(this.e0,this.e1,this.e2,this.e3,i);t=o*h*(1-d*c*(1/6-(8-c+8*u)*d/120)),s=f-this.ml0+o*n/a*d*(.5+(5-c+6*u)*d/24)}return e.x=t+this.x0,e.y=s+this.y0,e}function Q0(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,s=e.y/this.a,r,i;if(this.sphere){var n=s+this.lat0;r=Math.asin(Math.sin(n)*Math.cos(t)),i=Math.atan2(Math.tan(t),Math.cos(n))}else{var a=this.ml0/this.a+s,o=_s(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-N)<=A)return e.x=this.long0,e.y=N,s<0&&(e.y*=-1),e;var c=dt(this.a,this.e,Math.sin(o)),h=c*c*c/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(o),2),u=t*this.a/c,f=u*u;r=o-c*Math.tan(o)/h*u*u*(.5-(1+3*d)*u*u/24),i=u*(1-f*(d/3+(1+3*d)*d*f/15))/Math.cos(o)}return e.x=j(i+this.long0),e.y=Ue(r),e}var Z0=["Cassini","Cassini_Soldner","cass"];const Y0={init:K0,forward:X0,inverse:Q0,names:Z0};function Oe(e,t){var s;return e>1e-7?(s=e*t,(1-e*e)*(t/(1-s*s)-.5/e*Math.log((1-s)/(1+s)))):2*t}var ef=1,tf=2,sf=3,rf=4;function nf(){var e=Math.abs(this.lat0);if(Math.abs(e-N)<A?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<A?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=Oe(this.e,1),this.mmf=.5/(1-this.es),this.apa=mf(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Oe(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function af(e){var t,s,r,i,n,a,o,c,h,d,u=e.x,f=e.y;if(u=j(u-this.long0),this.sphere){if(n=Math.sin(f),d=Math.cos(f),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(s=this.mode===this.EQUIT?1+d*r:1+this.sinph0*n+this.cosph0*d*r,s<=A)return null;s=Math.sqrt(2/s),t=s*d*Math.sin(u),s*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*d*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(f+this.lat0)<A)return null;s=U-f*.5,s=2*(this.mode===this.S_POLE?Math.cos(s):Math.sin(s)),t=s*Math.sin(u),s*=r}}else{switch(o=0,c=0,h=0,r=Math.cos(u),i=Math.sin(u),n=Math.sin(f),a=Oe(this.e,n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,c=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*c*r;break;case this.EQUIT:h=1+c*r;break;case this.N_POLE:h=N+f,a=this.qp-a;break;case this.S_POLE:h=f-N,a=this.qp+a;break}if(Math.abs(h)<A)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?s=this.ymf*h*(this.cosb1*o-this.sinb1*c*r):s=(h=Math.sqrt(2/(1+c*r)))*o*this.ymf,t=this.xmf*h*c*i;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(h=Math.sqrt(a))*i,s=r*(this.mode===this.S_POLE?h:-h)):t=s=0;break}}return e.x=this.a*t+this.x0,e.y=this.a*s+this.y0,e}function of(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,s=e.y/this.a,r,i,n,a,o,c,h;if(this.sphere){var d=0,u,f=0;if(u=Math.sqrt(t*t+s*s),i=u*.5,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(i),d=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(u)<=A?0:Math.asin(s*f/u),t*=f,s=d*u;break;case this.OBLIQ:i=Math.abs(u)<=A?this.lat0:Math.asin(d*this.sinph0+s*f*this.cosph0/u),t*=f*this.cosph0,s=(d-Math.sin(i)*this.sinph0)*u;break;case this.N_POLE:s=-s,i=N-i;break;case this.S_POLE:i-=N;break}r=s===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,s)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,s*=this.dd,c=Math.sqrt(t*t+s*s),c<A)return e.x=this.long0,e.y=this.lat0,e;a=2*Math.asin(.5*c/this.rq),n=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(h=n*this.sinb1+s*a*this.cosb1/c,o=this.qp*h,s=c*this.cosb1*n-s*this.sinb1*a):(h=s*a/c,o=this.qp*h,s=c*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),o=t*t+s*s,!o)return e.x=this.long0,e.y=this.lat0,e;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}r=Math.atan2(t,s),i=gf(Math.asin(h),this.apa)}return e.x=j(this.long0+r),e.y=i,e}var lf=.3333333333333333,cf=.17222222222222222,hf=.10257936507936508,uf=.06388888888888888,df=.0664021164021164,ff=.016415012942191543;function mf(e){var t,s=[];return s[0]=e*lf,t=e*e,s[0]+=t*cf,s[1]=t*uf,t*=e,s[0]+=t*hf,s[1]+=t*df,s[2]=t*ff,s}function gf(e,t){var s=e+e;return e+t[0]*Math.sin(s)+t[1]*Math.sin(s+s)+t[2]*Math.sin(s+s+s)}var pf=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const vf={init:nf,forward:af,inverse:of,names:pf,S_POLE:ef,N_POLE:tf,EQUIT:sf,OBLIQ:rf};function De(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function yf(){Math.abs(this.lat1+this.lat2)<A||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=xe(this.e3,this.sin_po,this.cos_po),this.qs1=Oe(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=xe(this.e3,this.sin_po,this.cos_po),this.qs2=Oe(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Oe(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>A?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function xf(e){var t=e.x,s=e.y;this.sin_phi=Math.sin(s),this.cos_phi=Math.cos(s);var r=Oe(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,n=this.ns0*j(t-this.long0),a=i*Math.sin(n)+this.x0,o=this.rh-i*Math.cos(n)+this.y0;return e.x=a,e.y=o,e}function bf(e){var t,s,r,i,n,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),i=0,t!==0&&(i=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(s=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,s)),n=j(i/this.ns0+this.long0),e.x=n,e.y=a,e}function wf(e,t){var s,r,i,n,a,o=De(.5*t);if(e<A)return o;for(var c=e*e,h=1;h<=25;h++)if(s=Math.sin(o),r=Math.cos(o),i=e*s,n=1-i*i,a=.5*n*n/r*(t/(1-c)-s/n+.5/e*Math.log((1-i)/(1+i))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var Mf=["Albers_Conic_Equal_Area","Albers","aea"];const _f={init:yf,forward:xf,inverse:bf,names:Mf,phi1z:wf};function Ef(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function Sf(e){var t,s,r,i,n,a,o,c,h=e.x,d=e.y;return r=j(h-this.long0),t=Math.sin(d),s=Math.cos(d),i=Math.cos(r),a=this.sin_p14*t+this.cos_p14*s*i,n=1,a>0||Math.abs(a)<=A?(o=this.x0+this.a*n*s*Math.sin(r)/a,c=this.y0+this.a*n*(this.cos_p14*t-this.sin_p14*s*i)/a):(o=this.x0+this.infinity_dist*s*Math.sin(r),c=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*s*i)),e.x=o,e.y=c,e}function Nf(e){var t,s,r,i,n,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),s=Math.sin(i),r=Math.cos(i),a=De(r*this.sin_p14+e.y*s*this.cos_p14/t),n=Math.atan2(e.x*s,t*this.cos_p14*r-e.y*this.sin_p14*s),n=j(this.long0+n)):(a=this.phic0,n=0),e.x=n,e.y=a,e}var If=["gnom"];const Cf={init:Ef,forward:Sf,inverse:Nf,names:If};function Af(e,t){var s=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-s)<1e-6)return t<0?-1*N:N;for(var r=Math.asin(.5*t),i,n,a,o,c=0;c<30;c++)if(n=Math.sin(r),a=Math.cos(r),o=e*n,i=Math.pow(1-o*o,2)/(2*a)*(t/(1-e*e)-n/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),r+=i,Math.abs(i)<=1e-10)return r;return NaN}function jf(){this.sphere||(this.k0=xe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function kf(e){var t=e.x,s=e.y,r,i,n=j(t-this.long0);if(this.sphere)r=this.x0+this.a*n*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var a=Oe(this.e,Math.sin(s));r=this.x0+this.a*this.k0*n,i=this.y0+this.a*a*.5/this.k0}return e.x=r,e.y=i,e}function Pf(e){e.x-=this.x0,e.y-=this.y0;var t,s;return this.sphere?(t=j(this.long0+e.x/this.a/Math.cos(this.lat_ts)),s=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(s=Af(this.e,2*e.y*this.k0/this.a),t=j(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=s,e}var Tf=["cea"];const Rf={init:jf,forward:kf,inverse:Pf,names:Tf};function Of(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Lf(e){var t=e.x,s=e.y,r=j(t-this.long0),i=Ue(s-this.lat0);return e.x=this.x0+this.a*r*this.rc,e.y=this.y0+this.a*i,e}function Df(e){var t=e.x,s=e.y;return e.x=j(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Ue(this.lat0+(s-this.y0)/this.a),e}var $f=["Equirectangular","Equidistant_Cylindrical","eqc"];const Ff={init:Of,forward:Lf,inverse:Df,names:$f};var Xi=20;function Bf(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Xt(this.es),this.e1=Qt(this.es),this.e2=Zt(this.es),this.e3=Yt(this.es),this.ml0=this.a*te(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Uf(e){var t=e.x,s=e.y,r,i,n,a=j(t-this.long0);if(n=a*Math.sin(s),this.sphere)Math.abs(s)<=A?(r=this.a*a,i=-1*this.a*this.lat0):(r=this.a*Math.sin(n)/Math.tan(s),i=this.a*(Ue(s-this.lat0)+(1-Math.cos(n))/Math.tan(s)));else if(Math.abs(s)<=A)r=this.a*a,i=-1*this.ml0;else{var o=dt(this.a,this.e,Math.sin(s))/Math.tan(s);r=o*Math.sin(n),i=this.a*te(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*(1-Math.cos(n))}return e.x=r+this.x0,e.y=i+this.y0,e}function Vf(e){var t,s,r,i,n,a,o,c,h;if(r=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=A)t=j(r/this.a+this.long0),s=0;else{a=this.lat0+i/this.a,o=r*r/this.a/this.a+a*a,c=a;var d;for(n=Xi;n;--n)if(d=Math.tan(c),h=-1*(a*(c*d+1)-c-.5*(c*c+o)*d)/((c-a)/d-1),c+=h,Math.abs(h)<=A){s=c;break}t=j(this.long0+Math.asin(r*Math.tan(c)/this.a)/Math.sin(s))}else if(Math.abs(i+this.ml0)<=A)s=0,t=j(this.long0+r/this.a);else{a=(this.ml0+i)/this.a,o=r*r/this.a/this.a+a*a,c=a;var u,f,m,v,y;for(n=Xi;n;--n)if(y=this.e*Math.sin(c),u=Math.sqrt(1-y*y)*Math.tan(c),f=this.a*te(this.e0,this.e1,this.e2,this.e3,c),m=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),v=f/this.a,h=(a*(u*v+1)-v-.5*u*(v*v+o))/(this.es*Math.sin(2*c)*(v*v+o-2*a*v)/(4*u)+(a-v)*(u*m-2/Math.sin(2*c))-m),c-=h,Math.abs(h)<=A){s=c;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(s),2))*Math.tan(s),t=j(this.long0+Math.asin(r*u/this.a)/Math.sin(s))}return e.x=t,e.y=s,e}var Gf=["Polyconic","poly"];const zf={init:Bf,forward:Uf,inverse:Vf,names:Gf};function Hf(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function qf(e){var t,s=e.x,r=e.y,i=r-this.lat0,n=s-this.long0,a=i/It*1e-5,o=n,c=1,h=0;for(t=1;t<=10;t++)c=c*a,h=h+this.A[t]*c;var d=h,u=o,f=1,m=0,v,y,p=0,_=0;for(t=1;t<=6;t++)v=f*d-m*u,y=m*d+f*u,f=v,m=y,p=p+this.B_re[t]*f-this.B_im[t]*m,_=_+this.B_im[t]*f+this.B_re[t]*m;return e.x=_*this.a+this.x0,e.y=p*this.a+this.y0,e}function Wf(e){var t,s=e.x,r=e.y,i=s-this.x0,n=r-this.y0,a=n/this.a,o=i/this.a,c=1,h=0,d,u,f=0,m=0;for(t=1;t<=6;t++)d=c*a-h*o,u=h*a+c*o,c=d,h=u,f=f+this.C_re[t]*c-this.C_im[t]*h,m=m+this.C_im[t]*c+this.C_re[t]*h;for(var v=0;v<this.iterations;v++){var y=f,p=m,_,x,w=a,E=o;for(t=2;t<=6;t++)_=y*f-p*m,x=p*f+y*m,y=_,p=x,w=w+(t-1)*(this.B_re[t]*y-this.B_im[t]*p),E=E+(t-1)*(this.B_im[t]*y+this.B_re[t]*p);y=1,p=0;var b=this.B_re[1],M=this.B_im[1];for(t=2;t<=6;t++)_=y*f-p*m,x=p*f+y*m,y=_,p=x,b=b+t*(this.B_re[t]*y-this.B_im[t]*p),M=M+t*(this.B_im[t]*y+this.B_re[t]*p);var S=b*b+M*M;f=(w*b+E*M)/S,m=(E*b-w*M)/S}var I=f,C=m,R=1,k=0;for(t=1;t<=9;t++)R=R*I,k=k+this.D[t]*R;var D=this.lat0+k*It*1e5,$=this.long0+C;return e.x=$,e.y=D,e}var Jf=["New_Zealand_Map_Grid","nzmg"];const Kf={init:Hf,forward:qf,inverse:Wf,names:Jf};function Xf(){}function Qf(e){var t=e.x,s=e.y,r=j(t-this.long0),i=this.x0+this.a*r,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+s/2.5))*1.25;return e.x=i,e.y=n,e}function Zf(e){e.x-=this.x0,e.y-=this.y0;var t=j(this.long0+e.x/this.a),s=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=s,e}var Yf=["Miller_Cylindrical","mill"];const em={init:Xf,forward:Qf,inverse:Zf,names:Yf};var tm=20;function sm(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=$r(this.es)}function rm(e){var t,s,r=e.x,i=e.y;if(r=j(r-this.long0),this.sphere){if(!this.m)i=this.n!==1?Math.asin(this.n*Math.sin(i)):i;else for(var n=this.n*Math.sin(i),a=tm;a;--a){var o=(this.m*i+Math.sin(i)-n)/(this.m+Math.cos(i));if(i-=o,Math.abs(o)<A)break}t=this.a*this.C_x*r*(this.m+Math.cos(i)),s=this.a*this.C_y*i}else{var c=Math.sin(i),h=Math.cos(i);s=this.a*pt(i,c,h,this.en),t=this.a*r*h/Math.sqrt(1-this.es*c*c)}return e.x=t,e.y=s,e}function im(e){var t,s,r,i;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(t))),this.m?t=De((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=De(Math.sin(t)/this.n)),r=j(r+this.long0),t=Ue(t)):(t=Fr(e.y/this.a,this.es,this.en),i=Math.abs(t),i<N?(i=Math.sin(t),s=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),r=j(s)):i-A<N&&(r=this.long0)),e.x=r,e.y=t,e}var nm=["Sinusoidal","sinu"];const am={init:sm,forward:rm,inverse:im,names:nm};function om(){}function lm(e){for(var t=e.x,s=e.y,r=j(t-this.long0),i=s,n=Math.PI*Math.sin(s);;){var a=-(i+Math.sin(i)-n)/(1+Math.cos(i));if(i+=a,Math.abs(a)<A)break}i/=2,Math.PI/2-Math.abs(s)<A&&(r=0);var o=.900316316158*this.a*r*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=o,e.y=c,e}function cm(e){var t,s;e.x-=this.x0,e.y-=this.y0,s=e.y/(1.4142135623731*this.a),Math.abs(s)>.999999999999&&(s=.999999999999),t=Math.asin(s);var r=j(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),s=(2*t+Math.sin(2*t))/Math.PI,Math.abs(s)>1&&(s=1);var i=Math.asin(s);return e.x=r,e.y=i,e}var hm=["Mollweide","moll"];const um={init:om,forward:lm,inverse:cm,names:hm};function dm(){Math.abs(this.lat1+this.lat2)<A||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Xt(this.es),this.e1=Qt(this.es),this.e2=Zt(this.es),this.e3=Yt(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=xe(this.e,this.sinphi,this.cosphi),this.ml1=te(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<A?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=xe(this.e,this.sinphi,this.cosphi),this.ml2=te(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=te(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function fm(e){var t=e.x,s=e.y,r;if(this.sphere)r=this.a*(this.g-s);else{var i=te(this.e0,this.e1,this.e2,this.e3,s);r=this.a*(this.g-i)}var n=this.ns*j(t-this.long0),a=this.x0+r*Math.sin(n),o=this.y0+this.rh-r*Math.cos(n);return e.x=a,e.y=o,e}function mm(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,s,r,i;this.ns>=0?(s=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(s=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var n=0;if(s!==0&&(n=Math.atan2(t*e.x,t*e.y)),this.sphere)return i=j(this.long0+n/this.ns),r=Ue(this.g-s/this.a),e.x=i,e.y=r,e;var a=this.g-s/this.a;return r=_s(a,this.e0,this.e1,this.e2,this.e3),i=j(this.long0+n/this.ns),e.x=i,e.y=r,e}var gm=["Equidistant_Conic","eqdc"];const pm={init:dm,forward:fm,inverse:mm,names:gm};function vm(){this.R=this.a}function ym(e){var t=e.x,s=e.y,r=j(t-this.long0),i,n;Math.abs(s)<=A&&(i=this.x0+this.R*r,n=this.y0);var a=De(2*Math.abs(s/Math.PI));(Math.abs(r)<=A||Math.abs(Math.abs(s)-N)<=A)&&(i=this.x0,s>=0?n=this.y0+Math.PI*this.R*Math.tan(.5*a):n=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/r-r/Math.PI),c=o*o,h=Math.sin(a),d=Math.cos(a),u=d/(h+d-1),f=u*u,m=u*(2/h-1),v=m*m,y=Math.PI*this.R*(o*(u-v)+Math.sqrt(c*(u-v)*(u-v)-(v+c)*(f-v)))/(v+c);r<0&&(y=-y),i=this.x0+y;var p=c+u;return y=Math.PI*this.R*(m*p-o*Math.sqrt((v+c)*(c+1)-p*p))/(v+c),s>=0?n=this.y0+y:n=this.y0-y,e.x=i,e.y=n,e}function xm(e){var t,s,r,i,n,a,o,c,h,d,u,f,m;return e.x-=this.x0,e.y-=this.y0,u=Math.PI*this.R,r=e.x/u,i=e.y/u,n=r*r+i*i,a=-Math.abs(i)*(1+n),o=a-2*i*i+r*r,c=-2*a+1+2*i*i+n*n,m=i*i/c+(2*o*o*o/c/c/c-9*a*o/c/c)/27,h=(a-o*o/3/c)/c,d=2*Math.sqrt(-h/3),u=3*m/h/d,Math.abs(u)>1&&(u>=0?u=1:u=-1),f=Math.acos(u)/3,e.y>=0?s=(-d*Math.cos(f+Math.PI/3)-o/3/c)*Math.PI:s=-(-d*Math.cos(f+Math.PI/3)-o/3/c)*Math.PI,Math.abs(r)<A?t=this.long0:t=j(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(r*r-i*i)+n*n))/2/r),e.x=t,e.y=s,e}var bm=["Van_der_Grinten_I","VanDerGrinten","vandg"];const wm={init:vm,forward:ym,inverse:xm,names:bm};function Mm(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function _m(e){var t=e.x,s=e.y,r=Math.sin(e.y),i=Math.cos(e.y),n=j(t-this.long0),a,o,c,h,d,u,f,m,v,y,p,_,x,w,E,b,M,S,I,C,R,k,D;return this.sphere?Math.abs(this.sin_p12-1)<=A?(e.x=this.x0+this.a*(N-s)*Math.sin(n),e.y=this.y0-this.a*(N-s)*Math.cos(n),e):Math.abs(this.sin_p12+1)<=A?(e.x=this.x0+this.a*(N+s)*Math.sin(n),e.y=this.y0+this.a*(N+s)*Math.cos(n),e):(S=this.sin_p12*r+this.cos_p12*i*Math.cos(n),b=Math.acos(S),M=b?b/Math.sin(b):1,e.x=this.x0+this.a*M*i*Math.sin(n),e.y=this.y0+this.a*M*(this.cos_p12*r-this.sin_p12*i*Math.cos(n)),e):(a=Xt(this.es),o=Qt(this.es),c=Zt(this.es),h=Yt(this.es),Math.abs(this.sin_p12-1)<=A?(d=this.a*te(a,o,c,h,N),u=this.a*te(a,o,c,h,s),e.x=this.x0+(d-u)*Math.sin(n),e.y=this.y0-(d-u)*Math.cos(n),e):Math.abs(this.sin_p12+1)<=A?(d=this.a*te(a,o,c,h,N),u=this.a*te(a,o,c,h,s),e.x=this.x0+(d+u)*Math.sin(n),e.y=this.y0+(d+u)*Math.cos(n),e):(f=r/i,m=dt(this.a,this.e,this.sin_p12),v=dt(this.a,this.e,r),y=Math.atan((1-this.es)*f+this.es*m*this.sin_p12/(v*i)),p=Math.atan2(Math.sin(n),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(n)),p===0?I=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(p)-Math.PI)<=A?I=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):I=Math.asin(Math.sin(n)*Math.cos(y)/Math.sin(p)),_=this.e*this.sin_p12/Math.sqrt(1-this.es),x=this.e*this.cos_p12*Math.cos(p)/Math.sqrt(1-this.es),w=_*x,E=x*x,C=I*I,R=C*I,k=R*I,D=k*I,b=m*I*(1-C*E*(1-E)/6+R/8*w*(1-2*E)+k/120*(E*(4-7*E)-3*_*_*(1-7*E))-D/48*w),e.x=this.x0+b*Math.sin(p),e.y=this.y0+b*Math.cos(p),e))}function Em(e){e.x-=this.x0,e.y-=this.y0;var t,s,r,i,n,a,o,c,h,d,u,f,m,v,y,p,_,x,w,E,b,M,S,I;return this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y),t>2*N*this.a?void 0:(s=t/this.a,r=Math.sin(s),i=Math.cos(s),n=this.long0,Math.abs(t)<=A?a=this.lat0:(a=De(i*this.sin_p12+e.y*r*this.cos_p12/t),o=Math.abs(this.lat0)-N,Math.abs(o)<=A?this.lat0>=0?n=j(this.long0+Math.atan2(e.x,-e.y)):n=j(this.long0-Math.atan2(-e.x,e.y)):n=j(this.long0+Math.atan2(e.x*r,t*this.cos_p12*i-e.y*this.sin_p12*r))),e.x=n,e.y=a,e)):(c=Xt(this.es),h=Qt(this.es),d=Zt(this.es),u=Yt(this.es),Math.abs(this.sin_p12-1)<=A?(f=this.a*te(c,h,d,u,N),t=Math.sqrt(e.x*e.x+e.y*e.y),m=f-t,a=_s(m/this.a,c,h,d,u),n=j(this.long0+Math.atan2(e.x,-1*e.y)),e.x=n,e.y=a,e):Math.abs(this.sin_p12+1)<=A?(f=this.a*te(c,h,d,u,N),t=Math.sqrt(e.x*e.x+e.y*e.y),m=t-f,a=_s(m/this.a,c,h,d,u),n=j(this.long0+Math.atan2(e.x,e.y)),e.x=n,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),p=Math.atan2(e.x,e.y),v=dt(this.a,this.e,this.sin_p12),_=Math.cos(p),x=this.e*this.cos_p12*_,w=-x*x/(1-this.es),E=3*this.es*(1-w)*this.sin_p12*this.cos_p12*_/(1-this.es),b=t/v,M=b-w*(1+w)*Math.pow(b,3)/6-E*(1+3*w)*Math.pow(b,4)/24,S=1-w*M*M/2-b*M*M*M/6,y=Math.asin(this.sin_p12*Math.cos(M)+this.cos_p12*Math.sin(M)*_),n=j(this.long0+Math.asin(Math.sin(p)*Math.sin(M)/Math.cos(y))),I=Math.sin(y),a=Math.atan2((I-this.es*S*this.sin_p12)*Math.tan(y),I*(1-this.es)),e.x=n,e.y=a,e))}var Sm=["Azimuthal_Equidistant","aeqd"];const Nm={init:Mm,forward:_m,inverse:Em,names:Sm};function Im(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Cm(e){var t,s,r,i,n,a,o,c,h=e.x,d=e.y;return r=j(h-this.long0),t=Math.sin(d),s=Math.cos(d),i=Math.cos(r),a=this.sin_p14*t+this.cos_p14*s*i,n=1,(a>0||Math.abs(a)<=A)&&(o=this.a*n*s*Math.sin(r),c=this.y0+this.a*n*(this.cos_p14*t-this.sin_p14*s*i)),e.x=o,e.y=c,e}function Am(e){var t,s,r,i,n,a,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),s=De(t/this.a),r=Math.sin(s),i=Math.cos(s),a=this.long0,Math.abs(t)<=A?(o=this.lat0,e.x=a,e.y=o,e):(o=De(i*this.sin_p14+e.y*r*this.cos_p14/t),n=Math.abs(this.lat0)-N,Math.abs(n)<=A?(this.lat0>=0?a=j(this.long0+Math.atan2(e.x,-e.y)):a=j(this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=o,e):(a=j(this.long0+Math.atan2(e.x*r,t*this.cos_p14*i-e.y*this.sin_p14*r)),e.x=a,e.y=o,e))}var jm=["ortho"];const km={init:Im,forward:Cm,inverse:Am,names:jm};var K={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},V={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Pm(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=N-U/2?this.face=K.TOP:this.lat0<=-(N-U/2)?this.face=K.BOTTOM:Math.abs(this.long0)<=U?this.face=K.FRONT:Math.abs(this.long0)<=N+U?this.face=this.long0>0?K.RIGHT:K.LEFT:this.face=K.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Tm(e){var t={x:0,y:0},s,r,i,n,a,o,c={value:0};if(e.x-=this.long0,this.es!==0?s=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):s=e.y,r=e.x,this.face===K.TOP)n=N-s,r>=U&&r<=N+U?(c.value=V.AREA_0,i=r-N):r>N+U||r<=-(N+U)?(c.value=V.AREA_1,i=r>0?r-Z:r+Z):r>-(N+U)&&r<=-U?(c.value=V.AREA_2,i=r+N):(c.value=V.AREA_3,i=r);else if(this.face===K.BOTTOM)n=N+s,r>=U&&r<=N+U?(c.value=V.AREA_0,i=-r+N):r<U&&r>=-U?(c.value=V.AREA_1,i=-r):r<-U&&r>=-(N+U)?(c.value=V.AREA_2,i=-r-N):(c.value=V.AREA_3,i=r>0?-r+Z:-r-Z);else{var h,d,u,f,m,v,y;this.face===K.RIGHT?r=lt(r,+N):this.face===K.BACK?r=lt(r,3.14159265359):this.face===K.LEFT&&(r=lt(r,-N)),f=Math.sin(s),m=Math.cos(s),v=Math.sin(r),y=Math.cos(r),h=m*y,d=m*v,u=f,this.face===K.FRONT?(n=Math.acos(h),i=is(n,u,d,c)):this.face===K.RIGHT?(n=Math.acos(d),i=is(n,u,-h,c)):this.face===K.BACK?(n=Math.acos(-h),i=is(n,u,-d,c)):this.face===K.LEFT?(n=Math.acos(-d),i=is(n,u,h,c)):(n=i=0,c.value=V.AREA_0)}return o=Math.atan(12/Z*(i+Math.acos(Math.sin(i)*Math.cos(U))-N)),a=Math.sqrt((1-Math.cos(n))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(i))))),c.value===V.AREA_1?o+=N:c.value===V.AREA_2?o+=Z:c.value===V.AREA_3&&(o+=1.5*Z),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e}function Rm(e){var t={lam:0,phi:0},s,r,i,n,a,o,c,h,d,u={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),s=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?u.value=V.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(u.value=V.AREA_1,s-=N):e.x<0&&-e.x>=Math.abs(e.y)?(u.value=V.AREA_2,s=s<0?s+Z:s-Z):(u.value=V.AREA_3,s+=N),d=Z/12*Math.tan(s),a=Math.sin(d)/(Math.cos(d)-1/Math.sqrt(2)),o=Math.atan(a),i=Math.cos(s),n=Math.tan(r),c=1-i*i*n*n*(1-Math.cos(Math.atan(1/Math.cos(o)))),c<-1?c=-1:c>1&&(c=1),this.face===K.TOP)h=Math.acos(c),t.phi=N-h,u.value===V.AREA_0?t.lam=o+N:u.value===V.AREA_1?t.lam=o<0?o+Z:o-Z:u.value===V.AREA_2?t.lam=o-N:t.lam=o;else if(this.face===K.BOTTOM)h=Math.acos(c),t.phi=h-N,u.value===V.AREA_0?t.lam=-o+N:u.value===V.AREA_1?t.lam=-o:u.value===V.AREA_2?t.lam=-o-N:t.lam=o<0?-o-Z:-o+Z;else{var f,m,v;f=c,d=f*f,d>=1?v=0:v=Math.sqrt(1-d)*Math.sin(o),d+=v*v,d>=1?m=0:m=Math.sqrt(1-d),u.value===V.AREA_1?(d=m,m=-v,v=d):u.value===V.AREA_2?(m=-m,v=-v):u.value===V.AREA_3&&(d=m,m=v,v=-d),this.face===K.RIGHT?(d=f,f=-m,m=d):this.face===K.BACK?(f=-f,m=-m):this.face===K.LEFT&&(d=f,f=m,m=-d),t.phi=Math.acos(-v)-N,t.lam=Math.atan2(m,f),this.face===K.RIGHT?t.lam=lt(t.lam,-N):this.face===K.BACK?t.lam=lt(t.lam,-3.14159265359):this.face===K.LEFT&&(t.lam=lt(t.lam,+N))}if(this.es!==0){var y,p,_;y=t.phi<0?1:0,p=Math.tan(t.phi),_=this.b/Math.sqrt(p*p+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-_*_)/(this.one_minus_f*_)),y&&(t.phi=-t.phi)}return t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e}function is(e,t,s,r){var i;return e<A?(r.value=V.AREA_0,i=0):(i=Math.atan2(t,s),Math.abs(i)<=U?r.value=V.AREA_0:i>U&&i<=N+U?(r.value=V.AREA_1,i-=N):i>N+U||i<=-(N+U)?(r.value=V.AREA_2,i=i>=0?i-Z:i+Z):(r.value=V.AREA_3,i+=N)),i}function lt(e,t){var s=e+t;return s<-3.14159265359?s+=Dt:s>3.14159265359&&(s-=Dt),s}var Om=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Lm={init:Pm,forward:Tm,inverse:Rm,names:Om};var mr=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Et=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ia=.8487,Ca=1.3523,Aa=ge/5,Dm=1/Aa,st=18,Es=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},$m=function(e,t){return e[1]+t*(2*e[2]+t*3*e[3])};function Fm(e,t,s,r){for(var i=t;r;--r){var n=e(i);if(i-=n,Math.abs(n)<s)break}return i}function Bm(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Um(e){var t=j(e.x-this.long0),s=Math.abs(e.y),r=Math.floor(s*Aa);r<0?r=0:r>=st&&(r=st-1),s=ge*(s-Dm*r);var i={x:Es(mr[r],s)*t,y:Es(Et[r],s)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*Ia+this.x0,i.y=i.y*this.a*Ca+this.y0,i}function Vm(e){var t={x:(e.x-this.x0)/(this.a*Ia),y:Math.abs(e.y-this.y0)/(this.a*Ca)};if(t.y>=1)t.x/=mr[st][0],t.y=e.y<0?-N:N;else{var s=Math.floor(t.y*st);for(s<0?s=0:s>=st&&(s=st-1);;)if(Et[s][0]>t.y)--s;else if(Et[s+1][0]<=t.y)++s;else break;var r=Et[s],i=5*(t.y-r[0])/(Et[s+1][0]-r[0]);i=Fm(function(n){return(Es(r,n)-t.y)/$m(r,n)},i,A,100),t.x/=Es(mr[s],i),t.y=(5*s+i)*Q,e.y<0&&(t.y=-t.y)}return t.x=j(t.x+this.long0),t}var Gm=["Robinson","robin"];const zm={init:Bm,forward:Um,inverse:Vm,names:Gm};function Hm(){this.name="geocent"}function qm(e){var t=pa(e,this.es,this.a);return t}function Wm(e){var t=va(e,this.es,this.a,this.b);return t}var Jm=["Geocentric","geocentric","geocent","Geocent"];const Km={init:Hm,forward:qm,inverse:Wm,names:Jm};var Y={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},yt={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Xm(){if(Object.keys(yt).forEach((function(s){if(typeof this[s]>"u")this[s]=yt[s].def;else{if(yt[s].num&&isNaN(this[s]))throw new Error("Invalid parameter value, must be numeric "+s+" = "+this[s]);yt[s].num&&(this[s]=parseFloat(this[s]))}yt[s].degrees&&(this[s]=this[s]*Q)}).bind(this)),Math.abs(Math.abs(this.lat0)-N)<A?this.mode=this.lat0<0?Y.S_POLE:Y.N_POLE:Math.abs(this.lat0)<A?this.mode=Y.EQUIT:(this.mode=Y.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)}function Qm(e){e.x-=this.long0;var t=Math.sin(e.y),s=Math.cos(e.y),r=Math.cos(e.x),i,n;switch(this.mode){case Y.OBLIQ:n=this.sinph0*t+this.cosph0*s*r;break;case Y.EQUIT:n=s*r;break;case Y.S_POLE:n=-t;break;case Y.N_POLE:n=t;break}switch(n=this.pn1/(this.p-n),i=n*s*Math.sin(e.x),this.mode){case Y.OBLIQ:n*=this.cosph0*t-this.sinph0*s*r;break;case Y.EQUIT:n*=t;break;case Y.N_POLE:n*=-(s*r);break;case Y.S_POLE:n*=s*r;break}var a,o;return a=n*this.cg+i*this.sg,o=1/(a*this.sw*this.h1+this.cw),i=(i*this.cg-n*this.sg)*this.cw*o,n=a*o,e.x=i*this.a,e.y=n*this.a,e}function Zm(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},s,r,i;i=1/(this.pn1-e.y*this.sw),s=this.pn1*e.x*i,r=this.pn1*e.y*this.cw*i,e.x=s*this.cg+r*this.sg,e.y=r*this.cg-s*this.sg;var n=ne(e.x,e.y);if(Math.abs(n)<A)t.x=0,t.y=e.y;else{var a,o;switch(o=1-n*n*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/n+n/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Y.OBLIQ:t.y=Math.asin(a*this.sinph0+e.y*o*this.cosph0/n),e.y=(a-this.sinph0*Math.sin(t.y))*n,e.x*=o*this.cosph0;break;case Y.EQUIT:t.y=Math.asin(e.y*o/n),e.y=a*n,e.x*=o;break;case Y.N_POLE:t.y=Math.asin(a),e.y=-e.y;break;case Y.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e}var Ym=["Tilted_Perspective","tpers"];const eg={init:Xm,forward:Qm,inverse:Zm,names:Ym};function tg(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function sg(e){var t=e.x,s=e.y,r,i,n,a;if(t=t-this.long0,this.shape==="ellipse"){s=Math.atan(this.radius_p2*Math.tan(s));var o=this.radius_p/ne(this.radius_p*Math.cos(s),Math.sin(s));if(i=o*Math.cos(t)*Math.cos(s),n=o*Math.sin(t)*Math.cos(s),a=o*Math.sin(s),(this.radius_g-i)*i-n*n-a*a*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;r=this.radius_g-i,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/ne(a,r)),e.y=this.radius_g_1*Math.atan(a/r)):(e.x=this.radius_g_1*Math.atan(n/r),e.y=this.radius_g_1*Math.atan(a/ne(n,r)))}else this.shape==="sphere"&&(r=Math.cos(s),i=Math.cos(t)*r,n=Math.sin(t)*r,a=Math.sin(s),r=this.radius_g-i,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/ne(a,r)),e.y=this.radius_g_1*Math.atan(a/r)):(e.x=this.radius_g_1*Math.atan(n/r),e.y=this.radius_g_1*Math.atan(a/ne(n,r))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function rg(e){var t=-1,s=0,r=0,i,n,a,o;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*ne(1,r)):(s=Math.tan(e.x/this.radius_g_1),r=Math.tan(e.y/this.radius_g_1)*ne(1,s));var c=r/this.radius_p;if(i=s*s+c*c+t*t,n=2*this.radius_g*t,a=n*n-4*i*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-n-Math.sqrt(a))/(2*i),t=this.radius_g+o*t,s*=o,r*=o,e.x=Math.atan2(s,t),e.y=Math.atan(r*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(e.y/this.radius_g_1),s=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+r*r)):(s=Math.tan(e.x/this.radius_g_1),r=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+s*s)),i=s*s+r*r+t*t,n=2*this.radius_g*t,a=n*n-4*i*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-n-Math.sqrt(a))/(2*i),t=this.radius_g+o*t,s*=o,r*=o,e.x=Math.atan2(s,t),e.y=Math.atan(r*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e}var ig=["Geostationary Satellite View","Geostationary_Satellite","geos"];const ng={init:tg,forward:sg,inverse:rg,names:ig};var Ct=1.340264,At=-.081106,jt=893e-6,kt=.003796,Ss=Math.sqrt(3)/2;function ag(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function og(e){var t=j(e.x-this.long0),s=e.y,r=Math.asin(Ss*Math.sin(s)),i=r*r,n=i*i*i;return e.x=t*Math.cos(r)/(Ss*(Ct+3*At*i+n*(7*jt+9*kt*i))),e.y=r*(Ct+At*i+n*(jt+kt*i)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function lg(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t=1e-9,s=12,r=e.y,i,n,a,o,c,h;for(h=0;h<s&&(i=r*r,n=i*i*i,a=r*(Ct+At*i+n*(jt+kt*i))-e.y,o=Ct+3*At*i+n*(7*jt+9*kt*i),r-=c=a/o,!(Math.abs(c)<t));++h);return i=r*r,n=i*i*i,e.x=Ss*e.x*(Ct+3*At*i+n*(7*jt+9*kt*i))/Math.cos(r),e.y=Math.asin(Math.sin(r)/Ss),e.x=j(e.x+this.long0),e}var cg=["eqearth","Equal Earth","Equal_Earth"];const hg={init:ag,forward:og,inverse:lg,names:cg};var Bt=1e-10;function ug(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<Bt)throw new Error;this.es?(this.en=$r(this.es),this.m1=pt(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=fg,this.forward=dg):(Math.abs(this.phi1)+Bt>=N?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=gg,this.forward=mg)}function dg(e){var t=j(e.x-(this.long0||0)),s=e.y,r,i,n;return r=this.am1+this.m1-pt(s,i=Math.sin(s),n=Math.cos(s),this.en),i=n*t/(r*Math.sqrt(1-this.es*i*i)),e.x=r*Math.sin(i),e.y=this.am1-r*Math.cos(i),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function fg(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,s,r,i;if(s=ne(e.x,e.y=this.am1-e.y),i=Fr(this.am1+this.m1-s,this.es,this.en),(t=Math.abs(i))<N)t=Math.sin(i),r=s*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(i);else if(Math.abs(t-N)<=Bt)r=0;else throw new Error;return e.x=j(r+(this.long0||0)),e.y=Ue(i),e}function mg(e){var t=j(e.x-(this.long0||0)),s=e.y,r,i;return i=this.cphi1+this.phi1-s,Math.abs(i)>Bt?(e.x=i*Math.sin(r=t*Math.cos(s)/i),e.y=this.cphi1-i*Math.cos(r)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function gg(e){e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var t,s,r=ne(e.x,e.y=this.cphi1-e.y);if(s=this.cphi1+this.phi1-r,Math.abs(s)>N)throw new Error;return Math.abs(Math.abs(s)-N)<=Bt?t=0:t=r*Math.atan2(e.x,e.y)/Math.cos(s),e.x=j(t+(this.long0||0)),e.y=Ue(s),e}var pg=["bonne","Bonne (Werner lat_1=90)"];const vg={init:ug,names:pg};function yg(e){e.Proj.projections.add(us),e.Proj.projections.add(ds),e.Proj.projections.add(d0),e.Proj.projections.add(w0),e.Proj.projections.add(I0),e.Proj.projections.add(P0),e.Proj.projections.add($0),e.Proj.projections.add(G0),e.Proj.projections.add(J0),e.Proj.projections.add(Y0),e.Proj.projections.add(vf),e.Proj.projections.add(_f),e.Proj.projections.add(Cf),e.Proj.projections.add(Rf),e.Proj.projections.add(Ff),e.Proj.projections.add(zf),e.Proj.projections.add(Kf),e.Proj.projections.add(em),e.Proj.projections.add(am),e.Proj.projections.add(um),e.Proj.projections.add(pm),e.Proj.projections.add(wm),e.Proj.projections.add(Nm),e.Proj.projections.add(km),e.Proj.projections.add(Lm),e.Proj.projections.add(zm),e.Proj.projections.add(Km),e.Proj.projections.add(eg),e.Proj.projections.add(ng),e.Proj.projections.add(hg),e.Proj.projections.add(vg)}re.defaultDatum="WGS84";re.Proj=ve;re.WGS84=new re.Proj("WGS84");re.Point=ut;re.toPoint=ya;re.defs=ee;re.nadgrid=md;re.transform=Ms;re.mgrs=jd;re.version="__VERSION__";yg(re);var ja,Qi="deflate-raw",Zi=self.DecompressionStream;try{new Zi(Qi),ja=async e=>{let t=new Zi(Qi),s=t.writable.getWriter(),r=t.readable.getReader();s.write(e),s.close();let i,n=[],a=0,o=0,c;for(;!(c=await r.read()).done;)i=c.value,n.push(i),a+=i.length;return n.length-1?(i=new Uint8Array(a),n.map(h=>{i.set(h,o),o+=h.length}),i):n[0]}}catch{}var xg=new TextDecoder,Qs=e=>{throw new Error("but-unzip~"+e)},Yi=e=>xg.decode(e),bg=e=>{let t=e.length-20,s=Math.max(t-65516,2);for(;(t=e.lastIndexOf(80,t-1))!==-1&&!(e[t+1]===75&&e[t+2]===5&&e[t+3]===6)&&t>s;);return t};function*wg(e,t=ja){let s=bg(e);s===-1&&Qs(2);let r=(c,h)=>e.subarray(s+=c,s+=h),i=new DataView(e.buffer,e.byteOffset),n=c=>i.getUint16(c+s,!0),a=c=>i.getUint32(c+s,!0),o=n(10);for(o!==n(8)&&Qs(3),s=a(16);o--;){let c=n(10),h=n(28),d=n(30),u=n(32),f=a(20),m=a(42),v=Yi(r(46,h)),y=Yi(r(d,u)),p=s,_;s=m,_=r(30+n(26)+n(28),f),yield{filename:v,comment:y,read:()=>c&8?t(_):c?Qs(1):_},s=p}}const Mg=/.+\.(shp|dbf|json|prj|cpg)$/i,_g=async e=>{const t={},s=[];for(const n of wg(e))Mg.test(n.filename)&&s.push(Promise.resolve(n.read()).then(a=>t[n.filename]=a));await Promise.all(s);const r={},i=new TextDecoder;for(const[n,a]of Object.entries(t))n.slice(-3).toLowerCase()==="shp"||n.slice(-3).toLowerCase()==="dbf"?r[n]=new DataView(a.buffer,a.byteOffset,a.byteLength):r[n]=i.decode(a);return r},Eg=globalThis.URL,Sg=(e,t)=>{if(!t)return e;const s=new Eg(e);return s.pathname=`${s.pathname}.${t}`,s.href};async function Ut(e,t){const s=Sg(e,t),r=t==="prj"||t==="cpg";try{const i=await fetch(s);if(i.status>399)throw new Error(i.statusText);if(r)return i.text();const n=await i.arrayBuffer();return new DataView(n)}catch(i){if(r||t==="dbf")return!1;throw i}}function Ng(e){let t=0,s=1;const r=e.length;let i,n;const a=[e[0][0],e[0][1],e[0][0],e[0][1]];for(;s<r;)i=n||e[0],n=e[s],t+=(n[0]-i[0])*(n[1]+i[1]),s++,n[0]<a[0]&&(a[0]=n[0]),n[1]<a[1]&&(a[1]=n[1]),n[0]>a[2]&&(a[2]=n[0]),n[1]>a[3]&&(a[3]=n[1]);return{ring:e,clockWise:t>0,bbox:a,children:[]}}function Ig(e,t){return!(e.bbox[0]>t.bbox[0]||e.bbox[1]>t.bbox[1]||e.bbox[2]<t.bbox[2]||e.bbox[3]<t.bbox[3])}function Cg(e){const t=[],s=[];for(const i of e){const n=Ng(i);n.clockWise?t.push(n):s.push(n)}for(const i of s)for(const n of t)if(Ig(n,i)){n.children.push(i.ring);break}const r=[];for(const i of t)r.push([i.ring].concat(i.children));return r}X.prototype.parsePoint=function(e){return{type:"Point",coordinates:this.parseCoord(e,0)}};X.prototype.parseZPoint=function(e){const t=this.parsePoint(e);return t.coordinates.push(e.getFloat64(16,!0)),t};X.prototype.parsePointArray=function(e,t,s){const r=[];let i=0;for(;i<s;)r.push(this.parseCoord(e,t)),t+=16,i++;return r};X.prototype.parseZPointArray=function(e,t,s,r){let i=0;for(;i<s;)r[i].push(e.getFloat64(t,!0)),i++,t+=8;return r};X.prototype.parseArrayGroup=function(e,t,s,r,i){const n=[];let a=0,o,c=0,h;for(;a<r;)a++,s+=4,o=c,a===r?c=i:c=e.getInt32(s,!0),h=c-o,h&&(n.push(this.parsePointArray(e,t,h)),t+=h<<4);return n};X.prototype.parseZArrayGroup=function(e,t,s,r){let i=0;for(;i<s;)r[i]=this.parseZPointArray(e,t,r[i].length,r[i]),t+=r[i].length<<3,i++;return r};X.prototype.parseMultiPoint=function(e){const t={},s=e.getInt32(32,!0);if(!s)return null;const r=this.parseCoord(e,0),i=this.parseCoord(e,16);t.bbox=[r[0],r[1],i[0],i[1]];const n=36;return s===1?(t.type="Point",t.coordinates=this.parseCoord(e,n)):(t.type="MultiPoint",t.coordinates=this.parsePointArray(e,n,s)),t};X.prototype.parseZMultiPoint=function(e){const t=this.parseMultiPoint(e);if(!t)return null;let s;if(t.type==="Point")return t.coordinates.push(e.getFloat64(72,!0)),t;s=t.coordinates.length;const r=52+(s<<4);return t.coordinates=this.parseZPointArray(e,r,s,t.coordinates),t};X.prototype.parsePolyline=function(e){const t={},s=e.getInt32(32,!0);if(!s)return null;const r=this.parseCoord(e,0),i=this.parseCoord(e,16);t.bbox=[r[0],r[1],i[0],i[1]];const n=e.getInt32(36,!0);let a,o;return s===1?(t.type="LineString",a=44,t.coordinates=this.parsePointArray(e,a,n)):(t.type="MultiLineString",a=40+(s<<2),o=40,t.coordinates=this.parseArrayGroup(e,a,o,s,n)),t};X.prototype.parseZPolyline=function(e){const t=this.parsePolyline(e);if(!t)return null;const s=t.coordinates.length;let r;return t.type==="LineString"?(r=60+(s<<4),t.coordinates=this.parseZPointArray(e,r,s,t.coordinates),t):(r=56+(t.coordinates.reduce(function(n,a){return n+a.length},0)<<4)+(s<<2),t.coordinates=this.parseZArrayGroup(e,r,s,t.coordinates),t)};X.prototype.polyFuncs=function(e){return e&&(e.type==="LineString"?(e.type="Polygon",e.coordinates=[e.coordinates],e):(e.coordinates=Cg(e.coordinates),e.coordinates.length===1?(e.type="Polygon",e.coordinates=e.coordinates[0],e):(e.type="MultiPolygon",e)))};X.prototype.parsePolygon=function(e){return this.polyFuncs(this.parsePolyline(e))};X.prototype.parseZPolygon=function(e){return this.polyFuncs(this.parseZPolyline(e))};const en={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function Ag(e){return e?function(t,s){const r=[t.getFloat64(s,!0),t.getFloat64(s+8,!0)];return e.inverse(r)}:function(t,s){return[t.getFloat64(s,!0),t.getFloat64(s+8,!0)]}}function X(e,t){if(!(this instanceof X))return new X(e,t);this.buffer=e,this.headers=this.parseHeader(),this.shpFuncs(t),this.rows=this.getRows()}X.prototype.shpFuncs=function(e){let t=this.headers.shpCode;if(t>20&&(t-=20),!(t in en))throw new Error(`I don't know shp type "${t}"`);this.parseFunc=this[en[t]],this.parseCoord=Ag(e)};X.prototype.getShpCode=function(){return this.parseHeader().shpCode};X.prototype.parseHeader=function(){const e=this.buffer;return{length:e.getInt32(24)<<1,version:e.getInt32(28,!0),shpCode:e.getInt32(32,!0),bbox:[e.getFloat64(36,!0),e.getFloat64(44,!0),e.getFloat64(52,!0),e.getFloat64(60,!0)]}};X.prototype.getRows=function(){let e=100;const t=this.buffer.byteLength-8,s=[];let r;for(;e<=t&&(r=this.getRow(e),!!r);)e+=8,e+=r.len,r.type?s.push(this.parseFunc(r.data)):s.push(null);return s};X.prototype.getRow=function(e){const t=this.buffer.getInt32(e),s=this.buffer.getInt32(e+4)<<1;if(s===0)return{id:t,len:s,type:0};if(!(e+s+8>this.buffer.byteLength))return{id:t,len:s,data:new DataView(this.buffer.buffer,this.buffer.byteOffset+e+12,s-4),type:this.buffer.getInt32(e+8,!0)}};function Gr(e,t){return new X(e,t).rows}var jg=/^(?:ANSI\s)?(\d+)$/m;function ka(e,t){if(!e)return r;try{new TextDecoder(e.trim())}catch{var s=jg.exec(e);return s&&!t?ka("windows-"+s[1],!0):(e=void 0,r)}return r;function r(i){var n=new TextDecoder(e||void 0),a=n.decode(i,{stream:!0})+n.decode();return a.replace(/\0/g,"").trim()}}function kg(e){var t={};return t.lastUpdated=new Date(e.getUint8(1)+1900,e.getUint8(2),e.getUint8(3)),t.records=e.getUint32(4,!0),t.headerLen=e.getUint16(8,!0),t.recLen=e.getUint16(10,!0),t}function Pg(e,t,s){for(var r=[],i=32;i<t&&(r.push({name:s(new Uint8Array(e.buffer.slice(e.byteOffset+i,e.byteOffset+i+11))),dataType:String.fromCharCode(e.getUint8(i+11)),len:e.getUint8(i+16),decimal:e.getUint8(i+17)}),e.getUint8(i+32)!==13);)i+=32;return r}function Tg(e,t,s,r,i){const n=new Uint8Array(e.buffer.slice(e.byteOffset+t,e.byteOffset+t+s));var a=i(n);switch(r){case"N":case"F":case"O":return parseFloat(a,10);case"D":return new Date(a.slice(0,4),parseInt(a.slice(4,6),10)-1,a.slice(6,8));case"L":return a.toLowerCase()==="y"||a.toLowerCase()==="t";default:return a}}function Rg(e,t,s,r){for(var i={},n=0,a=s.length,o,c;n<a;)c=s[n],o=Tg(e,t,c.len,c.dataType,r),t+=c.len,typeof o<"u"&&(i[c.name]=o),n++;return i}function zr(e,t){for(var s=ka(t),r=kg(e),i=Pg(e,r.headerLen-1,s),n=(i.length+1<<5)+2,a=r.recLen,o=r.records,c=[];o;)c.push(Rg(e,n,i,s)),n+=a,o--;return c}const Og=globalThis.URL,Lg=e=>{if(!e)throw new Error("forgot to pass buffer");if(ft(e))return new Uint8Array(e);if(ft(e.buffer))return e.BYTES_PER_ELEMENT===1?e:new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")},Dg=new TextDecoder,Pa=e=>{if(e){if(typeof e=="string")return e;if(ft(e)||ArrayBuffer.isView(e)||Hr(e))return Dg.decode(e)}},Ta=e=>{if(!e)throw new Error("forgot to pass buffer");if(Hr(e))return e;if(ft(e))return new DataView(e);if(ft(e.buffer))return new DataView(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")};function ft(e){return e instanceof globalThis.ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]"}function Hr(e){return e instanceof globalThis.DataView||Object.prototype.toString.call(e)==="[object DataView]"}const qr=function([e,t]){const s={};s.type="FeatureCollection",s.features=[];let r=0;const i=e.length;for(t||(t=[]);r<i;)s.features.push({type:"Feature",geometry:e[r],properties:t[r]||{}}),r++;return s},Ra=async function(e,t){let s;e=Lg(e);const r=await _g(e),i=[];t=t||[];for(s in r)s.indexOf("__MACOSX")===-1&&(s.slice(-4).toLowerCase()===".shp"?(i.push(s.slice(0,-4)),r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=r[s]):s.slice(-4).toLowerCase()===".prj"?r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=re(r[s]):s.slice(-5).toLowerCase()===".json"||t.indexOf(s.split(".").pop())>-1?i.push(s.slice(0,-3)+s.slice(-3).toLowerCase()):(s.slice(-4).toLowerCase()===".dbf"||s.slice(-4).toLowerCase()===".cpg")&&(r[s.slice(0,-3)+s.slice(-3).toLowerCase()]=r[s]));if(!i.length)throw new Error("no layers founds");const n=i.map(function(a){let o,c;const h=a.lastIndexOf(".");return h>-1&&a.slice(h).indexOf("json")>-1?(o=JSON.parse(r[a]),o.fileName=a.slice(0,h)):t.indexOf(a.slice(h+1))>-1?(o=r[a],o.fileName=a):(r[a+".dbf"]&&(c=zr(r[a+".dbf"],r[a+".cpg"])),o=qr([Gr(r[a+".shp"],r[a+".prj"]),c]),o.fileName=a),o});return n.length===1?n[0]:n};async function $g(e,t){const s=await Ut(e);return Ra(s,t)}const Fg=async e=>{const t=await Promise.all([Ut(e,"shp"),Ut(e,"prj")]);let s=!1;try{t[1]&&(s=re(t[1]))}catch{s=!1}return Gr(t[0],s)},Bg=async e=>{const[t,s]=await Promise.all([Ut(e,"dbf"),Ut(e,"cpg")]);if(t)return zr(t,s)},tn=(e,t)=>{var r;return new Og(e,(r=globalThis==null?void 0:globalThis.document)==null?void 0:r.location).pathname.slice(-4).toLowerCase()===t},Ug=({shp:e,dbf:t,cpg:s,prj:r})=>{const i=[Gg(e,r)];return t&&i.push(zg(t,s)),qr(i)},Vg=async function(e,t){if(typeof e!="string"){if(ft(e)||ArrayBuffer.isView(e)||Hr(e))return Ra(e);if(e.shp)return Ug(e);throw new TypeError("must be a string, some sort of Buffer, or an object with at least a .shp property")}if(tn(e,".zip"))return $g(e,t);tn(e,".shp")&&(e=e.slice(0,-4));const s=await Promise.all([Fg(e),Bg(e)]);return qr(s)},Gg=function(e,t){if(e=Ta(e),t=Pa(t),typeof t=="string")try{t=re(t)}catch{t=!1}return Gr(e,t)},zg=function(e,t){return e=Ta(e),t=Pa(t),zr(e,t)},sn=50*1024*1024,Hg=["application/zip","application/x-zip-compressed"];function qg(e){if(!e)throw new Error("No file provided");if(e.size>sn)throw new Error(`File size exceeds maximum limit of ${sn/(1024*1024)}MB`);if(!Hg.includes(e.type))throw new Error("Invalid file type. Please upload a ZIP file containing shapefile components.")}function rn(e){if(!Array.isArray(e)||e.length<2)return!1;const[t,s]=e;return typeof t=="number"&&typeof s=="number"&&t>=-180&&t<=180&&s>=-90&&s<=90}function Wg(e){if(!e||typeof e!="object")throw new Error("Invalid GeoJSON: not an object");if(e.type!=="FeatureCollection")throw new Error("Invalid GeoJSON: not a FeatureCollection");if(!Array.isArray(e.features))throw new Error("Invalid GeoJSON: features is not an array");if(e.features.length===0)throw new Error("Invalid GeoJSON: no features found");e.features.forEach((t,s)=>{if(!t.geometry)throw new Error(`Invalid feature at index ${s}: no geometry`);if(t.geometry.type!=="LineString"&&t.geometry.type!=="MultiLineString")throw new Error(`Invalid feature at index ${s}: geometry must be LineString or MultiLineString`);t.geometry.type==="LineString"?t.geometry.coordinates.forEach((r,i)=>{if(!rn(r))throw new Error(`Invalid coordinate at index ${i} in feature ${s}`)}):t.geometry.coordinates.forEach((r,i)=>{r.forEach((n,a)=>{if(!rn(n))throw new Error(`Invalid coordinate at index ${a} in line ${i} of feature ${s}`)})})})}async function Jg(e){try{qg(e);const t=await e.arrayBuffer(),s=await Vg(t),r=Array.isArray(s)?s[0]:s;return Wg(r),{geoJSON:Kg(r)}}catch(t){throw console.error("Error processing shapefile:",t),new Error(t instanceof Error?t.message:"Failed to process shapefile")}}function Kg(e){return{type:"FeatureCollection",features:e.features.map(s=>({...s,properties:{...s.properties||{},_id:void 0,id:void 0,...Object.fromEntries(Object.entries(s.properties||{}).filter(([r])=>!r.startsWith("_")&&!r.includes("password")&&!r.includes("secret")))}}))}}const gr=(e,t)=>t.some(s=>e instanceof s);let nn,an;function Xg(){return nn||(nn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qg(){return an||(an=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pr=new WeakMap,Zs=new WeakMap,Ts=new WeakMap;function Zg(e){const t=new Promise((s,r)=>{const i=()=>{e.removeEventListener("success",n),e.removeEventListener("error",a)},n=()=>{s(qe(e.result)),i()},a=()=>{r(e.error),i()};e.addEventListener("success",n),e.addEventListener("error",a)});return Ts.set(t,e),t}function Yg(e){if(pr.has(e))return;const t=new Promise((s,r)=>{const i=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",a),e.removeEventListener("abort",a)},n=()=>{s(),i()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",n),e.addEventListener("error",a),e.addEventListener("abort",a)});pr.set(e,t)}let vr={get(e,t,s){if(e instanceof IDBTransaction){if(t==="done")return pr.get(e);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return qe(e[t])},set(e,t,s){return e[t]=s,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Oa(e){vr=e(vr)}function ep(e){return Qg().includes(e)?function(...t){return e.apply(yr(this),t),qe(this.request)}:function(...t){return qe(e.apply(yr(this),t))}}function tp(e){return typeof e=="function"?ep(e):(e instanceof IDBTransaction&&Yg(e),gr(e,Xg())?new Proxy(e,vr):e)}function qe(e){if(e instanceof IDBRequest)return Zg(e);if(Zs.has(e))return Zs.get(e);const t=tp(e);return t!==e&&(Zs.set(e,t),Ts.set(t,e)),t}const yr=e=>Ts.get(e);function sp(e,t,{blocked:s,upgrade:r,blocking:i,terminated:n}={}){const a=indexedDB.open(e,t),o=qe(a);return r&&a.addEventListener("upgradeneeded",c=>{r(qe(a.result),c.oldVersion,c.newVersion,qe(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),o.then(c=>{n&&c.addEventListener("close",()=>n()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),o}const rp=["get","getKey","getAll","getAllKeys","count"],ip=["put","add","delete","clear"],Ys=new Map;function on(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Ys.get(t))return Ys.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,i=ip.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||rp.includes(s)))return;const n=async function(a,...o){const c=this.transaction(a,i?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(o.shift())),(await Promise.all([h[s](...o),i&&c.done]))[0]};return Ys.set(t,n),n}Oa(e=>({...e,get:(t,s,r)=>on(t,s)||e.get(t,s,r),has:(t,s)=>!!on(t,s)||e.has(t,s)}));const np=["continue","continuePrimaryKey","advance"],ln={},xr=new WeakMap,La=new WeakMap,ap={get(e,t){if(!np.includes(t))return e[t];let s=ln[t];return s||(s=ln[t]=function(...r){xr.set(this,La.get(this)[t](...r))}),s}};async function*op(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const s=new Proxy(t,ap);for(La.set(s,t),Ts.set(s,yr(t));t;)yield s,t=await(xr.get(s)||t.continue()),xr.delete(s)}function cn(e,t){return t===Symbol.asyncIterator&&gr(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&gr(e,[IDBIndex,IDBObjectStore])}Oa(e=>({...e,get(t,s,r){return cn(t,s)?op:e.get(t,s,r)},has(t,s){return cn(t,s)||e.has(t,s)}}));const lp="shorelineDB",cp=1,Xe="shorelineData";class hp{constructor(){$s(this,"db",null)}async initialize(){try{this.db=await sp(lp,cp,{upgrade(t){t.objectStoreNames.contains(Xe)||t.createObjectStore(Xe,{keyPath:"id"})}})}catch(t){throw console.error("Failed to initialize IndexedDB:",t),new Error("Failed to initialize database storage. Please try again.")}}async storeShorelineData(t,s){this.db||await this.initialize();try{const r={id:t,data:s,timestamp:Date.now()};await this.db.put(Xe,r)}catch(r){throw console.error("Failed to store shoreline data:",r),r instanceof Error&&r.name==="QuotaExceededError"?new Error("Storage quota exceeded. Please try with a smaller file or clear some space."):new Error("Failed to store shoreline data. Please try again.")}}async getShorelineData(t){this.db||await this.initialize();try{const s=await this.db.get(Xe,t);return s?s.data:null}catch(s){throw console.error("Failed to retrieve shoreline data:",s),new Error("Failed to retrieve shoreline data. Please try again.")}}async deleteShorelineData(t){this.db||await this.initialize();try{await this.db.delete(Xe,t)}catch(s){throw console.error("Failed to delete shoreline data:",s),new Error("Failed to delete shoreline data. Please try again.")}}async clearAllData(){this.db||await this.initialize();try{await this.db.clear(Xe)}catch(t){throw console.error("Failed to clear shoreline data:",t),new Error("Failed to clear shoreline data. Please try again.")}}}const ce=new hp,hn=e=>{if(e==null||isNaN(e))return"#808080";const t=Math.round(e);return t<=1?"#1a9850":t===2?"#91cf60":t===3?"#fee08b":t===4?"#fc8d59":t>=5?"#d73027":"#808080"};function up(e,t,s,r,i,n="parameter"){var v,y;const a=(v=e.properties)==null?void 0:v.id,o=a?r.includes(a):!1,c=(y=e.properties)==null?void 0:y.vulnerabilityIndex;if(n==="cvi"){const p=hn(c);return{color:o?"#0ea5e9":p,weight:o?5:3,opacity:o?1:.8,fillOpacity:o?.4:.2}}const h=a?t.find(p=>p.id===a):null,d=i?s.find(p=>p.id===i):null;if(!i||!d||!(h!=null&&h.parameters))return{color:o?"#FF4500":"#3388ff",weight:o?5:3,opacity:1};const u=h.parameters[i];if(!u)return{color:o?"#FF4500":"#808080",weight:o?5:2,opacity:o?1:.6,dashArray:"5,5"};let f="#3388ff";const m=u.vulnerability;if(d.type==="categorical"&&d.options){const p=d.options.find(_=>_.value===u.value);f=(p==null?void 0:p.color)||hn(m)}else if(d.type==="numerical"&&d.vulnerabilityRanges){const p=d.vulnerabilityRanges.find(_=>_.value===m);f=(p==null?void 0:p.color)||"#808080"}return{color:o?"#FF4500":f,weight:o?5:3,opacity:1}}const vt=({segments:e,parameters:t,selectedSegments:s,selectedParameter:r,selectionPolygons:i,onSegmentSelect:n,onSelectionDelete:a,onAreaSelect:o,isEditing:c,initialBounds:h,geoJSON:d,zoomToFeatureId:u,stylingMode:f="parameter"})=>{const m=g.useRef(null),v=g.useRef(null),y=g.useRef(null),p=g.useRef(null),[_,x]=g.useState(!1),w=g.useCallback((E,b)=>{if(E.properties&&E.properties.id){const M=E.properties.id;if(console.log("Map: Segment clicked:",M),n(M),m.current&&b instanceof J.Path){const S=E.properties||{};let I=`<b>Segment ID:</b> ${S.id}`;S.cviScore!==void 0&&(I+=`<br/><b>CVI Score:</b> ${S.cviScore.toFixed(2)}`,I+=`<br/><b>Category:</b> ${S.cviCategory}`),S.length!==void 0&&(I+=`<br/><b>Length:</b> ${S.length.toFixed(2)}m`),b.bindPopup(I).openPopup()}}},[n]);return g.useEffect(()=>{if(console.log("Map Effect 1: Initializing map instance..."),m.current||typeof window>"u")return;const E=document.getElementById("map");if(!E){console.error("Map container 'map' not found");return}E._leaflet_id&&(console.warn("Map container already had a Leaflet ID. Clearing it."),E._leaflet_id=null);try{const b=J.map("map",{center:[20,0],zoom:2,zoomControl:!0});m.current=b,J.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(b);const M=new J.FeatureGroup;b.addLayer(M),p.current=M,x(!0),console.log("Map Effect 1: Map instance created.")}catch(b){console.error("Map Effect 1: Error initializing map:",b)}return()=>{console.log("Map Effect 1: Cleaning up map instance."),m.current&&(m.current.remove(),m.current=null),p.current=null,y.current=null,x(!1)}},[]),g.useEffect(()=>{const E=m.current;if(!E||!_){console.log("Map Effect 2: Skipping data layer update (map not ready).");return}if(y.current&&(E.removeLayer(y.current),y.current=null,console.log("Map Effect 2: Removed existing segments layer.")),d&&d.features&&d.features.length>0){console.log(`Map Effect 2: Creating GeoJSON layer with ${d.features.length} features (Styling: ${f}).`);const b=J.geoJSON(d,{style:M=>M?up(M,e,t,s,r,f):{color:"#808080",weight:1},onEachFeature:(M,S)=>{S.on({mouseover:R=>{var $;const k=R.target,D=($=M.properties)==null?void 0:$.id;D&&!s.includes(D)&&k instanceof J.Path&&(k.setStyle({weight:5}),k.bringToFront())},mouseout:R=>{var $;const k=R.target,D=($=M.properties)==null?void 0:$.id;D&&!s.includes(D)&&y.current&&k instanceof J.Path&&y.current.resetStyle(k)},click:()=>w(M,S)});const I=M.properties||{};let C=`ID: ${I.id}`;I.cviScore!==void 0&&(C+=` | CVI: ${I.cviScore.toFixed(2)}`),S.bindTooltip(C,{sticky:!0})}}).addTo(E);y.current=b,console.log("Map Effect 2: Added new segments layer.")}else console.log("Map Effect 2: No features in geoJSON to display.")},[d,e,t,s,r,f,w,_]),g.useEffect(()=>{const E=m.current;if(!E||!_){console.log("Map Effect 3: Skipping bounds fitting (map not ready).");return}if(u&&y.current){console.log("Map Effect 3: Skipping general bounds fitting because zoomToFeatureId is active.");return}let b=null;if(h)try{const M=h instanceof J.LatLngBounds?h:J.latLngBounds(h);M.isValid()?(b=M,console.log("Map Effect 3: Using provided initialBounds",b.toBBoxString())):console.warn("Map Effect 3: Provided initialBounds are invalid.")}catch(M){console.error("Map Effect 3: Error processing provided initialBounds:",M)}if(!b&&d&&d.features&&d.features.length>0){console.log("Map Effect 3: Calculating bounds from geoJSON data.");try{const M=d.features.filter(S=>S&&S.geometry);if(M.length>0){const S=Ns(M),I=Vt(S);I&&I.length===4&&I.every(C=>isFinite(C))&&I[0]<=I[2]&&I[1]<=I[3]?(b=J.latLngBounds([[I[1],I[0]],[I[3],I[2]]]),console.log("Map Effect 3: Calculated bounds from geoJSON",b.toBBoxString())):console.warn("Map Effect 3: Calculated bbox is invalid.",I)}else console.log("Map Effect 3: No valid features found in geoJSON for bounds calculation.")}catch(M){console.error("Map Effect 3: Error calculating bounds from geoJSON:",M)}}b&&b.isValid()?(console.log("Map Effect 3: Fitting map to bounds:",b.toBBoxString()),setTimeout(()=>{E.fitBounds(b,{padding:[50,50],maxZoom:18})},100)):h||(console.warn("Map Effect 3: No valid bounds found to fit. Resetting to default view."),E.setView([20,0],2))},[d,h,_,u]),g.useEffect(()=>{const E=m.current,b=y.current;if(!E||!b||!u||!_)return;console.log(`Map Effect 4: Attempting to zoom to feature ID: ${u}`);let M=null;if(b.eachLayer(S=>{var C;const I=S.feature;((C=I==null?void 0:I.properties)==null?void 0:C.id)===u&&(M=S)}),M&&typeof M.getBounds=="function"){const S=M.getBounds();S.isValid()?(console.log(`Map Effect 4: Found feature ${u}, flying to bounds:`,S.toBBoxString()),E.flyToBounds(S,{padding:[100,100],maxZoom:18,duration:1})):console.warn(`Map Effect 4: Feature ${u} found, but its bounds are invalid.`)}else console.warn(`Map Effect 4: Feature with ID ${u} not found in the segments layer or has no bounds.`)},[u,_]),g.useEffect(()=>{const E=m.current,b=p.current;if(!E||!b||!_){console.log("Map Effect 5: Skipping draw control setup (map not ready).");return}if(console.log(`Map Effect 5: Setting up draw controls (isEditing: ${c}).`),v.current){console.log("Map Effect 5: Removing previous draw control.");try{E.removeControl(v.current)}catch(M){console.warn("Minor error removing old draw control",M)}v.current=null}if(E.off(J.Draw.Event.CREATED),E.off(J.Draw.Event.DELETED),E.off(J.Draw.Event.DRAWSTART),E.off(J.Draw.Event.DRAWSTOP),c){console.log("Map Effect 5: Adding Leaflet Draw controls.");const M=new J.Control.Draw({draw:{polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1,polygon:{allowIntersection:!1,showArea:!1,shapeOptions:{color:"#007bff",weight:2,opacity:.7,fillOpacity:.1}}},edit:{featureGroup:b,remove:!0}});E.addControl(M),v.current=M,E.on(J.Draw.Event.DRAWSTART,S=>{console.log(`Draw Event: START (${S.layerType})`),b.clearLayers()}),E.on(J.Draw.Event.CREATED,S=>{const I=S.layer,C=S.layerType;if(console.log(`Draw Event: CREATED (${C})`),C==="polygon")try{const R=I;if(typeof R.toGeoJSON=="function"){const k=R.toGeoJSON();if(k.geometry&&k.geometry.type==="Polygon"){const D=k.geometry;console.log("Map: Passing geometry to onAreaSelect:",JSON.stringify(D)),o(D),setTimeout(()=>{try{E.hasLayer(I)&&(E.removeLayer(I),console.log("Map: Removed temporary drawing layer after CREATED event."))}catch($){console.warn("Map: Error removing temporary drawing layer:",$)}},0)}else console.error("Map: Created layer is not a valid Polygon GeoJSON",k)}else console.error("Map: Created layer does not have toGeoJSON method.")}catch(R){console.error("Map: Error processing created geometry:",R)}else setTimeout(()=>E.removeLayer(I),0)}),E.on(J.Draw.Event.DELETED,S=>{console.log("Draw Event: DELETED (Selection shape removed by user)")}),E.on(J.Draw.Event.DRAWSTOP,S=>{console.log("Draw Event: STOP")})}else console.log("Map Effect 5: Editing disabled, draw controls not added.");return()=>{if(console.log("Map Effect 5: Cleaning up draw controls and listeners."),m.current&&v.current){try{m.current.removeControl(v.current)}catch(M){console.warn("Minor error removing draw control on effect cleanup",M)}v.current=null}m.current&&(m.current.off(J.Draw.Event.CREATED),m.current.off(J.Draw.Event.DELETED),m.current.off(J.Draw.Event.DRAWSTART),m.current.off(J.Draw.Event.DRAWSTOP))}},[c,o,a,_]),l.jsx("div",{id:"map",style:{height:"100%",width:"100%",minHeight:"400px"}})};vt.displayName="MapComponent";const mt=({message:e,onClose:t})=>e?l.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[l.jsx("strong",{className:"font-bold",children:"Error: "}),l.jsx("span",{className:"block sm:inline",children:e}),l.jsx("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:t,children:l.jsxs("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:[l.jsx("title",{children:"Close"}),l.jsx("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]}):null;function dp(){const e=$e(),[t,s]=g.useState(null),[r,i]=g.useState(!1),[n,a]=g.useState(null),[o,c]=g.useState(null),[h,d]=g.useState(!1),u=g.useCallback(async x=>{if(x){a(null),i(!0),s(null),c(null);try{const w=await Jg(x);s(w.geoJSON),c(x.name),console.log("Shapefile processed successfully.")}catch(w){const E=w instanceof Error?w.message:"Failed to process shapefile. Ensure it is a valid ZIP containing required .shp, .shx, and .dbf files.";a(E),console.error("Error processing shapefile:",w)}finally{i(!1)}}},[]),f=x=>{var w;u(((w=x.target.files)==null?void 0:w[0])??null),x.target.value=""},m=g.useCallback(x=>{x.preventDefault(),x.stopPropagation(),d(!1),x.dataTransfer.files&&x.dataTransfer.files.length>0&&(u(x.dataTransfer.files[0]),x.dataTransfer.clearData())},[u]),v=g.useCallback(x=>{x.preventDefault(),x.stopPropagation(),d(!0)},[]),y=g.useCallback(x=>{x.preventDefault(),x.stopPropagation(),d(!1)},[]),p=()=>{s(null),c(null),a(null)},_=async()=>{if(t){i(!0),a(null);try{await ce.storeShorelineData("current-shoreline",t),console.log("Shoreline data stored in IndexedDB."),e("/segmentation")}catch(x){const w=x instanceof Error?x.message:"Failed to save shoreline data. Please try again.";a(w),console.error("Error storing shoreline data:",x),i(!1)}}};return l.jsxs("div",{className:"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-10",children:[l.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"1. Upload Shoreline Data"}),l.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Begin by uploading your shoreline data as a zipped Shapefile (.zip)."})]}),l.jsx(mt,{message:n,onClose:()=>a(null)}),l.jsxs("div",{className:"mt-6 mb-8 bg-white p-8 rounded-lg shadow-md border border-gray-200",children:[!o&&!r&&l.jsxs("div",{onDrop:m,onDragOver:v,onDragLeave:y,className:`relative block w-full rounded-lg border-2 ${h?"border-primary-500 bg-primary-50":"border-dashed border-gray-300"} p-12 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-colors duration-200`,children:[l.jsx("input",{type:"file",id:"shapefile",accept:".zip,application/zip,application/x-zip-compressed",onChange:f,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:r}),l.jsx(Zh,{className:"mx-auto h-12 w-12 text-gray-400"}),l.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Drag & drop your zipped shapefile here"}),l.jsx("span",{className:"block text-xs text-gray-500",children:"or click to browse files"}),l.jsx("span",{className:"mt-4 block text-xs text-gray-500",children:"Must be a .zip containing .shp, .shx, and .dbf files. Max 50MB."})]}),r&&l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),l.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Processing file..."}),l.jsx("p",{className:"text-xs text-gray-500",children:"This may take a moment for larger files."})]}),!r&&o&&t&&l.jsxs("div",{className:"text-center py-8 px-4 bg-green-50 border border-green-200 rounded-lg",children:[l.jsx(Or,{className:"mx-auto h-12 w-12 text-green-500 mb-3"}),l.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"File processed successfully!"}),l.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-600 mb-4",children:[l.jsx(cu,{className:"w-4 h-4 mr-1.5 flex-shrink-0"}),l.jsx("span",{className:"truncate max-w-xs",children:o})]}),l.jsxs("button",{onClick:p,className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500",children:[l.jsx(Eu,{className:"w-4 h-4 mr-1.5 text-gray-500"}),"Remove and Upload New File"]})]})]}),t&&!r&&l.jsxs("div",{className:"mb-8",children:[l.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Shoreline Preview"}),l.jsx("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden h-96",children:l.jsx(vt,{geoJSON:t,segments:[],parameters:[],selectedParameter:null,selectedSegments:[],selectionPolygons:[],onSegmentSelect:()=>{},onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1})})]}),l.jsx("div",{className:"text-center",children:l.jsx("button",{onClick:_,disabled:r||!t,className:"inline-flex items-center justify-center bg-primary-600 text-white font-semibold px-8 py-3 text-base rounded-lg shadow-md hover:bg-primary-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",title:t?"Proceed to segment the shoreline":"Upload a shapefile first",children:r&&!t?"Processing...":r&&t?"Saving...":"Continue to Segmentation"})})]})}function fp(e,t){const s=[];let r=1;return e.features.forEach(i=>{(i.geometry.type==="MultiLineString"?i.geometry.coordinates.map(a=>Zr(a)):[Zr(i.geometry.coordinates)]).forEach((a,o)=>{const c=Tt(a,{units:"meters"}),h=Math.ceil(c/t),d=c/h;for(let u=0;u<h;u++){const f=u*d,m=Math.min((u+1)*d,c),v=Xa(a,f,m,{units:"meters"}),y=Tt(v,{units:"meters"});s.push({type:"Feature",id:`segment-${r++}`,geometry:v.geometry,properties:{id:`segment-${r}`,index:u,lineIndex:o,length:y,values:{}},parameters:{}})}})}),s}function mp(){const e=$e(),[t,s]=g.useState(null),[r,i]=g.useState(""),[n,a]=g.useState([]),[o,c]=g.useState(null),[h,d]=g.useState(0),[u,f]=g.useState(0),[m,v]=g.useState(!0),[y,p]=g.useState(!1),[_,x]=g.useState(null),[w,E]=g.useState(!1);g.useEffect(()=>{(async()=>{v(!0),x(null);try{const $=await ce.getShorelineData("current-shoreline");if(!$){x("No shoreline data found. Please upload a shapefile first."),e("/shoreline");return}if($.features.every(oe=>oe.geometry.type==="LineString"||oe.geometry.type==="MultiLineString")){const oe=$;s(oe);let P=0;if(oe.features.forEach(F=>{try{P+=Tt(un(F.geometry),{units:"kilometers"})}catch(z){console.warn("Error calculating length for a feature:",z)}}),d(P),oe.features.length>0)try{const F=Vt(oe);if(F&&F.length===4&&F.every(z=>isFinite(z))&&F[0]<=F[2]&&F[1]<=F[3]){const z=[[F[1],F[0]],[F[3],F[2]]];c(z)}else console.warn("SegmentationPage: Could not calculate valid initial bounds.")}catch(F){console.error("SegmentationPage: Error calculating initial bounds:",F)}}else throw new Error("Invalid geometry type found in shoreline data. Only LineString or MultiLineString are supported.")}catch(D){console.error("Error loading shoreline data:",D),x(`Failed to load shoreline data: ${D instanceof Error?D.message:String(D)}`)}finally{v(!1)}})()},[e]),g.useEffect(()=>{typeof r=="number"&&r>0&&h>0?f(Math.ceil(h*1e3/r)):f(0)},[r,h]);const b=g.useCallback(k=>{const D=k.target.value,$=D===""?"":Number(D);i($),x(null),E(!1),a([])},[]),M=g.useCallback(()=>{if(!r||r<=0){x("Resolution must be a positive number (meters).");return}if(!t){x("Original shoreline data is not loaded.");return}u>1e4&&!confirm(`This resolution will generate approximately ${u} segments, which might be slow to preview and process. Continue preview?`)||(p(!0),x(null),a([]),E(!1),setTimeout(()=>{try{console.time("Segmentation Calculation");const k=fp(t,r);console.timeEnd("Segmentation Calculation"),a(k),E(!0),console.log(`Generated ${k.length} segments for preview.`)}catch(k){x(k instanceof Error?k.message:"Failed to generate segment preview."),console.error("Segmentation preview error:",k)}finally{p(!1)}},10))},[t,r,u]),S=g.useCallback(async()=>{if(!w||n.length===0){x("Please generate and preview the segmentation first using the 'Preview Segmentation' button.");return}if(!(u>1e4&&!confirm(`Confirming segmentation with approximately ${u} segments. This might take time to process in the next steps. Continue?`))){p(!0),x(null);try{await ce.storeShorelineData("current-segments",{type:"FeatureCollection",features:n.map(k=>({type:"Feature",geometry:k.geometry,properties:k.properties}))}),console.log("Confirmed segments stored in IndexedDB."),e("/segment-table")}catch(k){console.error("Error storing segments:",k),x(`Failed to save segments: ${k instanceof Error?k.message:String(k)}`)}finally{p(!1)}}},[w,n,e,u]),I=g.useCallback(()=>{e("/shoreline")},[e]),C=g.useMemo(()=>w&&n.length>0?{type:"FeatureCollection",features:n.map(k=>({type:"Feature",geometry:k.geometry,properties:{...k.properties,id:k.id}}))}:t,[t,n,w]),R=g.useMemo(()=>w?"parameter":void 0,[w]);return m?l.jsxs("div",{className:"flex items-center justify-center h-screen",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),l.jsx("p",{className:"ml-4 text-gray-600",children:"Loading shoreline data..."})]}):l.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-10",children:[l.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"2. Segment Shoreline"}),l.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Define the resolution to divide the shoreline into analysis segments."})]}),l.jsx(mt,{message:_,onClose:()=>x(null)}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:[l.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[" ",l.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[l.jsx(iu,{className:"h-6 w-6 mr-2 text-primary-700"})," Segmentation Settings"]}),l.jsxs("div",{className:"bg-white p-6 sm:p-8 rounded-lg shadow-md border border-gray-200 space-y-6",children:[" ",l.jsxs("div",{className:"flex items-center text-sm text-gray-600 border-b border-gray-200 pb-4",children:[l.jsx(yu,{className:"h-5 w-5 mr-2 text-primary-600 flex-shrink-0"}),l.jsxs("span",{children:["Total Shoreline Length: ",l.jsxs("span",{className:"font-medium text-gray-800",children:[h.toFixed(2)," km"]})]})]}),l.jsxs("div",{children:[" ",l.jsx("label",{htmlFor:"resolution",className:"block text-sm font-medium text-gray-700",children:"Segment Resolution"}),l.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[l.jsx("input",{type:"number",name:"resolution",id:"resolution",placeholder:"e.g., 100",value:r,onChange:b,className:"block w-full pr-16 rounded-md border-gray-300 focus:border-primary-500 focus:ring-primary-500 sm:text-sm disabled:bg-gray-100",disabled:y,"aria-describedby":"resolution-unit"}),l.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:l.jsx("span",{className:"text-gray-500 sm:text-sm",id:"resolution-unit",children:"meters"})})]}),l.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Enter the desired length for each shoreline segment."})]}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 space-y-2",children:[" ",l.jsxs("div",{className:"flex items-center text-sm",children:[l.jsx(mu,{className:"h-5 w-5 mr-2 text-blue-500 flex-shrink-0"}),l.jsxs("p",{className:"text-gray-700",children:["Estimated segments: ",l.jsx("span",{className:"font-semibold",children:u.toLocaleString()})]})]}),u>5e3&&l.jsxs("div",{className:"flex items-start text-sm text-amber-600",children:[l.jsx(ki,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5"}),l.jsx("span",{children:"Warning: High segment count (>5k) may impact performance."})]})]}),l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-start gap-4",children:[l.jsxs("button",{type:"button",onClick:M,disabled:!r||r<=0||y,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",title:!r||r<=0?"Enter a positive resolution first":"Generate segment preview on the map",children:[l.jsx(cr,{className:`h-5 w-5 mr-2 ${y&&!w?"animate-spin":""}`}),y&&!w?"Generating...":"Preview Segmentation"]}),w&&n.length>0&&l.jsxs("div",{className:"flex items-center text-sm text-green-600",children:[l.jsx(Or,{className:"h-5 w-5 mr-1.5"}),l.jsxs("span",{children:[n.length.toLocaleString()," segments ready."]})]}),w&&n.length===0&&l.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[l.jsx(ki,{className:"h-5 w-5 mr-1.5"}),l.jsx("span",{children:"No segments generated."})]})]})]})]})," ",l.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[l.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[l.jsx(hr,{className:"h-6 w-6 mr-2 text-primary-700"}),"Preview Map"]}),l.jsx("p",{className:"mb-3 text-sm text-gray-600",children:w?`Showing ${n.length.toLocaleString()} generated segments (${r}m).`:t?"Showing original shoreline. Enter resolution & click preview.":"Load shoreline data first."}),l.jsxs("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden flex-grow min-h-[500px] relative",children:[" ",t?l.jsx(vt,{geoJSON:C,segments:n,parameters:[],selectedParameter:null,selectedSegments:[],selectionPolygons:[],onSegmentSelect:()=>{},onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:o,stylingMode:R}):l.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:m?"Loading map data...":"No shoreline data loaded."})]})]})," "]})," ",l.jsxs("div",{className:"mt-10 pt-6 border-t border-gray-200 flex justify-between items-center",children:[l.jsxs("button",{type:"button",onClick:I,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[l.jsx(aa,{className:"h-4 w-4 mr-2"})," Back"]}),l.jsxs("button",{type:"button",onClick:S,disabled:!w||n.length===0||y,className:"inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",title:!w||n.length===0?"Generate and preview segments first":"Confirm segments and proceed",children:[y&&w?"Saving...":"Confirm & Continue",l.jsx(oa,{className:"h-4 w-4 ml-2"})]})]})]})}const xt=10;function gp(){var oe;const e=$e(),[t,s]=g.useState([]),[r,i]=g.useState(!0),[n,a]=g.useState(null),[o,c]=g.useState(1),[h,d]=g.useState(null),[u,f]=g.useState("properties.index"),[m,v]=g.useState("asc"),[y,p]=g.useState(""),[_,x]=g.useState(null);g.useEffect(()=>{(async()=>{i(!0),a(null);try{const F=await ce.getShorelineData("current-segments");if(!F){a("No segment data found. Please complete the segmentation step first."),e("/segmentation");return}const z=F.features.filter(G=>G&&G.geometry&&(G.geometry.type==="LineString"||G.geometry.type==="MultiLineString")).map((G,Ce)=>{var es,ts;const q=((es=G.properties)==null?void 0:es.id)||`segment-${Ce+1}`;let he=(ts=G.properties)==null?void 0:ts.length;if(he==null)try{he=Tt(un(G.geometry),{units:"meters"})}catch(Os){console.warn(`Could not calculate length for segment ${q}:`,Os),he=0}return{id:q,type:"Feature",geometry:G.geometry,properties:{...G.properties,id:q,index:Ce+1,length:he},parameters:{}}});if(z.length===0)throw new Error("No valid line segments found in the data.");if(z.length>0){const G=z.map(q=>({type:"Feature",geometry:q.geometry,properties:{}})),Ce=Ns(G);try{const q=Vt(Ce);if(q&&q.length===4&&q.every(he=>isFinite(he))&&q[0]<=q[2]&&q[1]<=q[3]){const he=[[q[1],q[0]],[q[3],q[2]]];x(he)}else console.warn("SegmentTablePage: Could not calculate valid initial bounds.")}catch(q){console.error("SegmentTablePage: Error calculating initial bounds:",q)}}s(z)}catch(F){console.error("Error loading segments:",F),a(`Failed to load segment data: ${F instanceof Error?F.message:String(F)}`)}finally{i(!1)}})()},[e]);const w=g.useMemo(()=>t.filter(P=>{const F=y.toLowerCase();return P.id.toLowerCase().includes(F)||String(P.properties.index).includes(F)}),[t,y]),E=g.useMemo(()=>[...w].sort((P,F)=>{let z=P,G=F;const Ce=u.split(".");for(const q of Ce)z=z==null?void 0:z[q],G=G==null?void 0:G[q];return z==null?m==="asc"?-1:1:G==null?m==="asc"?1:-1:typeof z=="number"&&typeof G=="number"?m==="asc"?z-G:G-z:(typeof z=="string"&&typeof G=="string"&&(z=z.toLowerCase(),G=G.toLowerCase()),z<G?m==="asc"?-1:1:z>G?m==="asc"?1:-1:0)}),[w,u,m]),b=g.useMemo(()=>{const P=(o-1)*xt;return E.slice(P,P+xt)},[E,o]),M=Math.ceil(w.length/xt),S=g.useCallback(P=>{d(P===h?null:P)},[h]),I=g.useCallback(P=>{P===u?v(F=>F==="asc"?"desc":"asc"):(f(P),v("asc")),c(1)},[u]),C=g.useCallback(()=>e("/segmentation"),[e]),R=g.useCallback(async()=>{i(!0),a(null);try{console.log("Continuing to parameter selection..."),e("/parameter-selection")}catch(P){console.error("Error preparing to continue:",P),a("Failed to proceed. Please try again."),i(!1)}},[e]),k=P=>{P>=1&&P<=M&&c(P)},D=g.useMemo(()=>!t||t.length===0?null:{type:"FeatureCollection",features:t.map(P=>({type:"Feature",geometry:P.geometry,properties:{...P.properties,id:P.id}}))},[t]),$=g.useMemo(()=>h?[h]:[],[h]);return r&&t.length===0?l.jsxs("div",{className:"flex items-center justify-center h-screen",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),l.jsx("p",{className:"ml-4 text-gray-600",children:"Loading segments..."})]}):l.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[" ",l.jsxs("div",{className:"text-center mb-10",children:[l.jsx("h2",{className:"text-3xl font-extrabold text-primary-900 tracking-tight",children:"3. Review Segments"}),l.jsx("p",{className:"mt-3 text-lg text-gray-600",children:"Review the generated shoreline segments. Click a row to view on map."}),l.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Total Segments: ",t.length.toLocaleString()]})]}),l.jsx(mt,{message:n,onClose:()=>a(null)}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8",children:[l.jsxs("div",{className:"lg:col-span-1 flex flex-col space-y-6",children:[l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 flex-grow flex flex-col",children:[" ",l.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4 gap-4 flex-shrink-0",children:[" ",l.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[l.jsx(Mu,{className:"h-6 w-6 mr-2 text-primary-700"})," Segment List"]}),l.jsxs("div",{className:"relative w-full sm:w-64",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l.jsx(pu,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),l.jsx("input",{type:"text",placeholder:"Search by ID or #",value:y,onChange:P=>{p(P.target.value),c(1)},className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]})]}),l.jsxs("div",{className:"flex-grow overflow-auto border border-gray-200 rounded-md",children:[" ",l.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[l.jsxs("thead",{className:"bg-gray-50 sticky top-0 z-10",children:[" ",l.jsxs("tr",{children:[l.jsxs("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>I("properties.index"),children:["#",u==="properties.index"&&l.jsx("span",{className:"ml-1",children:m==="asc"?"":""})]}),l.jsxs("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>I("properties.length"),children:["Length (m)",u==="properties.length"&&l.jsx("span",{className:"ml-1",children:m==="asc"?"":""})]})]})]}),l.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[b.map(P=>{var F;return l.jsxs("tr",{onClick:()=>S(P.id),className:`hover:bg-primary-50 cursor-pointer transition-colors duration-150 ${h===P.id?"bg-primary-100 font-medium":""}`,children:[l.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 text-center w-16",children:P.properties.index}),l.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 text-center w-32",children:(F=P.properties)!=null&&F.length?P.properties.length.toFixed(1):"N/A"})]},P.id)}),b.length===0&&l.jsx("tr",{children:l.jsx("td",{colSpan:2,className:"px-6 py-4 text-center text-sm text-gray-500",children:y?"No segments match search.":"No segments loaded."})})]})]})]}),M>1&&l.jsxs("nav",{className:"mt-4 flex items-center justify-between border-t border-gray-200 px-1 pt-3 flex-shrink-0","aria-label":"Pagination",children:[l.jsxs("p",{className:"text-sm text-gray-700 flex-shrink-0 mr-4",children:[" ","Showing ",l.jsx("span",{className:"font-medium",children:(o-1)*xt+1}),"- ",l.jsx("span",{className:"font-medium",children:Math.min(o*xt,w.length)})," ","of"," ",l.jsx("span",{className:"font-medium",children:w.length})]}),l.jsxs("div",{className:"flex space-x-1",children:[" ",l.jsx("button",{onClick:()=>k(o-1),disabled:o===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),l.jsx("button",{onClick:()=>k(o+1),disabled:o===M,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})," ",l.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 mt-auto",children:[" ",l.jsxs("button",{type:"button",onClick:C,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:r,children:[l.jsx(aa,{className:"h-4 w-4 mr-2"})," Back"]}),l.jsxs("button",{type:"button",onClick:R,className:"inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r||t.length===0,title:t.length===0?"No segments loaded":"Confirm segments and proceed to parameter selection",children:[r?"Processing...":"Confirm & Continue",l.jsx(oa,{className:"h-4 w-4 ml-2"})]})]})]})," ",l.jsxs("div",{className:"lg:col-span-1 flex flex-col",children:[l.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[l.jsx(wt,{className:"h-6 w-6 mr-2 text-primary-700"})," Map Preview"]}),h&&l.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-800 flex items-center",children:[l.jsx(Or,{className:"h-5 w-5 mr-2 text-blue-600 flex-shrink-0"}),"Highlighting segment #",((oe=t.find(P=>P.id===h))==null?void 0:oe.properties.index)||"",". Map zoomed to selection."]}),l.jsxs("div",{className:"bg-gray-100 rounded-lg shadow-inner border border-gray-200 overflow-hidden h-[600px] lg:h-full lg:min-h-[600px] flex-grow",children:[" ",D?l.jsx(vt,{geoJSON:D,segments:t,parameters:[],selectedParameter:null,selectedSegments:$,selectionPolygons:[],onSegmentSelect:S,onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:_,zoomToFeatureId:h,stylingMode:"parameter"}):l.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:r?"Loading map data...":"No shoreline data available"})]})]})," "]})," "]})}const pp=[{id:"geomorphology",name:"Geomorphology",description:"Coastal landform type and characteristics",type:"categorical",weight:.25,enabled:!0,options:[{type:"categorical",value:"rocky_cliffs",label:"Rocky, cliffed coasts / Fiords / Fiards",color:"#1a9850",vulnerability:1},{type:"categorical",value:"medium_cliffs",label:"Medium cliffs / Indented coasts",color:"#91cf60",vulnerability:2},{type:"categorical",value:"low_cliffs",label:"Low cliffs / Glacial drift / Alluvial plains",color:"#fee08b",vulnerability:3},{type:"categorical",value:"cobble_beaches",label:"Cobble beaches / Estuary / Lagoon",color:"#fc8d59",vulnerability:4},{type:"categorical",value:"barrier_beaches",label:"Barrier beaches / Sand beaches / Salt marsh / Mud flats / Deltas / Mangrove / Coral reefs",color:"#d73027",vulnerability:5}]},{id:"coastal_slope",name:"Coastal Slope",description:"Average slope of the coastal zone (%)",type:"numerical",weight:.25,enabled:!0,unit:"%",vulnerabilityRanges:[{value:1,min:2,max:null,label:"Very Low",color:"#1a9850"},{value:2,min:.7,max:2,label:"Low",color:"#91cf60"},{value:3,min:.04,max:.07,label:"Moderate",color:"#fee08b"},{value:4,min:.025,max:.04,label:"High",color:"#fc8d59"},{value:5,min:null,max:.025,label:"Very High",color:"#d73027"}]},{id:"sea_level_change",name:"Relative Sea-level Change",description:"Rate of relative sea-level change",type:"numerical",weight:.25,enabled:!0,unit:"mm/yr",vulnerabilityRanges:[{value:1,min:null,max:1.8,label:"Very Low",color:"#1a9850"},{value:2,min:1.8,max:2.5,label:"Low",color:"#91cf60"},{value:3,min:2.5,max:2.95,label:"Moderate",color:"#fee08b"},{value:4,min:2.95,max:3.16,label:"High",color:"#fc8d59"},{value:5,min:3.16,max:null,label:"Very High",color:"#d73027"}]},{id:"shoreline_change",name:"Shoreline Erosion/Accretion",description:"Rate of shoreline erosion or accretion",type:"numerical",weight:.25,enabled:!0,unit:"m/yr",vulnerabilityRanges:[{value:1,min:2,max:null,label:"Accretion",color:"#1a9850"},{value:2,min:1,max:2,label:"Low Erosion/Accretion",color:"#91cf60"},{value:3,min:-1,max:1,label:"Stable",color:"#fee08b"},{value:4,min:-2,max:-1,label:"High Erosion",color:"#fc8d59"},{value:5,min:null,max:-2,label:"Very High Erosion",color:"#d73027"}]},{id:"mean_tide_range",name:"Mean Tide Range",description:"Average tidal range",type:"numerical",weight:0,enabled:!1,unit:"m",vulnerabilityRanges:[{value:1,min:6,max:null,label:"Very Low",color:"#1a9850"},{value:2,min:4.1,max:6,label:"Low",color:"#91cf60"},{value:3,min:2,max:4,label:"Moderate",color:"#fee08b"},{value:4,min:1,max:1.9,label:"High",color:"#fc8d59"},{value:5,min:null,max:1,label:"Very High",color:"#d73027"}]},{id:"mean_wave_height",name:"Mean Wave Height",description:"Average wave height",type:"numerical",weight:0,enabled:!1,unit:"m",vulnerabilityRanges:[{value:1,min:null,max:.55,label:"Very Low",color:"#1a9850"},{value:2,min:.55,max:.85,label:"Low",color:"#91cf60"},{value:3,min:.85,max:1.05,label:"Moderate",color:"#fee08b"},{value:4,min:1.05,max:1.25,label:"High",color:"#fc8d59"},{value:5,min:1.25,max:null,label:"Very High",color:"#d73027"}]}];function vp(){const e=$e(),[t,s]=g.useState(pp),[r,i]=g.useState(null);g.useEffect(()=>{(async()=>{try{const u=await ce.getShorelineData("current-parameters");if(u&&u.features){const f=u.features.map(m=>m.properties);s(f.filter(m=>m!==null))}}catch(u){console.error("Error loading parameters:",u),i("Failed to load saved parameters")}})()},[]);const n=t.filter(d=>d.enabled).reduce((d,u)=>d+(u.weight||0),0),a=d=>{s(u=>u.map(f=>f.id===d?{...f,enabled:!f.enabled}:f))},o=(d,u)=>{s(f=>f.map(m=>m.id===d?{...m,weight:u}:m))},c=()=>{const d=t.filter(f=>f.enabled).length;if(d===0)return;const u=1/d;s(f=>f.map(m=>m.enabled?{...m,weight:u}:m))},h=async()=>{const u=t.filter(f=>f.enabled).reduce((f,m)=>f+(m.weight||0),0);if(Math.abs(u-1)>.01){i(`Parameter weights must sum to 100%. Current total: ${(u*100).toFixed(0)}%`);return}try{const f={type:"FeatureCollection",features:t.map(m=>({type:"Feature",properties:m,geometry:{type:"Point",coordinates:[0,0]}}))};await ce.storeShorelineData("current-parameters",f),e("/parameter-assignment")}catch(f){console.error("Error saving parameters:",f),i("Failed to save parameters. Please try again.")}};return l.jsxs("div",{className:"max-w-4xl mx-auto mt-8 px-4",children:[l.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"4.  Parameter Selection"}),r&&l.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:r}),l.jsxs("div",{className:"flex justify-between items-start mb-8",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-medium text-gray-900 mb-2 text-left",children:"Vulnerability Parameters"}),l.jsx("p",{className:"text-gray-600",children:"Configure the parameters that determine coastal vulnerability"})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Weight"}),l.jsxs("div",{className:`text-2xl font-medium ${Math.abs(n-1)<.01?"text-emerald-600":"text-gray-900"}`,children:[(n*100).toFixed(0),"%"]})]}),l.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Distribute Evenly"})]})]}),l.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.map(d=>l.jsx("div",{className:`p-5 rounded-xl border ${d.enabled?"bg-white border-gray-200 shadow-sm":"bg-gray-50 border-gray-100"}`,children:l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"flex-shrink-0 pt-1",children:l.jsx("input",{type:"checkbox",id:d.id,checked:d.enabled,onChange:()=>a(d.id),className:"h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500"})}),l.jsxs("div",{className:"flex-grow min-w-0",children:[l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsx("div",{className:"min-w-0",children:l.jsx("label",{htmlFor:d.id,className:"block text-lg font-medium text-gray-900 text-left",children:d.name})}),d.enabled&&l.jsxs("span",{className:"text-lg font-medium text-gray-900 ml-4 w-16 text-right flex-shrink-0",children:[((d.weight||0)*100).toFixed(0),"%"]})]}),d.enabled&&l.jsx("div",{className:"mt-3 flex items-center gap-3",children:l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d.weight||0,onChange:u=>o(d.id,parseFloat(u.target.value)),className:"flex-grow h-2 accent-teal-600 cursor-pointer"})})]})]})},d.id))}),l.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-between",children:[l.jsx("button",{onClick:()=>e("/segment-table"),className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Back to Segment Table"}),l.jsx("button",{onClick:h,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Continue to Parameter Assignment"})]})]})}const yp=({segments:e,parameters:t,selectedSegmentIds:s,selectedParameterId:r,selectionPolygons:i,onSegmentSelect:n,onSelectionDelete:a,onAreaSelect:o,initialBounds:c,geoJSON:h,onSelectAll:d,onClearSelection:u,mapContainerRef:f})=>l.jsxs("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[" ",l.jsxs("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[" ",l.jsxs("div",{children:[l.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md mr-2 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Select all visible segments",disabled:e.length===0,children:"Select All"}),l.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",title:"Deselect all segments",disabled:s.length===0,children:"Clear Selection"})]}),l.jsx("div",{className:"text-sm text-gray-600",children:"Use drawing tools (polygon/rectangle) on map to select segments by area."})]}),l.jsxs("div",{className:"flex-grow border rounded overflow-hidden",ref:f,children:[" ",e.length>0&&h?l.jsx(vt,{segments:e,parameters:t,geoJSON:h,selectedSegments:s,selectedParameter:r,selectionPolygons:i,onSegmentSelect:n,onSelectionDelete:a,onAreaSelect:o,isEditing:!0,initialBounds:c}):l.jsxs("div",{className:"h-full flex items-center justify-center bg-gray-50 text-gray-500",children:[" ",l.jsx("p",{className:"text-gray-500",children:e.length===0?"No shoreline segments loaded.":"Loading shoreline data..."})]})]})]}),xp=({parameters:e,activeParameter:t,onParameterSelect:s,selectedValue:r,selectedVulnerability:i,onValueSelect:n,onApplyValue:a,selectedSegmentIds:o})=>{const c=g.useMemo(()=>{if(!t)return[];if(t.type==="categorical"&&t.options){const u=t.options.map(m=>({label:m.label,value:typeof m.value=="string"?m.value:String(m.value),vulnerability:m.vulnerability})),f={};return u.forEach(m=>{f[m.value]&&console.warn(`Duplicate option value detected for ${t.name}: ${m.value}`),f[m.value]=!0}),u}else if(t.type==="numerical"&&t.vulnerabilityRanges){const u=[],f={};for(let m=1;m<=5;m++){const v=t.vulnerabilityRanges.find(y=>y.value===m);if(v&&!f[v.value]){const y=v.value.toString();let p=`${v.label}`;v.min!==null&&v.max!==null?p+=` (${v.min} - ${v.max}${t.unit||""})`:v.min!==null?p+=` (>= ${v.min}${t.unit||""})`:v.max!==null&&(p+=` (< ${v.max}${t.unit||""})`),u.push({label:p,value:y,vulnerability:v.value}),f[v.value]=!0}}return t.vulnerabilityRanges.forEach(m=>{if(!f[m.value]){const v=m.value.toString();let y=`${m.label}`;u.push({label:y,value:v,vulnerability:m.value}),f[m.value]=!0}}),u.sort((m,v)=>m.vulnerability-v.vulnerability),u}else if(t.type==="numerical"){console.warn(`Numerical parameter "${t.name}" has no vulnerabilityRanges defined. Using generic 1-5 scale.`);const u=["Very Low","Low","Moderate","High","Very High"];return[1,2,3,4,5].map(f=>({label:`${u[f-1]} (Score: ${f})`,value:f.toString(),vulnerability:f}))}return[]},[t]),h=u=>{const f=u.target.value,m=c.find(v=>v.value===f);m?n(m.value,m.vulnerability):n(null,1)},d=g.useMemo(()=>t?r===null?"Select a Value First":o.length===0?"Select Segments First":`Apply ${t.name}: ${r} to ${o.length} Segments`:"Select a Parameter First",[t,r,o]);return l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[l.jsx("h3",{className:"text-lg font-medium mb-4",children:"Parameter Values"}),l.jsxs("p",{className:"mb-4 text-sm text-gray-600",children:[o.length," selected"]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:"parameter-select",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Parameter"}),l.jsx("select",{id:"parameter-select",value:(t==null?void 0:t.id)||"",onChange:u=>s(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",children:e.length>0?e.map(u=>l.jsx("option",{value:u.id,children:u.name},u.id)):l.jsx("option",{value:"",children:"No parameters available"})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{htmlFor:"value-select",className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Value ",t&&`for ${t.name}`]}),l.jsxs("select",{id:"value-select",value:r||"",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm",disabled:!t||o.length===0,children:[l.jsx("option",{value:"",children:"Select a value..."}),c.map(u=>l.jsxs("option",{value:u.value,children:[u.label," (Vulnerability: ",u.vulnerability,")"]},u.value)),c.length===0&&t&&l.jsx("option",{value:"",disabled:!0,children:"No values available"})]}),(!t||o.length===0)&&r===null&&l.jsx("p",{className:"mt-1 text-sm text-red-500",children:t?"Select segments on the map first":"Select a parameter first"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vulnerability Preview"}),l.jsxs("div",{className:"flex items-center",children:[l.jsx("span",{className:"mr-2 text-gray-600",children:"Value:"}),l.jsx("span",{className:"font-medium",children:r||"-"}),l.jsx("span",{className:"mx-4 text-gray-600",children:"Vulnerability:"}),l.jsx("span",{className:`inline-block w-6 h-6 rounded-full text-white text-center flex items-center justify-center text-xs font-medium ${(()=>{switch(Math.round(i)){case 1:return"bg-green-600";case 2:return"bg-lime-500";case 3:return"bg-yellow-400";case 4:return"bg-orange-500";case 5:return"bg-red-600";default:return"bg-gray-400"}})()}`,children:i||"?"})]})]}),l.jsx("button",{onClick:a,disabled:!t||r===null||o.length===0,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md disabled:bg-gray-300 disabled:cursor-not-allowed",children:d}),l.jsx("div",{className:"mt-4 text-center",children:l.jsx("p",{className:"text-sm font-medium text-gray-600",children:o.length>0?`${o.length} segments selected`:"No segments selected. Click on the map or use Select All"})})]})},Rs=[{name:"Geometric Mean (Normalized)",type:"geometric-mean-normalized",description:"Normalized weighted geometric mean. Often used to scale results between 1-5."},{name:"Geometric Mean",type:"geometric-mean",description:"Standard weighted geometric mean. Traditional CVI method."},{name:"Arithmetic Mean",type:"arithmetic-mean",description:"Simple weighted arithmetic mean."},{name:"Nonlinear Power (sqrt)",type:"nonlinear-power",description:"Root mean square of weighted vulnerabilities. Emphasizes higher values."}],Pt=e=>{if(e==null||isNaN(e))return"No Data";const t=Math.round(e);return t<=1?"Very Low":t===2?"Low":t===3?"Moderate":t===4?"High":t>=5?"Very High":"No Data"},bp=({selectedFormula:e,onFormulaSelect:t,onCalculateCvi:s,completionPercentage:r,calculatingCvi:i,cviScores:n,segments:a})=>{const o=g.useMemo(()=>{const d=Object.values(n);if(d.length===0)return null;const u=Math.min(...d),f=Math.max(...d),v=d.reduce((E,b)=>E+b,0)/d.length;let y=0,p=0,_=0,x=0,w=0;return d.forEach(E=>{const b=Pt(E);b==="Very Low"?y++:b==="Low"?p++:b==="Moderate"?_++:b==="High"?x++:b==="Very High"&&w++}),{min:u.toFixed(2),max:f.toFixed(2),avg:v.toFixed(2),count:d.length,categories:{veryLow:y,low:p,moderate:_,high:x,veryHigh:w}}},[n]),c=g.useMemo(()=>r>=100&&e!==null&&!i,[r,e,i]),h=d=>{const u=d.target.value;t(u===""?null:u)};return l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[l.jsx("h3",{className:"text-lg font-medium mb-4",children:"CVI Calculation"}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:"formula-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Formula"}),l.jsxs("select",{id:"formula-select",value:(e==null?void 0:e.type)||"",onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",disabled:i,children:[l.jsx("option",{value:"",children:"-- Select a Formula --"}),Rs.map(d=>l.jsxs("option",{value:d.type,children:[d.name," "]},d.type))]}),e&&l.jsx("p",{className:"mt-1 text-xs text-gray-600",children:e.description})]}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("button",{onClick:s,disabled:!c,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 mr-2 ${i?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i?l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"}):l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 7h6m0 10v-6m-6 2h6m-6-4h6M9 3a1 1 0 011-1h4a1 1 0 011 1v1H9V3zM15 21a2 2 0 01-2 2H11a2 2 0 01-2-2m4-18a2 2 0 00-2-2H11a2 2 0 00-2 2m4 18V7m-4 14V7"})}),i?"Calculating...":`Calculate CVI ${e?`(${e.name})`:""}`]}),!e&&r>=100&&!i&&l.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Please select a formula before calculating."}),r<100&&!i&&l.jsxs("p",{className:"mt-1 text-sm text-amber-600",children:["Complete all parameter values (",r.toFixed(0),"%) before calculating CVI."]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Calculation Status"}),l.jsxs("div",{className:"flex items-center text-sm",children:[l.jsx("span",{className:"mr-2 text-gray-600 w-28 flex-shrink-0",children:"Selected Formula:"}),l.jsx("span",{className:"font-medium",children:(e==null?void 0:e.name)||"None Selected"})]}),l.jsxs("div",{className:"flex items-center text-sm",children:[l.jsx("span",{className:"mr-2 text-gray-600 w-28 flex-shrink-0",children:"Segments w/ CVI:"}),l.jsx("span",{className:"font-medium",children:Object.keys(n).length}),a.length>0&&l.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",Math.round(Object.keys(n).length/a.length*100),"% of ",a.length,")"]})]})]}),Object.keys(n).length>0&&o&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[l.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"CVI Score Categories & Stats"}),l.jsxs("div",{className:"flex flex-wrap space-x-4 mb-3",children:[" ",l.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",l.jsx("span",{className:"w-3 h-3 bg-green-600 rounded-full mr-1.5 border border-green-700 flex-shrink-0"}),"Very Low ","(1)"," [",o.categories.veryLow,"]"]}),l.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",l.jsx("span",{className:"w-3 h-3 bg-lime-500 rounded-full mr-1.5 border border-lime-600 flex-shrink-0"}),"Low ","(2)"," [",o.categories.low,"]"]}),l.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",l.jsx("span",{className:"w-3 h-3 bg-yellow-400 rounded-full mr-1.5 border border-yellow-500 flex-shrink-0"}),"Moderate ","(3)"," [",o.categories.moderate,"]"]}),l.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",l.jsx("span",{className:"w-3 h-3 bg-orange-500 rounded-full mr-1.5 border border-orange-600 flex-shrink-0"}),"High ","(4)"," [",o.categories.high,"]"]}),l.jsxs("div",{className:"flex items-center text-xs whitespace-nowrap",children:[" ",l.jsx("span",{className:"w-3 h-3 bg-red-600 rounded-full mr-1.5 border border-red-700 flex-shrink-0"}),"Very High ","(5)"," [",o.categories.veryHigh,"]"]})]}),l.jsxs("div",{className:"text-xs text-gray-600 grid grid-cols-3 gap-x-2 gap-y-1",children:[l.jsxs("div",{children:["Min: ",l.jsx("span",{className:"font-medium text-gray-800",children:o.min})]}),l.jsxs("div",{children:["Max: ",l.jsx("span",{className:"font-medium text-gray-800",children:o.max})]}),l.jsxs("div",{children:["Avg: ",l.jsx("span",{className:"font-medium text-gray-800",children:o.avg})]})]})]})]})},bt=10,wp=({segments:e,parameters:t,selectedSegmentIds:s,onSegmentSelect:r,cviScores:i,selectedFormula:n,cviStatistics:a})=>{const[o,c]=g.useState(1),h=g.useMemo(()=>{const p=[...e],_=(x,w)=>{const E=parseInt(x.split("-")[1]||"0",10),b=parseInt(w.split("-")[1]||"0",10);return E-b};return p.sort((x,w)=>{const E=s.includes(x.id),b=s.includes(w.id);return E!==b?E?-1:1:_(x.id,w.id)}),p},[e,s]),d=g.useMemo(()=>{const p=(o-1)*bt;return h.slice(p,p+bt)},[h,o]),u=Math.ceil(h.length/bt),f=p=>{p>=1&&p<=u&&c(p)},m=p=>p.includes("segment-")?p.split("-")[1]:p,v=p=>{if(p==null)return"bg-gray-300";switch(Math.round(p)){case 1:return"bg-green-600";case 2:return"bg-lime-500";case 3:return"bg-yellow-400";case 4:return"bg-orange-500";case 5:return"bg-red-600";default:return"bg-gray-400"}},y=p=>{if(p==null||isNaN(p))return"bg-gray-400";const _=Math.round(p);return _<=1?"bg-green-600":_===2?"bg-lime-500":_===3?"bg-yellow-400":_===4?"bg-orange-500":_>=5?"bg-red-600":"bg-gray-400"};return l.jsxs("div",{className:"flex flex-col flex-grow h-full overflow-hidden",children:[" ",l.jsx("h3",{className:"text-lg font-medium mb-4",children:"Segment Values"}),n&&a&&Object.keys(i).length>0&&l.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[l.jsxs("div",{className:"flex items-center mb-2",children:[l.jsx("span",{className:"font-medium text-blue-800 mr-2",children:"CVI Calculation:"}),l.jsx("span",{className:"text-blue-700",children:n.name})]}),l.jsx("p",{className:"text-sm text-blue-600",children:n.description}),l.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-x-4 gap-y-1 text-sm",children:[" ",l.jsxs("div",{children:[l.jsx("span",{className:"text-blue-500",children:"Segments:"})," ",l.jsxs("span",{className:"font-medium text-blue-800",children:[a.count," of ",e.length]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-blue-500",children:"Range:"})," ",l.jsxs("span",{className:"font-medium text-blue-800",children:[a.min," - ",a.max]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-blue-500",children:"Average:"})," ",l.jsx("span",{className:"font-medium text-blue-800",children:a.avg})]}),l.jsxs("div",{className:"col-span-3 pt-1 border-t border-blue-100 mt-1 text-xs",children:[" ",l.jsx("span",{className:"text-blue-500",children:"Counts:"})," Very Low: ",l.jsx("span",{className:"font-medium text-blue-800",children:a.categories.veryLow}),", Low: ",l.jsx("span",{className:"font-medium text-blue-800",children:a.categories.low}),", Moderate: ",l.jsx("span",{className:"font-medium text-blue-800",children:a.categories.moderate}),", High: ",l.jsx("span",{className:"font-medium text-blue-800",children:a.categories.high}),", Very High: ",l.jsx("span",{className:"font-medium text-blue-800",children:a.categories.veryHigh})]})]})]}),l.jsxs("div",{className:"flex-grow overflow-auto",children:[" ",l.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:[l.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),l.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Length (m)"}),t.map(p=>l.jsxs("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",title:p.name,children:[p.name.length>15?p.name.substring(0,12)+"...":p.name," (Vuln)"]},p.id)),l.jsxs("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:["CVI ",n&&l.jsxs("span",{className:"text-blue-500",children:["(",n.name.substring(0,10),n.name.length>10?"...":"",")"]})]})]})}),l.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[d.map((p,_)=>{var E;const x=m(p.id),w=s.includes(p.id);return l.jsxs("tr",{className:`${w?"bg-blue-50 font-medium":_%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-100 transition-colors duration-150`,onClick:()=>r(p.id),style:{cursor:"pointer"},children:[l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.jsxs("div",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",checked:w,onChange:b=>{b.stopPropagation(),r(p.id)},className:"mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500","aria-label":`Select segment ${x}`}),l.jsx("span",{children:x})]})}),l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:typeof((E=p.properties)==null?void 0:E.length)=="number"?p.properties.length.toFixed(2):"N/A"}),t.map(b=>{var I;const M=(I=p.parameters)==null?void 0:I[b.id],S=(M==null?void 0:M.vulnerability)??null;return l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:S!==null?l.jsx("div",{className:"flex justify-center",title:`Value: ${(M==null?void 0:M.value)??"N/A"}, Vulnerability: ${S}`,children:l.jsx("span",{title:`Vulnerability: ${S}`,className:`inline-block w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium ${v(S)}`,children:S})}):"-"},b.id)}),l.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:i[p.id]!==void 0?l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsxs("span",{title:`CVI Score: ${i[p.id].toFixed(2)} (${Pt(i[p.id])})`,className:`inline-block w-6 h-6 rounded-full text-white flex items-center justify-center text-xs font-medium ${y(i[p.id])}`,children:[Math.round(i[p.id])," "]}),l.jsx("span",{className:"text-xs mt-1",children:i[p.id].toFixed(2)})]}):"-"})]},p.id)}),d.length===0&&l.jsx("tr",{children:l.jsx("td",{colSpan:t.length+3,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No segments to display for the current page."})})]})]})]}),u>1&&l.jsxs("div",{className:"mt-4 flex items-center justify-between flex-shrink-0 border-t pt-3",children:[" ",l.jsxs("div",{className:"text-gray-500 text-sm",children:["Showing ",(o-1)*bt+1," to ",Math.min(o*bt,h.length)," of ",h.length," segments"]}),l.jsxs("div",{className:"flex space-x-1 sm:space-x-2",children:[l.jsx("button",{onClick:()=>f(o-1),disabled:o===1,className:"px-3 py-1 border border-gray-300 rounded-md text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50","aria-label":"Previous page",children:"Previous"}),l.jsxs("span",{className:"text-xs p-1 text-gray-700",children:[" ","Page ",o," of ",u]}),l.jsx("button",{onClick:()=>f(o+1),disabled:o===u,className:"px-3 py-1 border border-gray-300 rounded-md text-xs disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50","aria-label":"Next page",children:"Next"})]})]})]})},Mp=()=>{const e=$e(),[t,s]=g.useState([]),[r,i]=g.useState([]),[n,a]=g.useState(null),[o,c]=g.useState({}),[h,d]=g.useState(null),[u,f]=g.useState(!0),[m,v]=g.useState(null),y=g.useCallback(async()=>{f(!0),v(null);try{console.log("Loading data for Parameter Assignment...");const p=await ce.getShorelineData("current-segments");if(!p||!p.features||p.features.length===0){v("No segments found. Please complete the segmentation step first."),e("/segment-table"),f(!1);return}const _=await ce.getShorelineData("current-parameters");if(!_||!_.features||_.features.length===0){v("No parameters found. Please complete the parameter selection step first."),e("/parameter-selection"),f(!1);return}const x=p.features.filter(b=>b&&b.geometry&&(b.geometry.type==="LineString"||b.geometry.type==="MultiLineString")).map((b,M)=>{var D;const S=((D=b.properties)==null?void 0:D.id)||`segment-${M+1}`,I=b.properties||{},C=I.parameters&&typeof I.parameters=="object"?I.parameters:{};let R=I.length;if(R==null||typeof R!="number")try{R=Tt(b.geometry,{units:"meters"})}catch($){console.warn(`Could not calculate length for segment ${S}:`,$),R=0}const k={...I,id:S,length:R,parameters:C,index:I.index??M+1,vulnerabilityIndex:I.vulnerabilityIndex,vulnerabilityFormula:I.vulnerabilityFormula};return{id:S,type:"Feature",geometry:b.geometry,properties:k,parameters:C}});if(x.length===0)throw new Error("No valid line segments found after filtering");if(console.log(`Processed ${x.length} segments`),s(x),x.length>0){const b=x.map(S=>({type:"Feature",geometry:S.geometry,properties:{}})),M=Ns(b);try{const S=Vt(M);if(S&&S.length===4&&S.every(I=>isFinite(I))&&S[0]<=S[2]&&S[1]<=S[3]){const I=[[S[1],S[0]],[S[3],S[2]]];a(I),console.log("Calculated map bounds:",I)}else console.warn("Could not calculate valid bounds from segments.")}catch(S){console.error("Error calculating bounds:",S)}}const w=_.features.map(b=>b.properties).filter(b=>b!==null&&b.enabled===!0);console.log(`Processed ${w.length} enabled parameters`),i(w);const E=x.reduce((b,M)=>(M.properties.vulnerabilityIndex!==void 0&&M.properties.vulnerabilityIndex!==null&&(b[M.id]=M.properties.vulnerabilityIndex),b),{});if(Object.keys(E).length>0){console.log(`Loaded ${Object.keys(E).length} pre-existing CVI scores`),c(E);const b=x.find(M=>M.properties.vulnerabilityFormula);if(b!=null&&b.properties.vulnerabilityFormula){const M=Rs.find(S=>S.type===b.properties.vulnerabilityFormula);M?(console.log(`Setting pre-existing formula: ${M.name}`),d(M)):console.warn(`Segment ${b.id} has unknown formula type: ${b.properties.vulnerabilityFormula}`)}}}catch(p){console.error("Error loading data:",p),v(`Failed to load assignment data: ${p instanceof Error?p.message:String(p)}`)}finally{f(!1)}},[e]);return g.useEffect(()=>{y()},[y]),{segments:t,setSegments:s,parameters:r,mapBounds:n,initialCviScores:o,initialFormula:h,loading:u,error:m,setError:v}},_p=async(e,t,s,r,i)=>{console.log(`Applying value "${r}" (vuln: ${i}) for "${s.name}" to ${t.length} segments`);let n=!1;const a=e.map(o=>{var c;if(t.includes(o.id)){let h,d=!1;if(s.type==="numerical"){const f=parseFloat(r);if(!isNaN(f))h={type:"numerical",value:f,vulnerability:i};else return console.error(`Skipping segment ${o.id}: Invalid numerical value ${r}`),o}else h={type:"categorical",value:r,vulnerability:i};const u=(c=o.parameters)==null?void 0:c[s.id];if((!u||u.value!==h.value||u.vulnerability!==h.vulnerability)&&(d=!0),d){n=!0;const f={...o.parameters,[s.id]:h},m=o.properties||{id:o.id},v=m.parameters&&typeof m.parameters=="object"?m.parameters:{},y={...m,parameters:{...v,[s.id]:h}};return{...o,parameters:f,properties:y}}}return o});if(n)try{const o=a.map(c=>({type:"Feature",geometry:c.geometry,properties:c.properties}));await ce.storeShorelineData("current-segments",{type:"FeatureCollection",features:o}),console.log("Stored updated segments after value application")}catch(o){throw console.error("Failed to store updated segments:",o),new Error(`Failed to save changes: ${o instanceof Error?o.message:String(o)}`)}else console.log("No actual segment values changed, skipping database update.");return a},br=(e,t)=>{const s=t.reduce((i,n)=>i+n,0);if(s===0)return 0;let r=1;for(let i=0;i<e.length;i++){const n=Math.max(1e-9,e[i]),a=t[i]/s;r*=Math.pow(n,a)}return r},Ep=(e,t)=>{const s=e.length;if(s===0)return 0;const r=br(e,t);return Math.pow(r,1/s)},Sp=(e,t)=>{const s=t.reduce((n,a)=>n+a,0);if(s===0)return 0;let r=0;for(let n=0;n<e.length;n++)r+=e[n]*t[n];return r/s},Np=(e,t)=>{const s=t.reduce((a,o)=>a+o,0);if(s===0)return 0;const i=e.reduce((a,o,c)=>a+Math.pow(o,2)*t[c],0)/s;return Math.sqrt(i)},Ip=async(e,t,s,r,i,n)=>{console.log("Calculating CVI using formula:",s.name),n(null);try{const a={},o=[...e];let c=!1;const h=t.filter(u=>u.weight>0),d=h.reduce((u,f)=>u+f.weight,0);if(Math.abs(d-1)>.01){const u=`Weights of parameters used in calculation do not sum to 1 (Sum: ${d.toFixed(2)}). Please adjust weights in Parameter Selection.`;console.error(u),n(u)}if(e.forEach((u,f)=>{var x;if(!h.every(w=>u.parameters&&u.parameters[w.id]!==void 0))return;const v=[],y=[];h.forEach(w=>{const E=u.parameters[w.id],b=Math.max(1,Math.min(5,E.vulnerability));E.vulnerability!==b&&console.warn(`Parameter ${w.name} for segment ${u.id} has vulnerability ${E.vulnerability} outside 1-5 range. Clamped to ${b}.`),v.push(b),y.push(w.weight)});let p;const _=h.length;switch(s.type){case"geometric-mean":p=br(v,y);break;case"geometric-mean-normalized":p=Ep(v,y);break;case"arithmetic-mean":p=Sp(v,y);break;case"nonlinear-power":p=Np(v,y);break;default:console.warn(`Unknown formula type: ${s.type}. Defaulting to geometric mean.`),p=br(v,y)}p=Math.round(p*100)/100,a[u.id]=p,(x=o[f])!=null&&x.properties&&(o[f].properties.vulnerabilityIndex!==p||o[f].properties.vulnerabilityFormula!==s.type)&&(o[f].properties.vulnerabilityIndex=p,o[f].properties.vulnerabilityFormula=s.type,c=!0)}),c)try{await ce.storeShorelineData("current-segments",{type:"FeatureCollection",features:o.map(u=>({type:"Feature",geometry:u.geometry,properties:u.properties}))}),r(o),console.log("Saved CVI scores to segments in IndexedDB")}catch(u){console.error("Failed to save CVI scores to IndexedDB:",u),n("Failed to save calculated CVI scores. Calculations are shown but may be lost.")}i(a),console.log(`Calculated CVI scores for ${Object.keys(a).length} segments.`)}catch(a){console.error("Error during CVI calculation:",a),n(`An error occurred during CVI calculation: ${a instanceof Error?a.message:String(a)}`),i({})}},Cp=({title:e,completionPercentage:t})=>l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:e}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-sm text-gray-600",children:"Overall Completion:"}),l.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2.5 mt-1 dark:bg-gray-700",children:l.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${t}%`}})}),l.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[t,"%"]})]})]});function Ap(){const e=$e(),t=g.useRef(null),{segments:s,setSegments:r,parameters:i,mapBounds:n,initialCviScores:a,initialFormula:o,loading:c,error:h,setError:d}=Mp(),[u,f]=g.useState([]),[m,v]=g.useState(null),[y,p]=g.useState([]),[_,x]=g.useState(null),[w,E]=g.useState(1),[b,M]=g.useState(null),[S,I]=g.useState({}),[C,R]=g.useState(!1),[k,D]=g.useState(null);g.useEffect(()=>{!c&&i.length>0&&!m&&v(i[0]),!c&&o&&!b&&M(o),!c&&Object.keys(a).length>0&&Object.keys(S).length===0&&I(a)},[c,i,o,a,m,b,S]);const $=g.useMemo(()=>{if(s.length===0||i.length===0)return 0;const T=s.length*i.length;let B=0;return s.forEach(W=>{i.forEach(fe=>{W.parameters&&W.parameters[fe.id]!==void 0&&B++})}),T===0?0:Math.round(B/T*100)},[s,i]),oe=g.useMemo(()=>!s||s.length===0?null:{type:"FeatureCollection",features:s.map(T=>({type:"Feature",geometry:T.geometry,properties:{...T.properties,id:T.id,isSelected:u.includes(T.id),vulnerabilityIndex:T.properties.vulnerabilityIndex,vulnerabilityFormula:T.properties.vulnerabilityFormula}}))},[s,u]),P=T=>{D(T),T&&console.error("Error:",T)},F=g.useCallback(T=>{f(B=>B.includes(T)?B.filter(W=>W!==T):[...B,T])},[]),z=g.useCallback(()=>{f(s.map(T=>T.id))},[s]),G=g.useCallback(()=>{f([])},[]),Ce=g.useCallback(T=>{const B=i.find(W=>W.id===T);B?(v(B),x(null),E(1),console.log("Parameter selected:",B.name),P(null)):(console.error("Parameter not found:",T),P("Selected parameter could not be found."))},[i]),q=g.useCallback((T,B)=>{x(T),E(B??1),console.log(`Value staged for application: ${T}, Vulnerability: ${B??1}`),P(null)},[]),he=g.useCallback(async()=>{if(!m||_===null||u.length===0){P(`Cannot apply value: ${m?_===null?"Select a value first.":"Select at least one segment on the map.":"Select a parameter first."}`);return}P(null);try{const T=await _p(s,u,m,_,w);r(T),console.log("Successfully applied value and updated segments state.")}catch(T){console.error("Error applying parameter value:",T),P(T instanceof Error?T.message:"Failed to apply value.")}},[m,_,w,s,u,r]),es=g.useCallback(T=>{const B=T?Rs.find(W=>W.type===T):null;M(B||null),console.log("Selected formula:",(B==null?void 0:B.name)??"None"),P(null)},[]),ts=g.useCallback(async()=>{if(!b){P("Please select a CVI formula before calculating.");return}if(!s.every(B=>i.every(W=>B.parameters&&B.parameters[W.id]!==void 0))||$<100){P(`Cannot calculate CVI: Assign values for all parameters to all segments first. (${$}% complete)`);return}P(null),R(!0),console.log(`Calculating CVI using: ${b.name}`);try{await Ip(s,i,b,r,I,P),console.log("CVI calculation process finished successfully via utility.")}catch(B){console.error("Error during CVI calculation process:",B),k||P(B instanceof Error?B.message:"CVI calculation failed."),I({})}finally{R(!1)}},[s,i,b,r,I,$,k]),Os=g.useCallback(T=>{if(!T||!T.coordinates||T.coordinates.length===0){console.error("Invalid polygon geometry received for area selection");return}console.log("Area selection polygon created, finding intersecting segments...");const B=Qa(T.coordinates),W=[];s.forEach(fe=>{try{Za(fe.geometry,B)&&W.push(fe.id)}catch(Ls){console.warn(`Error checking intersection for segment ${fe.id}:`,Ls)}}),console.log(`Found ${W.length} segments intersecting the selected area.`),f(fe=>[...new Set([...fe,...W])])},[s]),Da=g.useCallback(T=>{console.log("Selection polygon deletion requested (if applicable):",T),p(B=>B.filter(W=>W.id!==T))},[]),$a=g.useCallback(async()=>{const T=s.every(W=>i.every(fe=>W.parameters&&W.parameters[fe.id]!==void 0)),B=Object.keys(S).length===s.length;if(!T||$<100){P(`Assign values for all parameters to all segments first. (${$}% complete)`);return}if(!B){P(`Calculate CVI scores for all ${s.length} segments first. (${Object.keys(S).length} calculated)`);return}P(null);try{console.log("All checks passed. Navigating to results page..."),e("/results")}catch(W){console.error("Error preparing to navigate or navigating:",W),P("Failed to proceed to results.")}},[s,i,S,$,e]),Fa=g.useMemo(()=>{const T=Object.values(S);if(T.length===0)return null;const B=Math.min(...T),W=Math.max(...T),Ls=T.reduce((Ds,Ve)=>Ds+Ve,0)/T.length;let Wr=0,Jr=0,Kr=0,Xr=0,Qr=0;return T.forEach(Ds=>{const Ve=Math.round(Ds);Ve<=1?Wr++:Ve===2?Jr++:Ve===3?Kr++:Ve===4?Xr++:Ve>=5&&Qr++}),{min:B.toFixed(2),max:W.toFixed(2),avg:Ls.toFixed(2),count:T.length,categories:{veryLow:Wr,low:Jr,moderate:Kr,high:Xr,veryHigh:Qr}}},[S]);return c?l.jsxs("div",{className:"flex items-center justify-center h-screen",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),l.jsx("p",{className:"ml-4 text-gray-600",children:"Loading assignment data..."})]}):h?l.jsxs("div",{className:"p-4 max-w-lg mx-auto mt-10 text-center",children:[l.jsx(mt,{message:h,onClose:()=>d(null)}),l.jsx("button",{onClick:()=>e("/"),className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Go Home"})]}):l.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] p-4 space-y-4 bg-gray-50",children:[" ",l.jsx(Cp,{title:"5. Parameter Assignment & CVI Calculation",completionPercentage:$}),l.jsx(mt,{message:k,onClose:()=>P(null)}),l.jsxs("div",{className:"grid grid-rows-[minmax(400px,1fr)_minmax(250px,1fr)] gap-4 flex-grow overflow-hidden",children:[l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 overflow-hidden",children:[l.jsxs("div",{className:"lg:col-span-2 flex flex-col h-full overflow-hidden",children:[" ",l.jsxs("div",{className:"flex-grow overflow-hidden",children:[" ",l.jsx(yp,{segments:s,parameters:i,geoJSON:oe,initialBounds:n,selectionPolygons:y,selectedSegmentIds:u,selectedParameterId:(m==null?void 0:m.id)??null,onSegmentSelect:F,onSelectAll:z,onClearSelection:G,onSelectionDelete:Da,onAreaSelect:Os,mapContainerRef:t})]})]}),l.jsxs("div",{className:"lg:col-span-1 flex flex-col space-y-4 overflow-y-auto pr-2 custom-scrollbar",children:[l.jsx(xp,{parameters:i,activeParameter:m,selectedValue:_,selectedVulnerability:w,onParameterSelect:Ce,onValueSelect:q,onApplyValue:he,selectedSegmentIds:u}),l.jsx(bp,{selectedFormula:b,onFormulaSelect:es,onCalculateCvi:ts,completionPercentage:$,calculatingCvi:C,cviScores:S,segments:s}),l.jsx("div",{className:"bg-white p-4 rounded-lg shadow sticky bottom-0 border-t border-gray-200 mt-auto",children:l.jsx("button",{onClick:$a,className:"w-full px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity duration-200",disabled:$<100||Object.keys(S).length!==s.length||C,title:$<100?`Complete parameter assignment (${$}%) first`:Object.keys(S).length!==s.length?`Calculate CVI for all ${s.length} segments first (${Object.keys(S).length} done)`:C?"Calculation in progress...":"Proceed to results visualization",children:C?l.jsxs(l.Fragment,{children:[l.jsxs("svg",{"aria-hidden":"true",role:"status",className:"inline w-4 h-4 mr-2 text-white animate-spin",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"#E5E7EB"}),l.jsx("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentColor"})]}),"Calculating..."]}):"Continue to Results"})})]})]}),l.jsx("div",{className:"bg-white p-4 rounded-lg shadow flex flex-col overflow-hidden",children:l.jsx(wp,{segments:s,parameters:i,selectedSegmentIds:u,onSegmentSelect:F,cviScores:S,selectedFormula:b,cviStatistics:Fa})})]})," "]})}const jp=()=>{const e=[{label:"Very Low",rank:1,color:"bg-green-600",border:"border-green-700"},{label:"Low",rank:2,color:"bg-lime-500",border:"border-lime-600"},{label:"Moderate",rank:3,color:"bg-yellow-400",border:"border-yellow-500"},{label:"High",rank:4,color:"bg-orange-500",border:"border-orange-600"},{label:"Very High",rank:5,color:"bg-red-600",border:"border-red-700"},{label:"No Data / Error",rank:0,color:"bg-gray-400",border:"border-gray-500"}];return l.jsx("div",{className:"space-y-2",children:e.map(t=>l.jsxs("div",{className:"flex items-center",children:[l.jsx("span",{className:`w-4 h-4 rounded-full mr-2 flex-shrink-0 ${t.color} border ${t.border}`}),l.jsxs("span",{className:"text-sm text-gray-700",children:[t.label,l.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(Rank ",t.rank>0?t.rank:"N/A",")"]})]})]},t.label))})};function kp(){const e=$e(),[t,s]=g.useState([]),[r,i]=g.useState([]),[n,a]=g.useState(null),[o,c]=g.useState(null),[h,d]=g.useState(!0),[u,f]=g.useState(null);g.useEffect(()=>{(async()=>{d(!0),f(null);try{console.log("Loading data for Results Page...");const w=await ce.getShorelineData("current-segments");if(!w||!w.features||w.features.length===0)throw new Error("No segments found. Please complete previous steps.");const E=w.features.filter(C=>{var R;return C&&C.geometry&&(C.geometry.type==="LineString"||C.geometry.type==="MultiLineString")&&((R=C.properties)==null?void 0:R.vulnerabilityIndex)!==void 0}).map((C,R)=>{const k=C.properties||{};return{id:k.id||`segment-${R+1}`,type:"Feature",geometry:C.geometry,properties:{...k,id:k.id||`segment-${R+1}`,vulnerabilityIndex:k.vulnerabilityIndex,vulnerabilityFormula:k.vulnerabilityFormula,parameters:k.parameters||{}},parameters:k.parameters||{}}});if(E.length===0)throw new Error("No segments with calculated CVI scores found. Please calculate CVI first.");console.log(`Loaded ${E.length} segments with CVI scores.`),s(E);const b=E.find(C=>C.properties.vulnerabilityFormula);if(b!=null&&b.properties.vulnerabilityFormula){const C=Rs.find(R=>R.type===b.properties.vulnerabilityFormula);C?(console.log(`Determined used formula: ${C.name}`),a(C)):console.warn(`Unknown formula type found in segments: ${b.properties.vulnerabilityFormula}`)}else console.warn("Could not determine the CVI formula used from segment data.");const M=await ce.getShorelineData("current-parameters");if(M&&M.features){const C=M.features.map(R=>R.properties).filter(R=>R!==null&&R.enabled===!0);i(C),console.log(`Loaded ${C.length} enabled parameters.`)}const S=E.map(C=>({type:"Feature",geometry:C.geometry,properties:{}})),I=Ns(S);try{const C=Vt(I);if(C&&C.length===4&&C.every(R=>isFinite(R))&&C[0]<=C[2]&&C[1]<=C[3]){const R=[[C[1],C[0]],[C[3],C[2]]];c(R),console.log("Calculated map bounds:",R)}else console.warn("Could not calculate valid bounds from segments.")}catch(C){console.error("Error calculating bounds:",C)}}catch(w){console.error("Error loading results data:",w),f(`Failed to load results: ${w instanceof Error?w.message:String(w)}. Please ensure previous steps are completed.`)}finally{d(!1)}})()},[e]);const m=g.useMemo(()=>t.length===0?null:{type:"FeatureCollection",features:t.map(x=>({type:"Feature",geometry:x.geometry,properties:{...x.properties,id:x.id,cviScore:x.properties.vulnerabilityIndex,cviCategory:Pt(x.properties.vulnerabilityIndex??null)}}))},[t]),v=g.useMemo(()=>{const x=t.map(D=>D.properties.vulnerabilityIndex).filter(D=>D!=null);if(x.length===0)return null;const w=Math.min(...x),E=Math.max(...x),M=x.reduce((D,$)=>D+$,0)/x.length;let S=0,I=0,C=0,R=0,k=0;return x.forEach(D=>{const $=Pt(D);$==="Very Low"?S++:$==="Low"?I++:$==="Moderate"?C++:$==="High"?R++:$==="Very High"&&k++}),{min:w.toFixed(2),max:E.toFixed(2),avg:M.toFixed(2),count:x.length,totalSegments:t.length,categories:{veryLow:S,low:I,moderate:C,high:R,veryHigh:k}}},[t]),y=()=>{e("/shoreline")},p=()=>{e("/parameter-assignment")},_=g.useCallback(()=>{if(t.length===0){f("No segment data available to export.");return}f(null);try{const w={type:"FeatureCollection",features:t.map(I=>{const C={...I.properties,cvi_score:I.properties.vulnerabilityIndex,cvi_category:Pt(I.properties.vulnerabilityIndex??null)};return{type:"Feature",geometry:I.geometry,properties:C}})},E=JSON.stringify(w,null,2),b=new Blob([E],{type:"application/geo+json"}),M=URL.createObjectURL(b),S=document.createElement("a");S.href=M,S.download="cvic_results.geojson",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(M),console.log("GeoJSON export triggered.")}catch(x){console.error("Error exporting GeoJSON:",x),f(`Failed to export GeoJSON: ${x instanceof Error?x.message:String(x)}`)}},[t]);return h?l.jsxs("div",{className:"flex items-center justify-center h-screen",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),l.jsx("p",{className:"ml-4 text-gray-600",children:"Loading results..."})]}):l.jsxs("div",{className:"max-w-7xl mx-auto mt-8 px-4",children:[l.jsx("h1",{className:"text-3xl font-bold text-center mb-6 text-gray-800",children:"Coastal Vulnerability Index Results"}),l.jsx(mt,{message:u,onClose:()=>f(null)}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 bg-white p-4 rounded-lg shadow overflow-hidden min-h-[600px] flex flex-col",children:[l.jsx("h2",{className:"text-xl font-semibold mb-3 text-gray-700",children:"Vulnerability Map"}),l.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Shoreline segments colored by calculated CVI score. Click segments for details. Formula used: ",l.jsx("span",{className:"font-medium",children:(n==null?void 0:n.name)||"Unknown"}),"."]}),l.jsx("div",{className:"flex-grow h-full border rounded",children:m?l.jsx(vt,{geoJSON:m,segments:t,parameters:r,selectedSegments:[],selectedParameter:null,selectionPolygons:[],onSegmentSelect:x=>console.log("Segment clicked:",x),onSelectionDelete:()=>{},onAreaSelect:()=>{},isEditing:!1,initialBounds:o,stylingMode:"cvi"}):l.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:u?"Error loading map data.":"No results data to display on map."})})]}),l.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[l.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Summary Statistics"}),v?l.jsxs("div",{className:"space-y-3",children:[l.jsxs("p",{className:"text-sm text-gray-600",children:["Calculated for ",l.jsx("span",{className:"font-medium",children:v.count})," of ",l.jsx("span",{className:"font-medium",children:v.totalSegments})," segments."]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Min CVI"}),l.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.min})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Max CVI"}),l.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.max})]}),l.jsxs("div",{className:"col-span-2",children:[l.jsx("span",{className:"text-xs text-gray-500 uppercase",children:"Average CVI"}),l.jsx("p",{className:"text-lg font-medium text-gray-800",children:v.avg})]})]}),l.jsxs("div",{className:"pt-3 mt-3 border-t",children:[l.jsx("span",{className:"text-xs text-gray-500 uppercase block mb-1",children:"Segment Counts by Category"}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-sm text-green-700",children:"Very Low:"}),l.jsx("span",{className:"font-medium text-gray-800",children:v.categories.veryLow})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-sm text-lime-600",children:"Low:"}),l.jsx("span",{className:"font-medium text-gray-800",children:v.categories.low})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-sm text-yellow-600",children:"Moderate:"}),l.jsx("span",{className:"font-medium text-gray-800",children:v.categories.moderate})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-sm text-orange-600",children:"High:"}),l.jsx("span",{className:"font-medium text-gray-800",children:v.categories.high})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-sm text-red-700",children:"Very High:"}),l.jsx("span",{className:"font-medium text-gray-800",children:v.categories.veryHigh})]})]})]}):l.jsx("p",{className:"text-gray-500",children:"No CVI statistics available."})]}),l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[l.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Map Legend"}),l.jsx(jp,{})]}),l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[l.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Actions"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("button",{onClick:p,className:"w-full px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",title:"Return to the parameter assignment and CVI calculation page",children:"Back to Parameter Assignment"}),l.jsx("button",{onClick:_,disabled:t.length===0||h,className:"w-full px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Download the results as a GeoJSON file",children:"Export Results (GeoJSON)"}),l.jsx("button",{onClick:y,className:"w-full px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",title:"Start a new analysis from the beginning (clears current data)",children:"Start New Analysis"})]})]})]})]})]})}function Qe({children:e}){const{user:t,loading:s}=ks();return s?l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}):t?l.jsx(l.Fragment,{children:e}):l.jsx(Wa,{to:"/login",replace:!0})}const Pp=qa([{path:"/",element:l.jsx(Jh,{children:l.jsx(Wh,{})}),errorElement:l.jsx("div",{children:"Something went wrong"}),children:[{index:!0,element:l.jsx(Su,{})},{path:"login",element:l.jsx(Nu,{})},{path:"shoreline",element:l.jsx(Qe,{children:l.jsx(dp,{})})},{path:"segmentation",element:l.jsx(Qe,{children:l.jsx(mp,{})})},{path:"segment-table",element:l.jsx(Qe,{children:l.jsx(gp,{})})},{path:"parameter-selection",element:l.jsx(Qe,{children:l.jsx(vp,{})})},{path:"parameter-assignment",element:l.jsx(Qe,{children:l.jsx(Ap,{})})},{path:"results",element:l.jsx(Qe,{children:l.jsx(kp,{})})}]}]),Tp=()=>l.jsx(Ja,{router:Pp});er.createRoot(document.getElementById("root")).render(l.jsx(Ka.StrictMode,{children:l.jsx(Hh,{children:l.jsx(Tp,{})})}))});export default Rp();
//# sourceMappingURL=index-BHplsXbz.js.map
